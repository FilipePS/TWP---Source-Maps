{"version":3,"file":"../../popup/popup-translate-document.js","names":["send","document","getElementById","error","selectService","pleaseWait","googleTranslate","cannotUseGoogle","cannotDownload","conversion","conversionAlert","showError","e","console","style","display","downloadDocument","url","Promise","resolve","reject","http","XMLHttpRequest","open","responseType","onprogress","lengthComputable","percentComplete","loaded","total","textContent","chrome","i18n","getMessage","toFixed","onload","target","response","onerror","convertDocument","service","data","file","File","type","lastModified","Date","now","container","DataTransfer","items","add","myForm","querySelector","files","value","twpConfig","get","onclick","click","window","close","dataset","name","tabs","query","active","currentWindow","startsWith","create","byteLength","$","bind","disableDarkMode","el","createElement","setAttribute","head","appendChild","enableDarkMode","remove","onReady","matchMedia","matches"],"sources":["popup-translate-document.js"],"sourcesContent":["const send = document.getElementById(\"send\");\r\nconst error = document.getElementById(\"error\");\r\nconst selectService = document.getElementById(\"selectService\");\r\nconst pleaseWait = document.getElementById(\"pleasewait\");\r\nconst googleTranslate = document.getElementById(\"googletranslate\");\r\nconst cannotUseGoogle = document.getElementById(\"cannotusegoogle\");\r\nconst cannotDownload = document.getElementById(\"cannotDownload\");\r\nconst conversion = document.getElementById(\"conversion\");\r\nconst conversionAlert = document.getElementById(\"conversionalert\");\r\n\r\nasync function showError(e) {\r\n  console.error(e);\r\n  selectService.style.display = \"none\";\r\n  conversion.style.display = \"none\";\r\n  conversionAlert.style.display = \"none\";\r\n  pleaseWait.style.display = \"none\";\r\n  cannotDownload.style.display = \"block\";\r\n}\r\n\r\nasync function downloadDocument(url) {\r\n  return new Promise((resolve, reject) => {\r\n    try {\r\n      const http = new XMLHttpRequest();\r\n      http.open(\"get\", url, true);\r\n      http.responseType = \"arraybuffer\";\r\n      http.onprogress = (e) => {\r\n        if (e.lengthComputable) {\r\n          const percentComplete = (e.loaded / e.total) * 100;\r\n          pleaseWait.textContent =\r\n            chrome.i18n.getMessage(\"msgPleaseWait\") +\r\n            \" \" +\r\n            percentComplete.toFixed(1) +\r\n            \"%\";\r\n        }\r\n      };\r\n      http.onload = (e) => {\r\n        resolve(e.target.response);\r\n      };\r\n      http.onerror = (e) => {\r\n        showError(e);\r\n        reject(e);\r\n      };\r\n      http.send();\r\n    } catch (e) {\r\n      showError(e);\r\n    }\r\n  });\r\n}\r\n\r\nasync function convertDocument(service, data) {\r\n  const file = new File([data], \"document.pdf\", {\r\n    type: \"application/pdf\",\r\n    lastModified: Date.now(),\r\n  });\r\n  const container = new DataTransfer();\r\n  container.items.add(file);\r\n  const myForm = document.getElementById(\"form_\" + service);\r\n  myForm.querySelector('[type=\"file\"]').files = container.files;\r\n  if (myForm.querySelector('[name=\"tl\"]')) {\r\n    myForm.querySelector('[name=\"tl\"]').value = twpConfig.get(\"targetLanguage\");\r\n  }\r\n  pleaseWait.style.display = \"none\";\r\n  send.style.display = \"block\";\r\n  send.onclick = (e) => {\r\n    myForm.querySelector('[type=\"submit\"]').click();\r\n    window.close();\r\n  };\r\n}\r\n\r\nselectService.onclick = async (e) => {\r\n  if (\r\n    e.target.dataset.name == \"google\" ||\r\n    e.target.dataset.name == \"translatewebpages\"\r\n  ) {\r\n    selectService.style.display = \"none\";\r\n    pleaseWait.style.display = \"block\";\r\n    conversion.style.display = \"none\";\r\n    conversionAlert.style.display = \"none\";\r\n    cannotUseGoogle.style.display = \"none\";\r\n    chrome.tabs.query({ active: true, currentWindow: true }, async (tabs) => {\r\n      try {\r\n        const service = e.target.dataset.name;\r\n        if (tabs[0].url.startsWith(\"file:\")) {\r\n          if (service == \"google\") {\r\n            chrome.tabs.create({\r\n              url: \"https://translate.google.com/?op=docs\",\r\n            });\r\n          } else {\r\n            chrome.tabs.create({ url: \"https://translatewebpages.org/\" });\r\n          }\r\n          return window.close();\r\n        }\r\n        const data = await downloadDocument(tabs[0].url);\r\n        pleaseWait.style.display = \"none\";\r\n        if (data.byteLength > 1024 * 1024 * 10 && service == \"google\") {\r\n          conversion.style.display = \"block\";\r\n          conversionAlert.style.display = \"block\";\r\n          googleTranslate.style.display = \"none\";\r\n          selectService.style.display = \"block\";\r\n          cannotUseGoogle.textContent = chrome.i18n.getMessage(\r\n            \"msgFileLargerThan\",\r\n            \"10 MB\"\r\n          );\r\n          cannotUseGoogle.style.display = \"block\";\r\n        } else {\r\n          convertDocument(service, data);\r\n        }\r\n      } catch (e) {\r\n        showError(e);\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\n$ = document.querySelector.bind(document);\r\n\r\nfunction disableDarkMode() {\r\n  if (!$(\"#lightModeElement\")) {\r\n    const el = document.createElement(\"style\");\r\n    el.setAttribute(\"id\", \"lightModeElement\");\r\n    el.setAttribute(\"rel\", \"stylesheet\");\r\n    el.textContent = `\r\n        body {\r\n            color: rgb(0, 0, 0);\r\n            background-color: rgb(224, 224, 224);\r\n        }\r\n        .servicebutton, .sendbutton, .title {\r\n            background-color: rgba(0, 0, 0, 0.2);\r\n        }\r\n        \r\n        .servicebutton:hover, .sendbutton:hover {\r\n            background-color: rgba(0, 0, 0, 0.4);\r\n        }\r\n        `;\r\n    document.head.appendChild(el);\r\n  }\r\n}\r\n\r\nfunction enableDarkMode() {\r\n  if ($(\"#lightModeElement\")) $(\"#lightModeElement\").remove();\r\n}\r\n\r\ntwpConfig.onReady(() => {\r\n  switch (twpConfig.get(\"darkMode\")) {\r\n    case \"auto\":\r\n      if (matchMedia(\"(prefers-color-scheme: dark)\").matches) enableDarkMode();\r\n      else disableDarkMode();\r\n      break;\r\n    case \"yes\":\r\n      enableDarkMode();\r\n      break;\r\n    case \"no\":\r\n      disableDarkMode();\r\n      break;\r\n  }\r\n});\r\n"],"mappings":"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"}
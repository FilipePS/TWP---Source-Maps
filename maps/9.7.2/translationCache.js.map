{"version":3,"file":"../../background/translationCache.js","names":["_classPrivateMethodInitSpec","obj","privateSet","_checkPrivateRedeclaration","add","privateCollection","has","TypeError","_classPrivateMethodGet","receiver","fn","translationCache","Utils","getTableSize","db","storageName","Promise","resolve","reject","size","transaction","objectStore","openCursor","onsuccess","event","cursor","result","storedObject","value","json","JSON","stringify","length","continue","onerror","err","getDatabaseSize","dbName","request","indexedDB","open","onblocked","console","error","tableNames","objectStoreNames","tableSizeGetters","reduce","acc","tableName","push","all","then","sizes","total","val","catch","e","close","humanReadableSize","bytes","thresh","Math","abs","units","u","toFixed","stringToSHA1String","message","msgUint8","TextEncoder","encode","hashBuffer","crypto","subtle","digest","hashArray","Array","from","Uint8Array","map","b","toString","padStart","join","_queryInDB","WeakSet","_addInDb","Cache","constructor","translationService","sourceLanguage","targetLanguage","cache","Map","promiseStartingCache","start","openDataBaseCache","deleteDatabase","query","originalText","hash","translation","get","_queryInDB2","call","set","translatedText","detectedLanguage","_addInDb2","key","getDataBaseName","getCacheStorageName","openIndexeddb","name","version","objectStorageNames","info","onupgradeneeded","createObjectStore","keyPath","origTextHash","data","put","_openCacheList","_addCacheList","_createCache","_addCache","_getAllDBNames","CacheList","list","_openCacheList2","getCache","_createCache2","deleteAll","promises","forEach","clear","dbnames","_getAllDBNames2","DBDeleteRequest","warn","calculateSize","results","dbCacheList","_addCacheList2","_addCache2","getAllKeys","cacheList","deleteTranslationCache","reload","chrome","runtime","promiseCalculatingStorage","onMessage","addListener","sender","sendResponse","action"],"sources":["translationCache.js"],"sourcesContent":["\"use strict\";\r\n\r\nconst translationCache = (function () {\r\n  const translationCache = {};\r\n\r\n  /**\r\n   * @typedef {Object} CacheEntry\r\n   * @property {String} originalText\r\n   * @property {String} translatedText\r\n   * @property {String} detectedLanguage\r\n   * @property {String} key\r\n   */\r\n\r\n  class Utils {\r\n    /**\r\n     * Returns the size of a ObjectStorage\r\n     * @param {IDBDatabase} db\r\n     * @param {string} storageName\r\n     * @returns {Promise<number>} Promise\\<size\\>\r\n     */\r\n    static async getTableSize(db, storageName) {\r\n      return await new Promise((resolve, reject) => {\r\n        if (db == null) return reject();\r\n        let size = 0;\r\n        const transaction = db\r\n          .transaction([storageName])\r\n          .objectStore(storageName)\r\n          .openCursor();\r\n\r\n        transaction.onsuccess = (event) => {\r\n          const cursor = transaction.result;\r\n          if (cursor) {\r\n            const storedObject = cursor.value;\r\n            const json = JSON.stringify(storedObject);\r\n            size += json.length;\r\n            cursor.continue();\r\n          } else {\r\n            resolve(size);\r\n          }\r\n        };\r\n        transaction.onerror = (err) =>\r\n          reject(\"error in \" + storageName + \": \" + err);\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Returns the size of a database\r\n     * @param {string} dbName\r\n     * @returns {Promise<number>} Promise\\<size\\>\r\n     */\r\n    static async getDatabaseSize(dbName) {\r\n      return await new Promise((resolve, reject) => {\r\n        const request = indexedDB.open(dbName);\r\n        request.onerror = request.onblocked = (event) => {\r\n          console.error(event);\r\n          reject();\r\n        };\r\n        request.onsuccess = (event) => {\r\n          try {\r\n            const db = request.result;\r\n            const tableNames = [...db.objectStoreNames];\r\n            ((tableNames, db) => {\r\n              const tableSizeGetters = tableNames.reduce((acc, tableName) => {\r\n                acc.push(Utils.getTableSize(db, tableName));\r\n                return acc;\r\n              }, []);\r\n\r\n              Promise.all(tableSizeGetters)\r\n                .then((sizes) => {\r\n                  const total = sizes.reduce((acc, val) => acc + val, 0);\r\n                  resolve(total);\r\n                })\r\n                .catch((e) => {\r\n                  console.error(e);\r\n                  reject();\r\n                });\r\n            })(tableNames, db);\r\n          } finally {\r\n            request.result.close();\r\n          }\r\n        };\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Converts a size in bytes to a human-readable string.\r\n     * @example\r\n     * humanReadableSize(1024)\r\n     * // returns \"1.0KB\"\r\n     * @param {number} bytes\r\n     * @returns {string} sizeString\r\n     */\r\n    static humanReadableSize(bytes) {\r\n      const thresh = 1024;\r\n      if (Math.abs(bytes) < thresh) {\r\n        return bytes + \" B\";\r\n      }\r\n      const units = [\"KB\", \"MB\", \"GB\", \"TB\", \"PB\", \"EB\", \"ZB\", \"YB\"];\r\n      let u = -1;\r\n      do {\r\n        bytes /= thresh;\r\n        ++u;\r\n      } while (Math.abs(bytes) >= thresh && u < units.length - 1);\r\n      return bytes.toFixed(1) + \" \" + units[u];\r\n    }\r\n\r\n    /**\r\n     * Returns a Promise that resolves to a sha1 string of the given text.\r\n     * @example\r\n     * await stringToSHA1String(\"Hello World!\")\r\n     * // returns \"2ef7bde608ce5404e97d5f042f95f89f1c232871\"\r\n     * @param {string} message text\r\n     * @returns {Promise<string>} Promise\\<sha1String\\>\r\n     */\r\n    static async stringToSHA1String(message) {\r\n      const msgUint8 = new TextEncoder().encode(message); // encode as (utf-8) Uint8Array\r\n      const hashBuffer = await crypto.subtle.digest(\"SHA-1\", msgUint8); // hash the message\r\n      const hashArray = Array.from(new Uint8Array(hashBuffer)); // convert buffer to byte array\r\n      return hashArray.map((b) => b.toString(16).padStart(2, \"0\")).join(\"\"); // convert bytes to hex string\r\n    }\r\n  }\r\n\r\n  class Cache {\r\n    /**\r\n     * Base class to create a translation cache for different services.\r\n     * @param {string} translationService\r\n     * @param {string} sourceLanguage\r\n     * @param {string} targetLanguage\r\n     */\r\n    constructor(translationService, sourceLanguage, targetLanguage) {\r\n      /** @type {string} */\r\n      this.translationService = translationService;\r\n      /** @type {string} */\r\n      this.sourceLanguage = sourceLanguage;\r\n      /** @type {string} */\r\n      this.targetLanguage = targetLanguage;\r\n      /** @type {Map<string, CacheEntry>} */\r\n      this.cache = new Map();\r\n      /** @type {Promise<boolean>} */\r\n      this.promiseStartingCache = null;\r\n    }\r\n\r\n    /**\r\n     * Start the translation cache\r\n     * @returns {Promise<boolean>}\r\n     */\r\n    async start() {\r\n      if (this.promiseStartingCache) return await this.promiseStartingCache;\r\n      this.promiseStartingCache = new Promise((resolve) => {\r\n        Cache.openDataBaseCache(\r\n          this.translationService,\r\n          this.sourceLanguage,\r\n          this.targetLanguage\r\n        )\r\n          .then((db) => {\r\n            this.db = db;\r\n            resolve(true);\r\n          })\r\n          .catch((e) => {\r\n            console.error(e);\r\n            Cache.deleteDatabase(\r\n              this.translationService,\r\n              this.sourceLanguage,\r\n              this.targetLanguage\r\n            );\r\n            resolve(false);\r\n          });\r\n      });\r\n      return await this.promiseStartingCache;\r\n    }\r\n\r\n    /**\r\n     * Closes the database.\r\n     */\r\n    close() {\r\n      if (this.db) this.db.close();\r\n      this.db = null;\r\n    }\r\n\r\n    /**\r\n     * Queries an entry in the translation cache, through the hash of the source text.\r\n     * @param {string} origTextHash\r\n     * @returns {Promise<CacheEntry>}\r\n     */\r\n    async #queryInDB(origTextHash) {\r\n      return await new Promise((resolve, reject) => {\r\n        if (!this.db) return reject();\r\n\r\n        const storageName = Cache.getCacheStorageName();\r\n        const objectStore = this.db\r\n          .transaction([storageName], \"readonly\")\r\n          .objectStore(storageName);\r\n        const request = objectStore.get(origTextHash);\r\n\r\n        request.onsuccess = (event) => {\r\n          const result = request.result;\r\n          resolve(result);\r\n        };\r\n\r\n        request.onerror = (event) => {\r\n          console.error(event);\r\n          reject();\r\n        };\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Query translation cache data\r\n     * @param {string} originalText\r\n     * @returns {Promise<CacheEntry>}\r\n     */\r\n    async query(originalText) {\r\n      const hash = await Utils.stringToSHA1String(originalText);\r\n\r\n      let translation = this.cache.get(hash);\r\n      if (translation) return translation;\r\n\r\n      translation = await this.#queryInDB(hash);\r\n      if (translation) this.cache.set(hash, translation);\r\n\r\n      return translation;\r\n    }\r\n\r\n    /**\r\n     * Store the data in the database\r\n     * @param {CacheEntry} data\r\n     * @returns {Promise<boolean>}\r\n     */\r\n    async #addInDb(data) {\r\n      return await new Promise((resolve) => {\r\n        if (!this.db) return resolve(false);\r\n\r\n        const storageName = Cache.getCacheStorageName();\r\n        const objectStore = this.db\r\n          .transaction([storageName], \"readwrite\")\r\n          .objectStore(storageName);\r\n        const request = objectStore.put(data);\r\n\r\n        request.onsuccess = (event) => {\r\n          resolve(true);\r\n        };\r\n\r\n        request.onerror = (event) => {\r\n          console.error(event);\r\n          resolve(false);\r\n        };\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Add to translation cache\r\n     * @param {string} originalText\r\n     * @param {string} translatedText\r\n     * @param {string} detectedLanguage\r\n     * @returns {Promise<boolean>}\r\n     */\r\n    async add(originalText, translatedText, detectedLanguage = \"und\") {\r\n      const hash = await Utils.stringToSHA1String(originalText);\r\n      return await this.#addInDb({\r\n        originalText,\r\n        translatedText,\r\n        detectedLanguage,\r\n        key: hash,\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Returns the name of the database using the given data.\r\n     * @example\r\n     * getDataBaseName(\"google\", \"de\", \"en\")\r\n     * // returns \"google@de.en\"\r\n     * @param {string} translationService\r\n     * @param {string} sourceLanguage\r\n     * @param {string} targetLanguage\r\n     * @returns {string} databaseName\r\n     */\r\n    static getDataBaseName(translationService, sourceLanguage, targetLanguage) {\r\n      return `${translationService}@${sourceLanguage}.${targetLanguage}`;\r\n    }\r\n\r\n    /**\r\n     * Returns the storageName\r\n     * @example\r\n     * getCacheStorageName()\r\n     * // returns \"cache\"\r\n     * @returns {string} storageName\r\n     */\r\n    static getCacheStorageName() {\r\n      return \"cache\";\r\n    }\r\n\r\n    /**\r\n     * Start/create a database with the given data.\r\n     * @param {string} name\r\n     * @param {number} version\r\n     * @param {string[]} objectStorageNames\r\n     * @returns {Promise<IDBDatabase>}\r\n     */\r\n    static async openIndexeddb(name, version, objectStorageNames) {\r\n      return await new Promise((resolve, reject) => {\r\n        const request = indexedDB.open(name, version);\r\n\r\n        request.onsuccess = (event) => {\r\n          console.info(request.result);\r\n          resolve(request.result);\r\n        };\r\n\r\n        request.onerror = request.onblocked = (event) => {\r\n          console.error(\r\n            \"Error opening the database, switching to non-database mode\",\r\n            event\r\n          );\r\n          reject();\r\n        };\r\n\r\n        request.onupgradeneeded = (event) => {\r\n          const db = request.result;\r\n\r\n          for (const storageName of objectStorageNames) {\r\n            db.createObjectStore(storageName, {\r\n              keyPath: \"key\",\r\n            });\r\n          }\r\n        };\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Start/create a database for the translation cache with the given data.\r\n     * @param {string} translationService\r\n     * @param {string} sourceLanguage\r\n     * @param {string} targetLanguage\r\n     * @returns {Promise<IDBDatabase>}\r\n     */\r\n    static async openDataBaseCache(\r\n      translationService,\r\n      sourceLanguage,\r\n      targetLanguage\r\n    ) {\r\n      const dbName = Cache.getDataBaseName(\r\n        translationService,\r\n        sourceLanguage,\r\n        targetLanguage\r\n      );\r\n      const storageName = Cache.getCacheStorageName();\r\n      const db = await Cache.openIndexeddb(dbName, 1, [storageName]);\r\n      return db;\r\n    }\r\n\r\n    /**\r\n     * Delete a database.\r\n     * @param {string} translationService\r\n     * @param {string} sourceLanguage\r\n     * @param {string} targetLanguage\r\n     * @returns {Promise<boolean>}\r\n     */\r\n    static async deleteDatabase(\r\n      translationService,\r\n      sourceLanguage,\r\n      targetLanguage\r\n    ) {\r\n      return await new Promise((resolve) => {\r\n        try {\r\n          const dbName = Cache.getDataBaseName(\r\n            translationService,\r\n            sourceLanguage,\r\n            targetLanguage\r\n          );\r\n          const request = indexedDB.deleteDatabase(dbName);\r\n\r\n          request.onsuccess = (event) => {\r\n            resolve(true);\r\n          };\r\n\r\n          request.onerror = (event) => {\r\n            console.error(event);\r\n            resolve(false);\r\n          };\r\n        } catch (e) {\r\n          console.error(e);\r\n          resolve(false);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  class CacheList {\r\n    /**\r\n     * Defines a translation cache manager.\r\n     */\r\n    constructor() {\r\n      /** @type {Map<string, Cache>} */\r\n      this.list = new Map();\r\n      try {\r\n        this.#openCacheList();\r\n      } catch (e) {\r\n        console.error(e);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Starts the connection to the database cacheList.\r\n     */\r\n    #openCacheList() {\r\n      const request = indexedDB.open(\"cacheList\", 1);\r\n\r\n      request.onsuccess = (event) => {\r\n        this.dbCacheList = request.result;\r\n\r\n        // If any translation cache was created while waiting for the cacheList to be created.\r\n        // Then add all these entries to the cacheList.\r\n        this.list.forEach((cache, key) => {\r\n          this.#addCacheList(key);\r\n        });\r\n      };\r\n\r\n      request.onerror = request.onblocked = (event) => {\r\n        console.error(\"Error opening the database\", event);\r\n        this.dbCacheList = null;\r\n      };\r\n\r\n      request.onupgradeneeded = (event) => {\r\n        const db = request.result;\r\n\r\n        db.createObjectStore(\"cache_list\", {\r\n          keyPath: \"dbName\",\r\n        });\r\n      };\r\n    }\r\n\r\n    /**\r\n     * Stores a new translation cache name to cacheList.\r\n     * @param {string} dbName\r\n     */\r\n    #addCacheList(dbName) {\r\n      if (!this.dbCacheList) return;\r\n\r\n      const storageName = \"cache_list\";\r\n      const objectStore = this.dbCacheList\r\n        .transaction([storageName], \"readwrite\")\r\n        .objectStore(storageName);\r\n      const request = objectStore.put({ dbName });\r\n\r\n      request.onsuccess = (event) => {};\r\n\r\n      request.onerror = (event) => {\r\n        console.error(event);\r\n      };\r\n    }\r\n\r\n    /**\r\n     * Create and start a translation cache then add to cacheList.\r\n     * @param {string} translationService\r\n     * @param {string} sourceLanguage\r\n     * @param {string} targetLanguage\r\n     * @returns {Promise<Cache>}\r\n     */\r\n    async #createCache(translationService, sourceLanguage, targetLanguage) {\r\n      const cache = new Cache(\r\n        translationService,\r\n        sourceLanguage,\r\n        targetLanguage\r\n      );\r\n      this.#addCache(translationService, sourceLanguage, targetLanguage, cache);\r\n      try {\r\n        await cache.start();\r\n      } catch (e) {\r\n        console.error(e);\r\n      }\r\n      return cache;\r\n    }\r\n\r\n    /**\r\n     * Get a translation cache from the given data.\r\n     * If the translation cache does not exist, create a new one.\r\n     * @param {string} translationService\r\n     * @param {string} sourceLanguage\r\n     * @param {string} targetLanguage\r\n     * @returns {Promise<Cache>}\r\n     */\r\n    async getCache(translationService, sourceLanguage, targetLanguage) {\r\n      const dbName = Cache.getDataBaseName(\r\n        translationService,\r\n        sourceLanguage,\r\n        targetLanguage\r\n      );\r\n      const cache = this.list.get(dbName);\r\n      if (cache) {\r\n        await cache.promiseStartingCache;\r\n        return cache;\r\n      } else {\r\n        return await this.#createCache(\r\n          translationService,\r\n          sourceLanguage,\r\n          targetLanguage\r\n        );\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Adds a new translation cache name to the \"list\" and if possible stores it in the cacheList database.\r\n     * @param {string} translationService\r\n     * @param {string} sourceLanguage\r\n     * @param {string} targetLanguage\r\n     * @param {Cache} cache\r\n     */\r\n    #addCache(translationService, sourceLanguage, targetLanguage, cache) {\r\n      const dbName = Cache.getDataBaseName(\r\n        translationService,\r\n        sourceLanguage,\r\n        targetLanguage\r\n      );\r\n      this.list.set(dbName, cache);\r\n      try {\r\n        this.#addCacheList(dbName);\r\n      } catch {}\r\n    }\r\n\r\n    /**\r\n     * Get the name of all translation caches.\r\n     * @example\r\n     * #getAllDBNames()\r\n     * // returns [\"google@de.en\", \"google@zh-CN.es\", \"yandex@ru.pt\"]\r\n     * @returns {Promise<string[]>}\r\n     */\r\n    async #getAllDBNames() {\r\n      if (!this.dbCacheList) return [];\r\n      return await new Promise((resolve) => {\r\n        const storageName = \"cache_list\";\r\n        const objectStore = this.dbCacheList\r\n          .transaction([storageName], \"readonly\")\r\n          .objectStore(storageName);\r\n        const request = objectStore.getAllKeys();\r\n\r\n        request.onsuccess = (event) => {\r\n          // TODO this cast is realy necessary?\r\n          //cast\r\n          resolve(/** @type {string[]} */ (request.result));\r\n        };\r\n\r\n        request.onerror = (event) => {\r\n          console.error(event);\r\n          resolve([]);\r\n        };\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Delete all translation caches.\r\n     * And clear the cache list.\r\n     * @returns {Promise<boolean>}\r\n     */\r\n    async deleteAll() {\r\n      try {\r\n        /** @type {Array<Promise>} */\r\n        const promises = [];\r\n        this.list.forEach((cache, key) => {\r\n          if (cache) cache.close();\r\n          promises.push(CacheList.deleteDatabase(key));\r\n        });\r\n        this.list.clear();\r\n        const dbnames = await this.#getAllDBNames();\r\n        dbnames.forEach((dbName) => {\r\n          promises.push(CacheList.deleteDatabase(dbName));\r\n        });\r\n        await Promise.all(promises);\r\n        return true;\r\n      } catch (e) {\r\n        console.error(e);\r\n        return false;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Delete a database by its name.\r\n     * @returns {Promise<boolean>}\r\n     */\r\n    static async deleteDatabase(dbName) {\r\n      return await new Promise((resolve) => {\r\n        const DBDeleteRequest = indexedDB.deleteDatabase(dbName);\r\n\r\n        DBDeleteRequest.onsuccess = () => {\r\n          console.info(\"Database deleted successfully\");\r\n          resolve(true);\r\n        };\r\n\r\n        DBDeleteRequest.onerror = () => {\r\n          console.warn(\"Error deleting database.\");\r\n          resolve(false);\r\n        };\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Gets the sum of the size of all translation caches.\r\n     * @example\r\n     * await calculateSize()\r\n     * // returns \"1.0MB\"\r\n     * @returns {Promise<string>}\r\n     */\r\n    async calculateSize() {\r\n      try {\r\n        /** @type {Array<Promise>} */\r\n        const promises = [];\r\n        const dbnames = await this.#getAllDBNames();\r\n        dbnames.forEach((dbName) => {\r\n          promises.push(Utils.getDatabaseSize(dbName));\r\n        });\r\n        const results = await Promise.all(promises);\r\n        return Utils.humanReadableSize(\r\n          results.reduce((total, size) => total + size, 0)\r\n        );\r\n      } catch (e) {\r\n        console.error(e);\r\n        return Utils.humanReadableSize(0);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Create a translation cache list.\r\n  const cacheList = new CacheList();\r\n\r\n  /**\r\n   * Get a new translation cache entry.\r\n   * @param {string} translationService\r\n   * @param {string} sourceLanguage\r\n   * @param {string} targetLanguage\r\n   * @param {string} originalText\r\n   * @returns {Promise<CacheEntry>} cacheEntry\r\n   */\r\n  translationCache.get = async (\r\n    translationService,\r\n    sourceLanguage,\r\n    targetLanguage,\r\n    originalText\r\n  ) => {\r\n    try {\r\n      const cache = await cacheList.getCache(\r\n        translationService,\r\n        sourceLanguage,\r\n        targetLanguage\r\n      );\r\n      return await cache.query(originalText);\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Defines a new entry in the translation cache.\r\n   * @param {string} translationService\r\n   * @param {string} sourceLanguage\r\n   * @param {string} targetLanguage\r\n   * @param {string} originalText\r\n   * @param {string} translatedText\r\n   * @param {string} detectedLanguage\r\n   * @returns {Promise<boolean>}\r\n   */\r\n  translationCache.set = async (\r\n    translationService,\r\n    sourceLanguage,\r\n    targetLanguage,\r\n    originalText,\r\n    translatedText,\r\n    detectedLanguage\r\n  ) => {\r\n    try {\r\n      const cache = await cacheList.getCache(\r\n        translationService,\r\n        sourceLanguage,\r\n        targetLanguage\r\n      );\r\n      return await cache.add(originalText, translatedText, detectedLanguage);\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Delete all translation caches.\r\n   * If `reload` is `true` reloads the extension after deleting caches.\r\n   * @param {boolean} reload\r\n   */\r\n  translationCache.deleteTranslationCache = async (reload = false) => {\r\n    try {\r\n      // Deletes old translation cache.\r\n      if (indexedDB && indexedDB.deleteDatabase) {\r\n        indexedDB.deleteDatabase(\"googleCache\");\r\n        indexedDB.deleteDatabase(\"yandexCache\");\r\n        indexedDB.deleteDatabase(\"bingCache\");\r\n      }\r\n      // Delete the new translation cache.\r\n      await cacheList.deleteAll();\r\n    } catch (e) {\r\n      console.error(e);\r\n    } finally {\r\n      if (reload) chrome.runtime.reload();\r\n    }\r\n  };\r\n\r\n  let promiseCalculatingStorage = null;\r\n  chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\r\n    if (request.action === \"getCacheSize\") {\r\n      if (!promiseCalculatingStorage) {\r\n        promiseCalculatingStorage = cacheList.calculateSize();\r\n      }\r\n\r\n      promiseCalculatingStorage\r\n        .then((size) => {\r\n          promiseCalculatingStorage = null;\r\n          sendResponse(size);\r\n          return size;\r\n        })\r\n        .catch((e) => {\r\n          console.error(e);\r\n          promiseCalculatingStorage = null;\r\n          sendResponse(\"0B\");\r\n          return \"0B\";\r\n        });\r\n      return true;\r\n    } else if (request.action === \"deleteTranslationCache\") {\r\n      translationCache.deleteTranslationCache(request.reload);\r\n    }\r\n  });\r\n\r\n  return translationCache;\r\n})();\r\n"],"mappings":"AAAA,YAAY;;AAAC,SAAAA,4BAAAC,GAAA,EAAAC,UAAA,IAAAC,0BAAA,CAAAF,GAAA,EAAAC,UAAA,GAAAA,UAAA,CAAAE,GAAA,CAAAH,GAAA;AAAA,SAAAE,2BAAAF,GAAA,EAAAI,iBAAA,QAAAA,iBAAA,CAAAC,GAAA,CAAAL,GAAA,eAAAM,SAAA;AAAA,SAAAC,uBAAAC,QAAA,EAAAP,UAAA,EAAAQ,EAAA,SAAAR,UAAA,CAAAI,GAAA,CAAAG,QAAA,eAAAF,SAAA,6DAAAG,EAAA;AAEb,MAAMC,gBAAgB,GAAI,YAAY;EACpC,MAAMA,gBAAgB,GAAG,CAAC,CAAC;;EAE3B;AACF;AACA;AACA;AACA;AACA;AACA;;EAEE,MAAMC,KAAK,CAAC;IACV;AACJ;AACA;AACA;AACA;AACA;IACI,aAAaC,YAAYA,CAACC,EAAE,EAAEC,WAAW,EAAE;MACzC,OAAO,MAAM,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;QAC5C,IAAIJ,EAAE,IAAI,IAAI,EAAE,OAAOI,MAAM,EAAE;QAC/B,IAAIC,IAAI,GAAG,CAAC;QACZ,MAAMC,WAAW,GAAGN,EAAE,CACnBM,WAAW,CAAC,CAACL,WAAW,CAAC,CAAC,CAC1BM,WAAW,CAACN,WAAW,CAAC,CACxBO,UAAU,EAAE;QAEfF,WAAW,CAACG,SAAS,GAAIC,KAAK,IAAK;UACjC,MAAMC,MAAM,GAAGL,WAAW,CAACM,MAAM;UACjC,IAAID,MAAM,EAAE;YACV,MAAME,YAAY,GAAGF,MAAM,CAACG,KAAK;YACjC,MAAMC,IAAI,GAAGC,IAAI,CAACC,SAAS,CAACJ,YAAY,CAAC;YACzCR,IAAI,IAAIU,IAAI,CAACG,MAAM;YACnBP,MAAM,CAACQ,QAAQ,EAAE;UACnB,CAAC,MAAM;YACLhB,OAAO,CAACE,IAAI,CAAC;UACf;QACF,CAAC;QACDC,WAAW,CAACc,OAAO,GAAIC,GAAG,IACxBjB,MAAM,CAAC,WAAW,GAAGH,WAAW,GAAG,IAAI,GAAGoB,GAAG,CAAC;MAClD,CAAC,CAAC;IACJ;;IAEA;AACJ;AACA;AACA;AACA;IACI,aAAaC,eAAeA,CAACC,MAAM,EAAE;MACnC,OAAO,MAAM,IAAIrB,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;QAC5C,MAAMoB,OAAO,GAAGC,SAAS,CAACC,IAAI,CAACH,MAAM,CAAC;QACtCC,OAAO,CAACJ,OAAO,GAAGI,OAAO,CAACG,SAAS,GAAIjB,KAAK,IAAK;UAC/CkB,OAAO,CAACC,KAAK,CAACnB,KAAK,CAAC;UACpBN,MAAM,EAAE;QACV,CAAC;QACDoB,OAAO,CAACf,SAAS,GAAIC,KAAK,IAAK;UAC7B,IAAI;YACF,MAAMV,EAAE,GAAGwB,OAAO,CAACZ,MAAM;YACzB,MAAMkB,UAAU,GAAG,CAAC,GAAG9B,EAAE,CAAC+B,gBAAgB,CAAC;YAC3C,CAAC,CAACD,UAAU,EAAE9B,EAAE,KAAK;cACnB,MAAMgC,gBAAgB,GAAGF,UAAU,CAACG,MAAM,CAAC,CAACC,GAAG,EAAEC,SAAS,KAAK;gBAC7DD,GAAG,CAACE,IAAI,CAACtC,KAAK,CAACC,YAAY,CAACC,EAAE,EAAEmC,SAAS,CAAC,CAAC;gBAC3C,OAAOD,GAAG;cACZ,CAAC,EAAE,EAAE,CAAC;cAENhC,OAAO,CAACmC,GAAG,CAACL,gBAAgB,CAAC,CAC1BM,IAAI,CAAEC,KAAK,IAAK;gBACf,MAAMC,KAAK,GAAGD,KAAK,CAACN,MAAM,CAAC,CAACC,GAAG,EAAEO,GAAG,KAAKP,GAAG,GAAGO,GAAG,EAAE,CAAC,CAAC;gBACtDtC,OAAO,CAACqC,KAAK,CAAC;cAChB,CAAC,CAAC,CACDE,KAAK,CAAEC,CAAC,IAAK;gBACZf,OAAO,CAACC,KAAK,CAACc,CAAC,CAAC;gBAChBvC,MAAM,EAAE;cACV,CAAC,CAAC;YACN,CAAC,EAAE0B,UAAU,EAAE9B,EAAE,CAAC;UACpB,CAAC,SAAS;YACRwB,OAAO,CAACZ,MAAM,CAACgC,KAAK,EAAE;UACxB;QACF,CAAC;MACH,CAAC,CAAC;IACJ;;IAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;IACI,OAAOC,iBAAiBA,CAACC,KAAK,EAAE;MAC9B,MAAMC,MAAM,GAAG,IAAI;MACnB,IAAIC,IAAI,CAACC,GAAG,CAACH,KAAK,CAAC,GAAGC,MAAM,EAAE;QAC5B,OAAOD,KAAK,GAAG,IAAI;MACrB;MACA,MAAMI,KAAK,GAAG,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC;MAC9D,IAAIC,CAAC,GAAG,CAAC,CAAC;MACV,GAAG;QACDL,KAAK,IAAIC,MAAM;QACf,EAAEI,CAAC;MACL,CAAC,QAAQH,IAAI,CAACC,GAAG,CAACH,KAAK,CAAC,IAAIC,MAAM,IAAII,CAAC,GAAGD,KAAK,CAAChC,MAAM,GAAG,CAAC;MAC1D,OAAO4B,KAAK,CAACM,OAAO,CAAC,CAAC,CAAC,GAAG,GAAG,GAAGF,KAAK,CAACC,CAAC,CAAC;IAC1C;;IAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;IACI,aAAaE,kBAAkBA,CAACC,OAAO,EAAE;MACvC,MAAMC,QAAQ,GAAG,IAAIC,WAAW,EAAE,CAACC,MAAM,CAACH,OAAO,CAAC,CAAC,CAAC;MACpD,MAAMI,UAAU,GAAG,MAAMC,MAAM,CAACC,MAAM,CAACC,MAAM,CAAC,OAAO,EAAEN,QAAQ,CAAC,CAAC,CAAC;MAClE,MAAMO,SAAS,GAAGC,KAAK,CAACC,IAAI,CAAC,IAAIC,UAAU,CAACP,UAAU,CAAC,CAAC,CAAC,CAAC;MAC1D,OAAOI,SAAS,CAACI,GAAG,CAAEC,CAAC,IAAKA,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAACC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC;IACzE;EACF;EAAC,IAAAC,UAAA,oBAAAC,OAAA;EAAA,IAAAC,QAAA,oBAAAD,OAAA;EAED,MAAME,KAAK,CAAC;IACV;AACJ;AACA;AACA;AACA;AACA;IACIC,WAAWA,CAACC,kBAAkB,EAAEC,cAAc,EAAEC,cAAc,EAAE;MA8FhE;AACJ;AACA;AACA;AACA;MAJI5F,2BAAA,OAAAuF,QAAA;MA5CA;AACJ;AACA;AACA;AACA;MAJIvF,2BAAA,OAAAqF,UAAA;MAjDE;MACA,IAAI,CAACK,kBAAkB,GAAGA,kBAAkB;MAC5C;MACA,IAAI,CAACC,cAAc,GAAGA,cAAc;MACpC;MACA,IAAI,CAACC,cAAc,GAAGA,cAAc;MACpC;MACA,IAAI,CAACC,KAAK,GAAG,IAAIC,GAAG,EAAE;MACtB;MACA,IAAI,CAACC,oBAAoB,GAAG,IAAI;IAClC;;IAEA;AACJ;AACA;AACA;IACI,MAAMC,KAAKA,CAAA,EAAG;MACZ,IAAI,IAAI,CAACD,oBAAoB,EAAE,OAAO,MAAM,IAAI,CAACA,oBAAoB;MACrE,IAAI,CAACA,oBAAoB,GAAG,IAAI/E,OAAO,CAAEC,OAAO,IAAK;QACnDuE,KAAK,CAACS,iBAAiB,CACrB,IAAI,CAACP,kBAAkB,EACvB,IAAI,CAACC,cAAc,EACnB,IAAI,CAACC,cAAc,CACpB,CACExC,IAAI,CAAEtC,EAAE,IAAK;UACZ,IAAI,CAACA,EAAE,GAAGA,EAAE;UACZG,OAAO,CAAC,IAAI,CAAC;QACf,CAAC,CAAC,CACDuC,KAAK,CAAEC,CAAC,IAAK;UACZf,OAAO,CAACC,KAAK,CAACc,CAAC,CAAC;UAChB+B,KAAK,CAACU,cAAc,CAClB,IAAI,CAACR,kBAAkB,EACvB,IAAI,CAACC,cAAc,EACnB,IAAI,CAACC,cAAc,CACpB;UACD3E,OAAO,CAAC,KAAK,CAAC;QAChB,CAAC,CAAC;MACN,CAAC,CAAC;MACF,OAAO,MAAM,IAAI,CAAC8E,oBAAoB;IACxC;;IAEA;AACJ;AACA;IACIrC,KAAKA,CAAA,EAAG;MACN,IAAI,IAAI,CAAC5C,EAAE,EAAE,IAAI,CAACA,EAAE,CAAC4C,KAAK,EAAE;MAC5B,IAAI,CAAC5C,EAAE,GAAG,IAAI;IAChB;IA6BA;AACJ;AACA;AACA;AACA;IACI,MAAMqF,KAAKA,CAACC,YAAY,EAAE;MACxB,MAAMC,IAAI,GAAG,MAAMzF,KAAK,CAACuD,kBAAkB,CAACiC,YAAY,CAAC;MAEzD,IAAIE,WAAW,GAAG,IAAI,CAACT,KAAK,CAACU,GAAG,CAACF,IAAI,CAAC;MACtC,IAAIC,WAAW,EAAE,OAAOA,WAAW;MAEnCA,WAAW,GAAG,MAAA9F,sBAAA,CAAM,IAAI,EAAA6E,UAAA,EAAAmB,WAAA,EAAAC,IAAA,CAAJ,IAAI,EAAYJ,IAAI,CAAC;MACzC,IAAIC,WAAW,EAAE,IAAI,CAACT,KAAK,CAACa,GAAG,CAACL,IAAI,EAAEC,WAAW,CAAC;MAElD,OAAOA,WAAW;IACpB;IA4BA;AACJ;AACA;AACA;AACA;AACA;AACA;IACI,MAAMlG,GAAGA,CAACgG,YAAY,EAAEO,cAAc,EAAEC,gBAAgB,GAAG,KAAK,EAAE;MAChE,MAAMP,IAAI,GAAG,MAAMzF,KAAK,CAACuD,kBAAkB,CAACiC,YAAY,CAAC;MACzD,OAAO,MAAA5F,sBAAA,CAAM,IAAI,EAAA+E,QAAA,EAAAsB,SAAA,EAAAJ,IAAA,CAAJ,IAAI,EAAU;QACzBL,YAAY;QACZO,cAAc;QACdC,gBAAgB;QAChBE,GAAG,EAAET;MACP,CAAC,CAAC;IACJ;;IAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACI,OAAOU,eAAeA,CAACrB,kBAAkB,EAAEC,cAAc,EAAEC,cAAc,EAAE;MACzE,OAAQ,GAAEF,kBAAmB,IAAGC,cAAe,IAAGC,cAAe,EAAC;IACpE;;IAEA;AACJ;AACA;AACA;AACA;AACA;AACA;IACI,OAAOoB,mBAAmBA,CAAA,EAAG;MAC3B,OAAO,OAAO;IAChB;;IAEA;AACJ;AACA;AACA;AACA;AACA;AACA;IACI,aAAaC,aAAaA,CAACC,IAAI,EAAEC,OAAO,EAAEC,kBAAkB,EAAE;MAC5D,OAAO,MAAM,IAAIpG,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;QAC5C,MAAMoB,OAAO,GAAGC,SAAS,CAACC,IAAI,CAAC0E,IAAI,EAAEC,OAAO,CAAC;QAE7C7E,OAAO,CAACf,SAAS,GAAIC,KAAK,IAAK;UAC7BkB,OAAO,CAAC2E,IAAI,CAAC/E,OAAO,CAACZ,MAAM,CAAC;UAC5BT,OAAO,CAACqB,OAAO,CAACZ,MAAM,CAAC;QACzB,CAAC;QAEDY,OAAO,CAACJ,OAAO,GAAGI,OAAO,CAACG,SAAS,GAAIjB,KAAK,IAAK;UAC/CkB,OAAO,CAACC,KAAK,CACX,4DAA4D,EAC5DnB,KAAK,CACN;UACDN,MAAM,EAAE;QACV,CAAC;QAEDoB,OAAO,CAACgF,eAAe,GAAI9F,KAAK,IAAK;UACnC,MAAMV,EAAE,GAAGwB,OAAO,CAACZ,MAAM;UAEzB,KAAK,MAAMX,WAAW,IAAIqG,kBAAkB,EAAE;YAC5CtG,EAAE,CAACyG,iBAAiB,CAACxG,WAAW,EAAE;cAChCyG,OAAO,EAAE;YACX,CAAC,CAAC;UACJ;QACF,CAAC;MACH,CAAC,CAAC;IACJ;;IAEA;AACJ;AACA;AACA;AACA;AACA;AACA;IACI,aAAavB,iBAAiBA,CAC5BP,kBAAkB,EAClBC,cAAc,EACdC,cAAc,EACd;MACA,MAAMvD,MAAM,GAAGmD,KAAK,CAACuB,eAAe,CAClCrB,kBAAkB,EAClBC,cAAc,EACdC,cAAc,CACf;MACD,MAAM7E,WAAW,GAAGyE,KAAK,CAACwB,mBAAmB,EAAE;MAC/C,MAAMlG,EAAE,GAAG,MAAM0E,KAAK,CAACyB,aAAa,CAAC5E,MAAM,EAAE,CAAC,EAAE,CAACtB,WAAW,CAAC,CAAC;MAC9D,OAAOD,EAAE;IACX;;IAEA;AACJ;AACA;AACA;AACA;AACA;AACA;IACI,aAAaoF,cAAcA,CACzBR,kBAAkB,EAClBC,cAAc,EACdC,cAAc,EACd;MACA,OAAO,MAAM,IAAI5E,OAAO,CAAEC,OAAO,IAAK;QACpC,IAAI;UACF,MAAMoB,MAAM,GAAGmD,KAAK,CAACuB,eAAe,CAClCrB,kBAAkB,EAClBC,cAAc,EACdC,cAAc,CACf;UACD,MAAMtD,OAAO,GAAGC,SAAS,CAAC2D,cAAc,CAAC7D,MAAM,CAAC;UAEhDC,OAAO,CAACf,SAAS,GAAIC,KAAK,IAAK;YAC7BP,OAAO,CAAC,IAAI,CAAC;UACf,CAAC;UAEDqB,OAAO,CAACJ,OAAO,GAAIV,KAAK,IAAK;YAC3BkB,OAAO,CAACC,KAAK,CAACnB,KAAK,CAAC;YACpBP,OAAO,CAAC,KAAK,CAAC;UAChB,CAAC;QACH,CAAC,CAAC,OAAOwC,CAAC,EAAE;UACVf,OAAO,CAACC,KAAK,CAACc,CAAC,CAAC;UAChBxC,OAAO,CAAC,KAAK,CAAC;QAChB;MACF,CAAC,CAAC;IACJ;EACF;EAAC,eAAAuF,YAxMkBiB,YAAY,EAAE;IAC7B,OAAO,MAAM,IAAIzG,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MAC5C,IAAI,CAAC,IAAI,CAACJ,EAAE,EAAE,OAAOI,MAAM,EAAE;MAE7B,MAAMH,WAAW,GAAGyE,KAAK,CAACwB,mBAAmB,EAAE;MAC/C,MAAM3F,WAAW,GAAG,IAAI,CAACP,EAAE,CACxBM,WAAW,CAAC,CAACL,WAAW,CAAC,EAAE,UAAU,CAAC,CACtCM,WAAW,CAACN,WAAW,CAAC;MAC3B,MAAMuB,OAAO,GAAGjB,WAAW,CAACkF,GAAG,CAACkB,YAAY,CAAC;MAE7CnF,OAAO,CAACf,SAAS,GAAIC,KAAK,IAAK;QAC7B,MAAME,MAAM,GAAGY,OAAO,CAACZ,MAAM;QAC7BT,OAAO,CAACS,MAAM,CAAC;MACjB,CAAC;MAEDY,OAAO,CAACJ,OAAO,GAAIV,KAAK,IAAK;QAC3BkB,OAAO,CAACC,KAAK,CAACnB,KAAK,CAAC;QACpBN,MAAM,EAAE;MACV,CAAC;IACH,CAAC,CAAC;EACJ;EAAC,eAAA2F,UAwBca,IAAI,EAAE;IACnB,OAAO,MAAM,IAAI1G,OAAO,CAAEC,OAAO,IAAK;MACpC,IAAI,CAAC,IAAI,CAACH,EAAE,EAAE,OAAOG,OAAO,CAAC,KAAK,CAAC;MAEnC,MAAMF,WAAW,GAAGyE,KAAK,CAACwB,mBAAmB,EAAE;MAC/C,MAAM3F,WAAW,GAAG,IAAI,CAACP,EAAE,CACxBM,WAAW,CAAC,CAACL,WAAW,CAAC,EAAE,WAAW,CAAC,CACvCM,WAAW,CAACN,WAAW,CAAC;MAC3B,MAAMuB,OAAO,GAAGjB,WAAW,CAACsG,GAAG,CAACD,IAAI,CAAC;MAErCpF,OAAO,CAACf,SAAS,GAAIC,KAAK,IAAK;QAC7BP,OAAO,CAAC,IAAI,CAAC;MACf,CAAC;MAEDqB,OAAO,CAACJ,OAAO,GAAIV,KAAK,IAAK;QAC3BkB,OAAO,CAACC,KAAK,CAACnB,KAAK,CAAC;QACpBP,OAAO,CAAC,KAAK,CAAC;MAChB,CAAC;IACH,CAAC,CAAC;EACJ;EAAC,IAAA2G,cAAA,oBAAAtC,OAAA;EAAA,IAAAuC,aAAA,oBAAAvC,OAAA;EAAA,IAAAwC,YAAA,oBAAAxC,OAAA;EAAA,IAAAyC,SAAA,oBAAAzC,OAAA;EAAA,IAAA0C,cAAA,oBAAA1C,OAAA;EA2IH,MAAM2C,SAAS,CAAC;IACd;AACJ;AACA;IACIxC,WAAWA,CAAA,EAAG;MAgId;AACJ;AACA;AACA;AACA;AACA;AACA;MANIzF,2BAAA,OAAAgI,cAAA;MAnBA;AACJ;AACA;AACA;AACA;AACA;AACA;MANIhI,2BAAA,OAAA+H,SAAA;MAjDA;AACJ;AACA;AACA;AACA;AACA;AACA;MANI/H,2BAAA,OAAA8H,YAAA;MApBA;AACJ;AACA;AACA;MAHI9H,2BAAA,OAAA6H,aAAA;MA9BA;AACJ;AACA;MAFI7H,2BAAA,OAAA4H,cAAA;MATE;MACA,IAAI,CAACM,IAAI,GAAG,IAAIpC,GAAG,EAAE;MACrB,IAAI;QACFtF,sBAAA,KAAI,EAAAoH,cAAA,EAAAO,eAAA,EAAA1B,IAAA,CAAJ,IAAI;MACN,CAAC,CAAC,OAAOhD,CAAC,EAAE;QACVf,OAAO,CAACC,KAAK,CAACc,CAAC,CAAC;MAClB;IACF;IA0EA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;IACI,MAAM2E,QAAQA,CAAC1C,kBAAkB,EAAEC,cAAc,EAAEC,cAAc,EAAE;MACjE,MAAMvD,MAAM,GAAGmD,KAAK,CAACuB,eAAe,CAClCrB,kBAAkB,EAClBC,cAAc,EACdC,cAAc,CACf;MACD,MAAMC,KAAK,GAAG,IAAI,CAACqC,IAAI,CAAC3B,GAAG,CAAClE,MAAM,CAAC;MACnC,IAAIwD,KAAK,EAAE;QACT,MAAMA,KAAK,CAACE,oBAAoB;QAChC,OAAOF,KAAK;MACd,CAAC,MAAM;QACL,OAAO,MAAArF,sBAAA,CAAM,IAAI,EAAAsH,YAAA,EAAAO,aAAA,EAAA5B,IAAA,CAAJ,IAAI,EACff,kBAAkB,EAClBC,cAAc,EACdC,cAAc,CACf;MACH;IACF;IAkDA;AACJ;AACA;AACA;AACA;IACI,MAAM0C,SAASA,CAAA,EAAG;MAChB,IAAI;QACF;QACA,MAAMC,QAAQ,GAAG,EAAE;QACnB,IAAI,CAACL,IAAI,CAACM,OAAO,CAAC,CAAC3C,KAAK,EAAEiB,GAAG,KAAK;UAChC,IAAIjB,KAAK,EAAEA,KAAK,CAACnC,KAAK,EAAE;UACxB6E,QAAQ,CAACrF,IAAI,CAAC+E,SAAS,CAAC/B,cAAc,CAACY,GAAG,CAAC,CAAC;QAC9C,CAAC,CAAC;QACF,IAAI,CAACoB,IAAI,CAACO,KAAK,EAAE;QACjB,MAAMC,OAAO,GAAG,MAAAlI,sBAAA,CAAM,IAAI,EAAAwH,cAAA,EAAAW,eAAA,EAAAlC,IAAA,CAAJ,IAAI,CAAiB;QAC3CiC,OAAO,CAACF,OAAO,CAAEnG,MAAM,IAAK;UAC1BkG,QAAQ,CAACrF,IAAI,CAAC+E,SAAS,CAAC/B,cAAc,CAAC7D,MAAM,CAAC,CAAC;QACjD,CAAC,CAAC;QACF,MAAMrB,OAAO,CAACmC,GAAG,CAACoF,QAAQ,CAAC;QAC3B,OAAO,IAAI;MACb,CAAC,CAAC,OAAO9E,CAAC,EAAE;QACVf,OAAO,CAACC,KAAK,CAACc,CAAC,CAAC;QAChB,OAAO,KAAK;MACd;IACF;;IAEA;AACJ;AACA;AACA;IACI,aAAayC,cAAcA,CAAC7D,MAAM,EAAE;MAClC,OAAO,MAAM,IAAIrB,OAAO,CAAEC,OAAO,IAAK;QACpC,MAAM2H,eAAe,GAAGrG,SAAS,CAAC2D,cAAc,CAAC7D,MAAM,CAAC;QAExDuG,eAAe,CAACrH,SAAS,GAAG,MAAM;UAChCmB,OAAO,CAAC2E,IAAI,CAAC,+BAA+B,CAAC;UAC7CpG,OAAO,CAAC,IAAI,CAAC;QACf,CAAC;QAED2H,eAAe,CAAC1G,OAAO,GAAG,MAAM;UAC9BQ,OAAO,CAACmG,IAAI,CAAC,0BAA0B,CAAC;UACxC5H,OAAO,CAAC,KAAK,CAAC;QAChB,CAAC;MACH,CAAC,CAAC;IACJ;;IAEA;AACJ;AACA;AACA;AACA;AACA;AACA;IACI,MAAM6H,aAAaA,CAAA,EAAG;MACpB,IAAI;QACF;QACA,MAAMP,QAAQ,GAAG,EAAE;QACnB,MAAMG,OAAO,GAAG,MAAAlI,sBAAA,CAAM,IAAI,EAAAwH,cAAA,EAAAW,eAAA,EAAAlC,IAAA,CAAJ,IAAI,CAAiB;QAC3CiC,OAAO,CAACF,OAAO,CAAEnG,MAAM,IAAK;UAC1BkG,QAAQ,CAACrF,IAAI,CAACtC,KAAK,CAACwB,eAAe,CAACC,MAAM,CAAC,CAAC;QAC9C,CAAC,CAAC;QACF,MAAM0G,OAAO,GAAG,MAAM/H,OAAO,CAACmC,GAAG,CAACoF,QAAQ,CAAC;QAC3C,OAAO3H,KAAK,CAAC+C,iBAAiB,CAC5BoF,OAAO,CAAChG,MAAM,CAAC,CAACO,KAAK,EAAEnC,IAAI,KAAKmC,KAAK,GAAGnC,IAAI,EAAE,CAAC,CAAC,CACjD;MACH,CAAC,CAAC,OAAOsC,CAAC,EAAE;QACVf,OAAO,CAACC,KAAK,CAACc,CAAC,CAAC;QAChB,OAAO7C,KAAK,CAAC+C,iBAAiB,CAAC,CAAC,CAAC;MACnC;IACF;EACF;;EAEA;EAAA,SAAAwE,gBAAA,EAxNmB;IACf,MAAM7F,OAAO,GAAGC,SAAS,CAACC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;IAE9CF,OAAO,CAACf,SAAS,GAAIC,KAAK,IAAK;MAC7B,IAAI,CAACwH,WAAW,GAAG1G,OAAO,CAACZ,MAAM;;MAEjC;MACA;MACA,IAAI,CAACwG,IAAI,CAACM,OAAO,CAAC,CAAC3C,KAAK,EAAEiB,GAAG,KAAK;QAChCtG,sBAAA,KAAI,EAAAqH,aAAA,EAAAoB,cAAA,EAAAxC,IAAA,CAAJ,IAAI,EAAeK,GAAG;MACxB,CAAC,CAAC;IACJ,CAAC;IAEDxE,OAAO,CAACJ,OAAO,GAAGI,OAAO,CAACG,SAAS,GAAIjB,KAAK,IAAK;MAC/CkB,OAAO,CAACC,KAAK,CAAC,4BAA4B,EAAEnB,KAAK,CAAC;MAClD,IAAI,CAACwH,WAAW,GAAG,IAAI;IACzB,CAAC;IAED1G,OAAO,CAACgF,eAAe,GAAI9F,KAAK,IAAK;MACnC,MAAMV,EAAE,GAAGwB,OAAO,CAACZ,MAAM;MAEzBZ,EAAE,CAACyG,iBAAiB,CAAC,YAAY,EAAE;QACjCC,OAAO,EAAE;MACX,CAAC,CAAC;IACJ,CAAC;EACH;EAAC,SAAAyB,eAMa5G,MAAM,EAAE;IACpB,IAAI,CAAC,IAAI,CAAC2G,WAAW,EAAE;IAEvB,MAAMjI,WAAW,GAAG,YAAY;IAChC,MAAMM,WAAW,GAAG,IAAI,CAAC2H,WAAW,CACjC5H,WAAW,CAAC,CAACL,WAAW,CAAC,EAAE,WAAW,CAAC,CACvCM,WAAW,CAACN,WAAW,CAAC;IAC3B,MAAMuB,OAAO,GAAGjB,WAAW,CAACsG,GAAG,CAAC;MAAEtF;IAAO,CAAC,CAAC;IAE3CC,OAAO,CAACf,SAAS,GAAIC,KAAK,IAAK,CAAC,CAAC;IAEjCc,OAAO,CAACJ,OAAO,GAAIV,KAAK,IAAK;MAC3BkB,OAAO,CAACC,KAAK,CAACnB,KAAK,CAAC;IACtB,CAAC;EACH;EAAC,eAAA6G,cASkB3C,kBAAkB,EAAEC,cAAc,EAAEC,cAAc,EAAE;IACrE,MAAMC,KAAK,GAAG,IAAIL,KAAK,CACrBE,kBAAkB,EAClBC,cAAc,EACdC,cAAc,CACf;IACDpF,sBAAA,KAAI,EAAAuH,SAAA,EAAAmB,UAAA,EAAAzC,IAAA,CAAJ,IAAI,EAAWf,kBAAkB,EAAEC,cAAc,EAAEC,cAAc,EAAEC,KAAK;IACxE,IAAI;MACF,MAAMA,KAAK,CAACG,KAAK,EAAE;IACrB,CAAC,CAAC,OAAOvC,CAAC,EAAE;MACVf,OAAO,CAACC,KAAK,CAACc,CAAC,CAAC;IAClB;IACA,OAAOoC,KAAK;EACd;EAAC,SAAAqD,WAoCSxD,kBAAkB,EAAEC,cAAc,EAAEC,cAAc,EAAEC,KAAK,EAAE;IACnE,MAAMxD,MAAM,GAAGmD,KAAK,CAACuB,eAAe,CAClCrB,kBAAkB,EAClBC,cAAc,EACdC,cAAc,CACf;IACD,IAAI,CAACsC,IAAI,CAACxB,GAAG,CAACrE,MAAM,EAAEwD,KAAK,CAAC;IAC5B,IAAI;MACFrF,sBAAA,KAAI,EAAAqH,aAAA,EAAAoB,cAAA,EAAAxC,IAAA,CAAJ,IAAI,EAAepE,MAAM;IAC3B,CAAC,CAAC,MAAM,CAAC;EACX;EAAC,eAAAsG,gBAAA,EASsB;IACrB,IAAI,CAAC,IAAI,CAACK,WAAW,EAAE,OAAO,EAAE;IAChC,OAAO,MAAM,IAAIhI,OAAO,CAAEC,OAAO,IAAK;MACpC,MAAMF,WAAW,GAAG,YAAY;MAChC,MAAMM,WAAW,GAAG,IAAI,CAAC2H,WAAW,CACjC5H,WAAW,CAAC,CAACL,WAAW,CAAC,EAAE,UAAU,CAAC,CACtCM,WAAW,CAACN,WAAW,CAAC;MAC3B,MAAMuB,OAAO,GAAGjB,WAAW,CAAC8H,UAAU,EAAE;MAExC7G,OAAO,CAACf,SAAS,GAAIC,KAAK,IAAK;QAC7B;QACA;QACAP,OAAO,EAAC,uBAAyBqB,OAAO,CAACZ,MAAM,CAAE;MACnD,CAAC;MAEDY,OAAO,CAACJ,OAAO,GAAIV,KAAK,IAAK;QAC3BkB,OAAO,CAACC,KAAK,CAACnB,KAAK,CAAC;QACpBP,OAAO,CAAC,EAAE,CAAC;MACb,CAAC;IACH,CAAC,CAAC;EACJ;EA2EF,MAAMmI,SAAS,GAAG,IAAInB,SAAS,EAAE;;EAEjC;AACF;AACA;AACA;AACA;AACA;AACA;AACA;EACEtH,gBAAgB,CAAC4F,GAAG,GAAG,OACrBb,kBAAkB,EAClBC,cAAc,EACdC,cAAc,EACdQ,YAAY,KACT;IACH,IAAI;MACF,MAAMP,KAAK,GAAG,MAAMuD,SAAS,CAAChB,QAAQ,CACpC1C,kBAAkB,EAClBC,cAAc,EACdC,cAAc,CACf;MACD,OAAO,MAAMC,KAAK,CAACM,KAAK,CAACC,YAAY,CAAC;IACxC,CAAC,CAAC,OAAO3C,CAAC,EAAE;MACVf,OAAO,CAACC,KAAK,CAACc,CAAC,CAAC;IAClB;EACF,CAAC;;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE9C,gBAAgB,CAAC+F,GAAG,GAAG,OACrBhB,kBAAkB,EAClBC,cAAc,EACdC,cAAc,EACdQ,YAAY,EACZO,cAAc,EACdC,gBAAgB,KACb;IACH,IAAI;MACF,MAAMf,KAAK,GAAG,MAAMuD,SAAS,CAAChB,QAAQ,CACpC1C,kBAAkB,EAClBC,cAAc,EACdC,cAAc,CACf;MACD,OAAO,MAAMC,KAAK,CAACzF,GAAG,CAACgG,YAAY,EAAEO,cAAc,EAAEC,gBAAgB,CAAC;IACxE,CAAC,CAAC,OAAOnD,CAAC,EAAE;MACVf,OAAO,CAACC,KAAK,CAACc,CAAC,CAAC;IAClB;EACF,CAAC;;EAED;AACF;AACA;AACA;AACA;EACE9C,gBAAgB,CAAC0I,sBAAsB,GAAG,OAAOC,MAAM,GAAG,KAAK,KAAK;IAClE,IAAI;MACF;MACA,IAAI/G,SAAS,IAAIA,SAAS,CAAC2D,cAAc,EAAE;QACzC3D,SAAS,CAAC2D,cAAc,CAAC,aAAa,CAAC;QACvC3D,SAAS,CAAC2D,cAAc,CAAC,aAAa,CAAC;QACvC3D,SAAS,CAAC2D,cAAc,CAAC,WAAW,CAAC;MACvC;MACA;MACA,MAAMkD,SAAS,CAACd,SAAS,EAAE;IAC7B,CAAC,CAAC,OAAO7E,CAAC,EAAE;MACVf,OAAO,CAACC,KAAK,CAACc,CAAC,CAAC;IAClB,CAAC,SAAS;MACR,IAAI6F,MAAM,EAAEC,MAAM,CAACC,OAAO,CAACF,MAAM,EAAE;IACrC;EACF,CAAC;EAED,IAAIG,yBAAyB,GAAG,IAAI;EACpCF,MAAM,CAACC,OAAO,CAACE,SAAS,CAACC,WAAW,CAAC,CAACrH,OAAO,EAAEsH,MAAM,EAAEC,YAAY,KAAK;IACtE,IAAIvH,OAAO,CAACwH,MAAM,KAAK,cAAc,EAAE;MACrC,IAAI,CAACL,yBAAyB,EAAE;QAC9BA,yBAAyB,GAAGL,SAAS,CAACN,aAAa,EAAE;MACvD;MAEAW,yBAAyB,CACtBrG,IAAI,CAAEjC,IAAI,IAAK;QACdsI,yBAAyB,GAAG,IAAI;QAChCI,YAAY,CAAC1I,IAAI,CAAC;QAClB,OAAOA,IAAI;MACb,CAAC,CAAC,CACDqC,KAAK,CAAEC,CAAC,IAAK;QACZf,OAAO,CAACC,KAAK,CAACc,CAAC,CAAC;QAChBgG,yBAAyB,GAAG,IAAI;QAChCI,YAAY,CAAC,IAAI,CAAC;QAClB,OAAO,IAAI;MACb,CAAC,CAAC;MACJ,OAAO,IAAI;IACb,CAAC,MAAM,IAAIvH,OAAO,CAACwH,MAAM,KAAK,wBAAwB,EAAE;MACtDnJ,gBAAgB,CAAC0I,sBAAsB,CAAC/G,OAAO,CAACgH,MAAM,CAAC;IACzD;EACF,CAAC,CAAC;EAEF,OAAO3I,gBAAgB;AACzB,CAAC,EAAG"}
{"version":3,"file":"../../contentScript/pageTranslator.js","names":["startMark","endMark","startMark0","endMark0","currentIndex","compressionMap","filterKeywordsInText","textContext","customDictionary","twpConfig","get","size","Map","entries","sort","a","b","String","length","keyWord","keys","index","toLowerCase","indexOf","removeExtraDelimiter","previousIndex","nextIndex","previousChar","charAt","nextChar","placeholderText","keyWordWithCase","substring","isPunctuationOrDelimiter","handleHitKeywords","c","Array","from","frontPart","backPart","replaceAll","handleCustomWords","translated","originalText","currentPageTranslatorService","currentSourceLanguage","currentTargetLanguage","customValue","trim","startIndex","endIndex","Error","e","backgroundTranslateSingleText","value","mode","undefined","set","Number","str","regex","test","replace","backgroundTranslateHTML","translationService","sourceLanguage","targetLanguage","sourceArray2d","dontSortResults","Promise","resolve","reject","chrome","runtime","sendMessage","action","response","checkedLastError","backgroundTranslateText","sourceArray","source","pageTranslator","getTabHostName","result","all","onReady","then","_","tabHostName","htmlTagsInlineText","htmlTagsInlineIgnore","htmlTagsNoTranslate","location","hostname","splice","push","onChanged","name","newvalue","piecesToTranslate","originalTabLanguage","currentPageLanguage","pageLanguageState","fooCount","originalPageTitle","attributesToTranslate","translateNewNodesTimerHandler","newNodes","removedNodes","nodesToRestore","translateNewNodes","forEach","nn","newPiecesToTranslate","getPiecesToTranslate","i","nodes","finded","ntt","some","n1","n2","console","error","mutationObserver","MutationObserver","mutations","mutation","addedNodes","addedNode","nodeName","isNoTranslateNode","removedNode","ptt","enableMutatinObserver","disableMutatinObserver","setInterval","observe","document","body","childList","subtree","clearInterval","disconnect","takeRecords","pageIsVisible","visibilityState","handleVisibilityChange","addEventListener","node","getAttribute","childNodes","find","nodeType","root","documentElement","isTranslated","parentElement","topElement","bottomElement","currentParagraphSize","getAllNodes","lastHTMLElement","lastSelectOrDataListElement","host","classList","contains","isContentEditable","startsWith","matches","getAllChilds","_node","shadowRoot","textContent","parentNode","temp","pieceInfo","pop","getAttributesToTranslate","placeholdersElements","querySelectorAll","altElements","valueElements","titleElements","hasNoTranslate","elem","txt","original","attrName","type","encapsulateTextNode","fontNode","createElement","setAttribute","replaceWith","translateTextContent","text","toRestore","translatedText","oldClientWidth","clientWidth","newClientWidth","transformMatch","style","transform","match","currentScaleX","parseFloat","originalScale","Math","min","translateResults","piecesToTranslateNow","results","j","restResults","slice","join","originalTextNode","showOriginal","isEnabled","add","translateAttributes","attributesToTranslateNow","ati","translationRoutine","innerHeight","window","isInScreen","element","rect","getBoundingClientRect","top","bottom","topIsInScreen","bottomIsInScreen","currentFooCount","map","clearTimeout","translationRoutine_handler","setTimeout","translatePageTitle","title","querySelector","pageLanguageStateObservers","onPageLanguageStateChange","callback","translatePage","restorePage","enable","remove","getElementById","dispatchEvent","Event","disable","ntr","swapTranslationService","newServiceName","improveTranslation","info","pageTranslatorService","alreadyGotTheLanguage","observers","onGetOriginalTabLanguage","onMessage","addListener","request","sender","sendResponse","serviceNames","includes","self","onTabVisible","langCode","twpLang","fixTLanguageCode","href","endsWith","platformInfo","isMobile","any","extension","inIncognitoContext","removeEventListener","enabledObserverSubscribe"],"sources":["pageTranslator.js"],"sourcesContent":["\"use strict\";\r\n\r\n/**\r\n * This mark cannot contain words, like <customskipword>12</customskipword>34\r\n *\r\n * Google will reorder as <customskipword>1234</customskipword>\r\n *\r\n * Under certain circumstances，Google broken the translation, returned startMark0 in some cases\r\n * */\r\nconst startMark = \"@%\";\r\nconst endMark = \"#$\";\r\nconst startMark0 = \"@ %\";\r\nconst endMark0 = \"# $\";\r\n\r\nlet currentIndex;\r\nlet compressionMap;\r\n\r\n/**\r\n *  Convert matching keywords to a string of special numbers to skip translation before sending to the translation engine.\r\n *\r\n *  For English words, ignore case when matching.\r\n *\r\n *  But for the word \"app\" , We don't want to \"Happy\" also matched.\r\n *\r\n *  So we match only isolated words, by checking the two characters before and after the keyword.\r\n *\r\n *  But this will also cause this method to not work for Chinese, Burmese and other languages without spaces.\r\n * */\r\nfunction filterKeywordsInText(textContext) {\r\n  let customDictionary = twpConfig.get(\"customDictionary\");\r\n  if (customDictionary.size > 0) {\r\n    // reordering , we want to match the keyword \"Spring Boot\" first then the keyword \"Spring\"\r\n    customDictionary = new Map(\r\n      [...customDictionary.entries()].sort(\r\n        (a, b) => String(b[0]).length - String(a[0]).length\r\n      )\r\n    );\r\n    for (let keyWord of customDictionary.keys()) {\r\n      while (true) {\r\n        let index = textContext.toLowerCase().indexOf(keyWord);\r\n        if (index === -1) {\r\n          break;\r\n        } else {\r\n          textContext = removeExtraDelimiter(textContext);\r\n          let previousIndex = index - 1;\r\n          let nextIndex = index + keyWord.length;\r\n          let previousChar =\r\n            previousIndex === -1 ? \"\\n\" : textContext.charAt(previousIndex);\r\n          let nextChar =\r\n            nextIndex === textContext.length\r\n              ? \"\\n\"\r\n              : textContext.charAt(nextIndex);\r\n          let placeholderText = \"\";\r\n          let keyWordWithCase = textContext.substring(\r\n            index,\r\n            index + keyWord.length\r\n          );\r\n          if (\r\n            isPunctuationOrDelimiter(previousChar) &&\r\n            isPunctuationOrDelimiter(nextChar)\r\n          ) {\r\n            placeholderText =\r\n              startMark + handleHitKeywords(keyWordWithCase, true) + endMark;\r\n          } else {\r\n            placeholderText = \"#n%o#\";\r\n            for (let c of Array.from(keyWordWithCase)) {\r\n              placeholderText += c;\r\n              placeholderText += \"#n%o#\";\r\n            }\r\n          }\r\n          let frontPart = textContext.substring(0, index);\r\n          let backPart = textContext.substring(index + keyWord.length);\r\n          textContext = frontPart + placeholderText + backPart;\r\n        }\r\n      }\r\n      textContext = textContext.replaceAll(\"#n%o#\", \"\");\r\n    }\r\n  }\r\n  return textContext;\r\n}\r\n\r\n/**\r\n *  handle the keywords in translatedText, replace it if there is a custom replacement value.\r\n *\r\n *  When encountering Google Translate reordering, the original text contains our mark, etc. , we will catch these exceptions and call the text translation method to retranslate this section.\r\n *  */\r\nasync function handleCustomWords(\r\n  translated,\r\n  originalText,\r\n  currentPageTranslatorService,\r\n  currentSourceLanguage,\r\n  currentTargetLanguage\r\n) {\r\n  try {\r\n    const customDictionary = twpConfig.get(\"customDictionary\");\r\n    if (customDictionary.size > 0) {\r\n      // If the translation is a single word and exists in the dictionary, return it directly\r\n      let customValue = customDictionary.get(originalText.trim());\r\n      if (customValue) return customValue;\r\n\r\n      translated = removeExtraDelimiter(translated);\r\n      translated = translated.replaceAll(startMark0, startMark);\r\n      translated = translated.replaceAll(endMark0, endMark);\r\n\r\n      while (true) {\r\n        let startIndex = translated.indexOf(startMark);\r\n        let endIndex = translated.indexOf(endMark);\r\n        if (startIndex === -1 && endIndex === -1) {\r\n          break;\r\n        } else {\r\n          let placeholderText = translated.substring(\r\n            startIndex + startMark.length,\r\n            endIndex\r\n          );\r\n          // At this point placeholderText is actually currentIndex , the real value is in compressionMap\r\n          let keyWord = handleHitKeywords(placeholderText, false);\r\n          if (keyWord === \"undefined\") {\r\n            throw new Error(\"undefined\");\r\n          }\r\n          let frontPart = translated.substring(0, startIndex);\r\n          let backPart = translated.substring(endIndex + endMark.length);\r\n          let customValue = customDictionary.get(keyWord.toLowerCase());\r\n          customValue = customValue === \"\" ? keyWord : customValue;\r\n          // Highlight custom words, make it have a space before and after it\r\n          frontPart = isPunctuationOrDelimiter(\r\n            frontPart.charAt(frontPart.length - 1)\r\n          )\r\n            ? frontPart\r\n            : frontPart + \" \";\r\n          backPart = isPunctuationOrDelimiter(backPart.charAt(0))\r\n            ? backPart\r\n            : \" \" + backPart;\r\n          translated = frontPart + customValue + backPart;\r\n        }\r\n      }\r\n    }\r\n  } catch (e) {\r\n    return await backgroundTranslateSingleText(\r\n      currentPageTranslatorService,\r\n      currentSourceLanguage,\r\n      currentTargetLanguage,\r\n      originalText\r\n    );\r\n  }\r\n\r\n  return translated;\r\n}\r\n\r\n/**\r\n *\r\n * True : Store the keyword in the Map and return the index\r\n *\r\n * False : Extract keywords by index\r\n * */\r\nfunction handleHitKeywords(value, mode) {\r\n  if (mode) {\r\n    if (currentIndex === undefined) {\r\n      currentIndex = 1;\r\n      compressionMap = new Map();\r\n      compressionMap.set(currentIndex, value);\r\n    } else {\r\n      compressionMap.set(++currentIndex, value);\r\n    }\r\n    return String(currentIndex);\r\n  } else {\r\n    return String(compressionMap.get(Number(value)));\r\n  }\r\n}\r\n\r\n/**\r\n * any kind of punctuation character (including international e.g. Chinese and Spanish punctuation), and spaces, newlines\r\n *\r\n * source: https://github.com/slevithan/xregexp/blob/41f4cd3fc0a8540c3c71969a0f81d1f00e9056a9/src/addons/unicode/unicode-categories.js#L142\r\n *\r\n * note: XRegExp unicode output taken from http://jsbin.com/uFiNeDOn/3/edit?js,console (see chrome console.log), then converted back to JS escaped unicode here http://rishida.net/tools/conversion/, then tested on http://regexpal.com/\r\n *\r\n * suggested by: https://stackoverflow.com/a/7578937\r\n *\r\n * added: extra characters like \"$\", \"\\uFFE5\" [yen symbol], \"^\", \"+\", \"=\" which are not consider punctuation in the XRegExp regex (they are currency or mathmatical characters)\r\n *\r\n * added: Chinese Punctuation: \\u3002|\\uff1f|\\uff01|\\uff0c|\\u3001|\\uff1b|\\uff1a|\\u201c|\\u201d|\\u2018|\\u2019|\\uff08|\\uff09|\\u300a|\\u300b|\\u3010|\\u3011|\\u007e\r\n *\r\n * added: special html space symbol: &nbsp; &ensp; &emsp; &thinsp; &zwnj; &zwj; -> \\u00A0|\\u2002|\\u2003|\\u2009|\\u200C|\\u200D\r\n * @see https://stackoverflow.com/a/21396529/19616126\r\n * */\r\nfunction isPunctuationOrDelimiter(str) {\r\n  if (typeof str !== \"string\") return false;\r\n  if (str === \"\\n\" || str === \" \") return true;\r\n  const regex =\r\n    /[\\$\\uFFE5\\^\\+=`~<>{}\\[\\]|\\u00A0|\\u2002|\\u2003|\\u2009|\\u200C|\\u200D|\\u3002|\\uff1f|\\uff01|\\uff0c|\\u3001|\\uff1b|\\uff1a|\\u201c|\\u201d|\\u2018|\\u2019|\\uff08|\\uff09|\\u300a|\\u300b|\\u3010|\\u3011|\\u007e!-#%-\\x2A,-/:;\\x3F@\\x5B-\\x5D_\\x7B}\\u00A1\\u00A7\\u00AB\\u00B6\\u00B7\\u00BB\\u00BF\\u037E\\u0387\\u055A-\\u055F\\u0589\\u058A\\u05BE\\u05C0\\u05C3\\u05C6\\u05F3\\u05F4\\u0609\\u060A\\u060C\\u060D\\u061B\\u061E\\u061F\\u066A-\\u066D\\u06D4\\u0700-\\u070D\\u07F7-\\u07F9\\u0830-\\u083E\\u085E\\u0964\\u0965\\u0970\\u0AF0\\u0DF4\\u0E4F\\u0E5A\\u0E5B\\u0F04-\\u0F12\\u0F14\\u0F3A-\\u0F3D\\u0F85\\u0FD0-\\u0FD4\\u0FD9\\u0FDA\\u104A-\\u104F\\u10FB\\u1360-\\u1368\\u1400\\u166D\\u166E\\u169B\\u169C\\u16EB-\\u16ED\\u1735\\u1736\\u17D4-\\u17D6\\u17D8-\\u17DA\\u1800-\\u180A\\u1944\\u1945\\u1A1E\\u1A1F\\u1AA0-\\u1AA6\\u1AA8-\\u1AAD\\u1B5A-\\u1B60\\u1BFC-\\u1BFF\\u1C3B-\\u1C3F\\u1C7E\\u1C7F\\u1CC0-\\u1CC7\\u1CD3\\u2010-\\u2027\\u2030-\\u2043\\u2045-\\u2051\\u2053-\\u205E\\u207D\\u207E\\u208D\\u208E\\u2329\\u232A\\u2768-\\u2775\\u27C5\\u27C6\\u27E6-\\u27EF\\u2983-\\u2998\\u29D8-\\u29DB\\u29FC\\u29FD\\u2CF9-\\u2CFC\\u2CFE\\u2CFF\\u2D70\\u2E00-\\u2E2E\\u2E30-\\u2E3B\\u3001-\\u3003\\u3008-\\u3011\\u3014-\\u301F\\u3030\\u303D\\u30A0\\u30FB\\uA4FE\\uA4FF\\uA60D-\\uA60F\\uA673\\uA67E\\uA6F2-\\uA6F7\\uA874-\\uA877\\uA8CE\\uA8CF\\uA8F8-\\uA8FA\\uA92E\\uA92F\\uA95F\\uA9C1-\\uA9CD\\uA9DE\\uA9DF\\uAA5C-\\uAA5F\\uAADE\\uAADF\\uAAF0\\uAAF1\\uABEB\\uFD3E\\uFD3F\\uFE10-\\uFE19\\uFE30-\\uFE52\\uFE54-\\uFE61\\uFE63\\uFE68\\uFE6A\\uFE6B\\uFF01-\\uFF03\\uFF05-\\uFF0A\\uFF0C-\\uFF0F\\uFF1A\\uFF1B\\uFF1F\\uFF20\\uFF3B-\\uFF3D\\uFF3F\\uFF5B\\uFF5D\\uFF5F-\\uFF65]+/g;\r\n  return regex.test(str);\r\n}\r\n\r\n/**\r\n * Remove useless newlines, spaces inside, which may affect our semantics\r\n * */\r\nfunction removeExtraDelimiter(textContext) {\r\n  textContext = textContext.replaceAll(\"\\n\", \" \");\r\n  textContext = textContext.replace(/  +/g, \" \");\r\n  return textContext;\r\n}\r\n\r\nfunction backgroundTranslateHTML(\r\n  translationService,\r\n  sourceLanguage,\r\n  targetLanguage,\r\n  sourceArray2d,\r\n  dontSortResults\r\n) {\r\n  return new Promise((resolve, reject) => {\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"translateHTML\",\r\n        translationService,\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        sourceArray2d,\r\n        dontSortResults,\r\n      },\r\n      (response) => {\r\n        checkedLastError();\r\n        resolve(response);\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\nfunction backgroundTranslateText(\r\n  translationService,\r\n  sourceLanguage,\r\n  targetLanguage,\r\n  sourceArray\r\n) {\r\n  return new Promise((resolve, reject) => {\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"translateText\",\r\n        translationService,\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        sourceArray,\r\n      },\r\n      (response) => {\r\n        checkedLastError();\r\n        resolve(response);\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\nfunction backgroundTranslateSingleText(\r\n  translationService,\r\n  sourceLanguage,\r\n  targetLanguage,\r\n  source\r\n) {\r\n  return new Promise((resolve, reject) => {\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"translateSingleText\",\r\n        translationService,\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        source,\r\n      },\r\n      (response) => {\r\n        checkedLastError();\r\n        resolve(response);\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\nvar pageTranslator = {};\r\n\r\nfunction getTabHostName() {\r\n  return new Promise((resolve) =>\r\n    chrome.runtime.sendMessage({ action: \"getTabHostName\" }, (result) => {\r\n      checkedLastError();\r\n      resolve(result);\r\n    })\r\n  );\r\n}\r\n\r\nPromise.all([twpConfig.onReady(), getTabHostName()]).then(function (_) {\r\n  const tabHostName = _[1];\r\n  // \"sup\" não será traduzido https://github.com/FilipePS/Traduzir-paginas-web/issues/647\r\n  /* prettier-ignore */\r\n  const htmlTagsInlineText = [\"#text\", \"a\", \"abbr\", \"acronym\", \"b\", \"bdo\", \"big\", \"cite\", \"dfn\", \"em\", \"i\", \"label\", \"q\", \"s\", \"small\", \"span\", \"strong\", \"sub\", /*\"sup\",*/ \"u\", \"tt\", \"var\"];\r\n  /* prettier-ignore */\r\n  const htmlTagsInlineIgnore = [\"br\", \"code\", \"kbd\", \"wbr\"]; // and input if type is submit or button, and <pre> depending on settings\r\n  /* prettier-ignore */\r\n  const htmlTagsNoTranslate = [\"title\", \"script\", \"style\", \"textarea\", \"svg\", \"template\"];\r\n\r\n  if (location.hostname === \"pdf.translatewebpages.org\") {\r\n    const index = htmlTagsInlineText.indexOf(\"span\");\r\n    if (index !== -1) {\r\n      htmlTagsInlineText.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  if (twpConfig.get(\"translateTag_pre\") !== \"yes\") {\r\n    htmlTagsInlineIgnore.push(\"pre\");\r\n  }\r\n  twpConfig.onChanged((name, newvalue) => {\r\n    switch (name) {\r\n      case \"translateTag_pre\":\r\n        const index = htmlTagsInlineIgnore.indexOf(\"pre\");\r\n        if (index !== -1) {\r\n          htmlTagsInlineIgnore.splice(index, 1);\r\n        }\r\n        if (newvalue !== \"yes\") {\r\n          htmlTagsInlineIgnore.push(\"pre\");\r\n        }\r\n        break;\r\n      case \"dontSortResults\":\r\n        dontSortResults = newvalue == \"yes\" ? true : false;\r\n        break;\r\n    }\r\n  });\r\n\r\n  //TODO FOO\r\n  if (\r\n    twpConfig.get(\"useOldPopup\") == \"yes\" ||\r\n    twpConfig.get(\"popupPanelSection\") <= 1\r\n  ) {\r\n    twpConfig.set(\"targetLanguage\", twpConfig.get(\"targetLanguages\")[0]);\r\n  }\r\n\r\n  // Pieces are a set of nodes separated by inline tags that form a sentence or paragraph.\r\n  let piecesToTranslate = [];\r\n  let originalTabLanguage = \"und\";\r\n  let currentPageLanguage = \"und\";\r\n  let pageLanguageState = \"original\";\r\n  let currentSourceLanguage = \"auto\";\r\n  let currentTargetLanguage = twpConfig.get(\"targetLanguage\");\r\n  let currentPageTranslatorService = twpConfig.get(\"pageTranslatorService\");\r\n  let dontSortResults =\r\n    twpConfig.get(\"dontSortResults\") == \"yes\" ? true : false;\r\n  let fooCount = 0;\r\n\r\n  let originalPageTitle;\r\n\r\n  let attributesToTranslate = [];\r\n\r\n  let translateNewNodesTimerHandler;\r\n  let newNodes = [];\r\n  let removedNodes = [];\r\n\r\n  let nodesToRestore = [];\r\n\r\n  function translateNewNodes() {\r\n    try {\r\n      newNodes.forEach((nn) => {\r\n        if (removedNodes.indexOf(nn) != -1) return;\r\n\r\n        let newPiecesToTranslate = getPiecesToTranslate(nn);\r\n\r\n        for (const i in newPiecesToTranslate) {\r\n          const newNodes = newPiecesToTranslate[i].nodes;\r\n          let finded = false;\r\n\r\n          for (const ntt of piecesToTranslate) {\r\n            if (ntt.nodes.some((n1) => newNodes.some((n2) => n1 === n2))) {\r\n              finded = true;\r\n            }\r\n          }\r\n\r\n          if (!finded) {\r\n            piecesToTranslate.push(newPiecesToTranslate[i]);\r\n          }\r\n        }\r\n      });\r\n    } catch (e) {\r\n      console.error(e);\r\n    } finally {\r\n      newNodes = [];\r\n      removedNodes = [];\r\n    }\r\n  }\r\n\r\n  const mutationObserver = new MutationObserver(function (mutations) {\r\n    const piecesToTranslate = [];\r\n\r\n    mutations.forEach((mutation) => {\r\n      mutation.addedNodes.forEach((addedNode) => {\r\n        const nodeName = addedNode.nodeName.toLowerCase();\r\n        if (!isNoTranslateNode(addedNode)) {\r\n          if (htmlTagsInlineText.indexOf(nodeName) == -1) {\r\n            if (htmlTagsInlineIgnore.indexOf(nodeName) == -1) {\r\n              piecesToTranslate.push(addedNode);\r\n            }\r\n          }\r\n        }\r\n      });\r\n\r\n      mutation.removedNodes.forEach((removedNode) => {\r\n        removedNodes.push(removedNode);\r\n      });\r\n    });\r\n\r\n    piecesToTranslate.forEach((ptt) => {\r\n      if (newNodes.indexOf(ptt) == -1) {\r\n        newNodes.push(ptt);\r\n      }\r\n    });\r\n  });\r\n\r\n  function enableMutatinObserver() {\r\n    disableMutatinObserver();\r\n\r\n    if (twpConfig.get(\"translateDynamicallyCreatedContent\") == \"yes\") {\r\n      translateNewNodesTimerHandler = setInterval(translateNewNodes, 2000);\r\n      mutationObserver.observe(document.body, {\r\n        childList: true,\r\n        subtree: true,\r\n      });\r\n    }\r\n  }\r\n\r\n  function disableMutatinObserver() {\r\n    clearInterval(translateNewNodesTimerHandler);\r\n    newNodes = [];\r\n    removedNodes = [];\r\n    mutationObserver.disconnect();\r\n    mutationObserver.takeRecords();\r\n  }\r\n\r\n  let pageIsVisible = document.visibilityState == \"visible\";\r\n  // isto faz com que partes do youtube não sejam traduzidas\r\n  // new IntersectionObserver(entries => {\r\n  //         if (entries[0].isIntersecting && document.visibilityState == \"visible\") {\r\n  //             pageIsVisible = true\r\n  //         } else {\r\n  //             pageIsVisible = false\r\n  //         }\r\n\r\n  //         if (pageIsVisible && pageLanguageState === \"translated\") {\r\n  //             enableMutatinObserver()\r\n  //         } else {\r\n  //             disableMutatinObserver()\r\n  //         }\r\n  //     }, {\r\n  //         root: null\r\n  //     })\r\n  //     .observe(document.body)\r\n\r\n  const handleVisibilityChange = function () {\r\n    if (document.visibilityState == \"visible\") {\r\n      pageIsVisible = true;\r\n    } else {\r\n      pageIsVisible = false;\r\n    }\r\n\r\n    if (pageIsVisible && pageLanguageState === \"translated\") {\r\n      enableMutatinObserver();\r\n    } else {\r\n      disableMutatinObserver();\r\n    }\r\n  };\r\n  document.addEventListener(\"visibilitychange\", handleVisibilityChange, false);\r\n\r\n  /**\r\n   *\r\n   * @param {HTMLElement} node\r\n   * @returns\r\n   */\r\n  function isNoTranslateNode(node) {\r\n    const nodeName = node.nodeName.toLowerCase();\r\n    const index = htmlTagsNoTranslate.indexOf(nodeName);\r\n    if (index === -1) {\r\n      return false;\r\n    } else {\r\n      // https://github.com/FilipePS/Traduzir-paginas-web/issues/654\r\n      if (\r\n        nodeName === \"script\" &&\r\n        node.getAttribute(\"data-spotim-module\") === \"spotim-launcher\" &&\r\n        [...node.childNodes].find((node) => node.nodeType === 1)\r\n      ) {\r\n        return false;\r\n      } else {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  function getPiecesToTranslate(root = document.documentElement) {\r\n    const piecesToTranslate = [\r\n      {\r\n        isTranslated: false,\r\n        parentElement: null,\r\n        topElement: null,\r\n        bottomElement: null,\r\n        nodes: [],\r\n      },\r\n    ];\r\n    let index = 0;\r\n    let currentParagraphSize = 0;\r\n\r\n    const getAllNodes = function (\r\n      node,\r\n      lastHTMLElement = null,\r\n      lastSelectOrDataListElement = null\r\n    ) {\r\n      if (node.nodeType == 1 || node.nodeType == 11) {\r\n        if (node.nodeType == 11) {\r\n          lastHTMLElement = node.host;\r\n          lastSelectOrDataListElement = null;\r\n        } else if (node.nodeType == 1) {\r\n          lastHTMLElement = node;\r\n          const nodeName = node.nodeName.toLowerCase();\r\n\r\n          if (nodeName === \"select\" || nodeName === \"datalist\")\r\n            lastSelectOrDataListElement = node;\r\n\r\n          if (\r\n            htmlTagsInlineIgnore.indexOf(nodeName) !== -1 ||\r\n            isNoTranslateNode(node) ||\r\n            node.classList.contains(\"notranslate\") ||\r\n            node.getAttribute(\"translate\") === \"no\" ||\r\n            node.isContentEditable ||\r\n            node.classList.contains(\"material-icons\") || // https://github.com/FilipePS/Traduzir-paginas-web/issues/481\r\n            node.classList.contains(\"material-symbols-outlined\") ||\r\n            nodeName.startsWith(\"br-\") || // https://github.com/FilipePS/Traduzir-paginas-web/issues/627\r\n            node.getAttribute(\"id\") === \"branch-select-menu\" || // https://github.com/FilipePS/Traduzir-paginas-web/issues/570\r\n            (location.hostname === \"twitter.com\" &&\r\n              nodeName === \"a\" &&\r\n              (node.matches ? node.matches(\"article a\") : true)) // https://github.com/FilipePS/Traduzir-paginas-web/issues/449\r\n          ) {\r\n            if (piecesToTranslate[index].nodes.length > 0) {\r\n              currentParagraphSize = 0;\r\n              piecesToTranslate[index].bottomElement = lastHTMLElement;\r\n              piecesToTranslate.push({\r\n                isTranslated: false,\r\n                parentElement: null,\r\n                topElement: null,\r\n                bottomElement: null,\r\n                nodes: [],\r\n              });\r\n              index++;\r\n            }\r\n            return;\r\n          }\r\n        }\r\n\r\n        function getAllChilds(childNodes) {\r\n          Array.from(childNodes).forEach((_node) => {\r\n            const nodeName = _node.nodeName.toLowerCase();\r\n\r\n            if (_node.nodeType == 1) {\r\n              lastHTMLElement = _node;\r\n              if (nodeName === \"select\" || nodeName === \"datalist\")\r\n                lastSelectOrDataListElement = _node;\r\n            }\r\n\r\n            if (htmlTagsInlineText.indexOf(nodeName) == -1) {\r\n              if (piecesToTranslate[index].nodes.length > 0) {\r\n                currentParagraphSize = 0;\r\n                piecesToTranslate[index].bottomElement = lastHTMLElement;\r\n                piecesToTranslate.push({\r\n                  isTranslated: false,\r\n                  parentElement: null,\r\n                  topElement: null,\r\n                  bottomElement: null,\r\n                  nodes: [],\r\n                });\r\n                index++;\r\n              }\r\n\r\n              getAllNodes(_node, lastHTMLElement, lastSelectOrDataListElement);\r\n\r\n              if (piecesToTranslate[index].nodes.length > 0) {\r\n                currentParagraphSize = 0;\r\n                piecesToTranslate[index].bottomElement = lastHTMLElement;\r\n                piecesToTranslate.push({\r\n                  isTranslated: false,\r\n                  parentElement: null,\r\n                  topElement: null,\r\n                  bottomElement: null,\r\n                  nodes: [],\r\n                });\r\n                index++;\r\n              }\r\n            } else {\r\n              getAllNodes(_node, lastHTMLElement, lastSelectOrDataListElement);\r\n            }\r\n          });\r\n        }\r\n\r\n        getAllChilds(node.childNodes);\r\n        if (!piecesToTranslate[index].bottomElement) {\r\n          piecesToTranslate[index].bottomElement = node;\r\n        }\r\n        if (node.shadowRoot) {\r\n          getAllChilds(node.shadowRoot.childNodes);\r\n          if (!piecesToTranslate[index].bottomElement) {\r\n            piecesToTranslate[index].bottomElement = node;\r\n          }\r\n        }\r\n      } else if (node.nodeType == 3) {\r\n        if (node.textContent.trim().length > 0) {\r\n          if (!piecesToTranslate[index].parentElement) {\r\n            if (\r\n              node &&\r\n              node.parentNode &&\r\n              node.parentNode.nodeName.toLowerCase() === \"option\" &&\r\n              lastSelectOrDataListElement\r\n            ) {\r\n              piecesToTranslate[index].parentElement =\r\n                lastSelectOrDataListElement;\r\n              piecesToTranslate[index].bottomElement =\r\n                lastSelectOrDataListElement;\r\n              piecesToTranslate[index].topElement = lastSelectOrDataListElement;\r\n            } else {\r\n              let temp = node.parentNode;\r\n              const nodeName = temp.nodeName.toLowerCase();\r\n              while (\r\n                temp &&\r\n                temp != root &&\r\n                (htmlTagsInlineText.indexOf(nodeName) != -1 ||\r\n                  htmlTagsInlineIgnore.indexOf(nodeName) != -1)\r\n              ) {\r\n                temp = temp.parentNode;\r\n              }\r\n              if (temp && temp.nodeType === 11) {\r\n                temp = temp.host;\r\n              }\r\n              piecesToTranslate[index].parentElement = temp;\r\n            }\r\n          }\r\n          if (!piecesToTranslate[index].topElement) {\r\n            piecesToTranslate[index].topElement = lastHTMLElement;\r\n          }\r\n          if (currentParagraphSize > 1000) {\r\n            currentParagraphSize = 0;\r\n            piecesToTranslate[index].bottomElement = lastHTMLElement;\r\n            const pieceInfo = {\r\n              isTranslated: false,\r\n              parentElement: null,\r\n              topElement: lastHTMLElement,\r\n              bottomElement: null,\r\n              nodes: [],\r\n            };\r\n            pieceInfo.parentElement = piecesToTranslate[index].parentElement;\r\n            piecesToTranslate.push(pieceInfo);\r\n            index++;\r\n          }\r\n          currentParagraphSize += node.textContent.length;\r\n          piecesToTranslate[index].nodes.push(node);\r\n          piecesToTranslate[index].bottomElement = null;\r\n        }\r\n      }\r\n    };\r\n    getAllNodes(root);\r\n\r\n    if (\r\n      piecesToTranslate.length > 0 &&\r\n      piecesToTranslate[piecesToTranslate.length - 1].nodes.length == 0\r\n    ) {\r\n      piecesToTranslate.pop();\r\n    }\r\n\r\n    return piecesToTranslate;\r\n  }\r\n\r\n  function getAttributesToTranslate(root = document.body) {\r\n    const attributesToTranslate = [];\r\n\r\n    const placeholdersElements = root.querySelectorAll(\r\n      \"input[placeholder], textarea[placeholder]\"\r\n    );\r\n    const altElements = root.querySelectorAll(\r\n      'area[alt], img[alt], input[type=\"image\"][alt]'\r\n    );\r\n    const valueElements = root.querySelectorAll(\r\n      'input[type=\"button\"], input[type=\"submit\"], input[type=\"reset\"]'\r\n    );\r\n    const titleElements = root.querySelectorAll(\"body [title]\");\r\n\r\n    function hasNoTranslate(elem) {\r\n      if (\r\n        elem &&\r\n        (elem.classList.contains(\"notranslate\") ||\r\n          elem.getAttribute(\"translate\") === \"no\")\r\n      ) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    placeholdersElements.forEach((e) => {\r\n      if (hasNoTranslate(e)) return;\r\n\r\n      const txt = e.getAttribute(\"placeholder\");\r\n      if (txt && txt.trim()) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: txt,\r\n          attrName: \"placeholder\",\r\n        });\r\n      }\r\n    });\r\n\r\n    altElements.forEach((e) => {\r\n      if (hasNoTranslate(e)) return;\r\n\r\n      const txt = e.getAttribute(\"alt\");\r\n      if (txt && txt.trim()) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: txt,\r\n          attrName: \"alt\",\r\n        });\r\n      }\r\n    });\r\n\r\n    valueElements.forEach((e) => {\r\n      if (hasNoTranslate(e)) return;\r\n\r\n      const txt = e.getAttribute(\"value\");\r\n      if (e.type == \"submit\" && !txt) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: \"Submit Query\",\r\n          attrName: \"value\",\r\n        });\r\n      } else if (e.type == \"reset\" && !txt) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: \"Reset\",\r\n          attrName: \"value\",\r\n        });\r\n      } else if (txt && txt.trim()) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: txt,\r\n          attrName: \"value\",\r\n        });\r\n      }\r\n    });\r\n\r\n    titleElements.forEach((e) => {\r\n      if (hasNoTranslate(e)) return;\r\n\r\n      const txt = e.getAttribute(\"title\");\r\n      if (txt && txt.trim()) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: txt,\r\n          attrName: \"title\",\r\n        });\r\n      }\r\n    });\r\n\r\n    return attributesToTranslate;\r\n  }\r\n\r\n  // encapsular o texto faz com que do video suma\r\n  // ao utilizar função como Pai.removeChild(filho)\r\n  // pode ser gerado um erro ao encapsular\r\n  function encapsulateTextNode(node) {\r\n    const fontNode = document.createElement(\"font\");\r\n    fontNode.setAttribute(\"style\", \"vertical-align: inherit;\");\r\n    fontNode.textContent = node.textContent;\r\n\r\n    node.replaceWith(fontNode);\r\n\r\n    return fontNode;\r\n  }\r\n\r\n  function translateTextContent(node, parentNode, text, toRestore) {\r\n    toRestore.translatedText = text;\r\n\r\n    if (location.hostname === \"pdf.translatewebpages.org\") {\r\n      if (\r\n        parentNode &&\r\n        parentNode.nodeName.toLowerCase() === \"span\" &&\r\n        parentNode.getAttribute(\"role\") === \"presentation\"\r\n      ) {\r\n        const oldClientWidth = node.parentNode.clientWidth;\r\n        node.textContent = text;\r\n        const newClientWidth = node.parentNode.clientWidth;\r\n        const transformMatch = parentNode.style.transform.match(\r\n          /[0-9]+[\\.]{1,1}[0-9]*/\r\n        );\r\n        const currentScaleX = transformMatch\r\n          ? parseFloat(transformMatch[0])\r\n          : 1.0;\r\n        toRestore.originalScale = currentScaleX;\r\n        parentNode.style.transform = `scaleX(${\r\n          currentScaleX *\r\n          Math.min(currentScaleX, oldClientWidth / newClientWidth)\r\n        })`;\r\n      } else {\r\n        node.textContent = text;\r\n      }\r\n    } else {\r\n      node.textContent = text;\r\n    }\r\n  }\r\n\r\n  function translateResults(piecesToTranslateNow, results) {\r\n    if (dontSortResults) {\r\n      for (let i = 0; i < results.length; i++) {\r\n        for (let j = 0; j < results[i].length; j++) {\r\n          if (piecesToTranslateNow[i].nodes[j]) {\r\n            const nodes = piecesToTranslateNow[i].nodes;\r\n            let translated = results[i][j] + \" \";\r\n            // In some case, results items count is over original node count\r\n            // Rest results append to last node\r\n            if (\r\n              piecesToTranslateNow[i].nodes.length - 1 === j &&\r\n              results[i].length > j\r\n            ) {\r\n              const restResults = results[i].slice(j + 1);\r\n              translated += restResults.join(\" \");\r\n            }\r\n\r\n            const originalTextNode = nodes[j];\r\n            const parentNode = nodes[j].parentNode;\r\n            if (showOriginal.isEnabled) {\r\n              nodes[j] = encapsulateTextNode(nodes[j]);\r\n              showOriginal.add(nodes[j]);\r\n            }\r\n\r\n            const toRestore = {\r\n              node: nodes[j],\r\n              original: originalTextNode,\r\n              originalText: originalTextNode.textContent,\r\n              translatedText: translated,\r\n              originalScale: null,\r\n              parentNode,\r\n            };\r\n            nodesToRestore.push(toRestore);\r\n\r\n            const originalText = originalTextNode.textContent;\r\n            handleCustomWords(\r\n              translated,\r\n              nodes[j].textContent,\r\n              currentPageTranslatorService,\r\n              currentSourceLanguage,\r\n              currentTargetLanguage\r\n            ).then((results) => {\r\n              // results = `${originalText.match(/^\\s*/)[0]}${results.trim()}${\r\n              //   originalText.match(/\\s*$/)[0]\r\n              // }`;\r\n              translateTextContent(nodes[j], parentNode, results, toRestore);\r\n            });\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      for (const i in piecesToTranslateNow) {\r\n        for (const j in piecesToTranslateNow[i].nodes) {\r\n          if (results[i][j]) {\r\n            const nodes = piecesToTranslateNow[i].nodes;\r\n            const translated = results[i][j] + \" \";\r\n\r\n            const originalTextNode = nodes[j];\r\n            const parentNode = nodes[j].parentNode;\r\n            if (showOriginal.isEnabled) {\r\n              nodes[j] = encapsulateTextNode(nodes[j]);\r\n              showOriginal.add(nodes[j]);\r\n            }\r\n\r\n            const toRestore = {\r\n              node: nodes[j],\r\n              original: originalTextNode,\r\n              originalText: originalTextNode.textContent,\r\n              translatedText: translated,\r\n              parentNode,\r\n            };\r\n            nodesToRestore.push(toRestore);\r\n\r\n            const originalText = originalTextNode.textContent;\r\n            handleCustomWords(\r\n              translated,\r\n              nodes[j].textContent,\r\n              currentPageTranslatorService,\r\n              currentSourceLanguage,\r\n              currentTargetLanguage\r\n            ).then((results) => {\r\n              // results = `${originalText.match(/^\\s*/)[0]}${results.trim()}${\r\n              //   originalText.match(/\\s*$/)[0]\r\n              // }`;\r\n              translateTextContent(nodes[j], parentNode, results, toRestore);\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    mutationObserver.takeRecords();\r\n  }\r\n\r\n  function translateAttributes(attributesToTranslateNow, results) {\r\n    for (const i in attributesToTranslateNow) {\r\n      const ati = attributesToTranslateNow[i];\r\n      ati.node.setAttribute(ati.attrName, results[i]);\r\n    }\r\n  }\r\n\r\n  function translationRoutine() {\r\n    try {\r\n      if (piecesToTranslate && pageIsVisible) {\r\n        (function () {\r\n          const innerHeight = window.innerHeight;\r\n\r\n          function isInScreen(element) {\r\n            const rect = element.getBoundingClientRect();\r\n            if (\r\n              (rect.top > 0 && rect.top <= innerHeight) ||\r\n              (rect.bottom > 0 && rect.bottom <= innerHeight)\r\n            ) {\r\n              return true;\r\n            }\r\n            return false;\r\n          }\r\n\r\n          function topIsInScreen(element) {\r\n            if (!element) {\r\n              // debugger;\r\n              return false;\r\n            }\r\n            const rect = element.getBoundingClientRect();\r\n            if (rect.top > 0 && rect.top <= innerHeight) {\r\n              return true;\r\n            }\r\n            return false;\r\n          }\r\n\r\n          function bottomIsInScreen(element) {\r\n            if (!element) {\r\n              // debugger;\r\n              return false;\r\n            }\r\n            const rect = element.getBoundingClientRect();\r\n            if (rect.bottom > 0 && rect.bottom <= innerHeight) {\r\n              return true;\r\n            }\r\n            return false;\r\n          }\r\n\r\n          const currentFooCount = fooCount;\r\n\r\n          const piecesToTranslateNow = [];\r\n          piecesToTranslate.forEach((ptt) => {\r\n            if (!ptt.isTranslated) {\r\n              if (\r\n                bottomIsInScreen(ptt.topElement) ||\r\n                topIsInScreen(ptt.bottomElement)\r\n              ) {\r\n                ptt.isTranslated = true;\r\n                piecesToTranslateNow.push(ptt);\r\n              }\r\n            }\r\n          });\r\n\r\n          const attributesToTranslateNow = [];\r\n          attributesToTranslate.forEach((ati) => {\r\n            if (!ati.isTranslated) {\r\n              if (isInScreen(ati.node)) {\r\n                ati.isTranslated = true;\r\n                attributesToTranslateNow.push(ati);\r\n              }\r\n            }\r\n          });\r\n\r\n          if (piecesToTranslateNow.length > 0) {\r\n            backgroundTranslateHTML(\r\n              currentPageTranslatorService,\r\n              currentSourceLanguage,\r\n              currentTargetLanguage,\r\n              piecesToTranslateNow.map((ptt) =>\r\n                ptt.nodes.map((node) => filterKeywordsInText(node.textContent))\r\n              ),\r\n              dontSortResults\r\n            ).then((results) => {\r\n              if (\r\n                pageLanguageState === \"translated\" &&\r\n                currentFooCount === fooCount\r\n              ) {\r\n                translateResults(piecesToTranslateNow, results);\r\n              }\r\n            });\r\n          }\r\n\r\n          if (attributesToTranslateNow.length > 0) {\r\n            backgroundTranslateText(\r\n              currentPageTranslatorService,\r\n              currentSourceLanguage,\r\n              currentTargetLanguage,\r\n              attributesToTranslateNow.map((ati) => ati.original)\r\n            ).then((results) => {\r\n              if (\r\n                pageLanguageState === \"translated\" &&\r\n                currentFooCount === fooCount\r\n              ) {\r\n                translateAttributes(attributesToTranslateNow, results);\r\n              }\r\n            });\r\n          }\r\n        })();\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n\r\n    clearTimeout(translationRoutine_handler);\r\n    translationRoutine_handler = setTimeout(translationRoutine, 300);\r\n  }\r\n\r\n  translationRoutine();\r\n\r\n  function translatePageTitle() {\r\n    const title = document.querySelector(\"title\");\r\n    if (\r\n      title &&\r\n      (title.classList.contains(\"notranslate\") ||\r\n        title.getAttribute(\"translate\") === \"no\")\r\n    ) {\r\n      return;\r\n    }\r\n    if (document.title.trim().length < 1) return;\r\n    originalPageTitle = document.title;\r\n\r\n    backgroundTranslateSingleText(\r\n      currentPageTranslatorService,\r\n      currentSourceLanguage,\r\n      currentTargetLanguage,\r\n      originalPageTitle\r\n    ).then((result) => {\r\n      if (result) {\r\n        document.title = result;\r\n      }\r\n    });\r\n  }\r\n\r\n  const pageLanguageStateObservers = [];\r\n\r\n  pageTranslator.onPageLanguageStateChange = function (callback) {\r\n    pageLanguageStateObservers.push(callback);\r\n  };\r\n\r\n  var translationRoutine_handler = null;\r\n\r\n  pageTranslator.translatePage = function (targetLanguage) {\r\n    fooCount++;\r\n    pageTranslator.restorePage();\r\n    showOriginal.enable();\r\n    chrome.runtime.sendMessage(\r\n      { action: \"removeTranslationsWithError\" },\r\n      checkedLastError\r\n    );\r\n\r\n    if (targetLanguage) {\r\n      currentTargetLanguage = targetLanguage;\r\n    }\r\n\r\n    // https://github.com/FilipePS/Traduzir-paginas-web/issues/619\r\n    if (\r\n      location.hostname === \"sberbank.com\" ||\r\n      location.hostname === \"www.sberbank.com\"\r\n    ) {\r\n      document.body.classList.remove(\"notranslate\");\r\n    }\r\n\r\n    if (location.hostname === \"pdf.translatewebpages.org\") {\r\n      document.getElementById(\"scaleSelect\").value = \"1.5\";\r\n      document.getElementById(\"scaleSelect\").dispatchEvent(new Event(\"change\"));\r\n    }\r\n\r\n    piecesToTranslate = getPiecesToTranslate();\r\n    attributesToTranslate = getAttributesToTranslate();\r\n\r\n    pageLanguageState = \"translated\";\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"setPageLanguageState\",\r\n        pageLanguageState,\r\n      },\r\n      checkedLastError\r\n    );\r\n    pageLanguageStateObservers.forEach((callback) =>\r\n      callback(pageLanguageState)\r\n    );\r\n    currentPageLanguage = currentTargetLanguage;\r\n\r\n    translatePageTitle();\r\n\r\n    enableMutatinObserver();\r\n\r\n    translationRoutine();\r\n  };\r\n\r\n  pageTranslator.restorePage = function () {\r\n    fooCount++;\r\n    piecesToTranslate = [];\r\n\r\n    showOriginal.disable();\r\n    disableMutatinObserver();\r\n\r\n    pageLanguageState = \"original\";\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"setPageLanguageState\",\r\n        pageLanguageState,\r\n      },\r\n      checkedLastError\r\n    );\r\n    pageLanguageStateObservers.forEach((callback) =>\r\n      callback(pageLanguageState)\r\n    );\r\n    currentPageLanguage = originalTabLanguage;\r\n\r\n    if (originalPageTitle) {\r\n      document.title = originalPageTitle;\r\n    }\r\n    originalPageTitle = null;\r\n\r\n    for (const ntr of nodesToRestore) {\r\n      if (ntr.node === ntr.original) {\r\n        if (ntr.node.textContent === ntr.translatedText) {\r\n          ntr.node.textContent = ntr.originalText;\r\n        }\r\n      } else {\r\n        ntr.node.replaceWith(ntr.original);\r\n      }\r\n      if (ntr.originalScale) {\r\n        ntr.parentNode.style.transform = `scaleX(${ntr.originalScale}`;\r\n      }\r\n    }\r\n    nodesToRestore = [];\r\n\r\n    //TODO não restaurar atributos que foram modificados\r\n    for (const ati of attributesToTranslate) {\r\n      if (ati.isTranslated) {\r\n        ati.node.setAttribute(ati.attrName, ati.original);\r\n      }\r\n    }\r\n    attributesToTranslate = [];\r\n  };\r\n\r\n  pageTranslator.swapTranslationService = function (newServiceName) {\r\n    currentPageTranslatorService = newServiceName;\r\n    if (pageLanguageState === \"translated\") {\r\n      pageTranslator.translatePage();\r\n    }\r\n  };\r\n\r\n  pageTranslator.improveTranslation = function (info) {\r\n    currentPageTranslatorService = info.pageTranslatorService;\r\n    dontSortResults = info.dontSortResults === \"yes\" ? true : false;\r\n    currentSourceLanguage = info.sourceLanguage;\r\n    if (pageLanguageState === \"translated\") {\r\n      pageTranslator.translatePage(info.targetLanguage);\r\n    }\r\n  };\r\n\r\n  let alreadyGotTheLanguage = false;\r\n  const observers = [];\r\n\r\n  pageTranslator.onGetOriginalTabLanguage = function (callback) {\r\n    if (alreadyGotTheLanguage) {\r\n      callback(originalTabLanguage);\r\n    } else {\r\n      observers.push(callback);\r\n    }\r\n  };\r\n\r\n  chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\r\n    if (request.action === \"translatePage\") {\r\n      if (request.targetLanguage === \"original\") {\r\n        pageTranslator.restorePage();\r\n      } else {\r\n        pageTranslator.translatePage(request.targetLanguage);\r\n      }\r\n    } else if (request.action === \"restorePage\") {\r\n      pageTranslator.restorePage();\r\n    } else if (request.action === \"getOriginalTabLanguage\") {\r\n      pageTranslator.onGetOriginalTabLanguage(function () {\r\n        sendResponse(originalTabLanguage);\r\n      });\r\n      return true;\r\n    } else if (request.action === \"getCurrentPageLanguage\") {\r\n      sendResponse(currentPageLanguage);\r\n    } else if (request.action === \"getCurrentPageLanguageState\") {\r\n      sendResponse(pageLanguageState);\r\n    } else if (request.action === \"getCurrentPageTranslatorService\") {\r\n      sendResponse(currentPageTranslatorService);\r\n    } else if (request.action === \"swapTranslationService\") {\r\n      pageTranslator.swapTranslationService(request.newServiceName);\r\n    } else if (request.action === \"toggle-translation\") {\r\n      if (pageLanguageState === \"translated\") {\r\n        pageTranslator.restorePage();\r\n      } else {\r\n        pageTranslator.translatePage();\r\n      }\r\n    } else if (request.action === \"autoTranslateBecauseClickedALink\") {\r\n      if (twpConfig.get(\"autoTranslateWhenClickingALink\") === \"yes\") {\r\n        pageTranslator.onGetOriginalTabLanguage(function () {\r\n          if (\r\n            pageLanguageState === \"original\" &&\r\n            originalTabLanguage !== currentTargetLanguage &&\r\n            twpConfig\r\n              .get(\"neverTranslateLangs\")\r\n              .indexOf(originalTabLanguage) === -1\r\n          ) {\r\n            pageTranslator.translatePage();\r\n          }\r\n        });\r\n      }\r\n    } else if (request.action === \"restorePagesWithServiceNames\") {\r\n      if (request.serviceNames.includes(currentPageTranslatorService)) {\r\n        pageTranslator.restorePage();\r\n        currentPageTranslatorService = request.newServiceName;\r\n      }\r\n    } else if (request.action === \"improveTranslation\") {\r\n      pageTranslator.improveTranslation(request);\r\n    } else if (request.action === \"getCurrentSourceLanguage\") {\r\n      sendResponse(currentSourceLanguage);\r\n    } else if (request.action === \"getDontSortResults\") {\r\n      sendResponse(dontSortResults);\r\n    } else if (request.action === \"cleanUp\") {\r\n      pageTranslator.restorePage();\r\n    }\r\n  });\r\n\r\n  // Requests the detection of the tab language in the background\r\n  if (window.self === window.top) {\r\n    // is main frame\r\n    const onTabVisible = function () {\r\n      chrome.runtime.sendMessage(\r\n        {\r\n          action: \"detectTabLanguage\",\r\n        },\r\n        (result) => {\r\n          checkedLastError();\r\n\r\n          result = result || \"und\";\r\n          if (result === \"und\") {\r\n            originalTabLanguage = result;\r\n            if (\r\n              twpConfig.get(\"alwaysTranslateSites\").indexOf(tabHostName) !==\r\n                -1 ||\r\n              (location.hostname === \"pdf.translatewebpages.org\" &&\r\n                twpConfig.get(\"neverTranslateSites\").indexOf(tabHostName) ===\r\n                  -1)\r\n            ) {\r\n              pageTranslator.translatePage();\r\n            }\r\n          } else {\r\n            const langCode = twpLang.fixTLanguageCode(result);\r\n            if (langCode) {\r\n              originalTabLanguage = langCode;\r\n            }\r\n            if (\r\n              (location.hostname === \"pdftohtml.translatewebpages.org\" &&\r\n                location.href.indexOf(\"?autotranslate\") !== -1 &&\r\n                twpConfig.get(\"neverTranslateSites\").indexOf(tabHostName) ===\r\n                  -1) ||\r\n              (location.hostname === \"pdf.translatewebpages.org\" &&\r\n                twpConfig.get(\"neverTranslateSites\").indexOf(tabHostName) ===\r\n                  -1)\r\n            ) {\r\n              pageTranslator.translatePage();\r\n            } else {\r\n              if (\r\n                location.hostname !== \"translate.googleusercontent.com\" &&\r\n                location.hostname !== \"translate.google.com\" &&\r\n                location.hostname !== \"translate.yandex.com\" &&\r\n                location.hostname !== \"www.deepl.com\" &&\r\n                location.hostname !== \"translated.turbopages.org\" &&\r\n                !location.hostname.endsWith(\"translate.goog\") &&\r\n                location.hostname !== \"sberbank.com\" &&\r\n                location.hostname !== \"www.sberbank.com\" // https://github.com/FilipePS/Traduzir-paginas-web/issues/619\r\n              ) {\r\n                if (\r\n                  pageLanguageState === \"original\" &&\r\n                  !platformInfo.isMobile.any &&\r\n                  !chrome.extension.inIncognitoContext\r\n                ) {\r\n                  if (\r\n                    twpConfig\r\n                      .get(\"neverTranslateSites\")\r\n                      .indexOf(tabHostName) === -1\r\n                  ) {\r\n                    if (\r\n                      langCode &&\r\n                      langCode !== currentTargetLanguage &&\r\n                      twpConfig\r\n                        .get(\"alwaysTranslateLangs\")\r\n                        .indexOf(langCode) !== -1\r\n                    ) {\r\n                      pageTranslator.translatePage();\r\n                    } else if (\r\n                      twpConfig\r\n                        .get(\"alwaysTranslateSites\")\r\n                        .indexOf(tabHostName) !== -1\r\n                    ) {\r\n                      pageTranslator.translatePage();\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n\r\n          observers.forEach((callback) => callback(originalTabLanguage));\r\n          alreadyGotTheLanguage = true;\r\n        }\r\n      );\r\n    };\r\n    setTimeout(function () {\r\n      if (document.visibilityState == \"visible\") {\r\n        onTabVisible();\r\n      } else {\r\n        const handleVisibilityChange = function () {\r\n          if (document.visibilityState == \"visible\") {\r\n            document.removeEventListener(\r\n              \"visibilitychange\",\r\n              handleVisibilityChange\r\n            );\r\n            onTabVisible();\r\n          }\r\n        };\r\n        document.addEventListener(\r\n          \"visibilitychange\",\r\n          handleVisibilityChange,\r\n          false\r\n        );\r\n      }\r\n    }, 150);\r\n  } else {\r\n    // is subframe (iframe)\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"getMainFrameTabLanguage\",\r\n      },\r\n      (result) => {\r\n        checkedLastError();\r\n\r\n        originalTabLanguage = result || \"und\";\r\n        observers.forEach((callback) => callback(originalTabLanguage));\r\n        alreadyGotTheLanguage = true;\r\n      }\r\n    );\r\n\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"getMainFramePageLanguageState\",\r\n      },\r\n      (result) => {\r\n        checkedLastError();\r\n\r\n        if (result === \"translated\" && pageLanguageState === \"original\") {\r\n          pageTranslator.translatePage();\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  showOriginal.enabledObserverSubscribe(function () {\r\n    if (pageLanguageState !== \"original\") {\r\n      pageTranslator.translatePage();\r\n    }\r\n  });\r\n});\r\n"],"mappings":"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"}
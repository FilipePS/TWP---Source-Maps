{"version":3,"file":"../../lib/i18n.js","names":["twpI18n","messages","getMessage","messageName","substitutions","toLowerCase","message","find","m","name","chrome","i18n","finalMessage","placeholders","key","value","Object","entries","content","match","index","parseInt","Array","replaceAll","String","e","console","log","translateAttributes","root","attributeName","element","querySelectorAll","text","getAttribute","setAttribute","translateDocument","document","textContent","updateUiMessages","temporaryLanguage","uiLanguage","twpConfig","get","replace","fetch","runtime","getURL","then","response","json","result","keys","map","catch","warn","onReady","onChanged","newValue"],"sources":["i18n.js"],"sourcesContent":["\"use strict\";\r\n\r\nconst twpI18n = (function () {\r\n  const twpI18n = {};\r\n  let messages = null;\r\n\r\n  /**\r\n   * Gets the localized string for the specified message\r\n   * @example\r\n   * getMessage(\"lblAlwaysTranslate\", \"German\")\r\n   * // returns \"Always translate from German\"\r\n   * getMessage(\"lblAlwaysTranslate\", [\"German\"])\r\n   * // returns \"Always translate from German\"\r\n   * @param {string} messageName\r\n   * @param {string | string[]} substitutions\r\n   * @returns {string} localizedString\r\n   */\r\n  twpI18n.getMessage = function (messageName, substitutions = null) {\r\n    try {\r\n      if (messages) {\r\n        messageName = messageName.toLowerCase();\r\n        const message = messages.find((m) => m.name === messageName);\r\n        if (!message) return chrome.i18n.getMessage(messageName, substitutions);\r\n\r\n        /** @type {string} */\r\n        let finalMessage = message.message;\r\n\r\n        if (message.placeholders) {\r\n          for (const [key, value] of Object.entries(message.placeholders)) {\r\n            /** @type {string} */\r\n            let content = value.content;\r\n            let match = content.match(/\\$([1-9][0-9]*)/);\r\n            let index = match ? parseInt(match[1]) : null;\r\n            if (index) {\r\n              if (substitutions instanceof Array) {\r\n                content = content.replaceAll(\r\n                  \"$\" + index,\r\n                  String(substitutions[index - 1])\r\n                );\r\n              } else if (index === 1) {\r\n                content = content.replaceAll(\r\n                  \"$\" + index,\r\n                  String(substitutions)\r\n                );\r\n              } else {\r\n                content = content.replaceAll(\"$\" + index, \"\");\r\n              }\r\n            }\r\n            finalMessage = finalMessage.replaceAll(\"$\" + key + \"$\", content);\r\n          }\r\n        }\r\n\r\n        return finalMessage;\r\n      } else {\r\n        return chrome.i18n.getMessage(messageName, substitutions);\r\n      }\r\n    } catch (e) {\r\n      console.log(e);\r\n      return chrome.i18n.getMessage(messageName, substitutions);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * translate attribute in all childNodes\r\n   * @param {Document | HTMLElement | ShadowRoot} root\r\n   * @param {string} attributeName\r\n   */\r\n  function translateAttributes(root, attributeName) {\r\n    for (const element of root.querySelectorAll(\r\n      `[data-i18n-${attributeName}]`\r\n    )) {\r\n      let text = twpI18n.getMessage(\r\n        element.getAttribute(`data-i18n-${attributeName}`),\r\n        element.getAttribute(\"data-i18n-ph-value\")\r\n      );\r\n      if (!text) {\r\n        continue;\r\n      }\r\n\r\n      element.setAttribute(attributeName, text);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * translate innerText and attributes for a Document or HTMLElement\r\n   * @param {Document | HTMLElement | ShadowRoot} root\r\n   */\r\n  twpI18n.translateDocument = function (root = document) {\r\n    for (const element of root.querySelectorAll(\"[data-i18n]\")) {\r\n      let text = twpI18n.getMessage(\r\n        element.getAttribute(\"data-i18n\"),\r\n        element.getAttribute(\"data-i18n-ph-value\")\r\n      );\r\n      if (!text) {\r\n        continue;\r\n      }\r\n      element.textContent = text;\r\n    }\r\n\r\n    translateAttributes(root, \"title\");\r\n    translateAttributes(root, \"placeholder\");\r\n    translateAttributes(root, \"label\");\r\n  };\r\n\r\n  /**\r\n   * Updates interface location messages based on user preference\r\n   * @returns {Promise<void>}\r\n   */\r\n  twpI18n.updateUiMessages = async (temporaryLanguage = null) => {\r\n    let uiLanguage = temporaryLanguage || twpConfig.get(\"uiLanguage\");\r\n    uiLanguage = uiLanguage.replace(\"-\", \"_\");\r\n    if (uiLanguage === \"default\") {\r\n      messages = null;\r\n    } else {\r\n      return await fetch(\r\n        chrome.runtime.getURL(`/_locales/${uiLanguage}/messages.json`)\r\n      )\r\n        .then((response) => response.json())\r\n        .then((result) => {\r\n          messages = Object.keys(result).map((key) => ({\r\n            name: key.toLowerCase(),\r\n            message: result[key].message,\r\n            placeholders: result[key].placeholders,\r\n          }));\r\n        })\r\n        .catch((e) => {\r\n          messages = null;\r\n          console.warn(e);\r\n        });\r\n    }\r\n  };\r\n\r\n  twpConfig.onReady(function () {\r\n    twpI18n.updateUiMessages();\r\n\r\n    twpConfig.onChanged(function (name, newValue) {\r\n      if (name === \"uiLanguage\") {\r\n        twpI18n.updateUiMessages();\r\n      }\r\n    });\r\n  });\r\n\r\n  return twpI18n;\r\n})();\r\n"],"mappings":"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","ignoreList":[]}
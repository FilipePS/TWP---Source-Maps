{"version":3,"file":"../../contentScript/pageTranslator.js","names":["startMark","endMark","startMark0","endMark0","bingMarkFrontPart","bingMarkSecondPart","currentIndex","compressionMap","filterKeywordsInText","textContext","sortedCustomDictionary","currentPageTranslatorService","size","keyWord","keys","index","toLowerCase","indexOf","removeExtraDelimiter","previousIndex","nextIndex","length","previousChar","charAt","nextChar","placeholderText","keyWordWithCase","substring","isPunctuationOrDelimiter","customValue","get","handleHitKeywords","c","Array","from","frontPart","backPart","replaceAll","handleCustomWords","translated","originalText","customDictionary","currentSourceLanguage","currentTargetLanguage","trim","startIndex","endIndex","Error","e","backgroundTranslateSingleText","value","mode","undefined","Map","set","String","Number","str","regex","test","sortDictionary","entries","sort","a","b","replace","backgroundTranslateHTML","translationService","sourceLanguage","targetLanguage","sourceArray2d","dontSortResults","Promise","resolve","reject","chrome","runtime","sendMessage","action","response","checkedLastError","backgroundTranslateText","sourceArray","source","pageTranslator","getTabHostName","result","all","twpConfig","onReady","then","_","tabHostName","htmlTagsInlineText","htmlTagsInlineIgnore","htmlTagsNoTranslate","location","hostname","splice","document","body","childElementCount","firstChild","nodeName","toLocaleLowerCase","push","onChanged","name","newvalue","piecesToTranslate","originalTabLanguage","currentPageLanguage","pageLanguageState","fooCount","originalPageTitle","attributesToTranslate","translateNewNodesTimerHandler","newNodes","removedNodes","nodesToRestore","translateNewNodes","forEach","nn","newPiecesToTranslate","getPiecesToTranslate","i","nodes","finded","ntt","some","n1","n2","console","error","mutationObserver","MutationObserver","mutations","mutation","addedNodes","addedNode","isNoTranslateNode","removedNode","ptt","enableMutatinObserver","disableMutatinObserver","setInterval","observe","childList","subtree","clearInterval","disconnect","takeRecords","pageIsVisible","visibilityState","handleVisibilityChange","addEventListener","node","classList","contains","getAttribute","childNodes","find","nodeType","root","documentElement","isTranslated","parentElement","topElement","bottomElement","currentParagraphSize","getAllNodes","lastHTMLElement","lastSelectOrDataListElement","host","isContentEditable","startsWith","matches","getAllChilds","_node","shadowRoot","textContent","parentNode","temp","pieceInfo","pop","getAttributesToTranslate","placeholdersElements","querySelectorAll","altElements","valueElements","titleElements","hasNoTranslate","elem","txt","original","attrName","type","encapsulateTextNode","fontNode","createElement","setAttribute","replaceWith","translateTextContent","text","toRestore","translatedText","oldClientWidth","clientWidth","newClientWidth","transformMatch","style","transform","match","currentScaleX","parseFloat","originalScale","Math","min","translateResults","piecesToTranslateNow","results","j","restResults","slice","join","originalTextNode","showOriginal","isEnabled","add","translateAttributes","attributesToTranslateNow","ati","translationRoutine","innerHeight","window","isInScreen","element","rect","getBoundingClientRect","top","bottom","topIsInScreen","bottomIsInScreen","currentFooCount","map","clearTimeout","translationRoutine_handler","setTimeout","translatePageTitle","title","querySelector","pageLanguageStateObservers","onPageLanguageStateChange","callback","translatePage","restorePage","enable","remove","getElementById","dispatchEvent","Event","disable","ntr","swapTranslationService","newServiceName","improveTranslation","info","pageTranslatorService","alreadyGotTheLanguage","observers","onGetOriginalTabLanguage","textContentLanguageDetectionPromise","onMessage","addListener","request","sender","sendResponse","serviceNames","includes","i18n","detectLanguage","isReliable","languages","language","self","onTabVisible","platformInfo","isMobile","any","langCode","twpLang","fixTLanguageCode","href","endsWith","extension","inIncognitoContext","removeEventListener","enabledObserverSubscribe"],"sources":["pageTranslator.js"],"sourcesContent":["\"use strict\";\r\n\r\n/**\r\n * This mark cannot contain words, like <customskipword>12</customskipword>34\r\n *\r\n * Google will reorder as <customskipword>1234</customskipword>\r\n *\r\n * Under certain circumstancesï¼ŒGoogle broken the translation, returned startMark0 in some cases\r\n * */\r\nconst startMark = \"@%\";\r\nconst endMark = \"#$\";\r\nconst startMark0 = \"@ %\";\r\nconst endMark0 = \"# $\";\r\n\r\nconst bingMarkFrontPart = '<mstrans:dictionary translation=\"';\r\nconst bingMarkSecondPart = '\"></mstrans:dictionary>';\r\n\r\nlet currentIndex;\r\nlet compressionMap;\r\n\r\n/**\r\n * ## custom dictionary functional preprocessing\r\n *\r\n * ### How to achieve:\r\n * 1. For Google and Yandex, this feature is not officially supported,\r\n *    we convert matching keywords to a string of special signs to skip translation,\r\n *    before sending to the translation engine,\r\n *    and after the results come back, call `handleCustomWords` to restore the words.\r\n * 2. For Bing, this feature is officially supported,\r\n *    we don't need to call `handleCustomWords`, Bing absorb these marks.\r\n *    And bing does not have the language restrictions in the third point below.\r\n *\r\n *  ### Notes:\r\n *  1. For English words, ignore case when matching.\r\n *  2. CustomDictionary must be sorted , we want to match the keyword \"Spring Boot\" first then the keyword \"Spring\"\r\n *  3. For the word \"app\" , We don't want to \"Happy\" also matched.\r\n *     So we match only isolated words, by checking the two characters before and after the keyword.\r\n *     But this will also cause this method to not work for Chinese, Burmese and other languages without spaces.\r\n * */\r\nfunction filterKeywordsInText(\r\n  textContext,\r\n  sortedCustomDictionary,\r\n  currentPageTranslatorService\r\n) {\r\n  if (sortedCustomDictionary.size > 0) {\r\n    for (let keyWord of sortedCustomDictionary.keys()) {\r\n      while (true) {\r\n        let index = textContext.toLowerCase().indexOf(keyWord);\r\n        if (index === -1) {\r\n          break;\r\n        } else {\r\n          textContext = removeExtraDelimiter(textContext);\r\n          let previousIndex = index - 1;\r\n          let nextIndex = index + keyWord.length;\r\n          let previousChar =\r\n            previousIndex === -1 ? \"\\n\" : textContext.charAt(previousIndex);\r\n          let nextChar =\r\n            nextIndex === textContext.length\r\n              ? \"\\n\"\r\n              : textContext.charAt(nextIndex);\r\n          let placeholderText = \"\";\r\n          let keyWordWithCase = textContext.substring(\r\n            index,\r\n            index + keyWord.length\r\n          );\r\n          if (\r\n            isPunctuationOrDelimiter(previousChar) &&\r\n            isPunctuationOrDelimiter(nextChar)\r\n          ) {\r\n            /**\r\n             * Bing's translation engine, officially provides custom dictionary function,\r\n             * so it has its own separate tags.\r\n             * At the same time we add a space before and after the word to make it look a little more comfortable.\r\n             * */\r\n            if (currentPageTranslatorService === \"bing\") {\r\n              let customValue = sortedCustomDictionary.get(keyWord);\r\n              if (customValue === \"\") customValue = keyWordWithCase;\r\n              customValue =\r\n                \" \" +\r\n                customValue.substring(0, 1) +\r\n                \"#n%o#\" +\r\n                customValue.substring(1) +\r\n                \" \";\r\n              placeholderText =\r\n                bingMarkFrontPart + customValue + bingMarkSecondPart;\r\n            } else {\r\n              placeholderText =\r\n                startMark + handleHitKeywords(keyWordWithCase, true) + endMark;\r\n            }\r\n          } else {\r\n            placeholderText = \"#n%o#\";\r\n            for (let c of Array.from(keyWordWithCase)) {\r\n              placeholderText += c;\r\n              placeholderText += \"#n%o#\";\r\n            }\r\n          }\r\n          let frontPart = textContext.substring(0, index);\r\n          let backPart = textContext.substring(index + keyWord.length);\r\n          textContext = frontPart + placeholderText + backPart;\r\n        }\r\n      }\r\n      textContext = textContext.replaceAll(\"#n%o#\", \"\");\r\n    }\r\n  }\r\n  return textContext;\r\n}\r\n\r\n/**\r\n *  handle the keywords in translatedText, replace it if there is a custom replacement value.\r\n *  When encountering Google Translate reordering, the original text contains our mark, etc.\r\n *  we will catch these exceptions and call the text translation method to retranslate this section.\r\n *\r\n * Note:\r\n *  1. Bing's translation engine has its own separate tags,and the engine digests these tags internally,\r\n *  we don't need to call the method below.\r\n **/\r\nasync function handleCustomWords(\r\n  translated,\r\n  originalText,\r\n  customDictionary,\r\n  currentPageTranslatorService,\r\n  currentSourceLanguage,\r\n  currentTargetLanguage\r\n) {\r\n  try {\r\n    if (customDictionary.size > 0 && currentPageTranslatorService !== \"bing\") {\r\n      // If the translation is a single word and exists in the dictionary, return it directly\r\n      let customValue = customDictionary.get(originalText.trim());\r\n      if (customValue) return customValue;\r\n\r\n      translated = removeExtraDelimiter(translated);\r\n      translated = translated.replaceAll(startMark0, startMark);\r\n      translated = translated.replaceAll(endMark0, endMark);\r\n\r\n      while (true) {\r\n        let startIndex = translated.indexOf(startMark);\r\n        let endIndex = translated.indexOf(endMark);\r\n        if (startIndex === -1 && endIndex === -1) {\r\n          break;\r\n        } else {\r\n          let placeholderText = translated.substring(\r\n            startIndex + startMark.length,\r\n            endIndex\r\n          );\r\n          // At this point placeholderText is actually currentIndex , the real value is in compressionMap\r\n          let keyWord = handleHitKeywords(placeholderText, false);\r\n          if (keyWord === \"undefined\") {\r\n            throw new Error(\"undefined\");\r\n          }\r\n          let frontPart = translated.substring(0, startIndex);\r\n          let backPart = translated.substring(endIndex + endMark.length);\r\n          let customValue = customDictionary.get(keyWord.toLowerCase());\r\n          customValue = customValue === \"\" ? keyWord : customValue;\r\n          // Highlight custom words, make it have a space before and after it\r\n          frontPart = isPunctuationOrDelimiter(\r\n            frontPart.charAt(frontPart.length - 1)\r\n          )\r\n            ? frontPart\r\n            : frontPart + \" \";\r\n          backPart = isPunctuationOrDelimiter(backPart.charAt(0))\r\n            ? backPart\r\n            : \" \" + backPart;\r\n          translated = frontPart + customValue + backPart;\r\n        }\r\n      }\r\n    }\r\n  } catch (e) {\r\n    return await backgroundTranslateSingleText(\r\n      currentPageTranslatorService,\r\n      currentSourceLanguage,\r\n      currentTargetLanguage,\r\n      originalText\r\n    );\r\n  }\r\n\r\n  return translated;\r\n}\r\n\r\n/**\r\n *\r\n * True : Store the keyword in the Map and return the index\r\n *\r\n * False : Extract keywords by index\r\n * */\r\nfunction handleHitKeywords(value, mode) {\r\n  if (mode) {\r\n    if (currentIndex === undefined) {\r\n      currentIndex = 1;\r\n      compressionMap = new Map();\r\n      compressionMap.set(currentIndex, value);\r\n    } else {\r\n      compressionMap.set(++currentIndex, value);\r\n    }\r\n    return String(currentIndex);\r\n  } else {\r\n    return String(compressionMap.get(Number(value)));\r\n  }\r\n}\r\n\r\n/**\r\n * any kind of punctuation character (including international e.g. Chinese and Spanish punctuation), and spaces, newlines\r\n *\r\n * source: https://github.com/slevithan/xregexp/blob/41f4cd3fc0a8540c3c71969a0f81d1f00e9056a9/src/addons/unicode/unicode-categories.js#L142\r\n *\r\n * note: XRegExp unicode output taken from http://jsbin.com/uFiNeDOn/3/edit?js,console (see chrome console.log), then converted back to JS escaped unicode here http://rishida.net/tools/conversion/, then tested on http://regexpal.com/\r\n *\r\n * suggested by: https://stackoverflow.com/a/7578937\r\n *\r\n * added: extra characters like \"$\", \"\\uFFE5\" [yen symbol], \"^\", \"+\", \"=\" which are not consider punctuation in the XRegExp regex (they are currency or mathmatical characters)\r\n *\r\n * added: Chinese Punctuation: \\u3002|\\uff1f|\\uff01|\\uff0c|\\u3001|\\uff1b|\\uff1a|\\u201c|\\u201d|\\u2018|\\u2019|\\uff08|\\uff09|\\u300a|\\u300b|\\u3010|\\u3011|\\u007e\r\n *\r\n * added: special html space symbol: &nbsp; &ensp; &emsp; &thinsp; &zwnj; &zwj; -> \\u00A0|\\u2002|\\u2003|\\u2009|\\u200C|\\u200D\r\n * @see https://stackoverflow.com/a/21396529/19616126\r\n * */\r\nfunction isPunctuationOrDelimiter(str) {\r\n  if (typeof str !== \"string\") return false;\r\n  if (str === \"\\n\" || str === \" \") return true;\r\n  const regex =\r\n    /[\\$\\uFFE5\\^\\+=`~<>{}\\[\\]|\\u00A0|\\u2002|\\u2003|\\u2009|\\u200C|\\u200D|\\u3002|\\uff1f|\\uff01|\\uff0c|\\u3001|\\uff1b|\\uff1a|\\u201c|\\u201d|\\u2018|\\u2019|\\uff08|\\uff09|\\u300a|\\u300b|\\u3010|\\u3011|\\u007e!-#%-\\x2A,-/:;\\x3F@\\x5B-\\x5D_\\x7B}\\u00A1\\u00A7\\u00AB\\u00B6\\u00B7\\u00BB\\u00BF\\u037E\\u0387\\u055A-\\u055F\\u0589\\u058A\\u05BE\\u05C0\\u05C3\\u05C6\\u05F3\\u05F4\\u0609\\u060A\\u060C\\u060D\\u061B\\u061E\\u061F\\u066A-\\u066D\\u06D4\\u0700-\\u070D\\u07F7-\\u07F9\\u0830-\\u083E\\u085E\\u0964\\u0965\\u0970\\u0AF0\\u0DF4\\u0E4F\\u0E5A\\u0E5B\\u0F04-\\u0F12\\u0F14\\u0F3A-\\u0F3D\\u0F85\\u0FD0-\\u0FD4\\u0FD9\\u0FDA\\u104A-\\u104F\\u10FB\\u1360-\\u1368\\u1400\\u166D\\u166E\\u169B\\u169C\\u16EB-\\u16ED\\u1735\\u1736\\u17D4-\\u17D6\\u17D8-\\u17DA\\u1800-\\u180A\\u1944\\u1945\\u1A1E\\u1A1F\\u1AA0-\\u1AA6\\u1AA8-\\u1AAD\\u1B5A-\\u1B60\\u1BFC-\\u1BFF\\u1C3B-\\u1C3F\\u1C7E\\u1C7F\\u1CC0-\\u1CC7\\u1CD3\\u2010-\\u2027\\u2030-\\u2043\\u2045-\\u2051\\u2053-\\u205E\\u207D\\u207E\\u208D\\u208E\\u2329\\u232A\\u2768-\\u2775\\u27C5\\u27C6\\u27E6-\\u27EF\\u2983-\\u2998\\u29D8-\\u29DB\\u29FC\\u29FD\\u2CF9-\\u2CFC\\u2CFE\\u2CFF\\u2D70\\u2E00-\\u2E2E\\u2E30-\\u2E3B\\u3001-\\u3003\\u3008-\\u3011\\u3014-\\u301F\\u3030\\u303D\\u30A0\\u30FB\\uA4FE\\uA4FF\\uA60D-\\uA60F\\uA673\\uA67E\\uA6F2-\\uA6F7\\uA874-\\uA877\\uA8CE\\uA8CF\\uA8F8-\\uA8FA\\uA92E\\uA92F\\uA95F\\uA9C1-\\uA9CD\\uA9DE\\uA9DF\\uAA5C-\\uAA5F\\uAADE\\uAADF\\uAAF0\\uAAF1\\uABEB\\uFD3E\\uFD3F\\uFE10-\\uFE19\\uFE30-\\uFE52\\uFE54-\\uFE61\\uFE63\\uFE68\\uFE6A\\uFE6B\\uFF01-\\uFF03\\uFF05-\\uFF0A\\uFF0C-\\uFF0F\\uFF1A\\uFF1B\\uFF1F\\uFF20\\uFF3B-\\uFF3D\\uFF3F\\uFF5B\\uFF5D\\uFF5F-\\uFF65]+/g;\r\n  return regex.test(str);\r\n}\r\n\r\n/**\r\n * get a sorted dictionary\r\n * */\r\nfunction sortDictionary(customDictionary) {\r\n  return new Map(\r\n    [...customDictionary.entries()].sort(\r\n      (a, b) => String(b[0]).length - String(a[0]).length\r\n    )\r\n  );\r\n}\r\n\r\n/**\r\n * Remove useless newlines, spaces inside, which may affect our semantics\r\n * */\r\nfunction removeExtraDelimiter(textContext) {\r\n  textContext = textContext.replaceAll(\"\\n\", \" \");\r\n  textContext = textContext.replace(/  +/g, \" \");\r\n  return textContext;\r\n}\r\n\r\nfunction backgroundTranslateHTML(\r\n  translationService,\r\n  sourceLanguage,\r\n  targetLanguage,\r\n  sourceArray2d,\r\n  dontSortResults\r\n) {\r\n  return new Promise((resolve, reject) => {\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"translateHTML\",\r\n        translationService,\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        sourceArray2d,\r\n        dontSortResults,\r\n      },\r\n      (response) => {\r\n        checkedLastError();\r\n        resolve(response);\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\nfunction backgroundTranslateText(\r\n  translationService,\r\n  sourceLanguage,\r\n  targetLanguage,\r\n  sourceArray\r\n) {\r\n  return new Promise((resolve, reject) => {\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"translateText\",\r\n        translationService,\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        sourceArray,\r\n      },\r\n      (response) => {\r\n        checkedLastError();\r\n        resolve(response);\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\nfunction backgroundTranslateSingleText(\r\n  translationService,\r\n  sourceLanguage,\r\n  targetLanguage,\r\n  source\r\n) {\r\n  return new Promise((resolve, reject) => {\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"translateSingleText\",\r\n        translationService,\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        source,\r\n      },\r\n      (response) => {\r\n        checkedLastError();\r\n        resolve(response);\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\nvar pageTranslator = {};\r\n\r\nfunction getTabHostName() {\r\n  return new Promise((resolve) =>\r\n    chrome.runtime.sendMessage({ action: \"getTabHostName\" }, (result) => {\r\n      checkedLastError();\r\n      resolve(result);\r\n    })\r\n  );\r\n}\r\n\r\nPromise.all([twpConfig.onReady(), getTabHostName()]).then(function (_) {\r\n  const tabHostName = _[1];\r\n  // \"sup\" nÃ£o serÃ¡ traduzido https://github.com/FilipePS/Traduzir-paginas-web/issues/647\r\n  /* prettier-ignore */\r\n  const htmlTagsInlineText = [\"#text\", \"a\", \"abbr\", \"acronym\", \"b\", \"bdo\", \"big\", \"cite\", \"dfn\", \"em\", \"i\", \"label\", \"q\", \"s\", \"small\", \"span\", \"strong\", \"sub\", /*\"sup\",*/ \"u\", \"tt\", \"var\"];\r\n  /* prettier-ignore */\r\n  const htmlTagsInlineIgnore = [\"br\", \"code\", \"kbd\", \"wbr\"]; // and input if type is submit or button, and <pre> depending on settings\r\n  /* prettier-ignore */\r\n  const htmlTagsNoTranslate = [\"title\", \"script\", \"style\", \"textarea\", \"svg\", \"template\",\r\n  \"math\", \"mjx-container\", \"tex-math\" // https://github.com/FilipePS/Traduzir-paginas-web/issues/704\r\n  ];\r\n\r\n  if (location.hostname === \"pdf.translatewebpages.org\") {\r\n    const index = htmlTagsInlineText.indexOf(\"span\");\r\n    if (index !== -1) {\r\n      htmlTagsInlineText.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  // https://github.com/FilipePS/Traduzir-paginas-web/issues/609\r\n  if (\r\n    twpConfig.get(\"translateTag_pre\") !== \"yes\" &&\r\n    !(\r\n      document.body.childElementCount === 1 &&\r\n      document.body.firstChild.nodeName.toLocaleLowerCase() === \"pre\"\r\n    )\r\n  ) {\r\n    htmlTagsInlineIgnore.push(\"pre\");\r\n  }\r\n  twpConfig.onChanged((name, newvalue) => {\r\n    switch (name) {\r\n      case \"translateTag_pre\":\r\n        const index = htmlTagsInlineIgnore.indexOf(\"pre\");\r\n        if (index !== -1) {\r\n          htmlTagsInlineIgnore.splice(index, 1);\r\n        }\r\n        if (\r\n          newvalue !== \"yes\" &&\r\n          !(\r\n            document.body.childElementCount === 1 &&\r\n            document.body.firstChild.nodeName.toLocaleLowerCase() === \"pre\"\r\n          )\r\n        ) {\r\n          htmlTagsInlineIgnore.push(\"pre\");\r\n        }\r\n        break;\r\n      case \"dontSortResults\":\r\n        dontSortResults = newvalue == \"yes\" ? true : false;\r\n        break;\r\n    }\r\n  });\r\n\r\n  //TODO FOO\r\n  if (\r\n    twpConfig.get(\"useOldPopup\") == \"yes\" ||\r\n    twpConfig.get(\"popupPanelSection\") <= 1\r\n  ) {\r\n    twpConfig.set(\"targetLanguage\", twpConfig.get(\"targetLanguages\")[0]);\r\n  }\r\n\r\n  // Pieces are a set of nodes separated by inline tags that form a sentence or paragraph.\r\n  let piecesToTranslate = [];\r\n  let originalTabLanguage = \"und\";\r\n  let currentPageLanguage = \"und\";\r\n  let pageLanguageState = \"original\";\r\n  let currentSourceLanguage = \"auto\";\r\n  let currentTargetLanguage = twpConfig.get(\"targetLanguage\");\r\n  let currentPageTranslatorService = twpConfig.get(\"pageTranslatorService\");\r\n  let customDictionary = sortDictionary(twpConfig.get(\"customDictionary\"));\r\n  let dontSortResults =\r\n    twpConfig.get(\"dontSortResults\") == \"yes\" ? true : false;\r\n\r\n  let fooCount = 0;\r\n\r\n  let originalPageTitle;\r\n\r\n  let attributesToTranslate = [];\r\n\r\n  let translateNewNodesTimerHandler;\r\n  let newNodes = [];\r\n  let removedNodes = [];\r\n\r\n  let nodesToRestore = [];\r\n\r\n  function translateNewNodes() {\r\n    try {\r\n      newNodes.forEach((nn) => {\r\n        if (removedNodes.indexOf(nn) != -1) return;\r\n\r\n        let newPiecesToTranslate = getPiecesToTranslate(nn);\r\n\r\n        for (const i in newPiecesToTranslate) {\r\n          const newNodes = newPiecesToTranslate[i].nodes;\r\n          let finded = false;\r\n\r\n          for (const ntt of piecesToTranslate) {\r\n            if (ntt.nodes.some((n1) => newNodes.some((n2) => n1 === n2))) {\r\n              finded = true;\r\n            }\r\n          }\r\n\r\n          if (!finded) {\r\n            piecesToTranslate.push(newPiecesToTranslate[i]);\r\n          }\r\n        }\r\n      });\r\n    } catch (e) {\r\n      console.error(e);\r\n    } finally {\r\n      newNodes = [];\r\n      removedNodes = [];\r\n    }\r\n  }\r\n\r\n  const mutationObserver = new MutationObserver(function (mutations) {\r\n    const piecesToTranslate = [];\r\n\r\n    mutations.forEach((mutation) => {\r\n      mutation.addedNodes.forEach((addedNode) => {\r\n        const nodeName = addedNode.nodeName.toLowerCase();\r\n        if (!isNoTranslateNode(addedNode)) {\r\n          if (htmlTagsInlineText.indexOf(nodeName) == -1) {\r\n            if (htmlTagsInlineIgnore.indexOf(nodeName) == -1) {\r\n              piecesToTranslate.push(addedNode);\r\n            }\r\n          }\r\n        }\r\n      });\r\n\r\n      mutation.removedNodes.forEach((removedNode) => {\r\n        removedNodes.push(removedNode);\r\n      });\r\n    });\r\n\r\n    piecesToTranslate.forEach((ptt) => {\r\n      if (newNodes.indexOf(ptt) == -1) {\r\n        newNodes.push(ptt);\r\n      }\r\n    });\r\n  });\r\n\r\n  function enableMutatinObserver() {\r\n    disableMutatinObserver();\r\n\r\n    if (twpConfig.get(\"translateDynamicallyCreatedContent\") == \"yes\") {\r\n      translateNewNodesTimerHandler = setInterval(translateNewNodes, 2000);\r\n      mutationObserver.observe(document.body, {\r\n        childList: true,\r\n        subtree: true,\r\n      });\r\n    }\r\n  }\r\n\r\n  function disableMutatinObserver() {\r\n    clearInterval(translateNewNodesTimerHandler);\r\n    newNodes = [];\r\n    removedNodes = [];\r\n    mutationObserver.disconnect();\r\n    mutationObserver.takeRecords();\r\n  }\r\n\r\n  let pageIsVisible = document.visibilityState == \"visible\";\r\n  // isto faz com que partes do youtube nÃ£o sejam traduzidas\r\n  // new IntersectionObserver(entries => {\r\n  //         if (entries[0].isIntersecting && document.visibilityState == \"visible\") {\r\n  //             pageIsVisible = true\r\n  //         } else {\r\n  //             pageIsVisible = false\r\n  //         }\r\n\r\n  //         if (pageIsVisible && pageLanguageState === \"translated\") {\r\n  //             enableMutatinObserver()\r\n  //         } else {\r\n  //             disableMutatinObserver()\r\n  //         }\r\n  //     }, {\r\n  //         root: null\r\n  //     })\r\n  //     .observe(document.body)\r\n\r\n  const handleVisibilityChange = function () {\r\n    if (document.visibilityState == \"visible\") {\r\n      pageIsVisible = true;\r\n    } else {\r\n      pageIsVisible = false;\r\n    }\r\n\r\n    if (pageIsVisible && pageLanguageState === \"translated\") {\r\n      enableMutatinObserver();\r\n    } else {\r\n      disableMutatinObserver();\r\n    }\r\n  };\r\n  document.addEventListener(\"visibilitychange\", handleVisibilityChange, false);\r\n\r\n  /**\r\n   *\r\n   * @param {HTMLElement} node\r\n   * @returns\r\n   */\r\n  function isNoTranslateNode(node) {\r\n    const nodeName = node.nodeName.toLowerCase();\r\n    const index = htmlTagsNoTranslate.indexOf(nodeName);\r\n\r\n    //https://github.com/FilipePS/Traduzir-paginas-web/issues/704\r\n    if (nodeName === \"span\" && node.classList.contains(\"mjx-chtml\")) {\r\n      return true;\r\n    } else if (index === -1) {\r\n      return false;\r\n    } else {\r\n      // https://github.com/FilipePS/Traduzir-paginas-web/issues/654\r\n      if (\r\n        nodeName === \"script\" &&\r\n        node.getAttribute(\"data-spotim-module\") === \"spotim-launcher\" &&\r\n        [...node.childNodes].find((node) => node.nodeType === 1)\r\n      ) {\r\n        return false;\r\n      } else {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  function getPiecesToTranslate(root = document.documentElement) {\r\n    const piecesToTranslate = [\r\n      {\r\n        isTranslated: false,\r\n        parentElement: null,\r\n        topElement: null,\r\n        bottomElement: null,\r\n        nodes: [],\r\n      },\r\n    ];\r\n    let index = 0;\r\n    let currentParagraphSize = 0;\r\n\r\n    const getAllNodes = function (\r\n      node,\r\n      lastHTMLElement = null,\r\n      lastSelectOrDataListElement = null\r\n    ) {\r\n      if (node.nodeType == 1 || node.nodeType == 11) {\r\n        if (node.nodeType == 11) {\r\n          lastHTMLElement = node.host;\r\n          lastSelectOrDataListElement = null;\r\n        } else if (node.nodeType == 1) {\r\n          lastHTMLElement = node;\r\n          const nodeName = node.nodeName.toLowerCase();\r\n\r\n          if (nodeName === \"select\" || nodeName === \"datalist\")\r\n            lastSelectOrDataListElement = node;\r\n\r\n          if (\r\n            htmlTagsInlineIgnore.indexOf(nodeName) !== -1 ||\r\n            isNoTranslateNode(node) ||\r\n            node.classList.contains(\"notranslate\") ||\r\n            node.getAttribute(\"translate\") === \"no\" ||\r\n            node.isContentEditable ||\r\n            node.classList.contains(\"CodeMirror\") || // https://www.w3schools.com/html/tryit.asp\r\n            node.classList.contains(\"material-icons\") || // https://github.com/FilipePS/Traduzir-paginas-web/issues/481\r\n            node.classList.contains(\"material-symbols-outlined\") ||\r\n            nodeName.startsWith(\"br-\") || // https://github.com/FilipePS/Traduzir-paginas-web/issues/627\r\n            node.getAttribute(\"id\") === \"branch-select-menu\" || // https://github.com/FilipePS/Traduzir-paginas-web/issues/570\r\n            (location.hostname === \"twitter.com\" &&\r\n              nodeName === \"a\" &&\r\n              (node.matches ? node.matches(\"article a\") : true)) // https://github.com/FilipePS/Traduzir-paginas-web/issues/449\r\n          ) {\r\n            if (piecesToTranslate[index].nodes.length > 0) {\r\n              currentParagraphSize = 0;\r\n              piecesToTranslate[index].bottomElement = lastHTMLElement;\r\n              piecesToTranslate.push({\r\n                isTranslated: false,\r\n                parentElement: null,\r\n                topElement: null,\r\n                bottomElement: null,\r\n                nodes: [],\r\n              });\r\n              index++;\r\n            }\r\n            return;\r\n          }\r\n        }\r\n\r\n        function getAllChilds(childNodes) {\r\n          Array.from(childNodes).forEach((_node) => {\r\n            const nodeName = _node.nodeName.toLowerCase();\r\n\r\n            if (_node.nodeType == 1) {\r\n              lastHTMLElement = _node;\r\n              if (nodeName === \"select\" || nodeName === \"datalist\")\r\n                lastSelectOrDataListElement = _node;\r\n            }\r\n\r\n            if (htmlTagsInlineText.indexOf(nodeName) == -1) {\r\n              if (piecesToTranslate[index].nodes.length > 0) {\r\n                currentParagraphSize = 0;\r\n                piecesToTranslate[index].bottomElement = lastHTMLElement;\r\n                piecesToTranslate.push({\r\n                  isTranslated: false,\r\n                  parentElement: null,\r\n                  topElement: null,\r\n                  bottomElement: null,\r\n                  nodes: [],\r\n                });\r\n                index++;\r\n              }\r\n\r\n              getAllNodes(_node, lastHTMLElement, lastSelectOrDataListElement);\r\n\r\n              if (piecesToTranslate[index].nodes.length > 0) {\r\n                currentParagraphSize = 0;\r\n                piecesToTranslate[index].bottomElement = lastHTMLElement;\r\n                piecesToTranslate.push({\r\n                  isTranslated: false,\r\n                  parentElement: null,\r\n                  topElement: null,\r\n                  bottomElement: null,\r\n                  nodes: [],\r\n                });\r\n                index++;\r\n              }\r\n            } else {\r\n              getAllNodes(_node, lastHTMLElement, lastSelectOrDataListElement);\r\n            }\r\n          });\r\n        }\r\n\r\n        getAllChilds(node.childNodes);\r\n        if (!piecesToTranslate[index].bottomElement) {\r\n          piecesToTranslate[index].bottomElement = node;\r\n        }\r\n        if (node.shadowRoot) {\r\n          getAllChilds(node.shadowRoot.childNodes);\r\n          if (!piecesToTranslate[index].bottomElement) {\r\n            piecesToTranslate[index].bottomElement = node;\r\n          }\r\n        }\r\n      } else if (node.nodeType == 3) {\r\n        if (node.textContent.trim().length > 0) {\r\n          if (!piecesToTranslate[index].parentElement) {\r\n            if (\r\n              node &&\r\n              node.parentNode &&\r\n              node.parentNode.nodeName.toLowerCase() === \"option\" &&\r\n              lastSelectOrDataListElement\r\n            ) {\r\n              piecesToTranslate[index].parentElement =\r\n                lastSelectOrDataListElement;\r\n              piecesToTranslate[index].bottomElement =\r\n                lastSelectOrDataListElement;\r\n              piecesToTranslate[index].topElement = lastSelectOrDataListElement;\r\n            } else {\r\n              let temp = node.parentNode;\r\n              const nodeName = temp.nodeName.toLowerCase();\r\n              while (\r\n                temp &&\r\n                temp != root &&\r\n                (htmlTagsInlineText.indexOf(nodeName) != -1 ||\r\n                  htmlTagsInlineIgnore.indexOf(nodeName) != -1)\r\n              ) {\r\n                temp = temp.parentNode;\r\n              }\r\n              if (temp && temp.nodeType === 11) {\r\n                temp = temp.host;\r\n              }\r\n              piecesToTranslate[index].parentElement = temp;\r\n            }\r\n          }\r\n          if (!piecesToTranslate[index].topElement) {\r\n            piecesToTranslate[index].topElement = lastHTMLElement;\r\n          }\r\n          if (currentParagraphSize > 1000) {\r\n            currentParagraphSize = 0;\r\n            piecesToTranslate[index].bottomElement = lastHTMLElement;\r\n            const pieceInfo = {\r\n              isTranslated: false,\r\n              parentElement: null,\r\n              topElement: lastHTMLElement,\r\n              bottomElement: null,\r\n              nodes: [],\r\n            };\r\n            pieceInfo.parentElement = piecesToTranslate[index].parentElement;\r\n            piecesToTranslate.push(pieceInfo);\r\n            index++;\r\n          }\r\n          currentParagraphSize += node.textContent.length;\r\n          piecesToTranslate[index].nodes.push(node);\r\n          piecesToTranslate[index].bottomElement = null;\r\n        }\r\n      }\r\n    };\r\n    getAllNodes(root);\r\n\r\n    if (\r\n      piecesToTranslate.length > 0 &&\r\n      piecesToTranslate[piecesToTranslate.length - 1].nodes.length == 0\r\n    ) {\r\n      piecesToTranslate.pop();\r\n    }\r\n\r\n    return piecesToTranslate;\r\n  }\r\n\r\n  function getAttributesToTranslate(root = document.body) {\r\n    const attributesToTranslate = [];\r\n\r\n    const placeholdersElements = root.querySelectorAll(\r\n      \"input[placeholder], textarea[placeholder]\"\r\n    );\r\n    const altElements = root.querySelectorAll(\r\n      'area[alt], img[alt], input[type=\"image\"][alt]'\r\n    );\r\n    const valueElements = root.querySelectorAll(\r\n      'input[type=\"button\"], input[type=\"submit\"], input[type=\"reset\"]'\r\n    );\r\n    const titleElements = root.querySelectorAll(\"body [title]\");\r\n\r\n    function hasNoTranslate(elem) {\r\n      if (\r\n        elem &&\r\n        (elem.classList.contains(\"notranslate\") ||\r\n          elem.getAttribute(\"translate\") === \"no\")\r\n      ) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    placeholdersElements.forEach((e) => {\r\n      if (hasNoTranslate(e)) return;\r\n\r\n      const txt = e.getAttribute(\"placeholder\");\r\n      if (txt && txt.trim()) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: txt,\r\n          attrName: \"placeholder\",\r\n        });\r\n      }\r\n    });\r\n\r\n    altElements.forEach((e) => {\r\n      if (hasNoTranslate(e)) return;\r\n\r\n      const txt = e.getAttribute(\"alt\");\r\n      if (txt && txt.trim()) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: txt,\r\n          attrName: \"alt\",\r\n        });\r\n      }\r\n    });\r\n\r\n    valueElements.forEach((e) => {\r\n      if (hasNoTranslate(e)) return;\r\n\r\n      const txt = e.getAttribute(\"value\");\r\n      if (e.type == \"submit\" && !txt) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: \"Submit Query\",\r\n          attrName: \"value\",\r\n        });\r\n      } else if (e.type == \"reset\" && !txt) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: \"Reset\",\r\n          attrName: \"value\",\r\n        });\r\n      } else if (txt && txt.trim()) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: txt,\r\n          attrName: \"value\",\r\n        });\r\n      }\r\n    });\r\n\r\n    titleElements.forEach((e) => {\r\n      if (hasNoTranslate(e)) return;\r\n\r\n      const txt = e.getAttribute(\"title\");\r\n      if (txt && txt.trim()) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: txt,\r\n          attrName: \"title\",\r\n        });\r\n      }\r\n    });\r\n\r\n    return attributesToTranslate;\r\n  }\r\n\r\n  // encapsular o texto faz com que do video suma\r\n  // ao utilizar funÃ§Ã£o como Pai.removeChild(filho)\r\n  // pode ser gerado um erro ao encapsular\r\n  function encapsulateTextNode(node) {\r\n    const fontNode = document.createElement(\"font\");\r\n    fontNode.setAttribute(\"style\", \"vertical-align: inherit;\");\r\n    fontNode.textContent = node.textContent;\r\n\r\n    node.replaceWith(fontNode);\r\n\r\n    return fontNode;\r\n  }\r\n\r\n  function translateTextContent(node, parentNode, text, toRestore) {\r\n    toRestore.translatedText = text;\r\n\r\n    if (location.hostname === \"pdf.translatewebpages.org\") {\r\n      if (\r\n        parentNode &&\r\n        parentNode.nodeName.toLowerCase() === \"span\" &&\r\n        parentNode.getAttribute(\"role\") === \"presentation\"\r\n      ) {\r\n        const oldClientWidth = node.parentNode.clientWidth;\r\n        node.textContent = text;\r\n        const newClientWidth = node.parentNode.clientWidth;\r\n        const transformMatch = parentNode.style.transform.match(\r\n          /[0-9]+[\\.]{1,1}[0-9]*/\r\n        );\r\n        const currentScaleX = transformMatch\r\n          ? parseFloat(transformMatch[0])\r\n          : 1.0;\r\n        toRestore.originalScale = currentScaleX;\r\n        parentNode.style.transform = `scaleX(${\r\n          currentScaleX *\r\n          Math.min(currentScaleX, oldClientWidth / newClientWidth)\r\n        })`;\r\n      } else {\r\n        node.textContent = text;\r\n      }\r\n    } else {\r\n      node.textContent = text;\r\n    }\r\n  }\r\n\r\n  function translateResults(piecesToTranslateNow, results) {\r\n    if (dontSortResults) {\r\n      for (let i = 0; i < results.length; i++) {\r\n        for (let j = 0; j < results[i].length; j++) {\r\n          if (piecesToTranslateNow[i].nodes[j]) {\r\n            const nodes = piecesToTranslateNow[i].nodes;\r\n            let translated = results[i][j] + \" \";\r\n            // In some case, results items count is over original node count\r\n            // Rest results append to last node\r\n            if (\r\n              piecesToTranslateNow[i].nodes.length - 1 === j &&\r\n              results[i].length > j\r\n            ) {\r\n              const restResults = results[i].slice(j + 1);\r\n              translated += restResults.join(\" \");\r\n            }\r\n\r\n            const originalTextNode = nodes[j];\r\n            const parentNode = nodes[j].parentNode;\r\n            if (showOriginal.isEnabled) {\r\n              nodes[j] = encapsulateTextNode(nodes[j]);\r\n              showOriginal.add(nodes[j]);\r\n            }\r\n\r\n            const toRestore = {\r\n              node: nodes[j],\r\n              original: originalTextNode,\r\n              originalText: originalTextNode.textContent,\r\n              translatedText: translated,\r\n              originalScale: null,\r\n              parentNode,\r\n            };\r\n            nodesToRestore.push(toRestore);\r\n\r\n            const originalText = originalTextNode.textContent;\r\n            handleCustomWords(\r\n              translated,\r\n              nodes[j].textContent,\r\n              customDictionary,\r\n              currentPageTranslatorService,\r\n              currentSourceLanguage,\r\n              currentTargetLanguage\r\n            ).then((results) => {\r\n              // results = `${originalText.match(/^\\s*/)[0]}${results.trim()}${\r\n              //   originalText.match(/\\s*$/)[0]\r\n              // }`;\r\n              translateTextContent(nodes[j], parentNode, results, toRestore);\r\n            });\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      for (const i in piecesToTranslateNow) {\r\n        for (const j in piecesToTranslateNow[i].nodes) {\r\n          if (results[i][j]) {\r\n            const nodes = piecesToTranslateNow[i].nodes;\r\n            const translated = results[i][j] + \" \";\r\n\r\n            const originalTextNode = nodes[j];\r\n            const parentNode = nodes[j].parentNode;\r\n            if (showOriginal.isEnabled) {\r\n              nodes[j] = encapsulateTextNode(nodes[j]);\r\n              showOriginal.add(nodes[j]);\r\n            }\r\n\r\n            const toRestore = {\r\n              node: nodes[j],\r\n              original: originalTextNode,\r\n              originalText: originalTextNode.textContent,\r\n              translatedText: translated,\r\n              parentNode,\r\n            };\r\n            nodesToRestore.push(toRestore);\r\n\r\n            const originalText = originalTextNode.textContent;\r\n            handleCustomWords(\r\n              translated,\r\n              nodes[j].textContent,\r\n              customDictionary,\r\n              currentPageTranslatorService,\r\n              currentSourceLanguage,\r\n              currentTargetLanguage\r\n            ).then((results) => {\r\n              // results = `${originalText.match(/^\\s*/)[0]}${results.trim()}${\r\n              //   originalText.match(/\\s*$/)[0]\r\n              // }`;\r\n              translateTextContent(nodes[j], parentNode, results, toRestore);\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    mutationObserver.takeRecords();\r\n  }\r\n\r\n  function translateAttributes(attributesToTranslateNow, results) {\r\n    for (const i in attributesToTranslateNow) {\r\n      const ati = attributesToTranslateNow[i];\r\n      ati.node.setAttribute(ati.attrName, results[i]);\r\n    }\r\n  }\r\n\r\n  function translationRoutine() {\r\n    try {\r\n      if (piecesToTranslate && pageIsVisible) {\r\n        (function () {\r\n          if (piecesToTranslate.length < 1) return;\r\n          const innerHeight = window.innerHeight;\r\n\r\n          function isInScreen(element) {\r\n            const rect = element.getBoundingClientRect();\r\n            if (\r\n              (rect.top > 0 && rect.top <= innerHeight) ||\r\n              (rect.bottom > 0 && rect.bottom <= innerHeight)\r\n            ) {\r\n              return true;\r\n            }\r\n            return false;\r\n          }\r\n\r\n          function topIsInScreen(element) {\r\n            if (!element) {\r\n              // debugger;\r\n              return false;\r\n            }\r\n            const rect = element.getBoundingClientRect();\r\n            if (rect.top > 0 && rect.top <= innerHeight) {\r\n              return true;\r\n            }\r\n            return false;\r\n          }\r\n\r\n          function bottomIsInScreen(element) {\r\n            if (!element) {\r\n              // debugger;\r\n              return false;\r\n            }\r\n            const rect = element.getBoundingClientRect();\r\n            if (rect.bottom > 0 && rect.bottom <= innerHeight) {\r\n              return true;\r\n            }\r\n            return false;\r\n          }\r\n\r\n          const currentFooCount = fooCount;\r\n\r\n          const piecesToTranslateNow = [];\r\n          piecesToTranslate.forEach((ptt) => {\r\n            if (!ptt.isTranslated) {\r\n              if (\r\n                bottomIsInScreen(ptt.topElement) ||\r\n                topIsInScreen(ptt.bottomElement)\r\n              ) {\r\n                ptt.isTranslated = true;\r\n                piecesToTranslateNow.push(ptt);\r\n              }\r\n            }\r\n          });\r\n\r\n          const attributesToTranslateNow = [];\r\n          attributesToTranslate.forEach((ati) => {\r\n            if (!ati.isTranslated) {\r\n              if (isInScreen(ati.node)) {\r\n                ati.isTranslated = true;\r\n                attributesToTranslateNow.push(ati);\r\n              }\r\n            }\r\n          });\r\n\r\n          if (piecesToTranslateNow.length > 0) {\r\n            backgroundTranslateHTML(\r\n              currentPageTranslatorService,\r\n              currentSourceLanguage,\r\n              currentTargetLanguage,\r\n              piecesToTranslateNow.map((ptt) =>\r\n                ptt.nodes.map((node) =>\r\n                  filterKeywordsInText(\r\n                    node.textContent,\r\n                    customDictionary,\r\n                    currentPageTranslatorService\r\n                  )\r\n                )\r\n              ),\r\n              dontSortResults\r\n            ).then((results) => {\r\n              if (\r\n                pageLanguageState === \"translated\" &&\r\n                currentFooCount === fooCount\r\n              ) {\r\n                translateResults(piecesToTranslateNow, results);\r\n              }\r\n            });\r\n          }\r\n\r\n          if (attributesToTranslateNow.length > 0) {\r\n            backgroundTranslateText(\r\n              currentPageTranslatorService,\r\n              currentSourceLanguage,\r\n              currentTargetLanguage,\r\n              attributesToTranslateNow.map((ati) => ati.original)\r\n            ).then((results) => {\r\n              if (\r\n                pageLanguageState === \"translated\" &&\r\n                currentFooCount === fooCount\r\n              ) {\r\n                translateAttributes(attributesToTranslateNow, results);\r\n              }\r\n            });\r\n          }\r\n        })();\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n\r\n    clearTimeout(translationRoutine_handler);\r\n    translationRoutine_handler = setTimeout(translationRoutine, 300);\r\n  }\r\n\r\n  translationRoutine();\r\n\r\n  function translatePageTitle() {\r\n    const title = document.querySelector(\"title\");\r\n    if (\r\n      title &&\r\n      (title.classList.contains(\"notranslate\") ||\r\n        title.getAttribute(\"translate\") === \"no\")\r\n    ) {\r\n      return;\r\n    }\r\n    if (document.title.trim().length < 1) return;\r\n    originalPageTitle = document.title;\r\n\r\n    backgroundTranslateSingleText(\r\n      currentPageTranslatorService,\r\n      currentSourceLanguage,\r\n      currentTargetLanguage,\r\n      originalPageTitle\r\n    ).then((result) => {\r\n      if (result) {\r\n        document.title = result;\r\n      }\r\n    });\r\n  }\r\n\r\n  const pageLanguageStateObservers = [];\r\n\r\n  pageTranslator.onPageLanguageStateChange = function (callback) {\r\n    pageLanguageStateObservers.push(callback);\r\n  };\r\n\r\n  var translationRoutine_handler = null;\r\n\r\n  pageTranslator.translatePage = function (targetLanguage) {\r\n    fooCount++;\r\n    pageTranslator.restorePage();\r\n    showOriginal.enable();\r\n    chrome.runtime.sendMessage(\r\n      { action: \"removeTranslationsWithError\" },\r\n      checkedLastError\r\n    );\r\n\r\n    if (targetLanguage) {\r\n      currentTargetLanguage = targetLanguage;\r\n    }\r\n\r\n    customDictionary = sortDictionary(twpConfig.get(\"customDictionary\"));\r\n\r\n    // https://github.com/FilipePS/Traduzir-paginas-web/issues/619\r\n    if (\r\n      location.hostname === \"sberbank.com\" ||\r\n      location.hostname === \"www.sberbank.com\"\r\n    ) {\r\n      document.body.classList.remove(\"notranslate\");\r\n    }\r\n\r\n    if (location.hostname === \"pdf.translatewebpages.org\") {\r\n      document.getElementById(\"scaleSelect\").value = \"1.5\";\r\n      document.getElementById(\"scaleSelect\").dispatchEvent(new Event(\"change\"));\r\n    }\r\n\r\n    piecesToTranslate = getPiecesToTranslate();\r\n    attributesToTranslate = getAttributesToTranslate();\r\n\r\n    pageLanguageState = \"translated\";\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"setPageLanguageState\",\r\n        pageLanguageState,\r\n      },\r\n      checkedLastError\r\n    );\r\n    pageLanguageStateObservers.forEach((callback) =>\r\n      callback(pageLanguageState)\r\n    );\r\n    currentPageLanguage = currentTargetLanguage;\r\n\r\n    translatePageTitle();\r\n\r\n    enableMutatinObserver();\r\n\r\n    translationRoutine();\r\n  };\r\n\r\n  pageTranslator.restorePage = function () {\r\n    fooCount++;\r\n    piecesToTranslate = [];\r\n\r\n    showOriginal.disable();\r\n    disableMutatinObserver();\r\n\r\n    pageLanguageState = \"original\";\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"setPageLanguageState\",\r\n        pageLanguageState,\r\n      },\r\n      checkedLastError\r\n    );\r\n    pageLanguageStateObservers.forEach((callback) =>\r\n      callback(pageLanguageState)\r\n    );\r\n    currentPageLanguage = originalTabLanguage;\r\n\r\n    if (originalPageTitle) {\r\n      document.title = originalPageTitle;\r\n    }\r\n    originalPageTitle = null;\r\n\r\n    for (const ntr of nodesToRestore) {\r\n      if (ntr.node === ntr.original) {\r\n        if (ntr.node.textContent === ntr.translatedText) {\r\n          ntr.node.textContent = ntr.originalText;\r\n        }\r\n      } else {\r\n        ntr.node.replaceWith(ntr.original);\r\n      }\r\n      if (ntr.originalScale) {\r\n        ntr.parentNode.style.transform = `scaleX(${ntr.originalScale}`;\r\n      }\r\n    }\r\n    nodesToRestore = [];\r\n\r\n    //TODO nÃ£o restaurar atributos que foram modificados\r\n    for (const ati of attributesToTranslate) {\r\n      if (ati.isTranslated) {\r\n        ati.node.setAttribute(ati.attrName, ati.original);\r\n      }\r\n    }\r\n    attributesToTranslate = [];\r\n  };\r\n\r\n  pageTranslator.swapTranslationService = function (newServiceName) {\r\n    currentPageTranslatorService = newServiceName;\r\n    if (pageLanguageState === \"translated\") {\r\n      pageTranslator.translatePage();\r\n    }\r\n  };\r\n\r\n  pageTranslator.improveTranslation = function (info) {\r\n    currentPageTranslatorService = info.pageTranslatorService;\r\n    dontSortResults = info.dontSortResults === \"yes\" ? true : false;\r\n    currentSourceLanguage = info.sourceLanguage;\r\n    if (pageLanguageState === \"translated\") {\r\n      pageTranslator.translatePage(info.targetLanguage);\r\n    }\r\n  };\r\n\r\n  let alreadyGotTheLanguage = false;\r\n  const observers = [];\r\n\r\n  pageTranslator.onGetOriginalTabLanguage = function (callback) {\r\n    if (alreadyGotTheLanguage) {\r\n      callback(originalTabLanguage);\r\n    } else {\r\n      observers.push(callback);\r\n    }\r\n  };\r\n\r\n  let textContentLanguageDetectionPromise = null;\r\n\r\n  chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\r\n    if (request.action === \"translatePage\") {\r\n      if (request.targetLanguage === \"original\") {\r\n        pageTranslator.restorePage();\r\n      } else {\r\n        pageTranslator.translatePage(request.targetLanguage);\r\n      }\r\n    } else if (request.action === \"restorePage\") {\r\n      pageTranslator.restorePage();\r\n    } else if (request.action === \"getOriginalTabLanguage\") {\r\n      pageTranslator.onGetOriginalTabLanguage(function () {\r\n        sendResponse(originalTabLanguage);\r\n      });\r\n      return true;\r\n    } else if (request.action === \"getCurrentPageLanguage\") {\r\n      sendResponse(currentPageLanguage);\r\n    } else if (request.action === \"getCurrentPageLanguageState\") {\r\n      sendResponse(pageLanguageState);\r\n    } else if (request.action === \"getCurrentPageTranslatorService\") {\r\n      sendResponse(currentPageTranslatorService);\r\n    } else if (request.action === \"swapTranslationService\") {\r\n      pageTranslator.swapTranslationService(request.newServiceName);\r\n    } else if (request.action === \"toggle-translation\") {\r\n      if (pageLanguageState === \"translated\") {\r\n        pageTranslator.restorePage();\r\n      } else {\r\n        pageTranslator.translatePage();\r\n      }\r\n    } else if (request.action === \"autoTranslateBecauseClickedALink\") {\r\n      if (twpConfig.get(\"autoTranslateWhenClickingALink\") === \"yes\") {\r\n        pageTranslator.onGetOriginalTabLanguage(function () {\r\n          if (\r\n            pageLanguageState === \"original\" &&\r\n            originalTabLanguage !== currentTargetLanguage &&\r\n            twpConfig\r\n              .get(\"neverTranslateLangs\")\r\n              .indexOf(originalTabLanguage) === -1 &&\r\n            twpConfig.get(\"neverTranslateSites\").indexOf(tabHostName) === -1\r\n          ) {\r\n            pageTranslator.translatePage();\r\n          }\r\n        });\r\n      }\r\n    } else if (request.action === \"restorePagesWithServiceNames\") {\r\n      if (request.serviceNames.includes(currentPageTranslatorService)) {\r\n        pageTranslator.restorePage();\r\n        currentPageTranslatorService = request.newServiceName;\r\n      }\r\n    } else if (request.action === \"improveTranslation\") {\r\n      pageTranslator.improveTranslation(request);\r\n    } else if (request.action === \"getCurrentSourceLanguage\") {\r\n      sendResponse(currentSourceLanguage);\r\n    } else if (request.action === \"getDontSortResults\") {\r\n      sendResponse(dontSortResults);\r\n    } else if (request.action === \"cleanUp\") {\r\n      pageTranslator.restorePage();\r\n    } else if (request.action === \"currentTargetLanguage\") {\r\n      sendResponse(currentTargetLanguage);\r\n    } else if (request.action === \"detectLanguageUsingTextContent\") {\r\n      if (textContentLanguageDetectionPromise) {\r\n        textContentLanguageDetectionPromise.then((result) =>\r\n          sendResponse(result)\r\n        );\r\n      } else {\r\n        textContentLanguageDetectionPromise = new Promise((resolve) => {\r\n          chrome.i18n.detectLanguage(\r\n            document.body.textContent.trim().slice(0, 1000),\r\n            (result) => {\r\n              // checkedLastError();\r\n              if (result && result.isReliable && result.languages && result.languages.length > 0) {\r\n                resolve(result.languages[0].language);\r\n                sendResponse(result.languages[0].language);\r\n              } else {\r\n                sendResponse(\"und\");\r\n              }\r\n            }\r\n          );\r\n        });\r\n      }\r\n      return true;\r\n    }\r\n  });\r\n\r\n  // Requests the detection of the tab language in the background\r\n  if (window.self === window.top) {\r\n    // is main frame\r\n    const onTabVisible = function () {\r\n      chrome.runtime.sendMessage(\r\n        {\r\n          action: \"detectTabLanguage\",\r\n        },\r\n        (result) => {\r\n          checkedLastError();\r\n\r\n          result = result || \"und\";\r\n          if (result === \"und\") {\r\n            originalTabLanguage = result;\r\n            if (\r\n              (twpConfig.get(\"alwaysTranslateSites\").indexOf(tabHostName) !==\r\n                -1 ||\r\n                (location.hostname === \"pdf.translatewebpages.org\" &&\r\n                  twpConfig.get(\"neverTranslateSites\").indexOf(tabHostName) ===\r\n                    -1)) &&\r\n              !platformInfo.isMobile.any\r\n            ) {\r\n              pageTranslator.translatePage();\r\n            }\r\n          } else {\r\n            const langCode = twpLang.fixTLanguageCode(result);\r\n            if (langCode) {\r\n              originalTabLanguage = langCode;\r\n            }\r\n            if (\r\n              (location.hostname === \"pdftohtml.translatewebpages.org\" &&\r\n                location.href.indexOf(\"?autotranslate\") !== -1 &&\r\n                twpConfig.get(\"neverTranslateSites\").indexOf(tabHostName) ===\r\n                  -1) ||\r\n              (location.hostname === \"pdf.translatewebpages.org\" &&\r\n                twpConfig.get(\"neverTranslateSites\").indexOf(tabHostName) ===\r\n                  -1)\r\n            ) {\r\n              pageTranslator.translatePage();\r\n            } else {\r\n              if (\r\n                location.hostname !== \"translate.googleusercontent.com\" &&\r\n                location.hostname !== \"translate.google.com\" &&\r\n                location.hostname !== \"translate.yandex.com\" &&\r\n                location.hostname !== \"www.deepl.com\" &&\r\n                location.hostname !== \"translated.turbopages.org\" &&\r\n                !location.hostname.endsWith(\"translate.goog\") &&\r\n                location.hostname !== \"sberbank.com\" &&\r\n                location.hostname !== \"www.sberbank.com\" // https://github.com/FilipePS/Traduzir-paginas-web/issues/619\r\n              ) {\r\n                if (\r\n                  pageLanguageState === \"original\" &&\r\n                  // !platformInfo.isMobile.any &&\r\n                  !chrome.extension.inIncognitoContext\r\n                ) {\r\n                  if (\r\n                    twpConfig\r\n                      .get(\"neverTranslateSites\")\r\n                      .indexOf(tabHostName) === -1\r\n                  ) {\r\n                    if (\r\n                      langCode &&\r\n                      langCode !== currentTargetLanguage &&\r\n                      twpConfig\r\n                        .get(\"alwaysTranslateLangs\")\r\n                        .indexOf(langCode) !== -1\r\n                    ) {\r\n                      pageTranslator.translatePage();\r\n                    } else if (\r\n                      twpConfig\r\n                        .get(\"alwaysTranslateSites\")\r\n                        .indexOf(tabHostName) !== -1 &&\r\n                      !platformInfo.isMobile.any\r\n                    ) {\r\n                      pageTranslator.translatePage();\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n\r\n          observers.forEach((callback) => callback(originalTabLanguage));\r\n          alreadyGotTheLanguage = true;\r\n        }\r\n      );\r\n    };\r\n    setTimeout(function () {\r\n      if (document.visibilityState == \"visible\") {\r\n        onTabVisible();\r\n      } else {\r\n        const handleVisibilityChange = function () {\r\n          if (document.visibilityState == \"visible\") {\r\n            document.removeEventListener(\r\n              \"visibilitychange\",\r\n              handleVisibilityChange\r\n            );\r\n            onTabVisible();\r\n          }\r\n        };\r\n        document.addEventListener(\r\n          \"visibilitychange\",\r\n          handleVisibilityChange,\r\n          false\r\n        );\r\n      }\r\n    }, 150);\r\n  } else {\r\n    // is subframe (iframe)\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"getMainFrameTabLanguage\",\r\n      },\r\n      (result) => {\r\n        checkedLastError();\r\n\r\n        originalTabLanguage = result || \"und\";\r\n        observers.forEach((callback) => callback(originalTabLanguage));\r\n        alreadyGotTheLanguage = true;\r\n      }\r\n    );\r\n\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"getMainFramePageLanguageState\",\r\n      },\r\n      (result) => {\r\n        checkedLastError();\r\n\r\n        if (\r\n          result === \"translated\" &&\r\n          pageLanguageState === \"original\" &&\r\n          twpConfig.get(\"enableIframePageTranslation\") === \"yes\"\r\n        ) {\r\n          pageTranslator.translatePage();\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  showOriginal.enabledObserverSubscribe(function () {\r\n    if (pageLanguageState !== \"original\") {\r\n      pageTranslator.translatePage();\r\n    }\r\n  });\r\n});\r\n"],"mappings":"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"}
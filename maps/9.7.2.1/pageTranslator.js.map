{"version":3,"file":"../../contentScript/pageTranslator.js","names":["startMark","endMark","startMark0","endMark0","currentIndex","compressionMap","filterKeywordsInText","textContext","customDictionary","twpConfig","get","size","Map","entries","sort","a","b","String","length","keyWord","keys","index","toLowerCase","indexOf","removeExtraDelimiter","previousIndex","nextIndex","previousChar","charAt","nextChar","placeholderText","keyWordWithCase","substring","isPunctuationOrDelimiter","handleHitKeywords","c","Array","from","frontPart","backPart","replaceAll","handleCustomWords","translated","originalText","currentPageTranslatorService","currentTargetLanguage","customValue","trim","startIndex","endIndex","Error","e","backgroundTranslateSingleText","value","mode","undefined","set","Number","str","regex","test","replace","backgroundTranslateHTML","translationService","targetLanguage","sourceArray2d","dontSortResults","Promise","resolve","reject","chrome","runtime","sendMessage","action","response","checkedLastError","backgroundTranslateText","sourceArray","source","pageTranslator","getTabHostName","result","all","onReady","then","_","tabHostName","htmlTagsInlineText","htmlTagsInlineIgnore","htmlTagsNoTranslate","push","onChanged","name","newvalue","splice","piecesToTranslate","originalTabLanguage","currentPageLanguage","pageLanguageState","fooCount","originalPageTitle","attributesToTranslate","translateNewNodesTimerHandler","newNodes","removedNodes","nodesToRestore","translateNewNodes","forEach","nn","newPiecesToTranslate","getPiecesToTranslate","i","nodes","finded","ntt","some","n1","n2","console","error","mutationObserver","MutationObserver","mutations","mutation","addedNodes","addedNode","nodeName","removedNode","ptt","enableMutatinObserver","disableMutatinObserver","setInterval","observe","document","body","childList","subtree","clearInterval","disconnect","takeRecords","pageIsVisible","visibilityState","handleVisibilityChange","addEventListener","root","documentElement","isTranslated","parentElement","topElement","bottomElement","currentParagraphSize","getAllNodes","node","lastHTMLElement","lastSelectOrDataListElement","nodeType","host","classList","contains","getAttribute","isContentEditable","getAllChilds","childNodes","_node","shadowRoot","textContent","parentNode","temp","pieceInfo","pop","getAttributesToTranslate","placeholdersElements","querySelectorAll","altElements","valueElements","titleElements","hasNoTranslate","elem","txt","original","attrName","type","encapsulateTextNode","fontNode","createElement","setAttribute","replaceWith","translateResults","piecesToTranslateNow","results","j","restResults","slice","join","originalTextNode","showOriginal","isEnabled","add","toRestore","translatedText","translateAttributes","attributesToTranslateNow","ati","translationRoutine","innerHeight","window","isInScreen","element","rect","getBoundingClientRect","top","bottom","topIsInScreen","bottomIsInScreen","currentFooCount","map","clearTimeout","translationRoutine_handler","setTimeout","translatePageTitle","title","querySelector","pageLanguageStateObservers","onPageLanguageStateChange","callback","translatePage","restorePage","enable","location","hostname","remove","disable","ntr","swapTranslationService","alreadyGotTheLanguage","observers","onGetOriginalTabLanguage","onMessage","addListener","request","sender","sendResponse","self","onTabVisible","langCode","twpLang","fixTLanguageCode","href","endsWith","platformInfo","isMobile","any","extension","inIncognitoContext","removeEventListener","enabledObserverSubscribe"],"sources":["pageTranslator.js"],"sourcesContent":["\"use strict\";\r\n\r\n/**\r\n * This mark cannot contain words, like <customskipword>12</customskipword>34\r\n *\r\n * Google will reorder as <customskipword>1234</customskipword>\r\n *\r\n * Under certain circumstances，Google broken the translation, returned startMark0 in some cases\r\n * */\r\nconst startMark = \"@%\";\r\nconst endMark = \"#$\";\r\nconst startMark0 = \"@ %\";\r\nconst endMark0 = \"# $\";\r\n\r\nlet currentIndex;\r\nlet compressionMap;\r\n\r\n/**\r\n *  Convert matching keywords to a string of special numbers to skip translation before sending to the translation engine.\r\n *\r\n *  For English words, ignore case when matching.\r\n *\r\n *  But for the word \"app\" , We don't want to \"Happy\" also matched.\r\n *\r\n *  So we match only isolated words, by checking the two characters before and after the keyword.\r\n *\r\n *  But this will also cause this method to not work for Chinese, Burmese and other languages without spaces.\r\n * */\r\nfunction filterKeywordsInText(textContext) {\r\n  let customDictionary = twpConfig.get(\"customDictionary\");\r\n  if (customDictionary.size > 0) {\r\n    // reordering , we want to match the keyword \"Spring Boot\" first then the keyword \"Spring\"\r\n    customDictionary = new Map(\r\n      [...customDictionary.entries()].sort(\r\n        (a, b) => String(b[0]).length - String(a[0]).length\r\n      )\r\n    );\r\n    for (let keyWord of customDictionary.keys()) {\r\n      while (true) {\r\n        let index = textContext.toLowerCase().indexOf(keyWord);\r\n        if (index === -1) {\r\n          break;\r\n        } else {\r\n          textContext = removeExtraDelimiter(textContext);\r\n          let previousIndex = index - 1;\r\n          let nextIndex = index + keyWord.length;\r\n          let previousChar =\r\n            previousIndex === -1 ? \"\\n\" : textContext.charAt(previousIndex);\r\n          let nextChar =\r\n            nextIndex === textContext.length\r\n              ? \"\\n\"\r\n              : textContext.charAt(nextIndex);\r\n          let placeholderText = \"\";\r\n          let keyWordWithCase = textContext.substring(\r\n            index,\r\n            index + keyWord.length\r\n          );\r\n          if (\r\n            isPunctuationOrDelimiter(previousChar) &&\r\n            isPunctuationOrDelimiter(nextChar)\r\n          ) {\r\n            placeholderText =\r\n              startMark + handleHitKeywords(keyWordWithCase, true) + endMark;\r\n          } else {\r\n            placeholderText = \"#n%o#\";\r\n            for (let c of Array.from(keyWordWithCase)) {\r\n              placeholderText += c;\r\n              placeholderText += \"#n%o#\";\r\n            }\r\n          }\r\n          let frontPart = textContext.substring(0, index);\r\n          let backPart = textContext.substring(index + keyWord.length);\r\n          textContext = frontPart + placeholderText + backPart;\r\n        }\r\n      }\r\n      textContext = textContext.replaceAll(\"#n%o#\", \"\");\r\n    }\r\n  }\r\n  return textContext;\r\n}\r\n\r\n/**\r\n *  handle the keywords in translatedText, replace it if there is a custom replacement value.\r\n *\r\n *  When encountering Google Translate reordering, the original text contains our mark, etc. , we will catch these exceptions and call the text translation method to retranslate this section.\r\n *  */\r\nasync function handleCustomWords(\r\n  translated,\r\n  originalText,\r\n  currentPageTranslatorService,\r\n  currentTargetLanguage\r\n) {\r\n  try {\r\n    const customDictionary = twpConfig.get(\"customDictionary\");\r\n    if (customDictionary.size > 0) {\r\n      // If the translation is a single word and exists in the dictionary, return it directly\r\n      let customValue = customDictionary.get(originalText.trim());\r\n      if (customValue) return customValue;\r\n\r\n      translated = removeExtraDelimiter(translated);\r\n      translated = translated.replaceAll(startMark0, startMark);\r\n      translated = translated.replaceAll(endMark0, endMark);\r\n\r\n      while (true) {\r\n        let startIndex = translated.indexOf(startMark);\r\n        let endIndex = translated.indexOf(endMark);\r\n        if (startIndex === -1 && endIndex === -1) {\r\n          break;\r\n        } else {\r\n          let placeholderText = translated.substring(\r\n            startIndex + startMark.length,\r\n            endIndex\r\n          );\r\n          // At this point placeholderText is actually currentIndex , the real value is in compressionMap\r\n          let keyWord = handleHitKeywords(placeholderText, false);\r\n          if (keyWord === \"undefined\") {\r\n            throw new Error(\"undefined\");\r\n          }\r\n          let frontPart = translated.substring(0, startIndex);\r\n          let backPart = translated.substring(endIndex + endMark.length);\r\n          let customValue = customDictionary.get(keyWord.toLowerCase());\r\n          customValue = customValue === \"\" ? keyWord : customValue;\r\n          // Highlight custom words, make it have a space before and after it\r\n          frontPart = isPunctuationOrDelimiter(\r\n            frontPart.charAt(frontPart.length - 1)\r\n          )\r\n            ? frontPart\r\n            : frontPart + \" \";\r\n          backPart = isPunctuationOrDelimiter(backPart.charAt(0))\r\n            ? backPart\r\n            : \" \" + backPart;\r\n          translated = frontPart + customValue + backPart;\r\n        }\r\n      }\r\n    }\r\n  } catch (e) {\r\n    return await backgroundTranslateSingleText(\r\n      currentPageTranslatorService,\r\n      currentTargetLanguage,\r\n      originalText\r\n    );\r\n  }\r\n\r\n  return translated;\r\n}\r\n\r\n/**\r\n *\r\n * True : Store the keyword in the Map and return the index\r\n *\r\n * False : Extract keywords by index\r\n * */\r\nfunction handleHitKeywords(value, mode) {\r\n  if (mode) {\r\n    if (currentIndex === undefined) {\r\n      currentIndex = 1;\r\n      compressionMap = new Map();\r\n      compressionMap.set(currentIndex, value);\r\n    } else {\r\n      compressionMap.set(++currentIndex, value);\r\n    }\r\n    return String(currentIndex);\r\n  } else {\r\n    return String(compressionMap.get(Number(value)));\r\n  }\r\n}\r\n\r\n/**\r\n * any kind of punctuation character (including international e.g. Chinese and Spanish punctuation), and spaces, newlines\r\n *\r\n * source: https://github.com/slevithan/xregexp/blob/41f4cd3fc0a8540c3c71969a0f81d1f00e9056a9/src/addons/unicode/unicode-categories.js#L142\r\n *\r\n * note: XRegExp unicode output taken from http://jsbin.com/uFiNeDOn/3/edit?js,console (see chrome console.log), then converted back to JS escaped unicode here http://rishida.net/tools/conversion/, then tested on http://regexpal.com/\r\n *\r\n * suggested by: https://stackoverflow.com/a/7578937\r\n *\r\n * added: extra characters like \"$\", \"\\uFFE5\" [yen symbol], \"^\", \"+\", \"=\" which are not consider punctuation in the XRegExp regex (they are currency or mathmatical characters)\r\n *\r\n * added: Chinese Punctuation: \\u3002|\\uff1f|\\uff01|\\uff0c|\\u3001|\\uff1b|\\uff1a|\\u201c|\\u201d|\\u2018|\\u2019|\\uff08|\\uff09|\\u300a|\\u300b|\\u3010|\\u3011|\\u007e\r\n *\r\n * added: special html space symbol: &nbsp; &ensp; &emsp; &thinsp; &zwnj; &zwj; -> \\u00A0|\\u2002|\\u2003|\\u2009|\\u200C|\\u200D\r\n * @see https://stackoverflow.com/a/21396529/19616126\r\n * */\r\nfunction isPunctuationOrDelimiter(str) {\r\n  if (typeof str !== \"string\") return false;\r\n  if (str === \"\\n\" || str === \" \") return true;\r\n  const regex =\r\n    /[\\$\\uFFE5\\^\\+=`~<>{}\\[\\]|\\u00A0|\\u2002|\\u2003|\\u2009|\\u200C|\\u200D|\\u3002|\\uff1f|\\uff01|\\uff0c|\\u3001|\\uff1b|\\uff1a|\\u201c|\\u201d|\\u2018|\\u2019|\\uff08|\\uff09|\\u300a|\\u300b|\\u3010|\\u3011|\\u007e!-#%-\\x2A,-/:;\\x3F@\\x5B-\\x5D_\\x7B}\\u00A1\\u00A7\\u00AB\\u00B6\\u00B7\\u00BB\\u00BF\\u037E\\u0387\\u055A-\\u055F\\u0589\\u058A\\u05BE\\u05C0\\u05C3\\u05C6\\u05F3\\u05F4\\u0609\\u060A\\u060C\\u060D\\u061B\\u061E\\u061F\\u066A-\\u066D\\u06D4\\u0700-\\u070D\\u07F7-\\u07F9\\u0830-\\u083E\\u085E\\u0964\\u0965\\u0970\\u0AF0\\u0DF4\\u0E4F\\u0E5A\\u0E5B\\u0F04-\\u0F12\\u0F14\\u0F3A-\\u0F3D\\u0F85\\u0FD0-\\u0FD4\\u0FD9\\u0FDA\\u104A-\\u104F\\u10FB\\u1360-\\u1368\\u1400\\u166D\\u166E\\u169B\\u169C\\u16EB-\\u16ED\\u1735\\u1736\\u17D4-\\u17D6\\u17D8-\\u17DA\\u1800-\\u180A\\u1944\\u1945\\u1A1E\\u1A1F\\u1AA0-\\u1AA6\\u1AA8-\\u1AAD\\u1B5A-\\u1B60\\u1BFC-\\u1BFF\\u1C3B-\\u1C3F\\u1C7E\\u1C7F\\u1CC0-\\u1CC7\\u1CD3\\u2010-\\u2027\\u2030-\\u2043\\u2045-\\u2051\\u2053-\\u205E\\u207D\\u207E\\u208D\\u208E\\u2329\\u232A\\u2768-\\u2775\\u27C5\\u27C6\\u27E6-\\u27EF\\u2983-\\u2998\\u29D8-\\u29DB\\u29FC\\u29FD\\u2CF9-\\u2CFC\\u2CFE\\u2CFF\\u2D70\\u2E00-\\u2E2E\\u2E30-\\u2E3B\\u3001-\\u3003\\u3008-\\u3011\\u3014-\\u301F\\u3030\\u303D\\u30A0\\u30FB\\uA4FE\\uA4FF\\uA60D-\\uA60F\\uA673\\uA67E\\uA6F2-\\uA6F7\\uA874-\\uA877\\uA8CE\\uA8CF\\uA8F8-\\uA8FA\\uA92E\\uA92F\\uA95F\\uA9C1-\\uA9CD\\uA9DE\\uA9DF\\uAA5C-\\uAA5F\\uAADE\\uAADF\\uAAF0\\uAAF1\\uABEB\\uFD3E\\uFD3F\\uFE10-\\uFE19\\uFE30-\\uFE52\\uFE54-\\uFE61\\uFE63\\uFE68\\uFE6A\\uFE6B\\uFF01-\\uFF03\\uFF05-\\uFF0A\\uFF0C-\\uFF0F\\uFF1A\\uFF1B\\uFF1F\\uFF20\\uFF3B-\\uFF3D\\uFF3F\\uFF5B\\uFF5D\\uFF5F-\\uFF65]+/g;\r\n  return regex.test(str);\r\n}\r\n\r\n/**\r\n * Remove useless newlines, spaces inside, which may affect our semantics\r\n * */\r\nfunction removeExtraDelimiter(textContext) {\r\n  textContext = textContext.replaceAll(\"\\n\", \" \");\r\n  textContext = textContext.replace(/  +/g, \" \");\r\n  return textContext;\r\n}\r\n\r\nfunction backgroundTranslateHTML(\r\n  translationService,\r\n  targetLanguage,\r\n  sourceArray2d,\r\n  dontSortResults\r\n) {\r\n  return new Promise((resolve, reject) => {\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"translateHTML\",\r\n        translationService,\r\n        targetLanguage,\r\n        sourceArray2d,\r\n        dontSortResults,\r\n      },\r\n      (response) => {\r\n        checkedLastError();\r\n        resolve(response);\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\nfunction backgroundTranslateText(\r\n  translationService,\r\n  targetLanguage,\r\n  sourceArray\r\n) {\r\n  return new Promise((resolve, reject) => {\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"translateText\",\r\n        translationService,\r\n        targetLanguage,\r\n        sourceArray,\r\n      },\r\n      (response) => {\r\n        checkedLastError();\r\n        resolve(response);\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\nfunction backgroundTranslateSingleText(\r\n  translationService,\r\n  targetLanguage,\r\n  source\r\n) {\r\n  return new Promise((resolve, reject) => {\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"translateSingleText\",\r\n        translationService,\r\n        targetLanguage,\r\n        source,\r\n      },\r\n      (response) => {\r\n        checkedLastError();\r\n        resolve(response);\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\nvar pageTranslator = {};\r\n\r\nfunction getTabHostName() {\r\n  return new Promise((resolve) =>\r\n    chrome.runtime.sendMessage({ action: \"getTabHostName\" }, (result) => {\r\n      checkedLastError();\r\n      resolve(result);\r\n    })\r\n  );\r\n}\r\n\r\nPromise.all([twpConfig.onReady(), getTabHostName()]).then(function (_) {\r\n  const tabHostName = _[1];\r\n  const htmlTagsInlineText = [\r\n    \"#text\",\r\n    \"a\",\r\n    \"abbr\",\r\n    \"acronym\",\r\n    \"b\",\r\n    \"bdo\",\r\n    \"big\",\r\n    \"cite\",\r\n    \"dfn\",\r\n    \"em\",\r\n    \"i\",\r\n    \"label\",\r\n    \"q\",\r\n    \"s\",\r\n    \"small\",\r\n    \"span\",\r\n    \"strong\",\r\n    \"sub\",\r\n    \"sup\",\r\n    \"u\",\r\n    \"tt\",\r\n    \"var\",\r\n  ];\r\n  const htmlTagsInlineIgnore = [\"br\", \"code\", \"kbd\", \"wbr\"]; // and input if type is submit or button, and <pre> depending on settings\r\n  const htmlTagsNoTranslate = [\"title\", \"script\", \"style\", \"textarea\", \"svg\"];\r\n\r\n  if (twpConfig.get(\"translateTag_pre\") !== \"yes\") {\r\n    htmlTagsInlineIgnore.push(\"pre\");\r\n  }\r\n  twpConfig.onChanged((name, newvalue) => {\r\n    switch (name) {\r\n      case \"translateTag_pre\":\r\n        const index = htmlTagsInlineIgnore.indexOf(\"pre\");\r\n        if (index !== -1) {\r\n          htmlTagsInlineIgnore.splice(index, 1);\r\n        }\r\n        if (newvalue !== \"yes\") {\r\n          htmlTagsInlineIgnore.push(\"pre\");\r\n        }\r\n        break;\r\n    }\r\n  });\r\n\r\n  //TODO FOO\r\n  if (\r\n    twpConfig.get(\"useOldPopup\") == \"yes\" ||\r\n    twpConfig.get(\"popupPanelSection\") <= 1\r\n  ) {\r\n    twpConfig.set(\"targetLanguage\", twpConfig.get(\"targetLanguages\")[0]);\r\n  }\r\n\r\n  // Pieces are a set of nodes separated by inline tags that form a sentence or paragraph.\r\n  let piecesToTranslate = [];\r\n  let originalTabLanguage = \"und\";\r\n  let currentPageLanguage = \"und\";\r\n  let pageLanguageState = \"original\";\r\n  let currentTargetLanguage = twpConfig.get(\"targetLanguage\");\r\n  let currentPageTranslatorService = twpConfig.get(\"pageTranslatorService\");\r\n  let dontSortResults =\r\n    twpConfig.get(\"dontSortResults\") == \"yes\" ? true : false;\r\n  let fooCount = 0;\r\n\r\n  let originalPageTitle;\r\n\r\n  let attributesToTranslate = [];\r\n\r\n  let translateNewNodesTimerHandler;\r\n  let newNodes = [];\r\n  let removedNodes = [];\r\n\r\n  let nodesToRestore = [];\r\n\r\n  function translateNewNodes() {\r\n    try {\r\n      newNodes.forEach((nn) => {\r\n        if (removedNodes.indexOf(nn) != -1) return;\r\n\r\n        let newPiecesToTranslate = getPiecesToTranslate(nn);\r\n\r\n        for (const i in newPiecesToTranslate) {\r\n          const newNodes = newPiecesToTranslate[i].nodes;\r\n          let finded = false;\r\n\r\n          for (const ntt of piecesToTranslate) {\r\n            if (ntt.nodes.some((n1) => newNodes.some((n2) => n1 === n2))) {\r\n              finded = true;\r\n            }\r\n          }\r\n\r\n          if (!finded) {\r\n            piecesToTranslate.push(newPiecesToTranslate[i]);\r\n          }\r\n        }\r\n      });\r\n    } catch (e) {\r\n      console.error(e);\r\n    } finally {\r\n      newNodes = [];\r\n      removedNodes = [];\r\n    }\r\n  }\r\n\r\n  const mutationObserver = new MutationObserver(function (mutations) {\r\n    const piecesToTranslate = [];\r\n\r\n    mutations.forEach((mutation) => {\r\n      mutation.addedNodes.forEach((addedNode) => {\r\n        const nodeName = addedNode.nodeName.toLowerCase();\r\n        if (htmlTagsNoTranslate.indexOf(nodeName) == -1) {\r\n          if (htmlTagsInlineText.indexOf(nodeName) == -1) {\r\n            if (htmlTagsInlineIgnore.indexOf(nodeName) == -1) {\r\n              piecesToTranslate.push(addedNode);\r\n            }\r\n          }\r\n        }\r\n      });\r\n\r\n      mutation.removedNodes.forEach((removedNode) => {\r\n        removedNodes.push(removedNode);\r\n      });\r\n    });\r\n\r\n    piecesToTranslate.forEach((ptt) => {\r\n      if (newNodes.indexOf(ptt) == -1) {\r\n        newNodes.push(ptt);\r\n      }\r\n    });\r\n  });\r\n\r\n  function enableMutatinObserver() {\r\n    disableMutatinObserver();\r\n\r\n    if (twpConfig.get(\"translateDynamicallyCreatedContent\") == \"yes\") {\r\n      translateNewNodesTimerHandler = setInterval(translateNewNodes, 2000);\r\n      mutationObserver.observe(document.body, {\r\n        childList: true,\r\n        subtree: true,\r\n      });\r\n    }\r\n  }\r\n\r\n  function disableMutatinObserver() {\r\n    clearInterval(translateNewNodesTimerHandler);\r\n    newNodes = [];\r\n    removedNodes = [];\r\n    mutationObserver.disconnect();\r\n    mutationObserver.takeRecords();\r\n  }\r\n\r\n  let pageIsVisible = document.visibilityState == \"visible\";\r\n  // isto faz com que partes do youtube não sejam traduzidas\r\n  // new IntersectionObserver(entries => {\r\n  //         if (entries[0].isIntersecting && document.visibilityState == \"visible\") {\r\n  //             pageIsVisible = true\r\n  //         } else {\r\n  //             pageIsVisible = false\r\n  //         }\r\n\r\n  //         if (pageIsVisible && pageLanguageState === \"translated\") {\r\n  //             enableMutatinObserver()\r\n  //         } else {\r\n  //             disableMutatinObserver()\r\n  //         }\r\n  //     }, {\r\n  //         root: null\r\n  //     })\r\n  //     .observe(document.body)\r\n\r\n  const handleVisibilityChange = function () {\r\n    if (document.visibilityState == \"visible\") {\r\n      pageIsVisible = true;\r\n    } else {\r\n      pageIsVisible = false;\r\n    }\r\n\r\n    if (pageIsVisible && pageLanguageState === \"translated\") {\r\n      enableMutatinObserver();\r\n    } else {\r\n      disableMutatinObserver();\r\n    }\r\n  };\r\n  document.addEventListener(\"visibilitychange\", handleVisibilityChange, false);\r\n\r\n  function getPiecesToTranslate(root = document.documentElement) {\r\n    const piecesToTranslate = [\r\n      {\r\n        isTranslated: false,\r\n        parentElement: null,\r\n        topElement: null,\r\n        bottomElement: null,\r\n        nodes: [],\r\n      },\r\n    ];\r\n    let index = 0;\r\n    let currentParagraphSize = 0;\r\n\r\n    const getAllNodes = function (\r\n      node,\r\n      lastHTMLElement = null,\r\n      lastSelectOrDataListElement = null\r\n    ) {\r\n      if (node.nodeType == 1 || node.nodeType == 11) {\r\n        if (node.nodeType == 11) {\r\n          lastHTMLElement = node.host;\r\n          lastSelectOrDataListElement = null;\r\n        } else if (node.nodeType == 1) {\r\n          lastHTMLElement = node;\r\n          const nodeName = node.nodeName.toLowerCase();\r\n\r\n          if (nodeName === \"select\" || nodeName === \"datalist\")\r\n            lastSelectOrDataListElement = node;\r\n\r\n          if (\r\n            htmlTagsInlineIgnore.indexOf(nodeName) !== -1 ||\r\n            htmlTagsNoTranslate.indexOf(nodeName) !== -1 ||\r\n            node.classList.contains(\"notranslate\") ||\r\n            node.getAttribute(\"translate\") === \"no\" ||\r\n            node.isContentEditable ||\r\n            node.classList.contains(\"material-icons\") ||\r\n            node.classList.contains(\"material-symbols-outlined\")\r\n          ) {\r\n            if (piecesToTranslate[index].nodes.length > 0) {\r\n              currentParagraphSize = 0;\r\n              piecesToTranslate[index].bottomElement = lastHTMLElement;\r\n              piecesToTranslate.push({\r\n                isTranslated: false,\r\n                parentElement: null,\r\n                topElement: null,\r\n                bottomElement: null,\r\n                nodes: [],\r\n              });\r\n              index++;\r\n            }\r\n            return;\r\n          }\r\n        }\r\n\r\n        function getAllChilds(childNodes) {\r\n          Array.from(childNodes).forEach((_node) => {\r\n            const nodeName = _node.nodeName.toLowerCase();\r\n\r\n            if (_node.nodeType == 1) {\r\n              lastHTMLElement = _node;\r\n              if (nodeName === \"select\" || nodeName === \"datalist\")\r\n                lastSelectOrDataListElement = _node;\r\n            }\r\n\r\n            if (htmlTagsInlineText.indexOf(nodeName) == -1) {\r\n              if (piecesToTranslate[index].nodes.length > 0) {\r\n                currentParagraphSize = 0;\r\n                piecesToTranslate[index].bottomElement = lastHTMLElement;\r\n                piecesToTranslate.push({\r\n                  isTranslated: false,\r\n                  parentElement: null,\r\n                  topElement: null,\r\n                  bottomElement: null,\r\n                  nodes: [],\r\n                });\r\n                index++;\r\n              }\r\n\r\n              getAllNodes(_node, lastHTMLElement, lastSelectOrDataListElement);\r\n\r\n              if (piecesToTranslate[index].nodes.length > 0) {\r\n                currentParagraphSize = 0;\r\n                piecesToTranslate[index].bottomElement = lastHTMLElement;\r\n                piecesToTranslate.push({\r\n                  isTranslated: false,\r\n                  parentElement: null,\r\n                  topElement: null,\r\n                  bottomElement: null,\r\n                  nodes: [],\r\n                });\r\n                index++;\r\n              }\r\n            } else {\r\n              getAllNodes(_node, lastHTMLElement, lastSelectOrDataListElement);\r\n            }\r\n          });\r\n        }\r\n\r\n        getAllChilds(node.childNodes);\r\n        if (!piecesToTranslate[index].bottomElement) {\r\n          piecesToTranslate[index].bottomElement = node;\r\n        }\r\n        if (node.shadowRoot) {\r\n          getAllChilds(node.shadowRoot.childNodes);\r\n          if (!piecesToTranslate[index].bottomElement) {\r\n            piecesToTranslate[index].bottomElement = node;\r\n          }\r\n        }\r\n      } else if (node.nodeType == 3) {\r\n        if (node.textContent.trim().length > 0) {\r\n          if (!piecesToTranslate[index].parentElement) {\r\n            if (\r\n              node &&\r\n              node.parentNode &&\r\n              node.parentNode.nodeName.toLowerCase() === \"option\" &&\r\n              lastSelectOrDataListElement\r\n            ) {\r\n              piecesToTranslate[index].parentElement =\r\n                lastSelectOrDataListElement;\r\n              piecesToTranslate[index].bottomElement =\r\n                lastSelectOrDataListElement;\r\n              piecesToTranslate[index].topElement = lastSelectOrDataListElement;\r\n            } else {\r\n              let temp = node.parentNode;\r\n              const nodeName = temp.nodeName.toLowerCase();\r\n              while (\r\n                temp &&\r\n                temp != root &&\r\n                (htmlTagsInlineText.indexOf(nodeName) != -1 ||\r\n                  htmlTagsInlineIgnore.indexOf(nodeName) != -1)\r\n              ) {\r\n                temp = temp.parentNode;\r\n              }\r\n              if (temp && temp.nodeType === 11) {\r\n                temp = temp.host;\r\n              }\r\n              piecesToTranslate[index].parentElement = temp;\r\n            }\r\n          }\r\n          if (!piecesToTranslate[index].topElement) {\r\n            piecesToTranslate[index].topElement = lastHTMLElement;\r\n          }\r\n          if (currentParagraphSize > 1000) {\r\n            currentParagraphSize = 0;\r\n            piecesToTranslate[index].bottomElement = lastHTMLElement;\r\n            const pieceInfo = {\r\n              isTranslated: false,\r\n              parentElement: null,\r\n              topElement: lastHTMLElement,\r\n              bottomElement: null,\r\n              nodes: [],\r\n            };\r\n            pieceInfo.parentElement = piecesToTranslate[index].parentElement;\r\n            piecesToTranslate.push(pieceInfo);\r\n            index++;\r\n          }\r\n          currentParagraphSize += node.textContent.length;\r\n          piecesToTranslate[index].nodes.push(node);\r\n          piecesToTranslate[index].bottomElement = null;\r\n        }\r\n      }\r\n    };\r\n    getAllNodes(root);\r\n\r\n    if (\r\n      piecesToTranslate.length > 0 &&\r\n      piecesToTranslate[piecesToTranslate.length - 1].nodes.length == 0\r\n    ) {\r\n      piecesToTranslate.pop();\r\n    }\r\n\r\n    return piecesToTranslate;\r\n  }\r\n\r\n  function getAttributesToTranslate(root = document.body) {\r\n    const attributesToTranslate = [];\r\n\r\n    const placeholdersElements = root.querySelectorAll(\r\n      \"input[placeholder], textarea[placeholder]\"\r\n    );\r\n    const altElements = root.querySelectorAll(\r\n      'area[alt], img[alt], input[type=\"image\"][alt]'\r\n    );\r\n    const valueElements = root.querySelectorAll(\r\n      'input[type=\"button\"], input[type=\"submit\"], input[type=\"reset\"]'\r\n    );\r\n    const titleElements = root.querySelectorAll(\"body [title]\");\r\n\r\n    function hasNoTranslate(elem) {\r\n      if (\r\n        elem &&\r\n        (elem.classList.contains(\"notranslate\") ||\r\n          elem.getAttribute(\"translate\") === \"no\")\r\n      ) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    placeholdersElements.forEach((e) => {\r\n      if (hasNoTranslate(e)) return;\r\n\r\n      const txt = e.getAttribute(\"placeholder\");\r\n      if (txt && txt.trim()) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: txt,\r\n          attrName: \"placeholder\",\r\n        });\r\n      }\r\n    });\r\n\r\n    altElements.forEach((e) => {\r\n      if (hasNoTranslate(e)) return;\r\n\r\n      const txt = e.getAttribute(\"alt\");\r\n      if (txt && txt.trim()) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: txt,\r\n          attrName: \"alt\",\r\n        });\r\n      }\r\n    });\r\n\r\n    valueElements.forEach((e) => {\r\n      if (hasNoTranslate(e)) return;\r\n\r\n      const txt = e.getAttribute(\"value\");\r\n      if (e.type == \"submit\" && !txt) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: \"Submit Query\",\r\n          attrName: \"value\",\r\n        });\r\n      } else if (e.type == \"reset\" && !txt) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: \"Reset\",\r\n          attrName: \"value\",\r\n        });\r\n      } else if (txt && txt.trim()) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: txt,\r\n          attrName: \"value\",\r\n        });\r\n      }\r\n    });\r\n\r\n    titleElements.forEach((e) => {\r\n      if (hasNoTranslate(e)) return;\r\n\r\n      const txt = e.getAttribute(\"title\");\r\n      if (txt && txt.trim()) {\r\n        attributesToTranslate.push({\r\n          node: e,\r\n          original: txt,\r\n          attrName: \"title\",\r\n        });\r\n      }\r\n    });\r\n\r\n    return attributesToTranslate;\r\n  }\r\n\r\n  // encapsular o texto faz com que do video suma\r\n  // ao utilizar função como Pai.removeChild(filho)\r\n  // pode ser gerado um erro ao encapsular\r\n  function encapsulateTextNode(node) {\r\n    const fontNode = document.createElement(\"font\");\r\n    fontNode.setAttribute(\"style\", \"vertical-align: inherit;\");\r\n    fontNode.textContent = node.textContent;\r\n\r\n    node.replaceWith(fontNode);\r\n\r\n    return fontNode;\r\n  }\r\n\r\n  function translateResults(piecesToTranslateNow, results) {\r\n    if (dontSortResults) {\r\n      for (let i = 0; i < results.length; i++) {\r\n        for (let j = 0; j < results[i].length; j++) {\r\n          if (piecesToTranslateNow[i].nodes[j]) {\r\n            const nodes = piecesToTranslateNow[i].nodes;\r\n            let translated = results[i][j] + \" \";\r\n            // In some case, results items count is over original node count\r\n            // Rest results append to last node\r\n            if (\r\n              piecesToTranslateNow[i].nodes.length - 1 === j &&\r\n              results[i].length > j\r\n            ) {\r\n              const restResults = results[i].slice(j + 1);\r\n              translated += restResults.join(\" \");\r\n            }\r\n\r\n            const originalTextNode = nodes[j];\r\n            if (showOriginal.isEnabled) {\r\n              nodes[j] = encapsulateTextNode(nodes[j]);\r\n              showOriginal.add(nodes[j]);\r\n            }\r\n\r\n            const toRestore = {\r\n              node: nodes[j],\r\n              original: originalTextNode,\r\n              originalText: originalTextNode.textContent,\r\n              translatedText: translated,\r\n            };\r\n            nodesToRestore.push(toRestore);\r\n\r\n            handleCustomWords(\r\n              translated,\r\n              nodes[j].textContent,\r\n              currentPageTranslatorService,\r\n              currentTargetLanguage\r\n            ).then((results) => {\r\n              nodes[j].textContent = results;\r\n              toRestore.translatedText = results;\r\n            });\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      for (const i in piecesToTranslateNow) {\r\n        for (const j in piecesToTranslateNow[i].nodes) {\r\n          if (results[i][j]) {\r\n            const nodes = piecesToTranslateNow[i].nodes;\r\n            const translated = results[i][j] + \" \";\r\n\r\n            const originalTextNode = nodes[j];\r\n            if (showOriginal.isEnabled) {\r\n              nodes[j] = encapsulateTextNode(nodes[j]);\r\n              showOriginal.add(nodes[j]);\r\n            }\r\n\r\n            const toRestore = {\r\n              node: nodes[j],\r\n              original: originalTextNode,\r\n              originalText: originalTextNode.textContent,\r\n              translatedText: translated,\r\n            };\r\n            nodesToRestore.push(toRestore);\r\n\r\n            handleCustomWords(\r\n              translated,\r\n              nodes[j].textContent,\r\n              currentPageTranslatorService,\r\n              currentTargetLanguage\r\n            ).then((results) => {\r\n              nodes[j].textContent = results;\r\n              toRestore.translatedText = results;\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n    mutationObserver.takeRecords();\r\n  }\r\n\r\n  function translateAttributes(attributesToTranslateNow, results) {\r\n    for (const i in attributesToTranslateNow) {\r\n      const ati = attributesToTranslateNow[i];\r\n      ati.node.setAttribute(ati.attrName, results[i]);\r\n    }\r\n  }\r\n\r\n  function translationRoutine() {\r\n    try {\r\n      if (piecesToTranslate && pageIsVisible) {\r\n        (function () {\r\n          const innerHeight = window.innerHeight;\r\n\r\n          function isInScreen(element) {\r\n            const rect = element.getBoundingClientRect();\r\n            if (\r\n              (rect.top > 0 && rect.top <= innerHeight) ||\r\n              (rect.bottom > 0 && rect.bottom <= innerHeight)\r\n            ) {\r\n              return true;\r\n            }\r\n            return false;\r\n          }\r\n\r\n          function topIsInScreen(element) {\r\n            if (!element) {\r\n              // debugger;\r\n              return false;\r\n            }\r\n            const rect = element.getBoundingClientRect();\r\n            if (rect.top > 0 && rect.top <= innerHeight) {\r\n              return true;\r\n            }\r\n            return false;\r\n          }\r\n\r\n          function bottomIsInScreen(element) {\r\n            if (!element) {\r\n              // debugger;\r\n              return false;\r\n            }\r\n            const rect = element.getBoundingClientRect();\r\n            if (rect.bottom > 0 && rect.bottom <= innerHeight) {\r\n              return true;\r\n            }\r\n            return false;\r\n          }\r\n\r\n          const currentFooCount = fooCount;\r\n\r\n          const piecesToTranslateNow = [];\r\n          piecesToTranslate.forEach((ptt) => {\r\n            if (!ptt.isTranslated) {\r\n              if (\r\n                bottomIsInScreen(ptt.topElement) ||\r\n                topIsInScreen(ptt.bottomElement)\r\n              ) {\r\n                ptt.isTranslated = true;\r\n                piecesToTranslateNow.push(ptt);\r\n              }\r\n            }\r\n          });\r\n\r\n          const attributesToTranslateNow = [];\r\n          attributesToTranslate.forEach((ati) => {\r\n            if (!ati.isTranslated) {\r\n              if (isInScreen(ati.node)) {\r\n                ati.isTranslated = true;\r\n                attributesToTranslateNow.push(ati);\r\n              }\r\n            }\r\n          });\r\n\r\n          if (piecesToTranslateNow.length > 0) {\r\n            backgroundTranslateHTML(\r\n              currentPageTranslatorService,\r\n              currentTargetLanguage,\r\n              piecesToTranslateNow.map((ptt) =>\r\n                ptt.nodes.map((node) => filterKeywordsInText(node.textContent))\r\n              ),\r\n              dontSortResults\r\n            ).then((results) => {\r\n              if (\r\n                pageLanguageState === \"translated\" &&\r\n                currentFooCount === fooCount\r\n              ) {\r\n                translateResults(piecesToTranslateNow, results);\r\n              }\r\n            });\r\n          }\r\n\r\n          if (attributesToTranslateNow.length > 0) {\r\n            backgroundTranslateText(\r\n              currentPageTranslatorService,\r\n              currentTargetLanguage,\r\n              attributesToTranslateNow.map((ati) => ati.original)\r\n            ).then((results) => {\r\n              if (\r\n                pageLanguageState === \"translated\" &&\r\n                currentFooCount === fooCount\r\n              ) {\r\n                translateAttributes(attributesToTranslateNow, results);\r\n              }\r\n            });\r\n          }\r\n        })();\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n    clearTimeout(translationRoutine_handler);\r\n    translationRoutine_handler = setTimeout(translationRoutine, 300);\r\n  }\r\n\r\n  translationRoutine();\r\n\r\n  function translatePageTitle() {\r\n    const title = document.querySelector(\"title\");\r\n    if (\r\n      title &&\r\n      (title.classList.contains(\"notranslate\") ||\r\n        title.getAttribute(\"translate\") === \"no\")\r\n    ) {\r\n      return;\r\n    }\r\n    if (document.title.trim().length < 1) return;\r\n    originalPageTitle = document.title;\r\n\r\n    backgroundTranslateSingleText(\r\n      currentPageTranslatorService,\r\n      currentTargetLanguage,\r\n      originalPageTitle\r\n    ).then((result) => {\r\n      if (result) {\r\n        document.title = result;\r\n      }\r\n    });\r\n  }\r\n\r\n  const pageLanguageStateObservers = [];\r\n\r\n  pageTranslator.onPageLanguageStateChange = function (callback) {\r\n    pageLanguageStateObservers.push(callback);\r\n  };\r\n\r\n  var translationRoutine_handler = null;\r\n\r\n  pageTranslator.translatePage = function (targetLanguage) {\r\n    fooCount++;\r\n    pageTranslator.restorePage();\r\n    showOriginal.enable();\r\n    chrome.runtime.sendMessage(\r\n      { action: \"removeTranslationsWithError\" },\r\n      checkedLastError\r\n    );\r\n\r\n    dontSortResults = twpConfig.get(\"dontSortResults\") == \"yes\" ? true : false;\r\n\r\n    if (targetLanguage) {\r\n      currentTargetLanguage = targetLanguage;\r\n    }\r\n\r\n    // https://github.com/FilipePS/Traduzir-paginas-web/issues/619\r\n    if (\r\n      location.hostname === \"sberbank.com\" ||\r\n      location.hostname === \"www.sberbank.com\"\r\n    ) {\r\n      document.body.classList.remove(\"notranslate\");\r\n    }\r\n\r\n    piecesToTranslate = getPiecesToTranslate();\r\n    attributesToTranslate = getAttributesToTranslate();\r\n\r\n    pageLanguageState = \"translated\";\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"setPageLanguageState\",\r\n        pageLanguageState,\r\n      },\r\n      checkedLastError\r\n    );\r\n    pageLanguageStateObservers.forEach((callback) =>\r\n      callback(pageLanguageState)\r\n    );\r\n    currentPageLanguage = currentTargetLanguage;\r\n\r\n    translatePageTitle();\r\n\r\n    enableMutatinObserver();\r\n\r\n    translationRoutine();\r\n  };\r\n\r\n  pageTranslator.restorePage = function () {\r\n    fooCount++;\r\n    piecesToTranslate = [];\r\n\r\n    showOriginal.disable();\r\n    disableMutatinObserver();\r\n\r\n    pageLanguageState = \"original\";\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"setPageLanguageState\",\r\n        pageLanguageState,\r\n      },\r\n      checkedLastError\r\n    );\r\n    pageLanguageStateObservers.forEach((callback) =>\r\n      callback(pageLanguageState)\r\n    );\r\n    currentPageLanguage = originalTabLanguage;\r\n\r\n    if (originalPageTitle) {\r\n      document.title = originalPageTitle;\r\n    }\r\n    originalPageTitle = null;\r\n\r\n    for (const ntr of nodesToRestore) {\r\n      if (ntr.node === ntr.original) {\r\n        if (ntr.node.textContent === ntr.translatedText) {\r\n          ntr.node.textContent = ntr.originalText;\r\n        }\r\n      } else {\r\n        ntr.node.replaceWith(ntr.original);\r\n      }\r\n    }\r\n    nodesToRestore = [];\r\n\r\n    //TODO não restaurar atributos que foram modificados\r\n    for (const ati of attributesToTranslate) {\r\n      if (ati.isTranslated) {\r\n        ati.node.setAttribute(ati.attrName, ati.original);\r\n      }\r\n    }\r\n    attributesToTranslate = [];\r\n  };\r\n\r\n  pageTranslator.swapTranslationService = function () {\r\n    if (currentPageTranslatorService === \"google\") {\r\n      currentPageTranslatorService = \"bing\";\r\n    } else if (currentPageTranslatorService === \"bing\") {\r\n      currentPageTranslatorService = \"yandex\";\r\n    } else {\r\n      currentPageTranslatorService = \"google\";\r\n    }\r\n    if (pageLanguageState === \"translated\") {\r\n      pageTranslator.translatePage();\r\n    }\r\n  };\r\n\r\n  let alreadyGotTheLanguage = false;\r\n  const observers = [];\r\n\r\n  pageTranslator.onGetOriginalTabLanguage = function (callback) {\r\n    if (alreadyGotTheLanguage) {\r\n      callback(originalTabLanguage);\r\n    } else {\r\n      observers.push(callback);\r\n    }\r\n  };\r\n\r\n  chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\r\n    if (request.action === \"translatePage\") {\r\n      if (request.targetLanguage === \"original\") {\r\n        pageTranslator.restorePage();\r\n      } else {\r\n        pageTranslator.translatePage(request.targetLanguage);\r\n      }\r\n    } else if (request.action === \"restorePage\") {\r\n      pageTranslator.restorePage();\r\n    } else if (request.action === \"getOriginalTabLanguage\") {\r\n      pageTranslator.onGetOriginalTabLanguage(function () {\r\n        sendResponse(originalTabLanguage);\r\n      });\r\n      return true;\r\n    } else if (request.action === \"getCurrentPageLanguage\") {\r\n      sendResponse(currentPageLanguage);\r\n    } else if (request.action === \"getCurrentPageLanguageState\") {\r\n      sendResponse(pageLanguageState);\r\n    } else if (request.action === \"getCurrentPageTranslatorService\") {\r\n      sendResponse(currentPageTranslatorService);\r\n    } else if (request.action === \"swapTranslationService\") {\r\n      pageTranslator.swapTranslationService();\r\n    } else if (request.action === \"toggle-translation\") {\r\n      if (pageLanguageState === \"translated\") {\r\n        pageTranslator.restorePage();\r\n      } else {\r\n        pageTranslator.translatePage();\r\n      }\r\n    } else if (request.action === \"autoTranslateBecauseClickedALink\") {\r\n      if (twpConfig.get(\"autoTranslateWhenClickingALink\") === \"yes\") {\r\n        pageTranslator.onGetOriginalTabLanguage(function () {\r\n          if (\r\n            pageLanguageState === \"original\" &&\r\n            originalTabLanguage !== currentTargetLanguage &&\r\n            twpConfig\r\n              .get(\"neverTranslateLangs\")\r\n              .indexOf(originalTabLanguage) === -1\r\n          ) {\r\n            pageTranslator.translatePage();\r\n          }\r\n        });\r\n      }\r\n    }\r\n  });\r\n\r\n  // Requests the detection of the tab language in the background\r\n  if (window.self === window.top) {\r\n    // is main frame\r\n    const onTabVisible = function () {\r\n      chrome.runtime.sendMessage(\r\n        {\r\n          action: \"detectTabLanguage\",\r\n        },\r\n        (result) => {\r\n          checkedLastError();\r\n\r\n          result = result || \"und\";\r\n          if (result === \"und\") {\r\n            originalTabLanguage = result;\r\n            if (\r\n              twpConfig.get(\"alwaysTranslateSites\").indexOf(tabHostName) !== -1\r\n            ) {\r\n              pageTranslator.translatePage();\r\n            }\r\n          } else {\r\n            const langCode = twpLang.fixTLanguageCode(result);\r\n            if (langCode) {\r\n              originalTabLanguage = langCode;\r\n            }\r\n            if (\r\n              location.hostname === \"translatewebpages.org\" &&\r\n              location.href.indexOf(\"?autotranslate\") !== -1 &&\r\n              twpConfig.get(\"neverTranslateSites\").indexOf(tabHostName) === -1\r\n            ) {\r\n              pageTranslator.translatePage();\r\n            } else {\r\n              if (\r\n                location.hostname !== \"translate.googleusercontent.com\" &&\r\n                location.hostname !== \"translate.google.com\" &&\r\n                location.hostname !== \"translate.yandex.com\" &&\r\n                location.hostname !== \"www.deepl.com\" &&\r\n                location.hostname !== \"translated.turbopages.org\" &&\r\n                !location.hostname.endsWith(\"translate.goog\") &&\r\n                location.hostname !== \"sberbank.com\" &&\r\n                location.hostname !== \"www.sberbank.com\" // https://github.com/FilipePS/Traduzir-paginas-web/issues/619\r\n              ) {\r\n                if (\r\n                  pageLanguageState === \"original\" &&\r\n                  !platformInfo.isMobile.any &&\r\n                  !chrome.extension.inIncognitoContext\r\n                ) {\r\n                  if (\r\n                    twpConfig\r\n                      .get(\"neverTranslateSites\")\r\n                      .indexOf(tabHostName) === -1\r\n                  ) {\r\n                    if (\r\n                      langCode &&\r\n                      langCode !== currentTargetLanguage &&\r\n                      twpConfig\r\n                        .get(\"alwaysTranslateLangs\")\r\n                        .indexOf(langCode) !== -1\r\n                    ) {\r\n                      pageTranslator.translatePage();\r\n                    } else if (\r\n                      twpConfig\r\n                        .get(\"alwaysTranslateSites\")\r\n                        .indexOf(tabHostName) !== -1\r\n                    ) {\r\n                      pageTranslator.translatePage();\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n\r\n          observers.forEach((callback) => callback(originalTabLanguage));\r\n          alreadyGotTheLanguage = true;\r\n        }\r\n      );\r\n    };\r\n    setTimeout(function () {\r\n      if (document.visibilityState == \"visible\") {\r\n        onTabVisible();\r\n      } else {\r\n        const handleVisibilityChange = function () {\r\n          if (document.visibilityState == \"visible\") {\r\n            document.removeEventListener(\r\n              \"visibilitychange\",\r\n              handleVisibilityChange\r\n            );\r\n            onTabVisible();\r\n          }\r\n        };\r\n        document.addEventListener(\r\n          \"visibilitychange\",\r\n          handleVisibilityChange,\r\n          false\r\n        );\r\n      }\r\n    }, 150);\r\n  } else {\r\n    // is subframe (iframe)\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"getMainFrameTabLanguage\",\r\n      },\r\n      (result) => {\r\n        checkedLastError();\r\n\r\n        originalTabLanguage = result || \"und\";\r\n        observers.forEach((callback) => callback(originalTabLanguage));\r\n        alreadyGotTheLanguage = true;\r\n      }\r\n    );\r\n\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"getMainFramePageLanguageState\",\r\n      },\r\n      (result) => {\r\n        checkedLastError();\r\n\r\n        if (result === \"translated\" && pageLanguageState === \"original\") {\r\n          pageTranslator.translatePage();\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  showOriginal.enabledObserverSubscribe(function () {\r\n    if (pageLanguageState !== \"original\") {\r\n      pageTranslator.translatePage();\r\n    }\r\n  });\r\n});\r\n"],"mappings":"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"}
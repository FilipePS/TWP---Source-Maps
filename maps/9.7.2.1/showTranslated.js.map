{"version":3,"file":"../../contentScript/showTranslated.js","names":["showTranslated","getTabHostName","Promise","resolve","chrome","runtime","sendMessage","action","result","checkedLastError","all","twpConfig","onReady","then","_","tabHostName","platformInfo","isMobile","any","styleTextContent","fetch","getURL","response","text","catch","e","console","error","pageLanguageState","originalTabLanguage","currentTargetLanguages","get","currentTargetLanguage","currentTextTranslatorService","showTranslatedTextWhenHoveringThisSite","indexOf","showTranslatedTextWhenHoveringThisLang","translateTextOverMouseWhenPressTwice","fooCount","onChanged","name","newValue","updateEventListener","htmlTagsInlineText","htmlTagsInlineIgnore","htmlTagsNoTranslate","push","newvalue","index","splice","divElement","shadowRoot","eTextTranslated","currentNodeOverMouse","timeoutHandler","onScroll","clearTimeout","mousePos","x","y","onMouseMove","clientX","clientY","target","destroy","buttons","setTimeout","translateThisNode","onMouseDown","contains","isPlayingAudio","playAudio","targetLanguage","cbOnEnded","stopAudio","window","addEventListener","prevNode","node","usePrevNode","currentFooCount","hasChildNodeBlock","foo","nodeName","toLowerCase","child","childNodes","value","length","placeholder","test","type","parentNode","document","body","textContent","innerText","backgroundTranslateSingleText","init","getElementById","twpLang","isRtlLanguage","setAttribute","eDivResult","height","offsetHeight","top","Math","max","min","innerHeight","width","offsetWidth","left","parseInt","innerWidth","style","dragElement","elmnt","elmnt2","pos1","pos2","pos3","pos4","dragMouseDown","event","preventDefault","closeDragElement","elementDrag","offsetTop","offsetLeft","removeEventListener","isTranslatingSelected","createElement","classList","add","attachShadow","mode","innerHTML","insertBefore","enableDarkMode","el","appendChild","querySelector","disableDarkMode","remove","matchMedia","matches","sGoogle","sYandex","sBing","sDeepL","onclick","set","setTargetLanguage","getAttribute","langCode","fixTLanguageCode","setTargetLanguageTextTranslation","querySelectorAll","forEach","li","eListen","msgListen","i18n","getMessage","msgStopListening","translateDocument","targetLanguageButtons","i","codeToLanguage","isSelectingText","activeEl","activeElement","activeElTagName","tagName","selectionStart","slice","selectionEnd","getSelection","selection","toString","lastTimePressedCtrl","onKeyUp","key","performance","now","elements","pageTranslator","onGetOriginalTabLanguage","tabLanguage","onPageLanguageStateChange","_pageLanguageState"],"sources":["showTranslated.js"],"sourcesContent":["\"use strict\";\r\n\r\nvar showTranslated = {};\r\n\r\nfunction getTabHostName() {\r\n  return new Promise((resolve) =>\r\n    chrome.runtime.sendMessage({ action: \"getTabHostName\" }, (result) => {\r\n      checkedLastError();\r\n      resolve(result);\r\n    })\r\n  );\r\n}\r\n\r\nPromise.all([twpConfig.onReady(), getTabHostName()]).then(function (_) {\r\n  const tabHostName = _[1];\r\n  if (platformInfo.isMobile.any) return;\r\n\r\n  let styleTextContent = \"\";\r\n  fetch(chrome.runtime.getURL(\"/contentScript/css/showTranslated.css\"))\r\n    .then((response) => response.text())\r\n    .then((response) => (styleTextContent = response))\r\n    .catch((e) => console.error(e));\r\n\r\n  let pageLanguageState = \"original\";\r\n  let originalTabLanguage = \"und\";\r\n  let currentTargetLanguages = twpConfig.get(\"targetLanguages\");\r\n  let currentTargetLanguage = twpConfig.get(\"targetLanguageTextTranslation\");\r\n  let currentTextTranslatorService =\r\n    twpConfig.get(\"textTranslatorService\") === \"deepl\"\r\n      ? \"google\"\r\n      : twpConfig.get(\"textTranslatorService\");\r\n  let showTranslatedTextWhenHoveringThisSite =\r\n    twpConfig.get(\"sitesToTranslateWhenHovering\").indexOf(tabHostName) !== -1;\r\n  let showTranslatedTextWhenHoveringThisLang = false;\r\n  let translateTextOverMouseWhenPressTwice =\r\n    twpConfig.get(\"translateTextOverMouseWhenPressTwice\") === \"yes\";\r\n  let fooCount = 0;\r\n\r\n  twpConfig.onChanged(function (name, newValue) {\r\n    switch (name) {\r\n      case \"textTranslatorService\":\r\n        currentTextTranslatorService =\r\n          newValue === \"deepl\" ? \"google\" : newValue;\r\n        break;\r\n      case \"targetLanguages\":\r\n        currentTargetLanguages = newValue;\r\n        break;\r\n      case \"targetLanguageTextTranslation\":\r\n        currentTargetLanguage = newValue;\r\n        break;\r\n      case \"sitesToTranslateWhenHovering\":\r\n        showTranslatedTextWhenHoveringThisSite =\r\n          newValue.indexOf(tabHostName) !== -1;\r\n        updateEventListener();\r\n        break;\r\n      case \"langsToTranslateWhenHovering\":\r\n        showTranslatedTextWhenHoveringThisLang =\r\n          newValue.indexOf(originalTabLanguage) !== -1;\r\n        updateEventListener();\r\n        break;\r\n      case \"translateTextOverMouseWhenPressTwice\":\r\n        translateTextOverMouseWhenPressTwice =\r\n          twpConfig.get(\"translateTextOverMouseWhenPressTwice\") === \"yes\";\r\n        updateEventListener();\r\n        break;\r\n    }\r\n  });\r\n\r\n  const htmlTagsInlineText = [\r\n    \"#text\",\r\n    \"a\",\r\n    \"abbr\",\r\n    \"acronym\",\r\n    \"b\",\r\n    \"bdo\",\r\n    \"big\",\r\n    \"cite\",\r\n    \"dfn\",\r\n    \"em\",\r\n    \"i\",\r\n    \"label\",\r\n    \"q\",\r\n    \"s\",\r\n    \"small\",\r\n    \"span\",\r\n    \"strong\",\r\n    \"sub\",\r\n    \"sup\",\r\n    \"u\",\r\n    \"tt\",\r\n    \"var\",\r\n  ];\r\n  const htmlTagsInlineIgnore = [\"br\", \"code\", \"kbd\", \"wbr\"]; // and input if type is submit or button, and <pre> depending on settings\r\n  const htmlTagsNoTranslate = [\"title\", \"script\", \"style\", \"textarea\", \"svg\"];\r\n\r\n  if (twpConfig.get(\"translateTag_pre\") !== \"yes\") {\r\n    htmlTagsInlineIgnore.push(\"pre\");\r\n  }\r\n  twpConfig.onChanged((name, newvalue) => {\r\n    switch (name) {\r\n      case \"translateTag_pre\":\r\n        const index = htmlTagsInlineIgnore.indexOf(\"pre\");\r\n        if (index !== -1) {\r\n          htmlTagsInlineIgnore.splice(index, 1);\r\n        }\r\n        if (newvalue !== \"yes\") {\r\n          htmlTagsInlineIgnore.push(\"pre\");\r\n        }\r\n        break;\r\n    }\r\n  });\r\n\r\n  let divElement;\r\n  let shadowRoot;\r\n  let eTextTranslated;\r\n  let currentNodeOverMouse;\r\n  let timeoutHandler;\r\n\r\n  function onScroll(e) {\r\n    clearTimeout(timeoutHandler);\r\n  }\r\n\r\n  const mousePos = {\r\n    x: 0,\r\n    y: 0,\r\n  };\r\n\r\n  function onMouseMove(e) {\r\n    mousePos.x = e.clientX;\r\n    mousePos.y = e.clientY;\r\n\r\n    if (e.target === divElement) return;\r\n\r\n    if (e.target === currentNodeOverMouse) return;\r\n    currentNodeOverMouse = e.target;\r\n\r\n    if (\r\n      !(\r\n        !showTranslatedTextWhenHoveringThisSite &&\r\n        !showTranslatedTextWhenHoveringThisLang\r\n      )\r\n    ) {\r\n      destroy();\r\n      if (e.buttons === 0) {\r\n        timeoutHandler = setTimeout(translateThisNode, 1250, e.target);\r\n      }\r\n    }\r\n  }\r\n\r\n  function onMouseDown(e) {\r\n    if (e.target === divElement) return;\r\n    if (divElement && divElement.contains(e.target)) return;\r\n    destroy();\r\n  }\r\n\r\n  let isPlayingAudio = false;\r\n\r\n  function playAudio(text, targetLanguage, cbOnEnded = () => {}) {\r\n    isPlayingAudio = true;\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"textToSpeech\",\r\n        text,\r\n        targetLanguage,\r\n      },\r\n      () => {\r\n        checkedLastError();\r\n\r\n        isPlayingAudio = false;\r\n        cbOnEnded();\r\n      }\r\n    );\r\n  }\r\n\r\n  function stopAudio() {\r\n    if (!isPlayingAudio) return;\r\n    isPlayingAudio = false;\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"stopAudio\",\r\n      },\r\n      checkedLastError\r\n    );\r\n  }\r\n\r\n  window.addEventListener(\"beforeunload\", (e) => {\r\n    destroy();\r\n  });\r\n\r\n  let prevNode = null;\r\n\r\n  function translateThisNode(node, usePrevNode = false) {\r\n    fooCount++;\r\n    let currentFooCount = fooCount;\r\n\r\n    stopAudio();\r\n\r\n    if (usePrevNode && prevNode) {\r\n      node = prevNode;\r\n    }\r\n    prevNode = node;\r\n\r\n    let hasChildNodeBlock = function (node) {\r\n      let foo = function (node) {\r\n        const nodeName = node.nodeName.toLowerCase();\r\n        if (\r\n          htmlTagsInlineText.indexOf(nodeName) === -1 &&\r\n          htmlTagsInlineIgnore.indexOf(nodeName) === -1\r\n        ) {\r\n          return true;\r\n        }\r\n\r\n        for (const child of node.childNodes) {\r\n          if (foo(child)) {\r\n            return true;\r\n          }\r\n        }\r\n      };\r\n      for (const child of node.childNodes) {\r\n        if (foo(child)) {\r\n          return true;\r\n        }\r\n      }\r\n    };\r\n\r\n    const nodeName = node.nodeName.toLowerCase();\r\n    if (\r\n      htmlTagsInlineText.indexOf(nodeName) === -1 &&\r\n      htmlTagsInlineIgnore.indexOf(nodeName) === -1\r\n    ) {\r\n      if (hasChildNodeBlock(node)) return;\r\n    }\r\n\r\n    let text;\r\n    if (nodeName === \"input\" || nodeName === \"textarea\") {\r\n      text = node.value.length > 0 ? node.value : node.placeholder;\r\n      if (\r\n        nodeName === \"input\" &&\r\n        !/^(?:text|search|button|submit)$/i.test(node.type)\r\n      ) {\r\n        text = null;\r\n        return;\r\n      }\r\n      if (\r\n        nodeName === \"input\" &&\r\n        (node.type === \"button\" || node.type === \"submit\")\r\n      ) {\r\n        text = node.value;\r\n        if (!text && node.type === \"submit\") {\r\n          text = \"Submit Query\";\r\n        }\r\n      }\r\n    } else {\r\n      do {\r\n        const nodeName = node.nodeName.toLowerCase();\r\n        if (htmlTagsNoTranslate.indexOf(nodeName) !== -1) return;\r\n        if (\r\n          htmlTagsInlineText.indexOf(nodeName) === -1 &&\r\n          htmlTagsInlineIgnore.indexOf(nodeName) === -1\r\n        ) {\r\n          break;\r\n        } else {\r\n          node = node.parentNode;\r\n        }\r\n      } while (node && node !== document.body);\r\n\r\n      if (!node) return;\r\n      if (node.textContent.length > 1000) return;\r\n      text = node.innerText;\r\n    }\r\n\r\n    if (!text || text.length < 1 || text.length > 1000) return;\r\n\r\n    backgroundTranslateSingleText(\r\n      currentTextTranslatorService,\r\n      currentTargetLanguage,\r\n      text\r\n    )\r\n      .then((result) => {\r\n        if (!result) return;\r\n        if (currentFooCount !== fooCount) return;\r\n\r\n        if (!usePrevNode) {\r\n          init();\r\n        }\r\n\r\n        const eTextTranslated = shadowRoot.getElementById(\"eTextTranslated\");\r\n        if (twpLang.isRtlLanguage(currentTargetLanguage)) {\r\n          eTextTranslated.setAttribute(\"dir\", \"rtl\");\r\n        } else {\r\n          eTextTranslated.setAttribute(\"dir\", \"ltr\");\r\n        }\r\n        eTextTranslated.textContent = result;\r\n\r\n        const eDivResult = shadowRoot.getElementById(\"eDivResult\");\r\n\r\n        const height = eDivResult.offsetHeight;\r\n        let top = mousePos.y + 10;\r\n        top = Math.max(0, top);\r\n        top = Math.min(window.innerHeight - height, top);\r\n\r\n        const width = eDivResult.offsetWidth;\r\n        let left = parseInt(mousePos.x /*- (width / 2) */);\r\n        left = Math.max(0, left);\r\n        left = Math.min(window.innerWidth - width, left);\r\n\r\n        if (!usePrevNode) {\r\n          eDivResult.style.top = top + \"px\";\r\n          eDivResult.style.left = left + \"px\";\r\n        }\r\n      })\r\n      .catch((e) => {\r\n        destroy();\r\n      });\r\n  }\r\n\r\n  function dragElement(elmnt, elmnt2) {\r\n    var pos1 = 0,\r\n      pos2 = 0,\r\n      pos3 = 0,\r\n      pos4 = 0;\r\n    if (elmnt2) {\r\n      elmnt2.addEventListener(\"mousedown\", dragMouseDown);\r\n    } else {\r\n      elmnt.addEventListener(\"mousedown\", dragMouseDown);\r\n    }\r\n\r\n    function dragMouseDown(e) {\r\n      e = e || window.event;\r\n      e.preventDefault();\r\n      // get the mouse cursor position at startup:\r\n      pos3 = e.clientX;\r\n      pos4 = e.clientY;\r\n      document.addEventListener(\"mouseup\", closeDragElement);\r\n      // call a function whenever the cursor moves:\r\n      document.addEventListener(\"mousemove\", elementDrag);\r\n    }\r\n\r\n    function elementDrag(e) {\r\n      e = e || window.event;\r\n      e.preventDefault();\r\n      // calculate the new cursor position:\r\n      pos1 = pos3 - e.clientX;\r\n      pos2 = pos4 - e.clientY;\r\n      pos3 = e.clientX;\r\n      pos4 = e.clientY;\r\n      // set the element's new position:\r\n      elmnt.style.top = elmnt.offsetTop - pos2 + \"px\";\r\n      elmnt.style.left = elmnt.offsetLeft - pos1 + \"px\";\r\n    }\r\n\r\n    function closeDragElement() {\r\n      // stop moving when mouse button is released:\r\n      document.removeEventListener(\"mouseup\", closeDragElement);\r\n      document.removeEventListener(\"mousemove\", elementDrag);\r\n    }\r\n  }\r\n\r\n  function init() {\r\n    destroy();\r\n    if (window.isTranslatingSelected) return;\r\n\r\n    divElement = document.createElement(\"div\");\r\n    divElement.style = \"all: initial\";\r\n    divElement.classList.add(\"notranslate\");\r\n\r\n    shadowRoot = divElement.attachShadow({\r\n      mode: \"closed\",\r\n    });\r\n    shadowRoot.innerHTML = `\r\n        <link rel=\"stylesheet\" href=\"${chrome.runtime.getURL(\r\n          \"/contentScript/css/showTranslated.css\"\r\n        )}\">\r\n\r\n        <div id=\"eDivResult\">\r\n                <div id=\"eTextTranslated\" dir=\"auto\"></div>\r\n                <hr>\r\n                <div id=\"drag\">\r\n                    <ul id=\"setTargetLanguage\">\r\n                        <li value=\"en\" title=\"English\">en</li>\r\n                        <li value=\"es\" title=\"Spanish\">es</li>\r\n                        <li value=\"de\" title=\"German\">de</li>\r\n                    </ul>\r\n                    <ul>\r\n                        <li title=\"Google\" id=\"sGoogle\">g</li>\r\n                        <li title=\"Yandex\" id=\"sYandex\">y</li>\r\n                        <li title=\"Bing\" id=\"sBing\">b</li>\r\n                        <li title=\"DeepL\" id=\"sDeepL\" hidden>d</li>\r\n                        <li title=\"Listen\" data-i18n-title=\"btnListen\" id=\"listen\">\r\n                            <svg version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\"\r\n                            width=\"14px\" height=\"12px\" viewBox=\"0 0 93.038 93.038\" xml:space=\"preserve\">\r\n                            <g>\r\n                                <path d=\"M46.547,75.521c0,1.639-0.947,3.128-2.429,3.823c-0.573,0.271-1.187,0.402-1.797,0.402c-0.966,0-1.923-0.332-2.696-0.973\r\n                                    l-23.098-19.14H4.225C1.892,59.635,0,57.742,0,55.409V38.576c0-2.334,1.892-4.226,4.225-4.226h12.303l23.098-19.14\r\n                                    c1.262-1.046,3.012-1.269,4.493-0.569c1.481,0.695,2.429,2.185,2.429,3.823L46.547,75.521L46.547,75.521z M62.784,68.919\r\n                                    c-0.103,0.007-0.202,0.011-0.304,0.011c-1.116,0-2.192-0.441-2.987-1.237l-0.565-0.567c-1.482-1.479-1.656-3.822-0.408-5.504\r\n                                    c3.164-4.266,4.834-9.323,4.834-14.628c0-5.706-1.896-11.058-5.484-15.478c-1.366-1.68-1.24-4.12,0.291-5.65l0.564-0.565\r\n                                    c0.844-0.844,1.975-1.304,3.199-1.231c1.192,0.06,2.305,0.621,3.061,1.545c4.977,6.09,7.606,13.484,7.606,21.38\r\n                                    c0,7.354-2.325,14.354-6.725,20.24C65.131,68.216,64.007,68.832,62.784,68.919z M80.252,81.976\r\n                                    c-0.764,0.903-1.869,1.445-3.052,1.495c-0.058,0.002-0.117,0.004-0.177,0.004c-1.119,0-2.193-0.442-2.988-1.237l-0.555-0.555\r\n                                    c-1.551-1.55-1.656-4.029-0.246-5.707c6.814-8.104,10.568-18.396,10.568-28.982c0-11.011-4.019-21.611-11.314-29.847\r\n                                    c-1.479-1.672-1.404-4.203,0.17-5.783l0.554-0.555c0.822-0.826,1.89-1.281,3.115-1.242c1.163,0.033,2.263,0.547,3.036,1.417\r\n                                    c8.818,9.928,13.675,22.718,13.675,36.01C93.04,59.783,88.499,72.207,80.252,81.976z\"/>\r\n                            </g>\r\n                            <g>\r\n                            </g>\r\n                            <g>\r\n                            </g>\r\n                            <g>\r\n                            </g>\r\n                            <g>\r\n                            </g>\r\n                            <g>\r\n                            </g>\r\n                            <g>\r\n                            </g>\r\n                            <g>\r\n                            </g>\r\n                            <g>\r\n                            </g>\r\n                            <g>\r\n                            </g>\r\n                            <g>\r\n                            </g>\r\n                            <g>\r\n                            </g>\r\n                            <g>\r\n                            </g>\r\n                            <g>\r\n                            </g>\r\n                            <g>\r\n                            </g>\r\n                            <g>\r\n                            </g>\r\n                            </svg>\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n    {\r\n      const style = document.createElement(\"style\");\r\n      style.textContent = styleTextContent;\r\n      shadowRoot.insertBefore(style, shadowRoot.getElementById(\"eDivResult\"));\r\n    }\r\n\r\n    dragElement(\r\n      shadowRoot.getElementById(\"eDivResult\"),\r\n      shadowRoot.getElementById(\"drag\")\r\n    );\r\n\r\n    function enableDarkMode() {\r\n      if (!shadowRoot.getElementById(\"darkModeElement\")) {\r\n        const el = document.createElement(\"style\");\r\n        el.setAttribute(\"id\", \"darkModeElement\");\r\n        el.setAttribute(\"rel\", \"stylesheet\");\r\n        el.textContent = `\r\n                * {\r\n                    scrollbar-color: #202324 #454a4d;\r\n                }\r\n                #eDivResult {\r\n                    color: rgb(231, 230, 228) !important;\r\n                    background-color: #181a1b !important;\r\n                }\r\n                hr {\r\n                    border-color: #666;\r\n                }\r\n                li:hover {\r\n                    color: rgb(231, 230, 228) !important;\r\n                    background-color: #454a4d !important;\r\n                }\r\n                .selected {\r\n                    background-color: #454a4d !important;\r\n                }\r\n                `;\r\n        shadowRoot.appendChild(el);\r\n        shadowRoot.querySelector(\"#listen svg\").style =\r\n          \"fill: rgb(231, 230, 228)\";\r\n      }\r\n    }\r\n\r\n    function disableDarkMode() {\r\n      if (shadowRoot.getElementById(\"#darkModeElement\")) {\r\n        shadowRoot.getElementById(\"#darkModeElement\").remove();\r\n        shadowRoot.querySelector(\"#listen svg\").style = \"fill: black\";\r\n      }\r\n    }\r\n\r\n    switch (twpConfig.get(\"darkMode\")) {\r\n      case \"auto\":\r\n        if (matchMedia(\"(prefers-color-scheme: dark)\").matches) {\r\n          enableDarkMode();\r\n        } else {\r\n          disableDarkMode();\r\n        }\r\n        break;\r\n      case \"yes\":\r\n        enableDarkMode();\r\n        break;\r\n      case \"no\":\r\n        disableDarkMode();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    eTextTranslated = shadowRoot.getElementById(\"eTextTranslated\");\r\n\r\n    const sGoogle = shadowRoot.getElementById(\"sGoogle\");\r\n    const sYandex = shadowRoot.getElementById(\"sYandex\");\r\n    const sBing = shadowRoot.getElementById(\"sBing\");\r\n    const sDeepL = shadowRoot.getElementById(\"sDeepL\");\r\n\r\n    sGoogle.onclick = () => {\r\n      currentTextTranslatorService = \"google\";\r\n      twpConfig.set(\"textTranslatorService\", \"google\");\r\n      translateThisNode(null, true);\r\n\r\n      sGoogle.classList.remove(\"selected\");\r\n      sYandex.classList.remove(\"selected\");\r\n      sBing.classList.remove(\"selected\");\r\n      sDeepL.classList.remove(\"selected\");\r\n\r\n      sGoogle.classList.add(\"selected\");\r\n    };\r\n    sYandex.onclick = () => {\r\n      currentTextTranslatorService = \"yandex\";\r\n      twpConfig.set(\"textTranslatorService\", \"yandex\");\r\n      translateThisNode(null, true);\r\n\r\n      sGoogle.classList.remove(\"selected\");\r\n      sYandex.classList.remove(\"selected\");\r\n      sBing.classList.remove(\"selected\");\r\n      sDeepL.classList.remove(\"selected\");\r\n\r\n      sYandex.classList.add(\"selected\");\r\n    };\r\n    sBing.onclick = () => {\r\n      currentTextTranslatorService = \"bing\";\r\n      twpConfig.set(\"textTranslatorService\", \"bing\");\r\n      translateThisNode(null, true);\r\n\r\n      sGoogle.classList.remove(\"selected\");\r\n      sYandex.classList.remove(\"selected\");\r\n      sBing.classList.remove(\"selected\");\r\n      sDeepL.classList.remove(\"selected\");\r\n\r\n      sBing.classList.add(\"selected\");\r\n    };\r\n    sDeepL.onclick = () => {\r\n      currentTextTranslatorService = \"deepl\";\r\n      twpConfig.set(\"textTranslatorService\", \"deepl\");\r\n      translateThisNode(null, true);\r\n\r\n      sGoogle.classList.remove(\"selected\");\r\n      sYandex.classList.remove(\"selected\");\r\n      sBing.classList.remove(\"selected\");\r\n      sDeepL.classList.remove(\"selected\");\r\n\r\n      sDeepL.classList.add(\"selected\");\r\n    };\r\n\r\n    const setTargetLanguage = shadowRoot.getElementById(\"setTargetLanguage\");\r\n    setTargetLanguage.onclick = (e) => {\r\n      if (e.target.getAttribute(\"value\")) {\r\n        const langCode = twpLang.fixTLanguageCode(\r\n          e.target.getAttribute(\"value\")\r\n        );\r\n        if (langCode) {\r\n          currentTargetLanguage = langCode;\r\n          twpConfig.setTargetLanguageTextTranslation(langCode);\r\n          translateThisNode(null, true);\r\n        }\r\n\r\n        shadowRoot.querySelectorAll(\"#setTargetLanguage li\").forEach((li) => {\r\n          li.classList.remove(\"selected\");\r\n        });\r\n\r\n        e.target.classList.add(\"selected\");\r\n      }\r\n    };\r\n\r\n    const eListen = shadowRoot.getElementById(\"listen\");\r\n    eListen.onclick = () => {\r\n      const msgListen = chrome.i18n.getMessage(\"btnListen\");\r\n      const msgStopListening = chrome.i18n.getMessage(\"btnStopListening\");\r\n\r\n      eListen.classList.remove(\"selected\");\r\n      eListen.setAttribute(\"title\", msgStopListening);\r\n\r\n      if (isPlayingAudio) {\r\n        stopAudio();\r\n        eListen.classList.remove(\"selected\");\r\n      } else {\r\n        playAudio(eTextTranslated.textContent, currentTargetLanguage, () => {\r\n          eListen.classList.remove(\"selected\");\r\n          eListen.setAttribute(\"title\", msgListen);\r\n        });\r\n        eListen.classList.add(\"selected\");\r\n      }\r\n    };\r\n\r\n    document.body.appendChild(divElement);\r\n\r\n    chrome.i18n.translateDocument(shadowRoot);\r\n\r\n    const targetLanguageButtons = shadowRoot.querySelectorAll(\r\n      \"#setTargetLanguage li\"\r\n    );\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      if (currentTargetLanguages[i] == currentTargetLanguage) {\r\n        targetLanguageButtons[i].classList.add(\"selected\");\r\n      }\r\n      targetLanguageButtons[i].textContent = currentTargetLanguages[i];\r\n      targetLanguageButtons[i].setAttribute(\"value\", currentTargetLanguages[i]);\r\n      targetLanguageButtons[i].setAttribute(\r\n        \"title\",\r\n        twpLang.codeToLanguage(currentTargetLanguages[i])\r\n      );\r\n    }\r\n\r\n    if (currentTextTranslatorService === \"yandex\") {\r\n      sYandex.classList.add(\"selected\");\r\n    } else if (currentTextTranslatorService == \"deepl\") {\r\n      sDeepL.classList.add(\"selected\");\r\n    } else if (currentTextTranslatorService == \"bing\") {\r\n      sBing.classList.add(\"selected\");\r\n    } else {\r\n      sGoogle.classList.add(\"selected\");\r\n    }\r\n\r\n    // if (twpConfig.get(\"enableDeepL\") === \"yes\") {\r\n    //     sDeepL.removeAttribute(\"hidden\")\r\n    // } else {\r\n    //     sDeepL.setAttribute(\"hidden\", \"\")\r\n    // }\r\n    twpConfig.onChanged((name, newvalue) => {\r\n      switch (name) {\r\n        case \"enableDeepL\":\r\n          // if (newvalue === \"yes\") {\r\n          //     sDeepL.removeAttribute(\"hidden\")\r\n          // } else {\r\n          //     sDeepL.setAttribute(\"hidden\", \"\")\r\n          // }\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  function destroy() {\r\n    fooCount++;\r\n    stopAudio();\r\n\r\n    clearTimeout(timeoutHandler);\r\n\r\n    if (divElement) {\r\n      divElement.remove();\r\n      divElement = shadowRoot = eTextTranslated = null;\r\n    }\r\n  }\r\n\r\n  function isSelectingText() {\r\n    const activeEl = document.activeElement;\r\n    const activeElTagName = activeEl ? activeEl.tagName.toLowerCase() : null;\r\n    if (\r\n      activeElTagName == \"textarea\" ||\r\n      (activeElTagName == \"input\" &&\r\n        /^(?:text|search)$/i.test(activeEl.type) &&\r\n        typeof activeEl.selectionStart == \"number\")\r\n    ) {\r\n      const text = activeEl.value.slice(\r\n        activeEl.selectionStart,\r\n        activeEl.selectionEnd\r\n      );\r\n      if (text) return true;\r\n    } else if (window.getSelection) {\r\n      const selection = window.getSelection();\r\n      if (selection.type == \"Range\") {\r\n        const text = selection.toString();\r\n        if (text) return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  let lastTimePressedCtrl = null;\r\n\r\n  function onKeyUp(e) {\r\n    if (!translateTextOverMouseWhenPressTwice) return;\r\n    if (e.key == \"Control\") {\r\n      if (\r\n        lastTimePressedCtrl &&\r\n        performance.now() - lastTimePressedCtrl < 280 &&\r\n        !isSelectingText()\r\n      ) {\r\n        lastTimePressedCtrl = performance.now();\r\n\r\n        const elements = document.querySelectorAll(\":hover\");\r\n        if (elements.length > 0) {\r\n          destroy();\r\n          translateThisNode(elements[elements.length - 1]);\r\n        }\r\n      }\r\n      lastTimePressedCtrl = performance.now();\r\n    }\r\n  }\r\n\r\n  function updateEventListener() {\r\n    if (\r\n      platformInfo.isMobile.any ||\r\n      pageLanguageState == \"translated\" ||\r\n      !(\r\n        showTranslatedTextWhenHoveringThisSite ||\r\n        showTranslatedTextWhenHoveringThisLang ||\r\n        translateTextOverMouseWhenPressTwice\r\n      )\r\n    ) {\r\n      window.removeEventListener(\"scroll\", onScroll);\r\n\r\n      window.removeEventListener(\"mousemove\", onMouseMove);\r\n      window.removeEventListener(\"mousedown\", onMouseDown);\r\n\r\n      document.removeEventListener(\"blur\", destroy);\r\n      document.removeEventListener(\"visibilitychange\", destroy);\r\n\r\n      document.removeEventListener(\"keyup\", onKeyUp);\r\n\r\n      destroy();\r\n    } else {\r\n      window.addEventListener(\"scroll\", onScroll);\r\n\r\n      window.addEventListener(\"mousemove\", onMouseMove);\r\n      window.addEventListener(\"mousedown\", onMouseDown);\r\n\r\n      document.addEventListener(\"blur\", destroy);\r\n      document.addEventListener(\"visibilitychange\", destroy);\r\n\r\n      document.addEventListener(\"keyup\", onKeyUp);\r\n    }\r\n  }\r\n  updateEventListener();\r\n\r\n  pageTranslator.onGetOriginalTabLanguage(function (tabLanguage) {\r\n    originalTabLanguage = tabLanguage;\r\n    showTranslatedTextWhenHoveringThisLang =\r\n      twpConfig\r\n        .get(\"langsToTranslateWhenHovering\")\r\n        .indexOf(originalTabLanguage) !== -1;\r\n    updateEventListener();\r\n  });\r\n\r\n  pageTranslator.onPageLanguageStateChange((_pageLanguageState) => {\r\n    pageLanguageState = _pageLanguageState;\r\n    updateEventListener();\r\n  });\r\n});\r\n"],"mappings":"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"}
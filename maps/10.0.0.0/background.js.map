{"version":3,"file":"../../background/background.js","names":["tabToMimeType","chrome","webRequest","onHeadersReceived","addListener","details","tabId","contentTypeHeader","header","responseHeaders","name","toLowerCase","value","split","urls","types","runtime","onMessage","request","sender","sendResponse","action","tabs","sendMessage","tab","id","frameId","pageLanguageState","checkedLastError","tabLanguage","updateContextMenu","tabsCreate","getURL","detectLanguage","result","e","console","error","URL","url","hostname","query","active","currentWindow","forEach","storage","local","set","authorizationToOpenOptions","updateTranslateSelectedContextMenu","contextMenus","remove","twpConfig","get","create","title","twpI18n","getMessage","contexts","contextMenuTitle","targetLanguage","twpLang","codeToLanguage","documentUrlPatterns","onInstalled","reason","onReady","i18n","getUILanguage","getManifest","version","previousVersion","platformInfo","isMobile","any","lastTimeShowingReleaseNotes","showReleaseNotes","date","Date","setDate","getDate","getTime","now","translationCache","deleteTranslationCache","enabledServices","index","indexOf","splice","resetPageAction","forceShow","pageAction","setPopup","popup","resetBrowserAction","browserAction","sendToggleTranslationMessage","sendTranslatePageMessage","updateActionContextMenu","tabHasContentScript","currentTabId","onActivated","activeInfo","onClicked","info","menuItemId","mimeType","openPopup","isInReaderMode","encodeURIComponent","selectionText","addSiteToNeverTranslate","onUpdated","changeInfo","status","response","onRemoved","removeInfo","hide","onChanged","newvalue","isFirefoxAlpenglow","theme","isFirefoxAlpenglowTheme","includes","JSON","stringify","properties","colors","themeColorFrame","themeColorToolbar","themeColorToolbarField","themeColorFieldText","themeColorAttention","isUsingTheme","browser","onThemeUpdated","getCurrent","then","frame","toolbar","toolbar_field","toolbar_field_text","icons_attention","images","updateIconInAllTabs","darkMode","matchMedia","matches","addEventListener","getSVGIcon","incognito","svgXml","svg64","replace","btoa","isDarkColor","standardize_color","b64Start","str1","str2","str3","ctx","OffscreenCanvas","getContext","imageSmoothingEnabled","fillStyle","fillRect","data","getImageData","rgb","join","hexToRgb","hex","exec","r","parseInt","g","b","hexColor","max","Math","min","l","updateIcon","tabInfo","setIcon","path","show","_pageLanguageState","commands","onCommand","command","newServiceName","swapPageTranslationService","setTargetLanguage","navigationsInfo","tabsInfo","tabsOnRemoved","runtimeOnMessage","host","webNavigationOnCreatedNavigationTarget","navInfo","sourceTabId","webNavigationOnBeforeNavigate","beforeNavigateIsExecuted","sourceHost","sourcePageLanguageState","promise_resolve","webNavigationOnCommitted","transitionType","Promise","resolve","webNavigationOnDOMContentLoaded","setTimeout","enableTranslationOnClickingALink","disableTranslationOnClickingALink","webNavigation","onCreatedNavigationTarget","onBeforeNavigate","onCommitted","onDOMContentLoaded","removeListener","permissions","contains","hasPermissions","onUpdateAvailable","reloaded","reload","cleanUpsPromises","push","all","finally"],"sources":["background.js"],"sourcesContent":["\"use strict\";\r\n\r\n// get mimetype\r\nvar tabToMimeType = {};\r\nchrome.webRequest.onHeadersReceived.addListener(\r\n  function (details) {\r\n    if (details.tabId !== -1) {\r\n      let contentTypeHeader = null;\r\n      for (const header of details.responseHeaders) {\r\n        if (header.name.toLowerCase() === \"content-type\") {\r\n          contentTypeHeader = header;\r\n          break;\r\n        }\r\n      }\r\n      tabToMimeType[details.tabId] =\r\n        contentTypeHeader && contentTypeHeader.value.split(\";\", 1)[0];\r\n    }\r\n  },\r\n  {\r\n    urls: [\"*://*/*\"],\r\n    types: [\"main_frame\"],\r\n  },\r\n  [\"responseHeaders\"]\r\n);\r\n\r\nchrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\r\n  if (request.action === \"getMainFramePageLanguageState\") {\r\n    chrome.tabs.sendMessage(\r\n      sender.tab.id,\r\n      {\r\n        action: \"getCurrentPageLanguageState\",\r\n      },\r\n      {\r\n        frameId: 0,\r\n      },\r\n      (pageLanguageState) => {\r\n        checkedLastError();\r\n        sendResponse(pageLanguageState);\r\n      }\r\n    );\r\n\r\n    return true;\r\n  } else if (request.action === \"getMainFrameTabLanguage\") {\r\n    chrome.tabs.sendMessage(\r\n      sender.tab.id,\r\n      {\r\n        action: \"getOriginalTabLanguage\",\r\n      },\r\n      {\r\n        frameId: 0,\r\n      },\r\n      (tabLanguage) => {\r\n        checkedLastError();\r\n        sendResponse(tabLanguage);\r\n      }\r\n    );\r\n\r\n    return true;\r\n  } else if (request.action === \"setPageLanguageState\") {\r\n    updateContextMenu(request.pageLanguageState);\r\n  } else if (request.action === \"openOptionsPage\") {\r\n    tabsCreate(chrome.runtime.getURL(\"/options/options.html\"));\r\n  } else if (request.action === \"openDonationPage\") {\r\n    tabsCreate(chrome.runtime.getURL(\"/options/options.html#donation\"));\r\n  } else if (request.action === \"detectTabLanguage\") {\r\n    if (!sender.tab) {\r\n      // https://github.com/FilipePS/Traduzir-paginas-web/issues/478\r\n      sendResponse(\"und\");\r\n      return;\r\n    }\r\n    try {\r\n      chrome.tabs.detectLanguage(sender.tab.id, (result) =>\r\n        sendResponse(result)\r\n      );\r\n    } catch (e) {\r\n      console.error(e);\r\n      sendResponse(\"und\");\r\n    }\r\n\r\n    return true;\r\n  } else if (request.action === \"getTabHostName\") {\r\n    sendResponse(new URL(sender.tab.url).hostname);\r\n  } else if (request.action === \"thisFrameIsInFocus\") {\r\n    chrome.tabs.sendMessage(\r\n      sender.tab.id,\r\n      { action: \"anotherFrameIsInFocus\" },\r\n      checkedLastError\r\n    );\r\n  } else if (request.action === \"getTabMimeType\") {\r\n    chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\r\n      sendResponse(tabToMimeType[tabs[0].id]);\r\n    });\r\n    return true;\r\n  } else if (request.action === \"restorePagesWithServiceNames\") {\r\n    chrome.tabs.query({}, (tabs) => {\r\n      tabs.forEach((tab) => {\r\n        chrome.tabs.sendMessage(tab.id, request, checkedLastError);\r\n      });\r\n    });\r\n  } else if (request.action == \"authorizationToOpenOptions\") {\r\n    chrome.storage.local.set({\r\n      authorizationToOpenOptions: request.authorizationToOpenOptions,\r\n    });\r\n  }\r\n});\r\n\r\nfunction updateTranslateSelectedContextMenu() {\r\n  if (typeof chrome.contextMenus !== \"undefined\") {\r\n    chrome.contextMenus.remove(\"translate-selected-text\", checkedLastError);\r\n    if (twpConfig.get(\"showTranslateSelectedContextMenu\") === \"yes\") {\r\n      chrome.contextMenus.create({\r\n        id: \"translate-selected-text\",\r\n        title: twpI18n.getMessage(\"msgTranslateSelectedText\"),\r\n        contexts: [\"selection\"],\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateContextMenu(pageLanguageState = \"original\") {\r\n  let contextMenuTitle;\r\n  if (pageLanguageState === \"translated\") {\r\n    contextMenuTitle = twpI18n.getMessage(\"btnRestore\");\r\n  } else {\r\n    const targetLanguage = twpConfig.get(\"targetLanguage\");\r\n    contextMenuTitle = twpI18n.getMessage(\r\n      \"msgTranslateFor\",\r\n      twpLang.codeToLanguage(targetLanguage)\r\n    );\r\n  }\r\n  if (typeof chrome.contextMenus != \"undefined\") {\r\n    chrome.contextMenus.remove(\"translate-web-page\", checkedLastError);\r\n    chrome.contextMenus.remove(\r\n      \"translate-restore-this-frame\",\r\n      checkedLastError\r\n    );\r\n\r\n    if (twpConfig.get(\"enableIframePageTranslation\") === \"yes\") {\r\n      if (twpConfig.get(\"showTranslatePageContextMenu\") == \"yes\") {\r\n        chrome.contextMenus.create({\r\n          id: \"translate-web-page\",\r\n          title: contextMenuTitle,\r\n          contexts: [\"page\", \"frame\"],\r\n          documentUrlPatterns: [\r\n            \"http://*/*\",\r\n            \"https://*/*\",\r\n            \"file://*/*\",\r\n            \"ftp://*/*\",\r\n          ],\r\n        });\r\n      }\r\n    } else {\r\n      if (twpConfig.get(\"showTranslatePageContextMenu\") == \"yes\") {\r\n        chrome.contextMenus.create({\r\n          id: \"translate-web-page\",\r\n          title: contextMenuTitle,\r\n          contexts: [\"page\"],\r\n          documentUrlPatterns: [\r\n            \"http://*/*\",\r\n            \"https://*/*\",\r\n            \"file://*/*\",\r\n            \"ftp://*/*\",\r\n          ],\r\n        });\r\n      }\r\n\r\n      chrome.contextMenus.create({\r\n        id: \"translate-restore-this-frame\",\r\n        title: twpI18n.getMessage(\"btnTranslateRestoreThisFrame\"),\r\n        contexts: [\"frame\"],\r\n        documentUrlPatterns: [\"http://*/*\", \"https://*/*\"],\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nchrome.runtime.onInstalled.addListener((details) => {\r\n  if (details.reason == \"install\") {\r\n    tabsCreate(chrome.runtime.getURL(\"/options/options.html\"));\r\n    twpConfig.onReady(async () => {\r\n      if (chrome.i18n.getUILanguage() === \"zh-CN\") {\r\n        twpConfig.set(\"pageTranslatorService\", \"bing\");\r\n        twpConfig.set(\"textTranslatorService\", \"bing\");\r\n      }\r\n    });\r\n  } else if (\r\n    details.reason == \"update\" &&\r\n    chrome.runtime.getManifest().version != details.previousVersion\r\n  ) {\r\n    twpConfig.onReady(async () => {\r\n      if (platformInfo.isMobile.any) {\r\n        twpConfig.set(\"neverTranslateLangs\", []);\r\n        twpConfig.set(\"neverTranslateSites\", []);\r\n        twpConfig.set(\"alwaysTranslateLangs\", []);\r\n        twpConfig.set(\"alwaysTranslateSites\", []);\r\n        return;\r\n      }\r\n      if (twpConfig.get(\"showReleaseNotes\") !== \"yes\") return;\r\n      let lastTimeShowingReleaseNotes = twpConfig.get(\r\n        \"lastTimeShowingReleaseNotes\"\r\n      );\r\n      let showReleaseNotes = false;\r\n      if (lastTimeShowingReleaseNotes) {\r\n        const date = new Date();\r\n        date.setDate(date.getDate() - 26);\r\n        if (date.getTime() > lastTimeShowingReleaseNotes) {\r\n          showReleaseNotes = true;\r\n          lastTimeShowingReleaseNotes = Date.now();\r\n          twpConfig.set(\r\n            \"lastTimeShowingReleaseNotes\",\r\n            lastTimeShowingReleaseNotes\r\n          );\r\n        }\r\n      } else {\r\n        showReleaseNotes = true;\r\n        lastTimeShowingReleaseNotes = Date.now();\r\n        twpConfig.set(\r\n          \"lastTimeShowingReleaseNotes\",\r\n          lastTimeShowingReleaseNotes\r\n        );\r\n      }\r\n      if (showReleaseNotes) {\r\n        tabsCreate(\r\n          chrome.runtime.getURL(\"/options/options.html#release_notes\")\r\n        );\r\n      }\r\n    });\r\n    twpConfig.onReady(async () => {\r\n      translationCache.deleteTranslationCache();\r\n    });\r\n    twpConfig.onReady(async () => {\r\n      twpConfig.set(\r\n        \"textTranslatorService\",\r\n        twpConfig.get(\"enabledServices\")[0]\r\n      );\r\n    });\r\n  }\r\n\r\n  twpConfig.onReady(async () => {\r\n    if (platformInfo.isMobile.any) {\r\n      const enabledServices = twpConfig.get(\"enabledServices\");\r\n      const index = enabledServices.indexOf(\"deepl\");\r\n      if (index !== -1) {\r\n        enabledServices.splice(index, 1);\r\n        twpConfig.set(\"enabledServices\", enabledServices);\r\n      }\r\n    }\r\n  });\r\n});\r\n\r\nfunction resetPageAction(tabId, forceShow = false) {\r\n  if (twpConfig.get(\"translateClickingOnce\") === \"yes\" && !forceShow) {\r\n    chrome.pageAction.setPopup({\r\n      popup: null,\r\n      tabId,\r\n    });\r\n  } else {\r\n    if (twpConfig.get(\"useOldPopup\") === \"yes\") {\r\n      chrome.pageAction.setPopup({\r\n        popup: \"popup/old-popup.html\",\r\n        tabId,\r\n      });\r\n    } else {\r\n      chrome.pageAction.setPopup({\r\n        popup: \"popup/popup.html\",\r\n        tabId,\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nfunction resetBrowserAction(forceShow = false) {\r\n  if (twpConfig.get(\"translateClickingOnce\") === \"yes\" && !forceShow) {\r\n    chrome.browserAction.setPopup({\r\n      popup: null,\r\n    });\r\n  } else {\r\n    if (twpConfig.get(\"useOldPopup\") === \"yes\") {\r\n      chrome.browserAction.setPopup({\r\n        popup: \"popup/old-popup.html\",\r\n      });\r\n    } else {\r\n      chrome.browserAction.setPopup({\r\n        popup: \"popup/popup.html\",\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nfunction sendToggleTranslationMessage(tabId) {\r\n  if (twpConfig.get(\"enableIframePageTranslation\") === \"yes\") {\r\n    chrome.tabs.sendMessage(\r\n      tabId,\r\n      {\r\n        action: \"toggle-translation\",\r\n      },\r\n      checkedLastError\r\n    );\r\n  } else {\r\n    chrome.tabs.sendMessage(\r\n      tabId,\r\n      {\r\n        action: \"toggle-translation\",\r\n      },\r\n      { frameId: 0 },\r\n      checkedLastError\r\n    );\r\n  }\r\n}\r\n\r\nfunction sendTranslatePageMessage(tabId, targetLanguage) {\r\n  if (twpConfig.get(\"enableIframePageTranslation\") === \"yes\") {\r\n    chrome.tabs.sendMessage(\r\n      tabId,\r\n      {\r\n        action: \"translatePage\",\r\n        targetLanguage,\r\n      },\r\n      checkedLastError\r\n    );\r\n  } else {\r\n    chrome.tabs.sendMessage(\r\n      tabId,\r\n      {\r\n        action: \"translatePage\",\r\n        targetLanguage,\r\n      },\r\n      { frameId: 0 },\r\n      checkedLastError\r\n    );\r\n  }\r\n}\r\n\r\nif (typeof chrome.contextMenus !== \"undefined\") {\r\n  const updateActionContextMenu = () => {\r\n    chrome.contextMenus.remove(\"browserAction-showPopup\", checkedLastError);\r\n    chrome.contextMenus.remove(\"pageAction-showPopup\", checkedLastError);\r\n    chrome.contextMenus.remove(\"never-translate\", checkedLastError);\r\n    chrome.contextMenus.remove(\"more-options\", checkedLastError);\r\n    chrome.contextMenus.remove(\"browserAction-translate-pdf\", checkedLastError);\r\n    chrome.contextMenus.remove(\"pageAction-translate-pdf\", checkedLastError);\r\n\r\n    chrome.contextMenus.create({\r\n      id: \"browserAction-showPopup\",\r\n      title: twpI18n.getMessage(\"btnShowPopup\"),\r\n      contexts: [\"browser_action\"],\r\n    });\r\n    chrome.contextMenus.create({\r\n      id: \"pageAction-showPopup\",\r\n      title: twpI18n.getMessage(\"btnShowPopup\"),\r\n      contexts: [\"page_action\"],\r\n    });\r\n    chrome.contextMenus.create({\r\n      id: \"never-translate\",\r\n      title: twpI18n.getMessage(\"btnNeverTranslate\"),\r\n      contexts: [\"browser_action\", \"page_action\"],\r\n    });\r\n    chrome.contextMenus.create({\r\n      id: \"more-options\",\r\n      title: twpI18n.getMessage(\"btnMoreOptions\"),\r\n      contexts: [\"browser_action\", \"page_action\"],\r\n    });\r\n    chrome.contextMenus.create({\r\n      id: \"browserAction-translate-pdf\",\r\n      title: twpI18n.getMessage(\"msgTranslatePDF\"),\r\n      contexts: [\"browser_action\"],\r\n    });\r\n    chrome.contextMenus.create({\r\n      id: \"pageAction-translate-pdf\",\r\n      title: twpI18n.getMessage(\"msgTranslatePDF\"),\r\n      contexts: [\"page_action\"],\r\n    });\r\n  };\r\n  updateActionContextMenu();\r\n\r\n  const tabHasContentScript = {};\r\n  let currentTabId = null;\r\n  chrome.tabs.onActivated.addListener((activeInfo) => {\r\n    currentTabId = activeInfo.tabId;\r\n    updateActionContextMenu();\r\n  });\r\n\r\n  chrome.contextMenus.onClicked.addListener((info, tab) => {\r\n    if (info.menuItemId == \"translate-web-page\") {\r\n      const mimeType = tabToMimeType[tab.id];\r\n      if (\r\n        mimeType &&\r\n        mimeType.toLowerCase() === \"application/pdf\" &&\r\n        chrome.pageAction &&\r\n        chrome.pageAction.openPopup\r\n      ) {\r\n        chrome.pageAction.openPopup();\r\n      } else {\r\n        sendToggleTranslationMessage(tab.id);\r\n      }\r\n    } else if (info.menuItemId == \"translate-restore-this-frame\") {\r\n      chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\r\n        chrome.tabs.sendMessage(\r\n          tab.id,\r\n          {\r\n            action: \"toggle-translation\",\r\n          },\r\n          { frameId: info.frameId },\r\n          checkedLastError\r\n        );\r\n      });\r\n    } else if (info.menuItemId == \"translate-selected-text\") {\r\n      if (\r\n        chrome.pageAction &&\r\n        chrome.pageAction.openPopup &&\r\n        (!tab || !tabHasContentScript[tab.id] || tab.isInReaderMode)\r\n      ) {\r\n        chrome.pageAction.setPopup({\r\n          popup:\r\n            \"popup/popup-translate-text.html#text=\" +\r\n            encodeURIComponent(info.selectionText),\r\n          tabId: tab?.id || currentTabId,\r\n        });\r\n        chrome.pageAction.openPopup();\r\n\r\n        resetPageAction(tab?.id || currentTabId);\r\n      } else {\r\n        // a merda do chrome não suporte openPopup\r\n        chrome.tabs.sendMessage(\r\n          tab.id,\r\n          {\r\n            action: \"TranslateSelectedText\",\r\n            selectionText: info.selectionText,\r\n          },\r\n          checkedLastError\r\n        );\r\n      }\r\n    } else if (info.menuItemId == \"browserAction-showPopup\") {\r\n      resetBrowserAction(true);\r\n\r\n      chrome.browserAction.openPopup();\r\n\r\n      resetBrowserAction();\r\n    } else if (info.menuItemId == \"pageAction-showPopup\") {\r\n      resetPageAction(tab.id, true);\r\n\r\n      chrome.pageAction.openPopup();\r\n\r\n      resetPageAction(tab.id);\r\n    } else if (info.menuItemId == \"never-translate\") {\r\n      const hostname = new URL(tab.url).hostname;\r\n      twpConfig.addSiteToNeverTranslate(hostname);\r\n    } else if (info.menuItemId == \"more-options\") {\r\n      tabsCreate(chrome.runtime.getURL(\"/options/options.html\"));\r\n    } else if (info.menuItemId == \"browserAction-translate-pdf\") {\r\n      const mimeType = tabToMimeType[tab.id];\r\n      if (\r\n        mimeType &&\r\n        mimeType.toLowerCase() === \"application/pdf\" &&\r\n        typeof chrome.browserAction.openPopup !== \"undefined\"\r\n      ) {\r\n        chrome.browserAction.openPopup();\r\n      } else {\r\n        tabsCreate(\"https://pdf.translatewebpages.org/\");\r\n      }\r\n    } else if (info.menuItemId == \"pageAction-translate-pdf\") {\r\n      const mimeType = tabToMimeType[tab.id];\r\n      if (\r\n        mimeType &&\r\n        mimeType.toLowerCase() === \"application/pdf\" &&\r\n        typeof chrome.pageAction.openPopup !== \"undefined\"\r\n      ) {\r\n        chrome.pageAction.openPopup();\r\n      } else {\r\n        tabsCreate(\"https://pdf.translatewebpages.org/\");\r\n      }\r\n    }\r\n  });\r\n\r\n  chrome.tabs.onActivated.addListener((activeInfo) => {\r\n    twpConfig.onReady(() => {\r\n      updateContextMenu();\r\n      updateTranslateSelectedContextMenu();\r\n    });\r\n    chrome.tabs.sendMessage(\r\n      activeInfo.tabId,\r\n      {\r\n        action: \"getCurrentPageLanguageState\",\r\n      },\r\n      {\r\n        frameId: 0,\r\n      },\r\n      (pageLanguageState) => {\r\n        checkedLastError();\r\n        if (pageLanguageState) {\r\n          twpConfig.onReady(() => updateContextMenu(pageLanguageState));\r\n        }\r\n      }\r\n    );\r\n  });\r\n\r\n  chrome.tabs.onUpdated.addListener((tabId, changeInfo, tab) => {\r\n    if (tab.active && changeInfo.status == \"loading\") {\r\n      twpConfig.onReady(() => updateContextMenu());\r\n    } else if (changeInfo.status == \"complete\") {\r\n      chrome.tabs.sendMessage(\r\n        tabId,\r\n        {\r\n          action: \"contentScriptIsInjected\",\r\n        },\r\n        {\r\n          frameId: 0,\r\n        },\r\n        (response) => {\r\n          checkedLastError();\r\n          tabHasContentScript[tabId] = !!response;\r\n        }\r\n      );\r\n    }\r\n  });\r\n\r\n  chrome.tabs.onRemoved.addListener((tabId, removeInfo) => {\r\n    delete tabHasContentScript[tabId];\r\n  });\r\n\r\n  chrome.tabs.query({}, (tabs) =>\r\n    tabs.forEach((tab) =>\r\n      chrome.tabs.sendMessage(\r\n        tab.id,\r\n        {\r\n          action: \"contentScriptIsInjected\",\r\n        },\r\n        {\r\n          frameId: 0,\r\n        },\r\n        (response) => {\r\n          checkedLastError();\r\n          if (response) {\r\n            tabHasContentScript[tab.id] = true;\r\n          }\r\n        }\r\n      )\r\n    )\r\n  );\r\n}\r\n\r\ntwpConfig.onReady(() => {\r\n  if (platformInfo.isMobile.any) {\r\n    chrome.tabs.query({}, (tabs) =>\r\n      tabs.forEach((tab) => chrome.pageAction.hide(tab.id))\r\n    );\r\n\r\n    chrome.tabs.onUpdated.addListener((tabId, changeInfo, tab) => {\r\n      if (changeInfo.status == \"loading\") {\r\n        chrome.pageAction.hide(tabId);\r\n      }\r\n    });\r\n\r\n    chrome.browserAction.onClicked.addListener((tab) => {\r\n      chrome.tabs.sendMessage(\r\n        tab.id,\r\n        {\r\n          action: \"showPopupMobile\",\r\n        },\r\n        {\r\n          frameId: 0,\r\n        },\r\n        checkedLastError\r\n      );\r\n    });\r\n  } else {\r\n    if (chrome.pageAction) {\r\n      chrome.pageAction.onClicked.addListener((tab) => {\r\n        if (twpConfig.get(\"translateClickingOnce\") === \"yes\") {\r\n          sendToggleTranslationMessage(tab.id);\r\n        }\r\n      });\r\n    }\r\n    chrome.browserAction.onClicked.addListener((tab) => {\r\n      if (twpConfig.get(\"translateClickingOnce\") === \"yes\") {\r\n        sendToggleTranslationMessage(tab.id);\r\n      }\r\n    });\r\n\r\n    resetBrowserAction();\r\n\r\n    twpConfig.onChanged((name, newvalue) => {\r\n      switch (name) {\r\n        case \"useOldPopup\":\r\n          resetBrowserAction();\r\n          break;\r\n        case \"translateClickingOnce\":\r\n          resetBrowserAction();\r\n          chrome.tabs.query(\r\n            {\r\n              currentWindow: true,\r\n              active: true,\r\n            },\r\n            (tabs) => {\r\n              resetPageAction(tabs[0].id);\r\n            }\r\n          );\r\n          break;\r\n      }\r\n    });\r\n\r\n    {\r\n      let pageLanguageState = \"original\";\r\n\r\n      // https://github.com/FilipePS/Traduzir-paginas-web/issues/548\r\n      const isFirefoxAlpenglow = function (theme) {\r\n        let isFirefoxAlpenglowTheme = false;\r\n        try {\r\n          if (\r\n            [\r\n              '{\"additional_backgrounds_alignment\":[\"right top\",\"left top\",\"right top\"],\"additional_backgrounds_tiling\":[\"no-repeat\",\"no-repeat\",\"repeat-x\"],\"color_scheme\":null,\"content_color_scheme\":null,\"zap_gradient\":\"linear-gradient(90deg, #9059FF 0%, #FF4AA2 52.08%, #FFBD4F 100%)\"}',\r\n              '{\"additional_backgrounds_alignment\":[\"right top\",\"left top\",\"right top\"],\"additional_backgrounds_tiling\":[\"no-repeat\",\"no-repeat\",\"repeat-x\"],\"color_scheme\":null,\"content_color_scheme\":null}',\r\n            ].includes(JSON.stringify(theme.properties)) &&\r\n            [\r\n              '{\"accentcolor\":null,\"bookmark_text\":\"hsla(261, 53%, 15%, 1)\",\"button_background_active\":\"hsla(240, 26%, 11%, .16)\",\"button_background_hover\":\"hsla(240, 26%, 11%, .08)\",\"frame\":\"hsla(240, 20%, 98%, 1)\",\"frame_inactive\":null,\"icons\":\"hsla(258, 66%, 48%, 1)\",\"icons_attention\":\"hsla(180, 100%, 32%, 1)\",\"ntp_background\":\"#F9F9FB\",\"ntp_card_background\":null,\"ntp_text\":\"hsla(261, 53%, 15%, 1)\",\"popup\":\"hsla(254, 46%, 21%, 1)\",\"popup_border\":\"hsla(255, 100%, 94%, .32)\",\"popup_highlight\":\"hsla(255, 100%, 94%, .12)\",\"popup_highlight_text\":\"hsla(0, 0%, 100%, 1)\",\"popup_text\":\"hsla(255, 100%, 94%, 1)\",\"sidebar\":\"hsla(240, 15%, 95%, 1)\",\"sidebar_border\":\"hsla(261, 53%, 15%, .24)\",\"sidebar_highlight\":\"hsla(265, 100%, 72%, 1)\",\"sidebar_highlight_text\":\"hsla(0, 0%, 100%, 1)\",\"sidebar_text\":\"hsla(261, 53%, 15%, 1)\",\"tab_background_separator\":\"hsla(261, 53%, 15%, 1)\",\"tab_background_text\":\"hsla(261, 53%, 15%, 1)\",\"tab_line\":\"hsla(265, 100%, 72%, 1)\",\"tab_loading\":\"hsla(265, 100%, 72%, 1)\",\"tab_selected\":null,\"tab_text\":\"hsla(261, 53%, 15%, 1)\",\"textcolor\":null,\"toolbar\":\"hsla(0, 0%, 100%, .76)\",\"toolbar_bottom_separator\":\"hsla(261, 53%, 15%, .32)\",\"toolbar_field\":\"hsla(0, 0%, 100%, .8)\",\"toolbar_field_border\":\"transparent\",\"toolbar_field_border_focus\":\"hsla(265, 100%, 72%, 1)\",\"toolbar_field_focus\":\"hsla(261, 53%, 15%, .96)\",\"toolbar_field_highlight\":\"hsla(265, 100%, 72%, .32)\",\"toolbar_field_highlight_text\":null,\"toolbar_field_separator\":null,\"toolbar_field_text\":\"hsla(261, 53%, 15%, 1)\",\"toolbar_field_text_focus\":\"hsla(255, 100%, 94%, 1)\",\"toolbar_text\":\"hsla(261, 53%, 15%, 1)\",\"toolbar_top_separator\":\"transparent\",\"toolbar_vertical_separator\":\"hsla(261, 53%, 15%, .2)\",\"focus_outline\":\"hsla(258, 65%, 48%, 1)\"}',\r\n              '{\"accentcolor\":null,\"bookmark_text\":\"hsla(261, 53%, 15%, 1)\",\"button_background_active\":\"hsla(240, 26%, 11%, .16)\",\"button_background_hover\":\"hsla(240, 26%, 11%, .08)\",\"frame\":\"hsla(240, 20%, 98%, 1)\",\"frame_inactive\":null,\"icons\":\"hsla(258, 66%, 48%, 1)\",\"icons_attention\":\"hsla(180, 100%, 32%, 1)\",\"ntp_background\":\"hsla(0, 0%, 100%, 1)\",\"ntp_card_background\":null,\"ntp_text\":\"hsla(261, 53%, 15%, 1)\",\"popup\":\"hsla(254, 46%, 21%, 1)\",\"popup_border\":\"hsla(255, 100%, 94%, .32)\",\"popup_highlight\":\"hsla(255, 100%, 94%, .12)\",\"popup_highlight_text\":null,\"popup_text\":\"hsla(255, 100%, 94%, 1)\",\"sidebar\":\"hsla(240, 15%, 95%, 1)\",\"sidebar_border\":\"hsla(261, 53%, 15%, .24)\",\"sidebar_highlight\":\"hsla(265, 100%, 72%, 1)\",\"sidebar_highlight_text\":\"hsla(0, 0%, 100%, 1)\",\"sidebar_text\":\"hsla(261, 53%, 15%, 1)\",\"tab_background_separator\":\"hsla(261, 53%, 15%, 1)\",\"tab_background_text\":\"hsla(261, 53%, 15%, 1)\",\"tab_line\":\"hsla(265, 100%, 72%, 1)\",\"tab_loading\":\"hsla(265, 100%, 72%, 1)\",\"tab_selected\":null,\"tab_text\":\"hsla(261, 53%, 15%, 1)\",\"textcolor\":null,\"toolbar\":\"hsla(0, 0%, 100%, .76)\",\"toolbar_bottom_separator\":\"hsla(261, 53%, 15%, .32)\",\"toolbar_field\":\"hsla(0, 0%, 100%, .8)\",\"toolbar_field_border\":\"hsla(261, 53%, 15%, .32)\",\"toolbar_field_border_focus\":\"hsla(265, 100%, 72%, 1)\",\"toolbar_field_focus\":\"hsla(261, 53%, 15%, .96)\",\"toolbar_field_highlight\":\"hsla(265, 100%, 72%, .32)\",\"toolbar_field_highlight_text\":null,\"toolbar_field_separator\":\"hsla(261, 53%, 15%, .32)\",\"toolbar_field_text\":\"hsla(261, 53%, 15%, 1)\",\"toolbar_field_text_focus\":\"hsla(255, 100%, 94%, 1)\",\"toolbar_text\":\"hsla(261, 53%, 15%, 1)\",\"toolbar_top_separator\":\"hsla(261, 53%, 15%, 1)\",\"toolbar_vertical_separator\":\"hsla(261, 53%, 15%, .08)\"}',\r\n            ].includes(JSON.stringify(theme.colors))\r\n          ) {\r\n            isFirefoxAlpenglowTheme = true;\r\n          }\r\n        } catch {}\r\n        return isFirefoxAlpenglowTheme;\r\n      };\r\n\r\n      let themeColorFrame = null;\r\n      let themeColorToolbar = null;\r\n      let themeColorToolbarField = null;\r\n      let themeColorFieldText = null;\r\n      let themeColorAttention = null;\r\n      let isUsingTheme = false;\r\n      let isFirefoxAlpenglowTheme = false;\r\n      if (typeof browser != \"undefined\" && browser.theme) {\r\n        function onThemeUpdated() {\r\n          browser.theme.getCurrent().then((theme) => {\r\n            themeColorFrame = null;\r\n            themeColorToolbar = null;\r\n            themeColorToolbarField = null;\r\n            themeColorFieldText = null;\r\n            themeColorAttention = null;\r\n            if (theme.colors && theme.colors.frame) {\r\n              themeColorFrame = theme.colors.frame;\r\n            }\r\n            if (theme.colors && theme.colors.toolbar) {\r\n              themeColorToolbar = theme.colors.toolbar;\r\n            }\r\n            if (theme.colors && theme.colors.toolbar_field) {\r\n              themeColorToolbarField = theme.colors.toolbar_field;\r\n            }\r\n            if (theme.colors && theme.colors.toolbar_field_text) {\r\n              themeColorFieldText = theme.colors.toolbar_field_text;\r\n            }\r\n            if (theme.colors && theme.colors.icons_attention) {\r\n              themeColorAttention = theme.colors.icons_attention;\r\n            }\r\n\r\n            isUsingTheme = false;\r\n            if (theme.colors || theme.images || theme.properties) {\r\n              isUsingTheme = true;\r\n            }\r\n\r\n            isFirefoxAlpenglowTheme = isFirefoxAlpenglow(theme);\r\n\r\n            updateIconInAllTabs();\r\n          });\r\n        }\r\n        onThemeUpdated();\r\n        browser.theme.onUpdated.addListener(() => onThemeUpdated());\r\n      }\r\n\r\n      let darkMode = false;\r\n      darkMode = matchMedia(\"(prefers-color-scheme: dark)\").matches;\r\n      updateIconInAllTabs();\r\n\r\n      matchMedia(\"(prefers-color-scheme: dark)\").addEventListener(\r\n        \"change\",\r\n        () => {\r\n          darkMode = matchMedia(\"(prefers-color-scheme: dark)\").matches;\r\n          updateIconInAllTabs();\r\n        }\r\n      );\r\n\r\n      function getSVGIcon(incognito = false) {\r\n        const svgXml = `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\">\r\n                    <path fill=\"$(fill);\" fill-opacity=\"$(fill-opacity);\" d=\"M 45 0 C 20.186 0 0 20.186 0 45 L 0 347 C 0 371.814 20.186 392 45 392 L 301 392 C 305.819 392 310.34683 389.68544 313.17383 385.77344 C 315.98683 381.84744 316.76261 376.82491 315.22461 372.25391 L 195.23828 10.269531 A 14.995 14.995 0 0 0 181 0 L 45 0 z M 114.3457 107.46289 L 156.19336 107.46289 C 159.49489 107.46289 162.41322 109.61359 163.39258 112.76367 L 163.38281 112.77539 L 214.06641 276.2832 C 214.77315 278.57508 214.35913 281.05986 212.93555 282.98828 C 211.52206 284.90648 209.27989 286.04688 206.87695 286.04688 L 179.28516 286.04688 C 175.95335 286.04687 173.01546 283.86624 172.06641 280.67578 L 159.92969 240.18945 L 108.77148 240.18945 L 97.564453 280.52344 C 96.655774 283.77448 93.688937 286.03711 90.306641 286.03711 L 64.347656 286.03711 C 61.954806 286.03711 59.71461 284.90648 58.291016 282.98828 C 56.867422 281.05986 56.442021 278.57475 57.138672 276.29297 L 107.14648 112.79492 C 108.11572 109.62465 111.03407 107.46289 114.3457 107.46289 z M 133.39648 137.70117 L 114.55664 210.03125 L 154.06445 210.03125 L 133.91211 137.70117 L 133.39648 137.70117 z \" />\r\n                    <path fill=\"$(fill);\" fill-opacity=\"$(fill-opacity);\" d=\"M226.882 378.932c28.35 85.716 26.013 84.921 34.254 88.658a14.933 14.933 0 0 0 6.186 1.342c5.706 0 11.16-3.274 13.67-8.809l36.813-81.19z\" />\r\n                    <g>\r\n                    <path fill=\"$(fill);\" fill-opacity=\"$(fill-opacity);\" d=\"M467 121H247.043L210.234 10.268A15 15 0 0 0 196 0H45C20.187 0 0 20.187 0 45v301c0 24.813 20.187 45 45 45h165.297l36.509 110.438c2.017 6.468 7.999 10.566 14.329 10.566.035 0 .07-.004.105-.004h205.761c24.813 0 45-20.187 45-45V166C512 141.187 491.813 121 467 121zM45 361c-8.271 0-15-6.729-15-15V45c0-8.271 6.729-15 15-15h140.179l110.027 331H45zm247.729 30l-29.4 64.841L241.894 391zM482 467c0 8.271-6.729 15-15 15H284.408l45.253-99.806a15.099 15.099 0 0 0 .571-10.932L257.015 151H467c8.271 0 15 6.729 15 15z\" />\r\n                    <path fill=\"$(fill);\" fill-opacity=\"$(fill-opacity);\" d=\"M444.075 241h-45v-15c0-8.284-6.716-15-15-15-8.284 0-15 6.716-15 15v15h-45c-8.284 0-15 6.716-15 15 0 8.284 6.716 15 15 15h87.14c-4.772 14.185-15.02 30.996-26.939 47.174a323.331 323.331 0 0 1-7.547-10.609c-4.659-6.851-13.988-8.628-20.838-3.969-6.85 4.658-8.627 13.988-3.969 20.839 4.208 6.189 8.62 12.211 13.017 17.919-7.496 8.694-14.885 16.57-21.369 22.94-5.913 5.802-6.003 15.299-.2 21.212 5.777 5.889 15.273 6.027 21.211.201.517-.508 8.698-8.566 19.624-20.937 10.663 12.2 18.645 20.218 19.264 20.837 5.855 5.855 15.35 5.858 21.208.002 5.858-5.855 5.861-15.352.007-21.212-.157-.157-9.34-9.392-21.059-23.059 21.233-27.448 34.18-51.357 38.663-71.338h1.786c8.284 0 15-6.716 15-15 0-8.284-6.715-15-14.999-15z\" />\r\n                    </g>\r\n                </svg>\r\n                `;\r\n\r\n        let svg64;\r\n        if (\r\n          pageLanguageState === \"translated\" &&\r\n          twpConfig.get(\"popupBlueWhenSiteIsTranslated\") === \"yes\"\r\n        ) {\r\n          svg64 = svgXml.replace(/\\$\\(fill\\-opacity\\)\\;/g, \"1.0\");\r\n          if (isFirefoxAlpenglowTheme) {\r\n            if (darkMode || incognito) {\r\n              svg64 = btoa(\r\n                svg64.replace(/\\$\\(fill\\)\\;/g, \"hsla(157, 100%, 66%, 1)\")\r\n              );\r\n            } else {\r\n              svg64 = btoa(\r\n                svg64.replace(/\\$\\(fill\\)\\;/g, \"hsla(180, 100%, 32%, 1)\")\r\n              );\r\n            }\r\n          } else {\r\n            if (\r\n              themeColorFrame &&\r\n              themeColorToolbar &&\r\n              themeColorToolbarField\r\n            ) {\r\n              try {\r\n                darkMode = isDarkColor(\r\n                  standardize_color(\r\n                    themeColorFrame,\r\n                    themeColorToolbar,\r\n                    themeColorToolbarField\r\n                  )\r\n                );\r\n              } catch (e) {\r\n                console.error(e);\r\n              }\r\n            } else if (themeColorFieldText) {\r\n              try {\r\n                darkMode = !isDarkColor(\r\n                  standardize_color(\r\n                    themeColorFieldText,\r\n                    themeColorFieldText,\r\n                    themeColorFieldText\r\n                  )\r\n                );\r\n              } catch (e) {\r\n                console.error(e);\r\n              }\r\n            }\r\n\r\n            if (themeColorAttention) {\r\n              svg64 = btoa(svg64.replace(/\\$\\(fill\\)\\;/g, themeColorAttention));\r\n            } else if (!isUsingTheme && (darkMode || incognito)) {\r\n              svg64 = btoa(svg64.replace(/\\$\\(fill\\)\\;/g, \"#00ddff\"));\r\n            } else if (isUsingTheme && darkMode) {\r\n              svg64 = btoa(svg64.replace(/\\$\\(fill\\)\\;/g, \"#00ddff\"));\r\n            } else {\r\n              svg64 = btoa(svg64.replace(/\\$\\(fill\\)\\;/g, \"#0061e0\"));\r\n            }\r\n          }\r\n        } else {\r\n          if ((isUsingTheme && darkMode) || (!isUsingTheme && incognito)) {\r\n            svg64 = svgXml.replace(/\\$\\(fill\\-opacity\\)\\;/g, \"1.0\");\r\n          } else {\r\n            svg64 = svgXml.replace(/\\$\\(fill\\-opacity\\)\\;/g, \"0.7\");\r\n          }\r\n          if (isFirefoxAlpenglowTheme) {\r\n            if (darkMode || incognito) {\r\n              svg64 = btoa(\r\n                svg64.replace(/\\$\\(fill\\)\\;/g, \"hsla(255, 100%, 94%, 1)\")\r\n              );\r\n            } else {\r\n              svg64 = btoa(\r\n                svg64.replace(/\\$\\(fill\\)\\;/g, \"hsla(261, 53%, 15%, 1)\")\r\n              );\r\n            }\r\n          } else {\r\n            if (themeColorFieldText) {\r\n              svg64 = btoa(svg64.replace(/\\$\\(fill\\)\\;/g, themeColorFieldText));\r\n            } else if (!isUsingTheme && (darkMode || incognito)) {\r\n              svg64 = btoa(svg64.replace(/\\$\\(fill\\)\\;/g, \"white\"));\r\n            } else {\r\n              svg64 = btoa(svg64.replace(/\\$\\(fill\\)\\;/g, \"black\"));\r\n            }\r\n          }\r\n        }\r\n\r\n        const b64Start = \"data:image/svg+xml;base64,\";\r\n        return b64Start + svg64;\r\n      }\r\n\r\n      function standardize_color(str1, str2, str3) {\r\n        var ctx = new OffscreenCanvas(1, 1).getContext(\"2d\");\r\n        ctx.imageSmoothingEnabled = false;\r\n        ctx.fillStyle = str1;\r\n        ctx.fillRect(0, 0, 1, 1);\r\n        ctx.fillStyle = str2;\r\n        ctx.fillRect(0, 0, 1, 1);\r\n        ctx.fillStyle = str3;\r\n        ctx.fillRect(0, 0, 1, 1);\r\n        var data = ctx.getImageData(0, 0, 1, 1).data;\r\n        var rgb = [data[0], data[1], data[2]];\r\n        ctx.fillStyle = \"rgb(\" + rgb.join(\",\") + \")\";\r\n        return ctx.fillStyle;\r\n      }\r\n\r\n      function hexToRgb(hex) {\r\n        var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n        return result\r\n          ? {\r\n              r: parseInt(result[1], 16),\r\n              g: parseInt(result[2], 16),\r\n              b: parseInt(result[3], 16),\r\n            }\r\n          : null;\r\n      }\r\n\r\n      function isDarkColor(hexColor) {\r\n        var rgb = hexToRgb(hexColor);\r\n\r\n        // Normalizando os valores RGB para o intervalo [0, 1]\r\n        var r = rgb.r / 255,\r\n          g = rgb.g / 255,\r\n          b = rgb.b / 255,\r\n          max = Math.max(r, g, b),\r\n          min = Math.min(r, g, b),\r\n          l = (max + min) / 2;\r\n\r\n        // Verificando a luminosidade\r\n        return l <= 0.5;\r\n      }\r\n\r\n      function updateIcon(tabId) {\r\n        chrome.tabs.get(tabId, (tabInfo) => {\r\n          const incognito = tabInfo ? tabInfo.incognito : false;\r\n\r\n          if (chrome.pageAction) {\r\n            resetPageAction(tabId);\r\n            chrome.pageAction.setIcon({\r\n              tabId: tabId,\r\n              path: getSVGIcon(incognito),\r\n            });\r\n\r\n            if (twpConfig.get(\"showButtonInTheAddressBar\") == \"no\") {\r\n              chrome.pageAction.hide(tabId);\r\n            } else {\r\n              chrome.pageAction.show(tabId);\r\n            }\r\n          }\r\n\r\n          if (chrome.browserAction) {\r\n            if (\r\n              pageLanguageState === \"translated\" &&\r\n              twpConfig.get(\"popupBlueWhenSiteIsTranslated\") === \"yes\"\r\n            ) {\r\n              chrome.browserAction.setIcon({\r\n                tabId: tabId,\r\n                path: \"/icons/icon-32-translated.png\",\r\n              });\r\n            } else {\r\n              chrome.browserAction.setIcon({\r\n                tabId: tabId,\r\n                path: \"/icons/icon-32.png\",\r\n              });\r\n            }\r\n          }\r\n        });\r\n      }\r\n\r\n      function updateIconInAllTabs() {\r\n        chrome.tabs.query({}, (tabs) =>\r\n          tabs.forEach((tab) => updateIcon(tab.id))\r\n        );\r\n      }\r\n\r\n      chrome.tabs.onUpdated.addListener((tabId, changeInfo, tab) => {\r\n        if (changeInfo.status == \"loading\") {\r\n          pageLanguageState = \"original\";\r\n          updateIcon(tabId);\r\n        } else if (changeInfo.status == \"complete\") {\r\n          chrome.tabs.sendMessage(\r\n            tabId,\r\n            {\r\n              action: \"getCurrentPageLanguageState\",\r\n            },\r\n            {\r\n              frameId: 0,\r\n            },\r\n            (_pageLanguageState) => {\r\n              checkedLastError();\r\n              if (_pageLanguageState) {\r\n                pageLanguageState = _pageLanguageState;\r\n                updateIcon(tabId);\r\n              }\r\n            }\r\n          );\r\n        }\r\n      });\r\n\r\n      chrome.tabs.onActivated.addListener((activeInfo) => {\r\n        pageLanguageState = \"original\";\r\n        updateIcon(activeInfo.tabId);\r\n        chrome.tabs.sendMessage(\r\n          activeInfo.tabId,\r\n          {\r\n            action: \"getCurrentPageLanguageState\",\r\n          },\r\n          {\r\n            frameId: 0,\r\n          },\r\n          (_pageLanguageState) => {\r\n            checkedLastError();\r\n            if (_pageLanguageState) {\r\n              pageLanguageState = _pageLanguageState;\r\n              updateIcon(activeInfo.tabId);\r\n            }\r\n          }\r\n        );\r\n      });\r\n\r\n      chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\r\n        if (request.action === \"setPageLanguageState\") {\r\n          pageLanguageState = request.pageLanguageState;\r\n          updateIcon(sender.tab.id);\r\n        }\r\n      });\r\n\r\n      twpConfig.onChanged((name, newvalue) => {\r\n        switch (name) {\r\n          case \"useOldPopup\":\r\n            updateIconInAllTabs();\r\n            break;\r\n          case \"showButtonInTheAddressBar\":\r\n            updateIconInAllTabs();\r\n            break;\r\n        }\r\n      });\r\n    }\r\n  }\r\n});\r\n\r\nif (typeof chrome.commands !== \"undefined\") {\r\n  chrome.commands.onCommand.addListener((command) => {\r\n    if (command === \"hotkey-toggle-translation\") {\r\n      chrome.tabs.query(\r\n        {\r\n          currentWindow: true,\r\n          active: true,\r\n        },\r\n        (tabs) => sendToggleTranslationMessage(tabs[0].id)\r\n      );\r\n    } else if (command === \"hotkey-translate-selected-text\") {\r\n      chrome.tabs.query(\r\n        {\r\n          currentWindow: true,\r\n          active: true,\r\n        },\r\n        (tabs) =>\r\n          chrome.tabs.sendMessage(\r\n            tabs[0].id,\r\n            {\r\n              action: \"TranslateSelectedText\",\r\n            },\r\n            checkedLastError\r\n          )\r\n      );\r\n    } else if (command === \"hotkey-swap-page-translation-service\") {\r\n      chrome.tabs.query(\r\n        {\r\n          active: true,\r\n          currentWindow: true,\r\n        },\r\n        (tabs) =>\r\n          chrome.tabs.sendMessage(\r\n            tabs[0].id,\r\n            {\r\n              action: \"swapTranslationService\",\r\n              newServiceName: twpConfig.swapPageTranslationService(),\r\n            },\r\n            checkedLastError\r\n          )\r\n      );\r\n    } else if (command === \"hotkey-show-original\") {\r\n      chrome.tabs.query(\r\n        {\r\n          active: true,\r\n          currentWindow: true,\r\n        },\r\n        (tabs) =>\r\n          chrome.tabs.sendMessage(\r\n            tabs[0].id,\r\n            {\r\n              action: \"translatePage\",\r\n              targetLanguage: \"original\",\r\n            },\r\n            checkedLastError\r\n          )\r\n      );\r\n    } else if (command === \"hotkey-translate-page-1\") {\r\n      chrome.tabs.query(\r\n        {\r\n          active: true,\r\n          currentWindow: true,\r\n        },\r\n        (tabs) => {\r\n          twpConfig.setTargetLanguage(twpConfig.get(\"targetLanguages\")[0]);\r\n          sendTranslatePageMessage(\r\n            tabs[0].id,\r\n            twpConfig.get(\"targetLanguages\")[0]\r\n          );\r\n        }\r\n      );\r\n    } else if (command === \"hotkey-translate-page-2\") {\r\n      chrome.tabs.query(\r\n        {\r\n          active: true,\r\n          currentWindow: true,\r\n        },\r\n        (tabs) => {\r\n          twpConfig.setTargetLanguage(twpConfig.get(\"targetLanguages\")[1]);\r\n          sendTranslatePageMessage(\r\n            tabs[0].id,\r\n            twpConfig.get(\"targetLanguages\")[1]\r\n          );\r\n        }\r\n      );\r\n    } else if (command === \"hotkey-translate-page-3\") {\r\n      chrome.tabs.query(\r\n        {\r\n          active: true,\r\n          currentWindow: true,\r\n        },\r\n        (tabs) => {\r\n          twpConfig.setTargetLanguage(twpConfig.get(\"targetLanguages\")[2]);\r\n          sendTranslatePageMessage(\r\n            tabs[0].id,\r\n            twpConfig.get(\"targetLanguages\")[2]\r\n          );\r\n        }\r\n      );\r\n    } else if (command === \"hotkey-hot-translate-selected-text\") {\r\n      chrome.tabs.query(\r\n        {\r\n          active: true,\r\n          currentWindow: true,\r\n        },\r\n        (tabs) => {\r\n          chrome.tabs.sendMessage(\r\n            tabs[0].id,\r\n            {\r\n              action: \"hotTranslateSelectedText\",\r\n            },\r\n            checkedLastError\r\n          );\r\n        }\r\n      );\r\n    }\r\n  });\r\n}\r\n\r\ntwpConfig.onReady(async () => {\r\n  updateContextMenu();\r\n  updateTranslateSelectedContextMenu();\r\n\r\n  twpConfig.onChanged((name, newvalue) => {\r\n    if (name === \"showTranslateSelectedContextMenu\") {\r\n      updateTranslateSelectedContextMenu();\r\n    }\r\n  });\r\n\r\n  if (!twpConfig.get(\"installDateTime\")) {\r\n    twpConfig.set(\"installDateTime\", Date.now());\r\n  }\r\n});\r\n\r\ntwpConfig.onReady(async () => {\r\n  let navigationsInfo = {};\r\n  let tabsInfo = {};\r\n\r\n  function tabsOnRemoved(tabId) {\r\n    delete navigationsInfo[tabId];\r\n    delete tabsInfo[tabId];\r\n  }\r\n\r\n  function runtimeOnMessage(request, sender, sendResponse) {\r\n    if (request.action === \"setPageLanguageState\") {\r\n      tabsInfo[sender.tab.id] = {\r\n        pageLanguageState: request.pageLanguageState,\r\n        host: new URL(sender.tab.url).host,\r\n      };\r\n    }\r\n  }\r\n\r\n  //TODO ver porque no Firefox o evento OnCommitted executa antes de OnCreatedNavigationTarget e OnBeforeNavigate quando [target=\"_blank\"]\r\n\r\n  function webNavigationOnCreatedNavigationTarget(details) {\r\n    const navInfo = navigationsInfo[details.tabId] || {};\r\n    navInfo.sourceTabId = details.sourceTabId;\r\n    navigationsInfo[details.tabId] = navInfo;\r\n  }\r\n\r\n  function webNavigationOnBeforeNavigate(details) {\r\n    if (details.frameId !== 0) return;\r\n\r\n    const navInfo = navigationsInfo[details.tabId] || {\r\n      sourceTabId: details.tabId,\r\n    };\r\n    navInfo.beforeNavigateIsExecuted = true;\r\n    if (tabsInfo[navInfo.sourceTabId]) {\r\n      navInfo.sourceHost = tabsInfo[navInfo.sourceTabId].host;\r\n      navInfo.sourcePageLanguageState =\r\n        tabsInfo[navInfo.sourceTabId].pageLanguageState;\r\n    }\r\n    navigationsInfo[details.tabId] = navInfo;\r\n\r\n    if (navInfo.promise_resolve) {\r\n      navInfo.promise_resolve();\r\n    }\r\n  }\r\n\r\n  async function webNavigationOnCommitted(details) {\r\n    if (details.frameId !== 0) return;\r\n\r\n    const navInfo = navigationsInfo[details.tabId] || {\r\n      sourceTabId: details.tabId,\r\n    };\r\n    navInfo.transitionType = details.transitionType;\r\n    navigationsInfo[details.tabId] = navInfo;\r\n\r\n    if (!navInfo.beforeNavigateIsExecuted) {\r\n      await new Promise((resolve) => (navInfo.promise_resolve = resolve));\r\n    }\r\n  }\r\n\r\n  function webNavigationOnDOMContentLoaded(details) {\r\n    if (details.frameId !== 0) return;\r\n\r\n    const navInfo = navigationsInfo[details.tabId];\r\n\r\n    if (navInfo && navInfo.sourceHost) {\r\n      const host = new URL(details.url).host;\r\n      if (\r\n        navInfo.transitionType === \"link\" &&\r\n        navInfo.sourcePageLanguageState === \"translated\" &&\r\n        navInfo.sourceHost === host\r\n      ) {\r\n        setTimeout(\r\n          () =>\r\n            chrome.tabs.sendMessage(\r\n              details.tabId,\r\n              {\r\n                action: \"autoTranslateBecauseClickedALink\",\r\n              },\r\n              {\r\n                frameId: 0,\r\n              },\r\n              checkedLastError\r\n            ),\r\n          500\r\n        );\r\n      }\r\n    }\r\n\r\n    delete navigationsInfo[details.tabId];\r\n  }\r\n\r\n  function enableTranslationOnClickingALink() {\r\n    disableTranslationOnClickingALink();\r\n    if (!chrome.webNavigation) return;\r\n\r\n    chrome.tabs.onRemoved.addListener(tabsOnRemoved);\r\n    chrome.runtime.onMessage.addListener(runtimeOnMessage);\r\n\r\n    chrome.webNavigation.onCreatedNavigationTarget.addListener(\r\n      webNavigationOnCreatedNavigationTarget\r\n    );\r\n    chrome.webNavigation.onBeforeNavigate.addListener(\r\n      webNavigationOnBeforeNavigate\r\n    );\r\n    chrome.webNavigation.onCommitted.addListener(webNavigationOnCommitted);\r\n    chrome.webNavigation.onDOMContentLoaded.addListener(\r\n      webNavigationOnDOMContentLoaded\r\n    );\r\n  }\r\n\r\n  function disableTranslationOnClickingALink() {\r\n    navigationsInfo = {};\r\n    tabsInfo = {};\r\n    chrome.tabs.onRemoved.removeListener(tabsOnRemoved);\r\n    chrome.runtime.onMessage.removeListener(runtimeOnMessage);\r\n\r\n    if (chrome.webNavigation) {\r\n      chrome.webNavigation.onCreatedNavigationTarget.removeListener(\r\n        webNavigationOnCreatedNavigationTarget\r\n      );\r\n      chrome.webNavigation.onBeforeNavigate.removeListener(\r\n        webNavigationOnBeforeNavigate\r\n      );\r\n      chrome.webNavigation.onCommitted.removeListener(webNavigationOnCommitted);\r\n      chrome.webNavigation.onDOMContentLoaded.removeListener(\r\n        webNavigationOnDOMContentLoaded\r\n      );\r\n    } else {\r\n      console.info(\"No webNavigation permission\");\r\n    }\r\n  }\r\n\r\n  twpConfig.onChanged((name, newvalue) => {\r\n    if (name === \"autoTranslateWhenClickingALink\") {\r\n      if (newvalue == \"yes\") {\r\n        enableTranslationOnClickingALink();\r\n      } else {\r\n        disableTranslationOnClickingALink();\r\n      }\r\n    }\r\n  });\r\n\r\n  if (chrome.permissions.onRemoved) {\r\n    chrome.permissions.onRemoved.addListener((permissions) => {\r\n      if (permissions.permissions.indexOf(\"webNavigation\") !== -1) {\r\n        twpConfig.set(\"autoTranslateWhenClickingALink\", \"no\");\r\n      }\r\n    });\r\n  }\r\n\r\n  chrome.permissions.contains(\r\n    {\r\n      permissions: [\"webNavigation\"],\r\n    },\r\n    (hasPermissions) => {\r\n      if (\r\n        hasPermissions &&\r\n        twpConfig.get(\"autoTranslateWhenClickingALink\") === \"yes\"\r\n      ) {\r\n        enableTranslationOnClickingALink();\r\n      } else {\r\n        twpConfig.set(\"autoTranslateWhenClickingALink\", \"no\");\r\n      }\r\n    }\r\n  );\r\n});\r\n\r\n// garante que a extensão só seja atualizada quando reiniciar o navegador.\r\n// caso seja uma atualização manual, realiza uma limpeza e recarrega a extensão para instalar a atualização.\r\nchrome.runtime.onUpdateAvailable.addListener((details) => {\r\n  var reloaded = false;\r\n\r\n  setTimeout(function () {\r\n    if (!reloaded) {\r\n      reloaded = true;\r\n      chrome.runtime.reload();\r\n    }\r\n  }, 2200);\r\n\r\n  chrome.tabs.query({}, (tabs) => {\r\n    const cleanUpsPromises = [];\r\n    tabs.forEach((tab) => {\r\n      cleanUpsPromises.push(\r\n        new Promise((resolve) => {\r\n          chrome.tabs.sendMessage(tab.id, { action: \"cleanUp\" }, resolve);\r\n        })\r\n      );\r\n    });\r\n    Promise.all(cleanUpsPromises).finally(() => {\r\n      if (!reloaded) {\r\n        reloaded = true;\r\n        chrome.runtime.reload();\r\n      }\r\n    });\r\n  });\r\n\r\n  // chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\r\n  //   const url = new URL(tabs[0].url);\r\n  //   if (\r\n  //     (url.hostname === \"github.com\" &&\r\n  //       url.pathname.includes(\"FilipePS/Traduzir-paginas-web/releases\")) ||\r\n  //     (url.hostname === \"addons.mozilla.org\" &&\r\n  //       url.pathname.includes(\"addon/traduzir-paginas-web/versions\"))\r\n  //   ) {\r\n  //     chrome.tabs.query({}, (tabs) => {\r\n  //       const cleanUpsPromises = [];\r\n  //       tabs.forEach((tab) => {\r\n  //         cleanUpsPromises.push(\r\n  //           new Promise((resolve) => {\r\n  //             chrome.tabs.sendMessage(tab.id, { action: \"cleanUp\" }, resolve);\r\n  //           })\r\n  //         );\r\n  //       });\r\n  //       Promise.all(cleanUpsPromises).finally(() => {\r\n  //         chrome.runtime.reload();\r\n  //       });\r\n  //     });\r\n  //   }\r\n  // });\r\n});\r\n"],"mappings":"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"}
{"version":3,"file":"../../contentScript/deepl.js","names":["translate","text","targetLanguage","Promise","resolve","target_textarea","document","querySelector","location","hash","encodeURIComponent","Error","startTime","performance","now","checkresult","oldvalue","textContent","setTimeout","startsWith","split","decodeURIComponent","substring","then","result","console","info","chrome","runtime","sendMessage","action","checkedLastError","catch","e","error","onMessage","addListener","request","sender","sendResponse"],"sources":["deepl.js"],"sourcesContent":["\"use strict\";\r\n\r\n/*\r\n  When the DeepL tab is not activated, the timers will have a minimum delay of 1 second which delays the translation.\r\n*/\r\n\r\nvoid (function () {\r\n  /**\r\n   * Put the original text in the correct place, select the target language, wait and return the translation result.\r\n   * @param {string} text\r\n   * @param {string} targetLanguage\r\n   * @returns {Promise<string>} resultText\r\n   */\r\n  async function translate(text, targetLanguage) {\r\n    return await new Promise((resolve) => {\r\n      /** @type {HTMLTextAreaElement} */\r\n      const target_textarea = document.querySelector(\r\n        \"d-textarea[data-testid=translator-target-input]\"\r\n      );\r\n\r\n      // set the URL hash, the translation will start immediately\r\n      location.hash = `#/auto/${targetLanguage}/${encodeURIComponent(text)}`;\r\n\r\n      if (!target_textarea) {\r\n        throw new Error(\"target_textarea not found.\");\r\n      }\r\n\r\n      const startTime = performance.now();\r\n\r\n      /**\r\n       * wait for the translation to finish\r\n       * @param {string} oldvalue\r\n       * @returns\r\n       */\r\n      function checkresult(oldvalue) {\r\n        if (\r\n          performance.now() - startTime > 2400 ||\r\n          (target_textarea.textContent &&\r\n            target_textarea.textContent !== oldvalue)\r\n        ) {\r\n          return resolve(target_textarea.textContent);\r\n        }\r\n        setTimeout(checkresult, 100, oldvalue);\r\n      }\r\n      checkresult(target_textarea.textContent);\r\n    });\r\n  }\r\n\r\n  // get the sourceText and targetLanguage from the URL hash\r\n  if (location.hash.startsWith(\"#!\")) {\r\n    let [targetLanguage, text] = location.hash.split(\"!#\");\r\n    location.hash = \"\";\r\n\r\n    targetLanguage = decodeURIComponent(targetLanguage.substring(2));\r\n    text = decodeURIComponent(text);\r\n\r\n    translate(text, targetLanguage || \"en\")\r\n      .then((result) => {\r\n        console.info(result);\r\n        chrome.runtime.sendMessage(\r\n          {\r\n            action: \"DeepL_firstTranslationResult\",\r\n            result,\r\n          },\r\n          checkedLastError\r\n        );\r\n      })\r\n      .catch((e) => {\r\n        console.error(e);\r\n        chrome.runtime.sendMessage(\r\n          {\r\n            action: \"DeepL_firstTranslationResult\",\r\n            result: \"\",\r\n          },\r\n          checkedLastError\r\n        );\r\n      });\r\n  }\r\n\r\n  chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\r\n    if (request.action === \"translateTextWithDeepL\") {\r\n      console.info(request);\r\n      translate(request.text, request.targetLanguage)\r\n        .then((result) => {\r\n          console.info(result);\r\n          sendResponse(result);\r\n        })\r\n        .catch((e) => {\r\n          console.error(e);\r\n          sendResponse(\"\");\r\n        });\r\n    }\r\n\r\n    return true;\r\n  });\r\n})();\r\n"],"mappings":"AAAA,YAAY;;AAEZ;AACA;AACA;AAEA,KAAM,YAAY;EAChB;AACF;AACA;AACA;AACA;AACA;EACE,eAAeA,SAAS,CAACC,IAAI,EAAEC,cAAc,EAAE;IAC7C,OAAO,MAAM,IAAIC,OAAO,CAAEC,OAAO,IAAK;MACpC;MACA,MAAMC,eAAe,GAAGC,QAAQ,CAACC,aAAa,CAC5C,iDAAiD,CAClD;;MAED;MACAC,QAAQ,CAACC,IAAI,GAAI,UAASP,cAAe,IAAGQ,kBAAkB,CAACT,IAAI,CAAE,EAAC;MAEtE,IAAI,CAACI,eAAe,EAAE;QACpB,MAAM,IAAIM,KAAK,CAAC,4BAA4B,CAAC;MAC/C;MAEA,MAAMC,SAAS,GAAGC,WAAW,CAACC,GAAG,EAAE;;MAEnC;AACN;AACA;AACA;AACA;MACM,SAASC,WAAW,CAACC,QAAQ,EAAE;QAC7B,IACEH,WAAW,CAACC,GAAG,EAAE,GAAGF,SAAS,GAAG,IAAI,IACnCP,eAAe,CAACY,WAAW,IAC1BZ,eAAe,CAACY,WAAW,KAAKD,QAAS,EAC3C;UACA,OAAOZ,OAAO,CAACC,eAAe,CAACY,WAAW,CAAC;QAC7C;QACAC,UAAU,CAACH,WAAW,EAAE,GAAG,EAAEC,QAAQ,CAAC;MACxC;MACAD,WAAW,CAACV,eAAe,CAACY,WAAW,CAAC;IAC1C,CAAC,CAAC;EACJ;;EAEA;EACA,IAAIT,QAAQ,CAACC,IAAI,CAACU,UAAU,CAAC,IAAI,CAAC,EAAE;IAClC,IAAI,CAACjB,cAAc,EAAED,IAAI,CAAC,GAAGO,QAAQ,CAACC,IAAI,CAACW,KAAK,CAAC,IAAI,CAAC;IACtDZ,QAAQ,CAACC,IAAI,GAAG,EAAE;IAElBP,cAAc,GAAGmB,kBAAkB,CAACnB,cAAc,CAACoB,SAAS,CAAC,CAAC,CAAC,CAAC;IAChErB,IAAI,GAAGoB,kBAAkB,CAACpB,IAAI,CAAC;IAE/BD,SAAS,CAACC,IAAI,EAAEC,cAAc,IAAI,IAAI,CAAC,CACpCqB,IAAI,CAAEC,MAAM,IAAK;MAChBC,OAAO,CAACC,IAAI,CAACF,MAAM,CAAC;MACpBG,MAAM,CAACC,OAAO,CAACC,WAAW,CACxB;QACEC,MAAM,EAAE,8BAA8B;QACtCN;MACF,CAAC,EACDO,gBAAgB,CACjB;IACH,CAAC,CAAC,CACDC,KAAK,CAAEC,CAAC,IAAK;MACZR,OAAO,CAACS,KAAK,CAACD,CAAC,CAAC;MAChBN,MAAM,CAACC,OAAO,CAACC,WAAW,CACxB;QACEC,MAAM,EAAE,8BAA8B;QACtCN,MAAM,EAAE;MACV,CAAC,EACDO,gBAAgB,CACjB;IACH,CAAC,CAAC;EACN;EAEAJ,MAAM,CAACC,OAAO,CAACO,SAAS,CAACC,WAAW,CAAC,CAACC,OAAO,EAAEC,MAAM,EAAEC,YAAY,KAAK;IACtE,IAAIF,OAAO,CAACP,MAAM,KAAK,wBAAwB,EAAE;MAC/CL,OAAO,CAACC,IAAI,CAACW,OAAO,CAAC;MACrBrC,SAAS,CAACqC,OAAO,CAACpC,IAAI,EAAEoC,OAAO,CAACnC,cAAc,CAAC,CAC5CqB,IAAI,CAAEC,MAAM,IAAK;QAChBC,OAAO,CAACC,IAAI,CAACF,MAAM,CAAC;QACpBe,YAAY,CAACf,MAAM,CAAC;MACtB,CAAC,CAAC,CACDQ,KAAK,CAAEC,CAAC,IAAK;QACZR,OAAO,CAACS,KAAK,CAACD,CAAC,CAAC;QAChBM,YAAY,CAAC,EAAE,CAAC;MAClB,CAAC,CAAC;IACN;IAEA,OAAO,IAAI;EACb,CAAC,CAAC;AACJ,CAAC,EAAG"}
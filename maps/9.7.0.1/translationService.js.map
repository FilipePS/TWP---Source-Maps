{"version":3,"file":"../../background/translationService.js","names":["translationService","Utils","escapeHTML","unsafe","replace","unescapeHTML","GoogleHelper","googleTranslateTKK","shiftLeftOrRightThenSumOrXor","num","optString","i","length","acc","charAt","charCodeAt","Number","transformQuery","query","bytesArray","idx","charCode","calcHash","windowTkk","tkkSplited","split","tkkIndex","tkkKey","encondingRound","item","normalizedResult","toString","YandexHelper","translateSid","findSID","Promise","resolve","updateYandexSid","date","Date","setHours","getMinutes","setMinutes","getTime","now","http","XMLHttpRequest","open","send","onload","e","result","responseText","match","substring","onerror","onabort","ontimeout","console","error","finally","BingHelper","translateAuth","findAuth","updateBingAuth","Service","constructor","serviceName","baseURL","xhrMethod","cbTransformRequest","cbParseResponse","cbTransformResponse","cbGetExtraParameters","cbGetRequestBody","cbGetExtraHeaders","translationsInProgress","Map","removeTranslationsWithError","forEach","transInfo","key","status","delete","getRequests","sourceLanguage","targetLanguage","sourceArray2d","requests","currentTranslationsInProgress","currentRequest","currentSize","sourceArray","requestString","fixString","requestHash","join","progressInfo","get","push","promise_resolve","originalText","translatedText","detectedLanguage","_status","waitTranlate","set","cacheEntry","translationCache","makeRequest","reject","xhr","headers","header","setRequestHeader","name","value","responseType","event","response","undefined","translate","dontSaveInPersistentCache","dontSortResults","promises","request","then","results","text","catch","all","map","str","googleService","index","responseJson","indexOf","slice","sentences","sentenceStartIndex","sentenceFinalIndex","resultArray","lastEndPos","r","matchAll","fullText","fullLength","pos","aTag","insideText","outsideText","lastOutsideText","resultStartAtIndex","indexes","parseInt","filter","isNaN","finalResulArray","j","info","encodeURIComponent","yandexService","lang","startsWith","bingService","id","translations","language","parser","DOMParser","doc","parseFromString","currText","body","childNodes","node","nodeName","textContent","JSON","stringify","replacements","search","deeplService","DeepLTab","waitFirstTranslationResult","listener","sender","sendResponse","action","chrome","runtime","onMessage","removeListener","addListener","setTimeout","tabs","tab","checkedLastError","sendMessage","frameId","create","url","serviceList","translateHTML","twpLang","getAlternativeService","service","translateText","translateSingleText","incognito","source"],"sources":["translationService.js"],"sourcesContent":["\"use strict\";\r\n\r\nconst translationService = (function () {\r\n  const translationService = {};\r\n\r\n  class Utils {\r\n    /**\r\n     * Replace the characters `& < > \" '` with `&amp; &lt; &gt; &quot; &#39;`.\r\n     * @param {string} unsafe\r\n     * @returns {string} escapedString\r\n     */\r\n    static escapeHTML(unsafe) {\r\n      return unsafe\r\n        .replace(/\\&/g, \"&amp;\")\r\n        .replace(/\\</g, \"&lt;\")\r\n        .replace(/\\>/g, \"&gt;\")\r\n        .replace(/\\\"/g, \"&quot;\")\r\n        .replace(/\\'/g, \"&#39;\");\r\n    }\r\n\r\n    /**\r\n     * Replace the characters `&amp; &lt; &gt; &quot; &#39;` with `& < > \" '`.\r\n     * @param {string} unsafe\r\n     * @returns {string} unescapedString\r\n     */\r\n    static unescapeHTML(unsafe) {\r\n      return unsafe\r\n        .replace(/\\&amp;/g, \"&\")\r\n        .replace(/\\&lt;/g, \"<\")\r\n        .replace(/\\&gt;/g, \">\")\r\n        .replace(/\\&quot;/g, '\"')\r\n        .replace(/\\&\\#39;/g, \"'\");\r\n    }\r\n  }\r\n\r\n  class GoogleHelper {\r\n    static get googleTranslateTKK() {\r\n      return \"448487.932609646\";\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {number} num\r\n     * @param {string} optString\r\n     * @returns {number}\r\n     */\r\n    static shiftLeftOrRightThenSumOrXor(num, optString) {\r\n      for (let i = 0; i < optString.length - 2; i += 3) {\r\n        /** @type {string|number} */\r\n        let acc = optString.charAt(i + 2);\r\n        if (\"a\" <= acc) {\r\n          acc = acc.charCodeAt(0) - 87;\r\n        } else {\r\n          acc = Number(acc);\r\n        }\r\n        if (optString.charAt(i + 1) == \"+\") {\r\n          acc = num >>> acc;\r\n        } else {\r\n          acc = num << acc;\r\n        }\r\n        if (optString.charAt(i) == \"+\") {\r\n          num += acc & 4294967295;\r\n        } else {\r\n          num ^= acc;\r\n        }\r\n      }\r\n      return num;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} query\r\n     * @returns {Array<number>}\r\n     */\r\n    static transformQuery(query) {\r\n      /** @type {Array<number>} */\r\n      const bytesArray = [];\r\n      let idx = 0;\r\n      for (let i = 0; i < query.length; i++) {\r\n        let charCode = query.charCodeAt(i);\r\n\r\n        if (128 > charCode) {\r\n          bytesArray[idx++] = charCode;\r\n        } else {\r\n          if (2048 > charCode) {\r\n            bytesArray[idx++] = (charCode >> 6) | 192;\r\n          } else {\r\n            if (\r\n              55296 == (charCode & 64512) &&\r\n              i + 1 < query.length &&\r\n              56320 == (query.charCodeAt(i + 1) & 64512)\r\n            ) {\r\n              charCode =\r\n                65536 +\r\n                ((charCode & 1023) << 10) +\r\n                (query.charCodeAt(++i) & 1023);\r\n              bytesArray[idx++] = (charCode >> 18) | 240;\r\n              bytesArray[idx++] = ((charCode >> 12) & 63) | 128;\r\n            } else {\r\n              bytesArray[idx++] = (charCode >> 12) | 224;\r\n            }\r\n            bytesArray[idx++] = ((charCode >> 6) & 63) | 128;\r\n          }\r\n          bytesArray[idx++] = (charCode & 63) | 128;\r\n        }\r\n      }\r\n      return bytesArray;\r\n    }\r\n\r\n    /**\r\n     * Calculates the hash (TK) of a query for google translator.\r\n     * @param {string} query\r\n     * @returns {string}\r\n     */\r\n    static calcHash(query) {\r\n      const windowTkk = GoogleHelper.googleTranslateTKK;\r\n      const tkkSplited = windowTkk.split(\".\");\r\n      const tkkIndex = Number(tkkSplited[0]) || 0;\r\n      const tkkKey = Number(tkkSplited[1]) || 0;\r\n\r\n      const bytesArray = GoogleHelper.transformQuery(query);\r\n\r\n      let encondingRound = tkkIndex;\r\n      for (const item of bytesArray) {\r\n        encondingRound += item;\r\n        encondingRound = GoogleHelper.shiftLeftOrRightThenSumOrXor(\r\n          encondingRound,\r\n          \"+-a^+6\"\r\n        );\r\n      }\r\n      encondingRound = GoogleHelper.shiftLeftOrRightThenSumOrXor(\r\n        encondingRound,\r\n        \"+-3^+b+-f\"\r\n      );\r\n\r\n      encondingRound ^= tkkKey;\r\n      if (encondingRound <= 0) {\r\n        encondingRound = (encondingRound & 2147483647) + 2147483648;\r\n      }\r\n\r\n      const normalizedResult = encondingRound % 1000000;\r\n      return normalizedResult.toString() + \".\" + (normalizedResult ^ tkkIndex);\r\n    }\r\n  }\r\n\r\n  class YandexHelper {\r\n    /** @type {number} */\r\n    static #lastRequestSidTime = null;\r\n    /** @type {string} */\r\n    static #translateSid = null;\r\n    /** @type {boolean} */\r\n    static #SIDNotFound = false;\r\n    /** @type {Promise<void>} */\r\n    static #findPromise = null;\r\n\r\n    static get translateSid() {\r\n      return YandexHelper.#translateSid;\r\n    }\r\n\r\n    /**\r\n     * Find the SID of Yandex Translator. The SID value is used in translation requests.\r\n     * @returns {Promise<void>}\r\n     */\r\n    static async findSID() {\r\n      if (YandexHelper.#findPromise) return await YandexHelper.#findPromise;\r\n      YandexHelper.#findPromise = new Promise((resolve) => {\r\n        let updateYandexSid = false;\r\n        if (YandexHelper.#lastRequestSidTime) {\r\n          const date = new Date();\r\n          if (YandexHelper.#translateSid) {\r\n            date.setHours(date.getMinutes() - 30);\r\n          } else if (YandexHelper.#SIDNotFound) {\r\n            date.setMinutes(date.getMinutes() - 5);\r\n          } else {\r\n            date.setMinutes(date.getMinutes() - 2);\r\n          }\r\n          if (date.getTime() > YandexHelper.#lastRequestSidTime) {\r\n            updateYandexSid = true;\r\n          }\r\n        } else {\r\n          updateYandexSid = true;\r\n        }\r\n\r\n        if (updateYandexSid) {\r\n          YandexHelper.#lastRequestSidTime = Date.now();\r\n\r\n          const http = new XMLHttpRequest();\r\n          http.open(\r\n            \"GET\",\r\n            \"https://translate.yandex.net/website-widget/v1/widget.js?widgetId=ytWidget&pageLang=es&widgetTheme=light&autoMode=false\"\r\n          );\r\n          http.send();\r\n          http.onload = (e) => {\r\n            const result = http.responseText.match(/sid\\:\\s\\'[0-9a-f\\.]+/);\r\n            if (result && result[0] && result[0].length > 7) {\r\n              YandexHelper.#translateSid = result[0].substring(6);\r\n              YandexHelper.#SIDNotFound = false;\r\n            } else {\r\n              YandexHelper.#SIDNotFound = true;\r\n            }\r\n            resolve();\r\n          };\r\n          http.onerror =\r\n            http.onabort =\r\n            http.ontimeout =\r\n              (e) => {\r\n                console.error(e);\r\n                resolve();\r\n              };\r\n        } else {\r\n          resolve();\r\n        }\r\n      });\r\n\r\n      YandexHelper.#findPromise.finally(() => {\r\n        YandexHelper.#findPromise = null;\r\n      });\r\n\r\n      return await YandexHelper.#findPromise;\r\n    }\r\n  }\r\n\r\n  class BingHelper {\r\n    /** @type {number} */\r\n    static #lastRequestAuthTime = null;\r\n    /** @type {string} */\r\n    static #translateAuth = null;\r\n    /** @type {boolean} */\r\n    static #AuthNotFound = false;\r\n    /** @type {Promise<void>} */\r\n    static #authPromise = null;\r\n\r\n    static get translateAuth() {\r\n      return BingHelper.#translateAuth;\r\n    }\r\n\r\n    /**\r\n     * Find the SID (IID and IG) of Bing Translator. The SID value is used in translation requests.\r\n     * @returns {Promise<void>}\r\n     */\r\n    static async findAuth() {\r\n      if (BingHelper.#authPromise) return await BingHelper.#authPromise;\r\n\r\n      BingHelper.#authPromise = new Promise((resolve) => {\r\n        let updateBingAuth = false;\r\n        if (BingHelper.#lastRequestAuthTime) {\r\n          const date = new Date();\r\n          if (BingHelper.#translateAuth) {\r\n            date.setHours(date.getMinutes() - 30);\r\n          } else if (BingHelper.#AuthNotFound) {\r\n            date.setMinutes(date.getMinutes() - 5);\r\n          } else {\r\n            date.setMinutes(date.getMinutes() - 2);\r\n          }\r\n          if (date.getTime() > BingHelper.#lastRequestAuthTime) {\r\n            updateBingAuth = true;\r\n          }\r\n        } else {\r\n          updateBingAuth = true;\r\n        }\r\n\r\n        if (updateBingAuth) {\r\n          BingHelper.#lastRequestAuthTime = Date.now();\r\n\r\n          const http = new XMLHttpRequest();\r\n          http.open(\"GET\", \"https://edge.microsoft.com/translate/auth\");\r\n          http.send();\r\n          http.onload = (e) => {\r\n            if (http.responseText && http.responseText.length > 1) {\r\n              BingHelper.#translateAuth = http.responseText;\r\n              BingHelper.#AuthNotFound = false;\r\n            } else {\r\n              BingHelper.#AuthNotFound = true;\r\n            }\r\n            resolve();\r\n          };\r\n          http.onerror =\r\n            http.onabort =\r\n            http.ontimeout =\r\n              (e) => {\r\n                console.error(e);\r\n                resolve();\r\n              };\r\n        } else {\r\n          resolve();\r\n        }\r\n      });\r\n\r\n      BingHelper.#authPromise.finally(() => {\r\n        BingHelper.#authPromise = null;\r\n      });\r\n\r\n      return await BingHelper.#authPromise;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a string with additional parameters to be concatenated to the request URL.\r\n   * @callback callback_cbParameters\r\n   * @param {string} sourceLanguage\r\n   * @param {string} targetLanguage\r\n   * @param {Array<TranslationInfo>} requests\r\n   * @returns {string}\r\n   */\r\n\r\n  /**\r\n   * Takes `sourceArray` and returns a request string to the translation service.\r\n   * @callback callback_cbTransformRequest\r\n   * @param {string[]} sourceArray\r\n   * @returns {string}\r\n   */\r\n\r\n  /**\r\n   * @typedef {{text: string, detectedLanguage: string}} Service_Single_Result_Response\r\n   */\r\n\r\n  /**\r\n   * Receives the response from the *http request* and returns `Service_Single_Result_Response[]`.\r\n   *\r\n   * Returns a string with the body of a request of type **POST**.\r\n   * @callback callback_cbParseResponse\r\n   * @param {Object} response\r\n   * @returns {Array<Service_Single_Result_Response>}\r\n   */\r\n\r\n  /**\r\n   * Takes a string formatted with the translated text and returns a `resultArray`.\r\n   * @callback callback_cbTransformResponse\r\n   * @param {String} response\r\n   * @param {boolean} dontSortResults\r\n   * @returns {string[]} resultArray\r\n   */\r\n\r\n  /**\r\n   * Return extra headers for the request.\r\n   * @callback callback_cbGetExtraHeaders\r\n   * @returns {Array<{name: string, value: string}>} headers\r\n   */\r\n\r\n  /** @typedef {\"complete\" | \"translating\" | \"error\"} TranslationStatus */\r\n  /**\r\n   * @typedef {Object} TranslationInfo\r\n   * @property {String} originalText\r\n   * @property {String} translatedText\r\n   * @property {String} detectedLanguage\r\n   * @property {TranslationStatus} status\r\n   * @property {Promise<void>} waitTranlate\r\n   */\r\n\r\n  /**\r\n   * Base class to create new translation services.\r\n   */\r\n  class Service {\r\n    /**\r\n     * Initializes the **Service** class with information about the new translation service.\r\n     * @param {string} serviceName\r\n     * @param {string} baseURL\r\n     * @param {\"GET\" | \"POST\"} xhrMethod\r\n     * @param {callback_cbTransformRequest} cbTransformRequest Takes `sourceArray` and returns a request string to the translation service.\r\n     * @param {callback_cbParseResponse} cbParseResponse Receives the response from the *http request* and returns `Service_Single_Result_Response[]`.\r\n     * @param {callback_cbTransformResponse} cbTransformResponse Takes a string formatted with the translated text and returns a `resultArray`.\r\n     * @param {callback_cbParameters} cbGetExtraParameters Returns a string with additional parameters to be concatenated to the request URL.\r\n     * @param {callback_cbParameters} cbGetRequestBody Returns a string with the body of a request of type **POST**.\r\n     * @param {callback_cbGetExtraHeaders} cbGetExtraHeaders Return extra headers for the request.\r\n     */\r\n    constructor(\r\n      serviceName,\r\n      baseURL,\r\n      xhrMethod = \"GET\",\r\n      cbTransformRequest,\r\n      cbParseResponse,\r\n      cbTransformResponse,\r\n      cbGetExtraParameters = null,\r\n      cbGetRequestBody = null,\r\n      cbGetExtraHeaders = null\r\n    ) {\r\n      this.serviceName = serviceName;\r\n      this.baseURL = baseURL;\r\n      this.xhrMethod = xhrMethod;\r\n      this.cbTransformRequest = cbTransformRequest;\r\n      this.cbParseResponse = cbParseResponse;\r\n      this.cbTransformResponse = cbTransformResponse;\r\n      this.cbGetExtraParameters = cbGetExtraParameters;\r\n      this.cbGetRequestBody = cbGetRequestBody;\r\n      this.cbGetExtraHeaders = cbGetExtraHeaders;\r\n\r\n      /**\r\n       * @type {Map<string, TranslationInfo>}\r\n       *\r\n       * It works as an in-memory translation cache.\r\n       * Ensures that two identical requests share the same `XMLHttpRequest`.\r\n       * */\r\n      this.translationsInProgress = new Map();\r\n    }\r\n\r\n    /**\r\n     * Removes all translations with `status` **error** and are in `translationsInProgress`.\r\n     *\r\n     * Sometimes there is a device translation error due to internet connection problems.\r\n     * Clearing translationsInProgress ensures that the translation will be retried.\r\n     */\r\n    removeTranslationsWithError() {\r\n      this.translationsInProgress.forEach((transInfo, key) => {\r\n        if (transInfo.status === \"error\") {\r\n          this.translationsInProgress.delete(key);\r\n        }\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Receives the `sourceArray2d` parameter and prepares the requests.\r\n     * Calls `cbTransformRequest` for each `sourceArray` of `sourceArray2d`.\r\n     * The `currentTranslationsInProgress` array will be the **final result** with requests already completed or in progress. And the `requests` array will only contain the new requests that need to be made.\r\n     *\r\n     * Checks if there is already an identical request in progress or if it is already in the translation cache.\r\n     * If it doesn't exist, add it to `requests` to make a new *http request*.\r\n     *\r\n     * Requests longer than **800 characters** will be split into new requests.\r\n     * @param {string} sourceLanguage\r\n     * @param {string} targetLanguage\r\n     * @param {Array<string[]>} sourceArray2d\r\n     * @returns {Promise<[Array<TranslationInfo[]>, TranslationInfo[]]>} `requests`, `currentTranslationsInProgress`\r\n     */\r\n    async getRequests(sourceLanguage, targetLanguage, sourceArray2d) {\r\n      /** @type {Array<TranslationInfo[]>} */\r\n      const requests = [];\r\n      /** @type {TranslationInfo[]} */\r\n      const currentTranslationsInProgress = [];\r\n\r\n      let currentRequest = [];\r\n      let currentSize = 0;\r\n\r\n      for (const sourceArray of sourceArray2d) {\r\n        const requestString = this.fixString(\r\n          this.cbTransformRequest(sourceArray)\r\n        );\r\n        const requestHash = [\r\n          sourceLanguage,\r\n          targetLanguage,\r\n          requestString,\r\n        ].join(\", \");\r\n\r\n        const progressInfo = this.translationsInProgress.get(requestHash);\r\n        if (progressInfo) {\r\n          currentTranslationsInProgress.push(progressInfo);\r\n        } else {\r\n          /** @type {TranslationStatus} */\r\n          let status = \"translating\";\r\n          /** @type {() => void} */\r\n          let promise_resolve = null;\r\n\r\n          /** @type {TranslationInfo} */\r\n          const progressInfo = {\r\n            originalText: requestString,\r\n            translatedText: null,\r\n            detectedLanguage: null,\r\n            get status() {\r\n              return status;\r\n            },\r\n            set status(_status) {\r\n              status = _status;\r\n              promise_resolve();\r\n            },\r\n            waitTranlate: new Promise((resolve) => (promise_resolve = resolve)),\r\n          };\r\n\r\n          currentTranslationsInProgress.push(progressInfo);\r\n          this.translationsInProgress.set(requestHash, progressInfo);\r\n\r\n          //cast\r\n          const cacheEntry = await translationCache.get(\r\n            this.serviceName,\r\n            sourceLanguage,\r\n            targetLanguage,\r\n            requestString\r\n          );\r\n          if (cacheEntry) {\r\n            progressInfo.translatedText = cacheEntry.translatedText;\r\n            progressInfo.detectedLanguage = cacheEntry.detectedLanguage;\r\n            progressInfo.status = \"complete\";\r\n            //this.translationsInProgress.delete([sourceLanguage, targetLanguage, requestString])\r\n          } else {\r\n            currentRequest.push(progressInfo);\r\n            currentSize += progressInfo.originalText.length;\r\n            if (currentSize > 800) {\r\n              requests.push(currentRequest);\r\n              currentSize = 0;\r\n              currentRequest = [];\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if (currentRequest.length > 0) {\r\n        requests.push(currentRequest);\r\n        currentRequest = [];\r\n        currentSize = 0;\r\n      }\r\n\r\n      return [requests, currentTranslationsInProgress];\r\n    }\r\n\r\n    /**\r\n     * Makes a request using the *XMLHttpRequest* API. Returns a promise that will be resolved with the result of the request. If the request fails, the promise will be rejected.\r\n     * @param {string} sourceLanguage\r\n     * @param {string} targetLanguage\r\n     * @param {Array<TranslationInfo>} requests\r\n     * @returns {Promise<*>}\r\n     */\r\n    async makeRequest(sourceLanguage, targetLanguage, requests) {\r\n      return await new Promise((resolve, reject) => {\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.open(\r\n          this.xhrMethod,\r\n          this.baseURL +\r\n            (this.cbGetExtraParameters\r\n              ? this.cbGetExtraParameters(\r\n                  sourceLanguage,\r\n                  targetLanguage,\r\n                  requests\r\n                )\r\n              : \"\")\r\n        );\r\n\r\n        if (this.cbGetExtraHeaders) {\r\n          const headers = this.cbGetExtraHeaders();\r\n          headers.forEach((header) => {\r\n            xhr.setRequestHeader(header.name, header.value);\r\n          });\r\n        }\r\n\r\n        xhr.responseType = \"json\";\r\n\r\n        xhr.onload = (event) => {\r\n          resolve(xhr.response);\r\n        };\r\n\r\n        xhr.onerror =\r\n          xhr.onabort =\r\n          xhr.ontimeout =\r\n            (event) => {\r\n              console.error(event);\r\n              reject();\r\n            };\r\n\r\n        xhr.send(\r\n          this.cbGetExtraParameters\r\n            ? this.cbGetRequestBody(sourceLanguage, targetLanguage, requests)\r\n            : undefined\r\n        );\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Translates the `sourceArray2d`.\r\n     *\r\n     * If `dontSaveInPersistentCache` is **true** then the translation result will not be saved in the on-disk translation cache, only in the in-memory cache.\r\n     *\r\n     * The `dontSortResults` parameter is only valid when using the ***google*** translation service, if its value is **true** then the translation result will not be sorted.\r\n     * @param {string} sourceLanguage\r\n     * @param {string} targetLanguage\r\n     * @param {Array<string[]>} sourceArray2d\r\n     * @param {boolean} dontSaveInPersistentCache\r\n     * @param {boolean} dontSortResults\r\n     * @returns {Promise<string[][]>}\r\n     */\r\n    async translate(\r\n      sourceLanguage,\r\n      targetLanguage,\r\n      sourceArray2d,\r\n      dontSaveInPersistentCache = false,\r\n      dontSortResults = false\r\n    ) {\r\n      const [requests, currentTranslationsInProgress] = await this.getRequests(\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        sourceArray2d\r\n      );\r\n      /** @type {Promise<void>[]} */\r\n      const promises = [];\r\n\r\n      for (const request of requests) {\r\n        promises.push(\r\n          this.makeRequest(sourceLanguage, targetLanguage, request)\r\n            .then((response) => {\r\n              const results = this.cbParseResponse(response);\r\n              for (const idx in request) {\r\n                const result = results[idx];\r\n                this.cbTransformResponse(result.text, dontSortResults); // apenas para gerar error\r\n                const transInfo = request[idx];\r\n                transInfo.detectedLanguage = result.detectedLanguage || \"und\";\r\n                transInfo.translatedText = result.text;\r\n                transInfo.status = \"complete\";\r\n\r\n                if (\r\n                  dontSaveInPersistentCache === false &&\r\n                  transInfo.translatedText\r\n                ) {\r\n                  translationCache.set(\r\n                    this.serviceName,\r\n                    sourceLanguage,\r\n                    targetLanguage,\r\n                    transInfo.originalText,\r\n                    transInfo.translatedText,\r\n                    transInfo.detectedLanguage\r\n                  );\r\n                }\r\n              }\r\n            })\r\n            .catch((e) => {\r\n              console.error(e);\r\n              for (const transInfo of request) {\r\n                transInfo.status = \"error\";\r\n                //this.translationsInProgress.delete([sourceLanguage, targetLanguage, transInfo.originalText])\r\n              }\r\n            })\r\n        );\r\n      }\r\n      await Promise.all(\r\n        currentTranslationsInProgress.map((transInfo) => transInfo.waitTranlate)\r\n      );\r\n      return currentTranslationsInProgress.map((transInfo) =>\r\n        this.cbTransformResponse(transInfo.translatedText, dontSortResults)\r\n      );\r\n    }\r\n\r\n    /**\r\n     * https://github.com/FilipePS/Traduzir-paginas-web/issues/484\r\n     * @param {string} str\r\n     * @returns {string} fixedStr\r\n     */\r\n    fixString(str) {\r\n      return str.replace(/\\u200b/g, \" \");\r\n    }\r\n  }\r\n\r\n  const googleService = new (class extends Service {\r\n    constructor() {\r\n      super(\r\n        \"google\",\r\n        \"https://translate.googleapis.com/translate_a/t?anno=3&client=te&v=1.0&format=html\",\r\n        \"POST\",\r\n        function cbTransformRequest(sourceArray) {\r\n          sourceArray = sourceArray.map((text) => Utils.escapeHTML(text));\r\n          if (sourceArray.length > 1) {\r\n            sourceArray = sourceArray.map(\r\n              (text, index) => `<a i=${index}>${text}</a>`\r\n            );\r\n          }\r\n          // the <pre> tag is to preserve the text formating\r\n          return `<pre>${sourceArray.join(\"\")}</pre>`;\r\n        },\r\n        function cbParseResponse(response) {\r\n          /** @type {[Service_Single_Result_Response]} */\r\n          let responseJson;\r\n          if (typeof response === \"string\") {\r\n            responseJson = [{ text: response, detectedLanguage: null }];\r\n          } else if (typeof response[0] === \"string\") {\r\n            responseJson = response.map(\r\n              /** @returns {Service_Single_Result_Response} */ (\r\n                /** @type {string} */ value\r\n              ) => ({ text: value, detectedLanguage: null })\r\n            );\r\n          } else {\r\n            responseJson = response.map(\r\n              /** @returns {Service_Single_Result_Response} */ (\r\n                /** @type {[string, string]} */ value\r\n              ) => ({ text: value[0], detectedLanguage: value[1] })\r\n            );\r\n          }\r\n          return responseJson;\r\n        },\r\n        function cbTransformResponse(result, dontSortResults) {\r\n          // remove the <pre> tag from the response\r\n          if (result.indexOf(\"<pre\") !== -1) {\r\n            result = result.replace(\"</pre>\", \"\");\r\n            const index = result.indexOf(\">\");\r\n            result = result.slice(index + 1);\r\n          }\r\n\r\n          /** @type {string[]} */\r\n          const sentences = []; // each translated sentence is inside of <b> tag\r\n\r\n          // The main objective is to remove the original text of each sentense that is inside the <i> tags.\r\n          // Keeping only the <a> tags\r\n          let idx = 0;\r\n          while (true) {\r\n            // each translated sentence is inside of <b> tag\r\n            const sentenceStartIndex = result.indexOf(\"<b>\", idx);\r\n            if (sentenceStartIndex === -1) break;\r\n\r\n            // the <i> tag is the original text in each sentence\r\n            const sentenceFinalIndex = result.indexOf(\r\n              \"<i>\",\r\n              sentenceStartIndex\r\n            );\r\n\r\n            if (sentenceFinalIndex === -1) {\r\n              sentences.push(result.slice(sentenceStartIndex + 3));\r\n              break;\r\n            } else {\r\n              sentences.push(\r\n                result.slice(sentenceStartIndex + 3, sentenceFinalIndex)\r\n              );\r\n            }\r\n            idx = sentenceFinalIndex;\r\n          }\r\n\r\n          // maybe the response don't have any sentence (does not have <i> and <b> tags), is this case just use de result\r\n          result = sentences.length > 0 ? sentences.join(\" \") : result;\r\n          // Remove the remaining </b> tags (usually the last)\r\n          result = result.replace(/\\<\\/b\\>/g, \"\");\r\n          // Capture each <a i={number}> and put it in an array, the </a> will be ignored\r\n          // maybe the same index appears several times\r\n          // maybe some text will be outside of <a i={number}> (Usually text before the first <a> tag, and some whitespace between the <a> tags),\r\n          // in this case, The outside text will be placed inside the <a i={number}> closer\r\n          // https://github.com/FilipePS/Traduzir-paginas-web/issues/449\r\n          // TODO lidar com tags dentro de tags e tags vazias\r\n          // https://de.wikipedia.org/wiki/Wikipedia:Hauptseite\r\n          // \"{\\\"originalText\\\":\\\"<pre><a i=0>\\\\nFür den </a><a i=1>37. Schreib­wettbewerb</a><a i=2> und den </a><a i=3>18. Miniaturwettbewerb</a><a i=4> können ab sofort Artikel nominiert werden.</a></pre>\\\",\\\"translatedText\\\":\\\"<pre><a i=0>\\\\n</a>Artigos já podem ser indicados <a i=0>para o</a> <a i=1>37º Concurso de Redação <a i=2>e</a></a> <a i=3><a i=4>18º</a> Concurso de Miniaturas</a> .</pre>\\\",\\\"detectedLanguage\\\":\\\"de\\\",\\\"status\\\":\\\"complete\\\",\\\"waitTranlate\\\":{}}\"\r\n          let resultArray = [];\r\n          let lastEndPos = 0;\r\n          for (const r of result.matchAll(\r\n            /(\\<a\\si\\=[0-9]+\\>)([^\\<\\>]*(?=\\<\\/a\\>))*/g\r\n          )) {\r\n            const fullText = r[0];\r\n            const fullLength = r[0].length;\r\n            const pos = r.index;\r\n            // if it is bigger then it has text outside the tags\r\n            if (pos > lastEndPos) {\r\n              const aTag = r[1];\r\n              const insideText = r[2] || \"\";\r\n              const outsideText = result\r\n                .slice(lastEndPos, pos)\r\n                .replace(/\\<\\/a\\>/g, \"\");\r\n              resultArray.push(aTag + outsideText + insideText);\r\n            } else {\r\n              resultArray.push(fullText);\r\n            }\r\n            lastEndPos = pos + fullLength;\r\n          }\r\n          // captures the final text outside the <a> tag\r\n          {\r\n            const lastOutsideText = result\r\n              .slice(lastEndPos)\r\n              .replace(/\\<\\/a\\>/g, \"\");\r\n            if (resultArray.length > 0) {\r\n              resultArray[resultArray.length - 1] += lastOutsideText;\r\n            }\r\n          }\r\n          // this is the old method, don't capture text outside of <a> tags\r\n          // let resultArray = result.match(\r\n          //   /\\<a\\si\\=[0-9]+\\>[^\\<\\>]*(?=\\<\\/a\\>)/g\r\n          // );\r\n\r\n          if (dontSortResults) {\r\n            // Should not sort the <a i={number}> of Google Translate result\r\n            // Instead of it, join the texts without sorting\r\n            // https://github.com/FilipePS/Traduzir-paginas-web/issues/163\r\n\r\n            if (resultArray && resultArray.length > 0) {\r\n              // get the text inside of <a i={number}>\r\n              // the indexes is not needed in this case\r\n              resultArray = resultArray.map((value) => {\r\n                const resultStartAtIndex = value.indexOf(\">\");\r\n                return value.slice(resultStartAtIndex + 1);\r\n              });\r\n            } else {\r\n              // maybe the response don't have any <a i={number}>\r\n              resultArray = [result];\r\n            }\r\n\r\n            // unescapeHTML\r\n            resultArray = resultArray.map((value) => Utils.unescapeHTML(value));\r\n\r\n            return resultArray;\r\n          } else {\r\n            // Sort Google translate results to keep the links with the correct name\r\n            // Note: the links may also disappear; http://web.archive.org/web/20220919162911/https://de.wikipedia.org/wiki/Wikipedia:Hauptseite\r\n            // each inline tag has a index starting with 0 <a i={number}>\r\n            let indexes;\r\n            if (resultArray && resultArray.length > 0) {\r\n              // get the indexed of <a i={number}>\r\n              indexes = resultArray\r\n                .map((value) => parseInt(value.match(/[0-9]+(?=\\>)/g)[0]))\r\n                .filter((value) => !isNaN(value));\r\n              // get the text inside of <a i={number}>\r\n              resultArray = resultArray.map((value) => {\r\n                const resultStartAtIndex = value.indexOf(\">\");\r\n                return value.slice(resultStartAtIndex + 1);\r\n              });\r\n            } else {\r\n              // maybe the response don't have any <a i={number}>\r\n              resultArray = [result];\r\n              indexes = [0];\r\n            }\r\n\r\n            // unescapeHTML\r\n            resultArray = resultArray.map((value) => Utils.unescapeHTML(value));\r\n\r\n            /** @type {string[]} */\r\n            const finalResulArray = [];\r\n            // sorte de results and put in finalResulArray\r\n            for (const j in indexes) {\r\n              if (finalResulArray[indexes[j]]) {\r\n                finalResulArray[indexes[j]] += \" \" + resultArray[j];\r\n              } else {\r\n                finalResulArray[indexes[j]] = resultArray[j];\r\n              }\r\n            }\r\n\r\n            return finalResulArray;\r\n          }\r\n        },\r\n        function cbGetExtraParameters(\r\n          sourceLanguage,\r\n          targetLanguage,\r\n          requests\r\n        ) {\r\n          return `&sl=${sourceLanguage}&tl=${targetLanguage}&tk=${GoogleHelper.calcHash(\r\n            requests.map((info) => info.originalText).join(\"\")\r\n          )}`;\r\n        },\r\n        function cbGetRequestBody(sourceLanguage, targetLanguage, requests) {\r\n          return requests\r\n            .map((info) => `&q=${encodeURIComponent(info.originalText)}`)\r\n            .join(\"\");\r\n        },\r\n        function cbGetExtraHeaders() {\r\n          return [\r\n            {\r\n              name: \"Content-Type\",\r\n              value: \"application/x-www-form-urlencoded\",\r\n            },\r\n          ];\r\n        }\r\n      );\r\n    }\r\n  })();\r\n\r\n  const yandexService = new (class extends Service {\r\n    constructor() {\r\n      super(\r\n        \"yandex\",\r\n        \"https://translate.yandex.net/api/v1/tr.json/translate?srv=tr-url-widget\",\r\n        \"GET\",\r\n        function cbTransformRequest(sourceArray) {\r\n          return sourceArray\r\n            .map((value) => Utils.escapeHTML(value))\r\n            .join(\"<wbr>\");\r\n        },\r\n        function cbParseResponse(response) {\r\n          const lang = response.lang;\r\n          const detectedLanguage = lang ? lang.split(\"-\")[0] : null;\r\n          return response.text.map(\r\n            /** @return {Service_Single_Result_Response} */ (\r\n              /** @type {string} */ text\r\n            ) => ({ text, detectedLanguage })\r\n          );\r\n        },\r\n        function cbTransformResponse(result, dontSortResults) {\r\n          return result\r\n            .split(\"<wbr>\")\r\n            .map((value) => Utils.unescapeHTML(value));\r\n        },\r\n        function cbGetExtraParameters(\r\n          sourceLanguage,\r\n          targetLanguage,\r\n          requests\r\n        ) {\r\n          return `&id=${YandexHelper.translateSid}-0-0&format=html&lang=${\r\n            sourceLanguage === \"auto\" ? \"\" : sourceLanguage + \"-\"\r\n          }${targetLanguage}${requests\r\n            .map((info) => `&text=${encodeURIComponent(info.originalText)}`)\r\n            .join(\"\")}`;\r\n        },\r\n        function cbGetRequestBody(sourceLanguage, targetLanguage, requests) {\r\n          return undefined;\r\n        },\r\n        function cbGetExtraHeaders() {\r\n          return [\r\n            {\r\n              name: \"Content-Type\",\r\n              value: \"application/x-www-form-urlencoded\",\r\n            },\r\n          ];\r\n        }\r\n      );\r\n    }\r\n\r\n    /**\r\n     * @param {boolean} dontSortResults This parameter is not needed in this translation service\r\n     */\r\n    async translate(\r\n      sourceLanguage,\r\n      targetLanguage,\r\n      sourceArray2d,\r\n      dontSaveInPersistentCache,\r\n      dontSortResults = false\r\n    ) {\r\n      await YandexHelper.findSID();\r\n      if (!YandexHelper.translateSid) return;\r\n      if (sourceLanguage.startsWith(\"zh\")) sourceLanguage = \"zh\";\r\n      if (targetLanguage.startsWith(\"zh\")) targetLanguage = \"zh\";\r\n      return await super.translate(\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        sourceArray2d,\r\n        dontSaveInPersistentCache,\r\n        dontSortResults\r\n      );\r\n    }\r\n  })();\r\n\r\n  const bingService = new (class extends Service {\r\n    constructor() {\r\n      super(\r\n        \"bing\",\r\n        \"https://api-edge.cognitive.microsofttranslator.com/translate?api-version=3.0&includeSentenceLength=true\",\r\n        \"POST\",\r\n        function cbTransformRequest(sourceArray) {\r\n          let id = 10;\r\n          return sourceArray\r\n            .map((value) => {\r\n              const r = `<b${id}>${Utils.escapeHTML(value)}</b${id}>`;\r\n              id++;\r\n              return r;\r\n            })\r\n            .join(\"\");\r\n        },\r\n        function cbParseResponse(response) {\r\n          return response.map(\r\n            /** @return {Service_Single_Result_Response} */\r\n            (/** @type {object} */ r) => ({\r\n              text: r.translations[0].text,\r\n              detectedLanguage: r.detectedLanguage?.language,\r\n            })\r\n          );\r\n        },\r\n        function cbTransformResponse(result, dontSortResults) {\r\n          const resultArray = []\r\n\r\n          const parser = new DOMParser();\r\n          const doc = parser.parseFromString(result, \"text/html\");\r\n          let currText = \"\"\r\n          doc.body.childNodes.forEach((node) => {\r\n            if (dontSortResults) {\r\n              if (node.nodeName == \"#text\") {\r\n                currText += node.textContent\r\n              } else {\r\n                resultArray.push(currText + node.textContent);\r\n                currText = \"\"\r\n              }\r\n            } else {\r\n              if (node.nodeName == \"#text\") {\r\n                currText += node.textContent\r\n              } else {\r\n                const id = parseInt(node.nodeName.slice(1)) - 10\r\n                resultArray[id] = currText + node.textContent;\r\n                currText = \"\"\r\n              }\r\n            }\r\n          });\r\n\r\n          return resultArray;\r\n        },\r\n        function cbGetExtraParameters(\r\n          sourceLanguage,\r\n          targetLanguage,\r\n          requests\r\n        ) {\r\n          return `${\r\n            sourceLanguage !== \"auto-detect\" ? \"&from=\" + sourceLanguage : \"\"\r\n          }&to=${targetLanguage}`;\r\n        },\r\n        function cbGetRequestBody(sourceLanguage, targetLanguage, requests) {\r\n          return JSON.stringify(\r\n            requests.map((info) => ({\r\n              text: info.originalText,\r\n            }))\r\n          );\r\n        },\r\n        function cbGetExtraHeaders() {\r\n          return [\r\n            {\r\n              name: \"Content-Type\",\r\n              value: \"application/json\",\r\n            },\r\n            {\r\n              name: \"authorization\",\r\n              value: \"Bearer \" + BingHelper.translateAuth,\r\n            },\r\n          ];\r\n        }\r\n      );\r\n    }\r\n\r\n    /**\r\n     * @param {string[][]} sourceArray2d - Only the string `sourceArray2d[0][0]` will be translated.\r\n     * @param {boolean} dontSortResults - This parameter is not needed in this translation service\r\n     */\r\n    async translate(\r\n      sourceLanguage,\r\n      targetLanguage,\r\n      sourceArray2d,\r\n      dontSaveInPersistentCache,\r\n      dontSortResults = false\r\n    ) {\r\n      /** @type {{search: string, replace: string}[]} */\r\n      const replacements = [\r\n        {\r\n          search: \"auto\",\r\n          replace: \"auto-detect\",\r\n        },\r\n        {\r\n          search: \"zh-CN\",\r\n          replace: \"zh-Hans\",\r\n        },\r\n        {\r\n          search: \"zh-TW\",\r\n          replace: \"zh-Hant\",\r\n        },\r\n        {\r\n          search: \"tl\",\r\n          replace: \"fil\",\r\n        },\r\n        {\r\n          search: \"hmn\",\r\n          replace: \"mww\",\r\n        },\r\n        {\r\n          search: \"ckb\",\r\n          replace: \"kmr\",\r\n        },\r\n        {\r\n          search: \"mn\",\r\n          replace: \"mn-Cyrl\",\r\n        },\r\n        {\r\n          search: \"no\",\r\n          replace: \"nb\",\r\n        },\r\n        {\r\n          search: \"sr\",\r\n          replace: \"sr-Cyrl\",\r\n        },\r\n      ];\r\n      replacements.forEach((r) => {\r\n        if (targetLanguage === r.search) {\r\n          targetLanguage = r.replace;\r\n        }\r\n        if (sourceLanguage === r.search) {\r\n          sourceLanguage = r.replace;\r\n        }\r\n      });\r\n\r\n      await BingHelper.findAuth();\r\n      if (!BingHelper.translateAuth) return;\r\n\r\n      return await super.translate(\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        sourceArray2d,\r\n        dontSaveInPersistentCache,\r\n        dontSortResults\r\n      );\r\n    }\r\n  })();\r\n\r\n  const deeplService = new (class {\r\n    constructor() {\r\n      this.DeepLTab = null;\r\n    }\r\n    /**\r\n     *\r\n     * @param {string} sourceLanguage - This parameter is not used\r\n     * @param {*} targetLanguage\r\n     * @param {*} sourceArray2d - Only the string `sourceArray2d[0][0]` will be translated.\r\n     * @param {*} dontSaveInPersistentCache - This parameter is not used\r\n     * @param {*} dontSortResults - This parameter is not used\r\n     * @returns\r\n     */\r\n    async translate(\r\n      sourceLanguage,\r\n      targetLanguage,\r\n      sourceArray2d,\r\n      dontSaveInPersistentCache,\r\n      dontSortResults = false\r\n    ) {\r\n      return await new Promise((resolve) => {\r\n        const waitFirstTranslationResult = () => {\r\n          const listener = (request, sender, sendResponse) => {\r\n            if (request.action === \"DeepL_firstTranslationResult\") {\r\n              resolve([[request.result]]);\r\n              chrome.runtime.onMessage.removeListener(listener);\r\n            }\r\n          };\r\n          chrome.runtime.onMessage.addListener(listener);\r\n\r\n          setTimeout(() => {\r\n            chrome.runtime.onMessage.removeListener(listener);\r\n            resolve([[\"\"]]);\r\n          }, 8000);\r\n        };\r\n\r\n        if (this.DeepLTab) {\r\n          chrome.tabs.get(this.DeepLTab.id, (tab) => {\r\n            checkedLastError();\r\n            if (tab) {\r\n              //chrome.tabs.update(tab.id, {active: true})\r\n              chrome.tabs.sendMessage(\r\n                tab.id,\r\n                {\r\n                  action: \"translateTextWithDeepL\",\r\n                  text: sourceArray2d[0][0],\r\n                  targetLanguage,\r\n                },\r\n                {\r\n                  frameId: 0,\r\n                },\r\n                (response) => {\r\n                  checkedLastError();\r\n                  resolve([[response]]);\r\n                }\r\n              );\r\n            } else {\r\n              chrome.tabs.create(\r\n                {\r\n                  url: `https://www.deepl.com/#!${targetLanguage}!#${encodeURIComponent(\r\n                    sourceArray2d[0][0]\r\n                  )}`,\r\n                },\r\n                (tab) => {\r\n                  this.DeepLTab = tab;\r\n                  waitFirstTranslationResult();\r\n                }\r\n              );\r\n              // resolve([[\"\"]])\r\n            }\r\n          });\r\n        } else {\r\n          chrome.tabs.create(\r\n            {\r\n              url: `https://www.deepl.com/#!${targetLanguage}!#${encodeURIComponent(\r\n                sourceArray2d[0][0]\r\n              )}`,\r\n            },\r\n            (tab) => {\r\n              this.DeepLTab = tab;\r\n              waitFirstTranslationResult();\r\n            }\r\n          );\r\n          // resolve([[\"\"]])\r\n        }\r\n      });\r\n    }\r\n  })();\r\n\r\n  /** @type {Map<string, Service>} */\r\n  const serviceList = new Map();\r\n\r\n  serviceList.set(\"google\", googleService);\r\n  serviceList.set(\"yandex\", yandexService);\r\n  serviceList.set(\"bing\", bingService);\r\n  serviceList.set(\r\n    \"deepl\",\r\n    /** @type {Service} */ /** @type {?} */ (deeplService)\r\n  );\r\n\r\n  translationService.translateHTML = async (\r\n    serviceName,\r\n    sourceLanguage,\r\n    targetLanguage,\r\n    sourceArray2d,\r\n    dontSaveInPersistentCache = false,\r\n    dontSortResults = false\r\n  ) => {\r\n    serviceName = twpLang.getAlternativeService(\r\n      targetLanguage,\r\n      serviceName,\r\n      true\r\n    );\r\n    const service = serviceList.get(serviceName) || serviceList.get(\"google\");\r\n    return await service.translate(\r\n      sourceLanguage,\r\n      targetLanguage,\r\n      sourceArray2d,\r\n      dontSaveInPersistentCache,\r\n      dontSortResults\r\n    );\r\n  };\r\n\r\n  translationService.translateText = async (\r\n    serviceName,\r\n    sourceLanguage,\r\n    targetLanguage,\r\n    sourceArray,\r\n    dontSaveInPersistentCache = false\r\n  ) => {\r\n    serviceName = twpLang.getAlternativeService(\r\n      targetLanguage,\r\n      serviceName,\r\n      false\r\n    );\r\n    const service = serviceList.get(serviceName) || serviceList.get(\"google\");\r\n    return (\r\n      await service.translate(\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        [sourceArray],\r\n        dontSaveInPersistentCache\r\n      )\r\n    )[0];\r\n  };\r\n\r\n  translationService.translateSingleText = async (\r\n    serviceName,\r\n    sourceLanguage,\r\n    targetLanguage,\r\n    originalText,\r\n    dontSaveInPersistentCache = false\r\n  ) => {\r\n    serviceName = twpLang.getAlternativeService(\r\n      targetLanguage,\r\n      serviceName,\r\n      false\r\n    );\r\n    const service = serviceList.get(serviceName) || serviceList.get(\"google\");\r\n    return (\r\n      await service.translate(\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        [[originalText]],\r\n        dontSaveInPersistentCache\r\n      )\r\n    )[0][0];\r\n  };\r\n\r\n  chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\r\n    // If the translation request came from an incognito window, the translation should not be cached on disk.\r\n    const dontSaveInPersistentCache = sender.tab ? sender.tab.incognito : false;\r\n    if (request.action === \"translateHTML\") {\r\n      translationService\r\n        .translateHTML(\r\n          request.translationService,\r\n          \"auto\",\r\n          request.targetLanguage,\r\n          request.sourceArray2d,\r\n          dontSaveInPersistentCache,\r\n          request.dontSortResults\r\n        )\r\n        .then((results) => sendResponse(results))\r\n        .catch((e) => {\r\n          sendResponse();\r\n          console.error(e);\r\n        });\r\n\r\n      return true;\r\n    } else if (request.action === \"translateText\") {\r\n      translationService\r\n        .translateText(\r\n          request.translationService,\r\n          \"auto\",\r\n          request.targetLanguage,\r\n          request.sourceArray,\r\n          dontSaveInPersistentCache\r\n        )\r\n        .then((results) => sendResponse(results))\r\n        .catch((e) => {\r\n          sendResponse();\r\n          console.error(e);\r\n        });\r\n\r\n      return true;\r\n    } else if (request.action === \"translateSingleText\") {\r\n      translationService\r\n        .translateSingleText(\r\n          request.translationService,\r\n          \"auto\",\r\n          request.targetLanguage,\r\n          request.source,\r\n          dontSaveInPersistentCache\r\n        )\r\n        .then((results) => sendResponse(results))\r\n        .catch((e) => {\r\n          sendResponse();\r\n          console.error(e);\r\n        });\r\n\r\n      return true;\r\n    } else if (request.action === \"removeTranslationsWithError\") {\r\n      serviceList.forEach((service) => {\r\n        if (service.removeTranslationsWithError) {\r\n          service.removeTranslationsWithError();\r\n        }\r\n      });\r\n    }\r\n  });\r\n\r\n  return translationService;\r\n})();\r\n"],"mappings":"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"}
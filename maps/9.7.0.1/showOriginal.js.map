{"version":3,"file":"../../contentScript/showOriginal.js","names":["showOriginal","twpConfig","onReady","platformInfo","isMobile","any","enable","disable","add","removeAll","enabledObservers","enabledObserverSubscribe","callback","push","styleTextContent","fetch","chrome","runtime","getURL","then","response","text","catch","e","console","error","showOriginalTextWhenHovering","get","isEnabled","onChanged","name","newValue","forEach","originalTextIsShowing","divElement","shadowRoot","currentNodeOverMouse","timeoutHandler","nodesToShowOriginal","mousePos","x","y","onMouseMove","clientX","clientY","onMouseDown","target","hideOriginalText","showOriginalText","node","window","isTranslatingSelected","nodeInf","find","eOriginalText","getElementById","textContent","original","document","body","appendChild","height","offsetHeight","top","Math","max","min","innerHeight","width","offsetWidth","left","parseInt","innerWidth","style","remove","clearTimeout","isShowingOriginalText","onMouseEnter","setTimeout","onMouseOut","relatedTarget","indexOf","addEventListener","removeEventListener","dontDeleteNodesToShowOriginal","createElement","classList","attachShadow","mode","innerHTML","insertBefore","enableDarkMode","el","setAttribute","disableDarkMode","matchMedia","matches"],"sources":["showOriginal.js"],"sourcesContent":["\"use strict\";\r\n\r\nvar showOriginal = {};\r\n\r\ntwpConfig.onReady(function () {\r\n  if (platformInfo.isMobile.any) {\r\n    showOriginal.enable = () => {};\r\n    showOriginal.disable = () => {};\r\n    showOriginal.add = () => {};\r\n    showOriginal.removeAll = () => {};\r\n    return;\r\n  }\r\n\r\n  const enabledObservers = [];\r\n  showOriginal.enabledObserverSubscribe = function (callback) {\r\n    enabledObservers.push(callback);\r\n  };\r\n\r\n  let styleTextContent = \"\";\r\n  fetch(chrome.runtime.getURL(\"/contentScript/css/showOriginal.css\"))\r\n    .then((response) => response.text())\r\n    .then((response) => (styleTextContent = response))\r\n    .catch((e) => console.error(e));\r\n\r\n  let showOriginalTextWhenHovering = twpConfig.get(\r\n    \"showOriginalTextWhenHovering\"\r\n  );\r\n  showOriginal.isEnabled = showOriginalTextWhenHovering === \"yes\";\r\n  twpConfig.onChanged(function (name, newValue) {\r\n    if (name === \"showOriginalTextWhenHovering\") {\r\n      showOriginalTextWhenHovering = newValue;\r\n      showOriginal.isEnabled = showOriginalTextWhenHovering === \"yes\";\r\n      showOriginal.enable(true);\r\n      enabledObservers.forEach((callback) => {\r\n        callback();\r\n      });\r\n    }\r\n  });\r\n\r\n  let originalTextIsShowing = false;\r\n  let divElement;\r\n  let shadowRoot;\r\n  let currentNodeOverMouse;\r\n  let timeoutHandler;\r\n\r\n  let nodesToShowOriginal = [];\r\n\r\n  const mousePos = {\r\n    x: 0,\r\n    y: 0,\r\n  };\r\n\r\n  function onMouseMove(e) {\r\n    mousePos.x = e.clientX;\r\n    mousePos.y = e.clientY;\r\n  }\r\n\r\n  function onMouseDown(e) {\r\n    if (!divElement) return;\r\n    if (e.target === divElement) return;\r\n    hideOriginalText();\r\n  }\r\n\r\n  function showOriginalText(node) {\r\n    hideOriginalText();\r\n    if (!divElement) return;\r\n    if (window.isTranslatingSelected) return;\r\n\r\n    const nodeInf = nodesToShowOriginal.find(\r\n      (nodeInf) => nodeInf.node === node\r\n    );\r\n    if (nodeInf) {\r\n      const eOriginalText = shadowRoot.getElementById(\"originalText\");\r\n      eOriginalText.textContent = nodeInf.original;\r\n      document.body.appendChild(divElement);\r\n      originalTextIsShowing = true;\r\n\r\n      const height = eOriginalText.offsetHeight;\r\n      let top = mousePos.y + 10;\r\n      top = Math.max(0, top);\r\n      top = Math.min(window.innerHeight - height, top);\r\n\r\n      const width = eOriginalText.offsetWidth;\r\n      let left = parseInt(mousePos.x /*- (width / 2) */);\r\n      left = Math.max(0, left);\r\n      left = Math.min(window.innerWidth - width, left);\r\n\r\n      eOriginalText.style.top = top + \"px\";\r\n      eOriginalText.style.left = left + \"px\";\r\n    }\r\n  }\r\n\r\n  function hideOriginalText() {\r\n    if (divElement) {\r\n      divElement.remove();\r\n      originalTextIsShowing = false;\r\n    }\r\n    clearTimeout(timeoutHandler);\r\n  }\r\n\r\n  function isShowingOriginalText() {\r\n    return originalTextIsShowing;\r\n  }\r\n\r\n  function onMouseEnter(e) {\r\n    if (!divElement) return;\r\n    if (currentNodeOverMouse && e.target === currentNodeOverMouse) return;\r\n    currentNodeOverMouse = e.target;\r\n    if (timeoutHandler) clearTimeout(timeoutHandler);\r\n    timeoutHandler = setTimeout(showOriginalText, 1500, currentNodeOverMouse);\r\n  }\r\n\r\n  function onMouseOut(e) {\r\n    if (!divElement) return;\r\n    if (!isShowingOriginalText()) return;\r\n\r\n    if (e.target === currentNodeOverMouse && e.relatedTarget === divElement)\r\n      return;\r\n    if (e.target === divElement && e.relatedTarget === currentNodeOverMouse)\r\n      return;\r\n\r\n    hideOriginalText();\r\n  }\r\n\r\n  showOriginal.add = function (node) {\r\n    if (platformInfo.isMobile.any) return;\r\n\r\n    if (node && nodesToShowOriginal.indexOf(node) === -1) {\r\n      nodesToShowOriginal.push({\r\n        node: node,\r\n        original: node.textContent,\r\n      });\r\n      node.addEventListener(\"mouseenter\", onMouseEnter);\r\n      node.addEventListener(\"mouseout\", onMouseOut);\r\n    }\r\n  };\r\n\r\n  showOriginal.removeAll = function () {\r\n    nodesToShowOriginal.forEach((nodeInf) => {\r\n      nodeInf.node.removeEventListener(\"mouseenter\", onMouseEnter);\r\n      nodeInf.node.removeEventListener(\"mouseout\", onMouseOut);\r\n    });\r\n    nodesToShowOriginal = [];\r\n  };\r\n\r\n  showOriginal.enable = function (dontDeleteNodesToShowOriginal = false) {\r\n    showOriginal.disable(dontDeleteNodesToShowOriginal);\r\n\r\n    if (platformInfo.isMobile.any) return;\r\n    if (showOriginalTextWhenHovering !== \"yes\") return;\r\n    if (divElement) return;\r\n\r\n    divElement = document.createElement(\"div\");\r\n    divElement.style = \"all: initial\";\r\n    divElement.classList.add(\"notranslate\");\r\n\r\n    shadowRoot = divElement.attachShadow({\r\n      mode: \"closed\",\r\n    });\r\n    shadowRoot.innerHTML = `\r\n            <link rel=\"stylesheet\" href=\"${chrome.runtime.getURL(\r\n              \"/contentScript/css/showOriginal.css\"\r\n            )}\">\r\n            <div id=\"originalText\" dir=\"auto\"></div>\r\n        `;\r\n\r\n    {\r\n      const style = document.createElement(\"style\");\r\n      style.textContent = styleTextContent;\r\n      shadowRoot.insertBefore(style, shadowRoot.getElementById(\"originalText\"));\r\n    }\r\n\r\n    function enableDarkMode() {\r\n      if (!shadowRoot.getElementById(\"darkModeElement\")) {\r\n        const el = document.createElement(\"style\");\r\n        el.setAttribute(\"id\", \"darkModeElement\");\r\n        el.setAttribute(\"rel\", \"stylesheet\");\r\n        el.textContent = `\r\n                    * {\r\n                        scrollbar-color: #202324 #454a4d;\r\n                    }\r\n                    #originalText {\r\n                        color: rgb(231, 230, 228) !important;\r\n                        background-color: #181a1b !important;\r\n                    }\r\n                `;\r\n        shadowRoot.appendChild(el);\r\n      }\r\n    }\r\n\r\n    function disableDarkMode() {\r\n      if (shadowRoot.getElementById(\"#darkModeElement\")) {\r\n        shadowRoot.getElementById(\"#darkModeElement\").remove();\r\n      }\r\n    }\r\n\r\n    switch (twpConfig.get(\"darkMode\")) {\r\n      case \"auto\":\r\n        if (matchMedia(\"(prefers-color-scheme: dark)\").matches) {\r\n          enableDarkMode();\r\n        } else {\r\n          disableDarkMode();\r\n        }\r\n        break;\r\n      case \"yes\":\r\n        enableDarkMode();\r\n        break;\r\n      case \"no\":\r\n        disableDarkMode();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    divElement.addEventListener(\"mouseout\", onMouseOut);\r\n\r\n    document.addEventListener(\"mousemove\", onMouseMove);\r\n    document.addEventListener(\"mousedown\", onMouseDown);\r\n\r\n    document.addEventListener(\"blur\", hideOriginalText);\r\n    document.addEventListener(\"visibilitychange\", hideOriginalText);\r\n  };\r\n\r\n  showOriginal.disable = function (dontDeleteNodesToShowOriginal = false) {\r\n    if (divElement) {\r\n      hideOriginalText();\r\n      divElement.remove();\r\n      divElement = null;\r\n      shadowRoot = null;\r\n    }\r\n\r\n    if (!dontDeleteNodesToShowOriginal) {\r\n      showOriginal.removeAll();\r\n    }\r\n\r\n    document.removeEventListener(\"mousemove\", onMouseMove);\r\n    document.removeEventListener(\"mousedown\", onMouseDown);\r\n\r\n    document.removeEventListener(\"blur\", hideOriginalText);\r\n    document.removeEventListener(\"visibilitychange\", hideOriginalText);\r\n  };\r\n});\r\n"],"mappings":"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"}
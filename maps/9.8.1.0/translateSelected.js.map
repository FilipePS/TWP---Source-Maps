{"version":3,"file":"../../contentScript/translateSelected.js","names":["translateSelected","getTabHostName","Promise","resolve","chrome","runtime","sendMessage","action","result","checkedLastError","all","twpConfig","onReady","then","_","tabHostName","gSelectionInfo","prevSelectionInfo","divElement","eButtonTransSelText","eDivResult","eSelTextTrans","eOrigText","origTextContainer","originalTabLanguage","currentTargetLanguages","get","currentTargetLanguage","currentTextTranslatorService","awaysTranslateThisSite","indexOf","translateThisSite","translateThisLanguage","showTranslateSelectedButton","dontShowIfPageLangIsTargetLang","dontShowIfPageLangIsUnknown","dontShowIfSelectedTextIsTargetLang","dontShowIfSelectedTextIsUnknown","fooCount","pageTranslator","onGetOriginalTabLanguage","tabLanguage","updateEventListener","detectTextLanguage","text","i18n","detectLanguage","lang","isReliable","langInfo","languages","langCode","twpLang","fixTLanguageCode","language","isPlayingAudio","playAudio","targetLanguage","cbOnEnded","stopAudio","dragElement","elmnt","elmnt2","pos1","pos2","pos3","pos4","addEventListener","dragMouseDown","e","window","event","preventDefault","clientX","clientY","document","closeDragElement","elementDrag","style","top","Math","min","innerHeight","parseInt","getComputedStyle","height","max","offsetTop","left","offsetLeft","removeEventListener","setCaretAtEnd","el","range","createRange","sel","getSelection","setStart","textContent","length","collapse","removeAllRanges","addRange","focus","onCSSLoad","isCSSLoaded","init","destroy","isTranslatingSelected","createElement","classList","add","shadowRoot","attachShadow","mode","innerHTML","link","setAttribute","getURL","onload","appendChild","styleFix","getElementById","isFirefox","navigator","userAgent","toLowerCase","CSS","supports","darkMode","matchMedia","matches","eMoreOrLess","eMore","eLess","sGoogle","sYandex","sBing","sDeepL","sLibre","eCopy","eReplace","eListenOriginal","eListenTranslated","isInputElement","isContentEditable","display","minHeight","replaceText","prevSelInfo","element","nodeType","parentNode","execCommand","setSelectionRange","selStart","selEnd","selection","onclick","clipboard","writeText","oldBackgroundColor","backgroundColor","setTimeout","onkeypress","stopPropagation","onkeydown","lastTimePressedCtrl","onkeyup","isSelectingText","onKeyUp","hasAttribute","key","performance","now","translateNewInputTimerHandler","oninput","clearTimeout","translateNewInput","set","remove","setTargetLanguage","target","getAttribute","setTargetLanguageTextTranslation","querySelectorAll","forEach","li","onListenClick","type","msgListen","twpI18n","getMessage","msgStopListening","lastListenAudioType","body","translateDocument","platformInfo","isMobile","any","width","onTouchstart","onClick","onDown","targetLanguageButtons","i","codeToLanguage","enabledServices","includes","removeAttribute","find","cs","name","onChanged","newvalue","prevHeight","destroyIfButtonIsShowing","newValue","update_eDivResult","onloaded","eTop","bottom","eLeft","isRtlLanguage","offsetHeight","offsetWidth","innerWidth","currentFooCount","backgroundTranslateSingleText","translateSelText","usePrevSelectionInfo","isTouchSelection","getSelectionText","activeEl","activeElement","activeElTagName","tagName","test","selectionStart","value","slice","selectionEnd","toString","readSelection","dontReadIfSelectionDontChange","newSelectionInfo","rect","getBoundingClientRect","right","getRangeAt","focusNode","startOffset","endOffset","onUp","changedTouches","selectedText","trim","detectedLanguage","showButtonTimerHandler","onMouseup","button","onTouchend","onSelectionchange","windowIsInFocus","onMessage","addListener","request","sender","sendResponse","_prevSelInfo$element","_prevSelInfo$element2","_prevSelInfo$element3","readOnly"],"sources":["translateSelected.js"],"sourcesContent":["\"use strict\";\r\n\r\n// TODO especificar o parametro HL para aprimorar a detecção de idioma\r\n//TODO desativar o botão caso a pagina esteja traduzida\r\n\r\nvar translateSelected = {};\r\n\r\nfunction getTabHostName() {\r\n  return new Promise((resolve) =>\r\n    chrome.runtime.sendMessage({ action: \"getTabHostName\" }, (result) => {\r\n      checkedLastError();\r\n\r\n      resolve(result);\r\n    })\r\n  );\r\n}\r\n\r\nPromise.all([twpConfig.onReady(), getTabHostName()]).then(function (_) {\r\n  const tabHostName = _[1];\r\n\r\n  let gSelectionInfo;\r\n  let prevSelectionInfo;\r\n\r\n  let divElement;\r\n  let eButtonTransSelText;\r\n  let eDivResult;\r\n  let eSelTextTrans;\r\n  let eOrigText;\r\n  let origTextContainer;\r\n\r\n  let originalTabLanguage = \"und\";\r\n  let currentTargetLanguages = twpConfig.get(\"targetLanguages\");\r\n  let currentTargetLanguage = twpConfig.get(\"targetLanguageTextTranslation\");\r\n  let currentTextTranslatorService = twpConfig.get(\"textTranslatorService\");\r\n  let awaysTranslateThisSite =\r\n    twpConfig.get(\"alwaysTranslateSites\").indexOf(tabHostName) !== -1;\r\n  let translateThisSite =\r\n    twpConfig.get(\"neverTranslateSites\").indexOf(tabHostName) === -1;\r\n  let translateThisLanguage =\r\n    twpConfig.get(\"neverTranslateLangs\").indexOf(originalTabLanguage) === -1;\r\n  let showTranslateSelectedButton = twpConfig.get(\r\n    \"showTranslateSelectedButton\"\r\n  );\r\n  let dontShowIfPageLangIsTargetLang = twpConfig.get(\r\n    \"dontShowIfPageLangIsTargetLang\"\r\n  );\r\n  let dontShowIfPageLangIsUnknown = twpConfig.get(\r\n    \"dontShowIfPageLangIsUnknown\"\r\n  );\r\n  let dontShowIfSelectedTextIsTargetLang = twpConfig.get(\r\n    \"dontShowIfSelectedTextIsTargetLang\"\r\n  );\r\n  let dontShowIfSelectedTextIsUnknown = twpConfig.get(\r\n    \"dontShowIfSelectedTextIsUnknown\"\r\n  );\r\n  let fooCount = 0;\r\n\r\n  pageTranslator.onGetOriginalTabLanguage(function (tabLanguage) {\r\n    originalTabLanguage = tabLanguage;\r\n    translateThisLanguage =\r\n      twpConfig.get(\"neverTranslateLangs\").indexOf(originalTabLanguage) === -1;\r\n    updateEventListener();\r\n  });\r\n\r\n  async function detectTextLanguage(text) {\r\n    if (!chrome.i18n.detectLanguage) return \"und\";\r\n\r\n    return await new Promise((resolve) => {\r\n      chrome.i18n.detectLanguage(text, (result) => {\r\n        if (!result) return resolve({ lang: \"und\", isReliable: false });\r\n\r\n        for (const langInfo of result.languages) {\r\n          const langCode = twpLang.fixTLanguageCode(langInfo.language);\r\n          if (langCode) {\r\n            return resolve({ lang: langCode, isReliable: result.isReliable });\r\n          }\r\n        }\r\n\r\n        return resolve({ lang: \"und\", isReliable: false });\r\n      });\r\n    });\r\n  }\r\n\r\n  let isPlayingAudio = false;\r\n\r\n  function playAudio(text, targetLanguage, cbOnEnded = () => {}) {\r\n    isPlayingAudio = true;\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"textToSpeech\",\r\n        text,\r\n        targetLanguage,\r\n      },\r\n      () => {\r\n        checkedLastError();\r\n\r\n        isPlayingAudio = false;\r\n        cbOnEnded();\r\n      }\r\n    );\r\n  }\r\n\r\n  function stopAudio() {\r\n    if (!isPlayingAudio) return;\r\n    isPlayingAudio = false;\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: \"stopAudio\",\r\n      },\r\n      checkedLastError\r\n    );\r\n  }\r\n\r\n  function dragElement(elmnt, elmnt2) {\r\n    var pos1 = 0,\r\n      pos2 = 0,\r\n      pos3 = 0,\r\n      pos4 = 0;\r\n    if (elmnt2) {\r\n      elmnt2.addEventListener(\"mousedown\", dragMouseDown);\r\n    } else {\r\n      elmnt.addEventListener(\"mousedown\", dragMouseDown);\r\n    }\r\n\r\n    function dragMouseDown(e) {\r\n      e = e || window.event;\r\n      e.preventDefault();\r\n      // get the mouse cursor position at startup:\r\n      pos3 = e.clientX;\r\n      pos4 = e.clientY;\r\n      document.addEventListener(\"mouseup\", closeDragElement);\r\n      // call a function whenever the cursor moves:\r\n      document.addEventListener(\"mousemove\", elementDrag);\r\n    }\r\n\r\n    function elementDrag(e) {\r\n      e = e || window.event;\r\n      e.preventDefault();\r\n      // calculate the new cursor position:\r\n      pos1 = pos3 - e.clientX;\r\n      pos2 = pos4 - e.clientY;\r\n      pos3 = e.clientX;\r\n      pos4 = e.clientY;\r\n      // set the element's new position:\r\n      elmnt.style.top =\r\n        Math.min(\r\n          window.innerHeight - parseInt(getComputedStyle(elmnt).height),\r\n          Math.max(0, elmnt.offsetTop - pos2)\r\n        ) + \"px\";\r\n      elmnt.style.left = Math.max(0, elmnt.offsetLeft - pos1) + \"px\";\r\n    }\r\n\r\n    function closeDragElement() {\r\n      // stop moving when mouse button is released:\r\n      document.removeEventListener(\"mouseup\", closeDragElement);\r\n      document.removeEventListener(\"mousemove\", elementDrag);\r\n    }\r\n  }\r\n\r\n  function setCaretAtEnd() {\r\n    const el = eOrigText;\r\n    const range = document.createRange();\r\n    const sel = window.getSelection();\r\n    range.setStart(el, el.textContent.length > 0 ? 1 : 0);\r\n    range.collapse(true);\r\n    sel.removeAllRanges();\r\n    sel.addRange(range);\r\n    el.focus();\r\n  }\r\n\r\n  let onCSSLoad = null;\r\n  let isCSSLoaded = false;\r\n\r\n  function init() {\r\n    destroy();\r\n\r\n    window.isTranslatingSelected = true;\r\n\r\n    divElement = document.createElement(\"div\");\r\n    divElement.style = \"all: initial\";\r\n    divElement.classList.add(\"notranslate\");\r\n\r\n    const shadowRoot = divElement.attachShadow({\r\n      mode: \"closed\",\r\n    });\r\n\r\n    shadowRoot.innerHTML = `\r\n        <div id=\"eButtonTransSelText\" style=\"display: none\"></div>\r\n\t\t<div id=\"eDivResult\" style=\"display: none\">\r\n\t\t\t<div id=\"origTextContainer\">\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<div id=\"eOrigText\" contentEditable=\"true\" spellcheck=\"false\" dir=\"auto\"></div>\r\n\t\t\t\t\t<hr>\r\n\t\t\t\t</div>\r\n\t\t\t\t<ul><li title=\"Listen\" data-i18n-title=\"btnListen\" id=\"listenOriginal\">\r\n\t\t\t\t\t<svg id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"10px\" height=\"10px\" viewBox=\"0 0 93.038 93.038\"\r\n\t\t\t\t\t\tstyle=\"enable-background:new 0 0 93.038 93.038;\" xml:space=\"preserve\">\r\n\t\t\t\t\t<g>\r\n\t\t\t\t\t\t<path d=\"M46.547,75.521c0,1.639-0.947,3.128-2.429,3.823c-0.573,0.271-1.187,0.402-1.797,0.402c-0.966,0-1.923-0.332-2.696-0.973\r\n\t\t\t\t\t\tl-23.098-19.14H4.225C1.892,59.635,0,57.742,0,55.409V38.576c0-2.334,1.892-4.226,4.225-4.226h12.303l23.098-19.14\r\n\t\t\t\t\t\tc1.262-1.046,3.012-1.269,4.493-0.569c1.481,0.695,2.429,2.185,2.429,3.823L46.547,75.521L46.547,75.521z M62.784,68.919\r\n\t\t\t\t\t\tc-0.103,0.007-0.202,0.011-0.304,0.011c-1.116,0-2.192-0.441-2.987-1.237l-0.565-0.567c-1.482-1.479-1.656-3.822-0.408-5.504\r\n\t\t\t\t\t\tc3.164-4.266,4.834-9.323,4.834-14.628c0-5.706-1.896-11.058-5.484-15.478c-1.366-1.68-1.24-4.12,0.291-5.65l0.564-0.565\r\n\t\t\t\t\t\tc0.844-0.844,1.975-1.304,3.199-1.231c1.192,0.06,2.305,0.621,3.061,1.545c4.977,6.09,7.606,13.484,7.606,21.38\r\n\t\t\t\t\t\tc0,7.354-2.325,14.354-6.725,20.24C65.131,68.216,64.007,68.832,62.784,68.919z M80.252,81.976\r\n\t\t\t\t\t\tc-0.764,0.903-1.869,1.445-3.052,1.495c-0.058,0.002-0.117,0.004-0.177,0.004c-1.119,0-2.193-0.442-2.988-1.237l-0.555-0.555\r\n\t\t\t\t\t\tc-1.551-1.55-1.656-4.029-0.246-5.707c6.814-8.104,10.568-18.396,10.568-28.982c0-11.011-4.019-21.611-11.314-29.847\r\n\t\t\t\t\t\tc-1.479-1.672-1.404-4.203,0.17-5.783l0.554-0.555c0.822-0.826,1.89-1.281,3.115-1.242c1.163,0.033,2.263,0.547,3.036,1.417\r\n\t\t\t\t\t\tc8.818,9.928,13.675,22.718,13.675,36.01C93.04,59.783,88.499,72.207,80.252,81.976z\"/>\r\n\t\t\t\t\t</g>\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t</li></ul>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"transTextContainer\">\r\n\t\t\t\t<div id=\"eSelTextTrans\" dir=\"auto\"></div>\r\n\t\t\t\t<ul>\r\n\t\t\t\t\t<li title=\"Listen\" data-i18n-title=\"btnListen\" id=\"listenTranslated\">\r\n\t\t\t\t\t\t<svg id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"10px\" height=\"10px\" viewBox=\"0 0 93.038 93.038\"\r\n\t\t\t\t\t\t\tstyle=\"enable-background:new 0 0 93.038 93.038;\" xml:space=\"preserve\">\r\n\t\t\t\t\t\t<g>\r\n\t\t\t\t\t\t\t<path d=\"M46.547,75.521c0,1.639-0.947,3.128-2.429,3.823c-0.573,0.271-1.187,0.402-1.797,0.402c-0.966,0-1.923-0.332-2.696-0.973\r\n\t\t\t\t\t\t\tl-23.098-19.14H4.225C1.892,59.635,0,57.742,0,55.409V38.576c0-2.334,1.892-4.226,4.225-4.226h12.303l23.098-19.14\r\n\t\t\t\t\t\t\tc1.262-1.046,3.012-1.269,4.493-0.569c1.481,0.695,2.429,2.185,2.429,3.823L46.547,75.521L46.547,75.521z M62.784,68.919\r\n\t\t\t\t\t\t\tc-0.103,0.007-0.202,0.011-0.304,0.011c-1.116,0-2.192-0.441-2.987-1.237l-0.565-0.567c-1.482-1.479-1.656-3.822-0.408-5.504\r\n\t\t\t\t\t\t\tc3.164-4.266,4.834-9.323,4.834-14.628c0-5.706-1.896-11.058-5.484-15.478c-1.366-1.68-1.24-4.12,0.291-5.65l0.564-0.565\r\n\t\t\t\t\t\t\tc0.844-0.844,1.975-1.304,3.199-1.231c1.192,0.06,2.305,0.621,3.061,1.545c4.977,6.09,7.606,13.484,7.606,21.38\r\n\t\t\t\t\t\t\tc0,7.354-2.325,14.354-6.725,20.24C65.131,68.216,64.007,68.832,62.784,68.919z M80.252,81.976\r\n\t\t\t\t\t\t\tc-0.764,0.903-1.869,1.445-3.052,1.495c-0.058,0.002-0.117,0.004-0.177,0.004c-1.119,0-2.193-0.442-2.988-1.237l-0.555-0.555\r\n\t\t\t\t\t\t\tc-1.551-1.55-1.656-4.029-0.246-5.707c6.814-8.104,10.568-18.396,10.568-28.982c0-11.011-4.019-21.611-11.314-29.847\r\n\t\t\t\t\t\t\tc-1.479-1.672-1.404-4.203,0.17-5.783l0.554-0.555c0.822-0.826,1.89-1.281,3.115-1.242c1.163,0.033,2.263,0.547,3.036,1.417\r\n\t\t\t\t\t\t\tc8.818,9.928,13.675,22.718,13.675,36.01C93.04,59.783,88.499,72.207,80.252,81.976z\"/>\r\n\t\t\t\t\t\t</g>\r\n\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t<li title=\"Copy\" data-i18n-title=\"btncopy\" id=\"copy\">\r\n\t\t\t\t\t\t<svg width=\"10\" height=\"10\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n\t\t\t\t\t\t<path d=\"M13 7H7V5H13V7Z\" fill=\"currentColor\" />\r\n\t\t\t\t\t\t<path d=\"M13 11H7V9H13V11Z\" fill=\"currentColor\" />\r\n\t\t\t\t\t\t<path d=\"M7 15H13V13H7V15Z\" fill=\"currentColor\" />\r\n\t\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M3 19V1H17V5H21V23H7V19H3ZM15 17V3H5V17H15ZM17 7V19H9V21H19V7H17Z\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t<li title=\"Replace\" data-i18n-title=\"btnReplace\" id=\"replace\" hidden>\r\n\t\t\t\t\t\t<svg width=\"10\" height=\"10\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n\t\t\t\t\t\t<path\r\n\t\t\t\t\t\td=\"M5.75739 7.17154L7.1716 5.75732L16.2426 14.8283L16.2426 10.2427H18.2426L18.2426 18.2427H10.2426V16.2427L14.8285 16.2427L5.75739 7.17154Z\"\r\n\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t</ul>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"drag\">\r\n\t\t\t\t<ul id=\"setTargetLanguage\">\r\n\t\t\t\t\t<li value=\"en\" title=\"English\">en</li>\r\n\t\t\t\t\t<li value=\"es\" title=\"Spanish\">es</li>\r\n\t\t\t\t\t<li value=\"de\" title=\"German\">de</li>\r\n\t\t\t\t</ul>\r\n\t\t\t\t<div id=\"moreOrLess\"><i class=\"arrow up\" id=\"more\"></i><i class=\"arrow down\" id=\"less\"></i></div>\r\n\t\t\t\t<ul>\r\n\t\t\t\t\t<li title=\"Google\" id=\"sGoogle\">g</li>\r\n\t\t\t\t\t<li title=\"Bing\" id=\"sBing\">b</li>\r\n\t\t\t\t\t<li title=\"Yandex\" id=\"sYandex\">y</li>\r\n\t\t\t\t\t<li title=\"DeepL\" id=\"sDeepL\" hidden>d</li>\r\n\t\t\t\t\t<li title=\"Libretranslate\" id=\"sLibre\" hidden>l</li>\r\n\t\t\t\t\t<li style=\"opacity: 0; cursor: move;\">O</li>\r\n\t\t\t\t</ul>\r\n\t\t\t</div>\r\n\t\t</div>\r\n        `;\r\n\r\n    const link = document.createElement(\"link\");\r\n    link.setAttribute(\"rel\", \"stylesheet\");\r\n    link.setAttribute(\r\n      \"href\",\r\n      chrome.runtime.getURL(\"/contentScript/css/translateSelected.css\")\r\n    );\r\n    isCSSLoaded = false;\r\n    link.onload = (e) => {\r\n      isCSSLoaded = true;\r\n      if (onCSSLoad) onCSSLoad();\r\n    };\r\n    shadowRoot.appendChild(link);\r\n\r\n    const styleFix = document.createElement(\"style\");\r\n    styleFix.textContent = `\r\n\t\t#eSelTextTrans,#eOrigText {\r\n\t\t\tmargin-right: 22px;\r\n\t\t}\r\n\t\t#eDivResult {\r\n\t\t\tmin-width: 300px;\r\n\t\t}\r\n\t\t`;\r\n    shadowRoot.appendChild(styleFix);\r\n\r\n    dragElement(\r\n      shadowRoot.getElementById(\"eDivResult\"),\r\n      shadowRoot.getElementById(\"drag\")\r\n    );\r\n\r\n    const isFirefox = navigator.userAgent.toLowerCase().indexOf(\"firefox\") > -1;\r\n\r\n    if (CSS.supports(\"backdrop-filter: blur(5px)\") && !isFirefox && false) {\r\n      const el = document.createElement(\"style\");\r\n      el.setAttribute(\"id\", \"backdropFilterElement\");\r\n      el.setAttribute(\"rel\", \"stylesheet\");\r\n      el.textContent = `\r\n                    #eDivResult {\r\n                        backdrop-filter: blur(3px);\r\n                        background-color: rgba(0, 0, 0, 0.5);\r\n                    }\r\n                    li {\r\n                    \tbackground-color: rgba(255, 255, 255, 0.1);\r\n                    }\r\n                    .selected {\r\n                    \tbackground-color: rgba(255, 255, 255, 0.3);\r\n                    }\r\n                    #moreOrLess {\r\n                \t\tbackground-color: rgba(255, 255, 255, 0.1);\r\n            \t\t}\r\n            \t\thr {\r\n            \t\t\tborder: 1px rgba(255, 255, 255, 0.5) solid;\r\n            \t\t}\r\n            \t\t#listen {\r\n            \t\t    fill: white;\r\n            \t\t}\r\n                `;\r\n      shadowRoot.appendChild(el);\r\n    } else {\r\n      const el = document.createElement(\"style\");\r\n      el.setAttribute(\"id\", \"backdropFilterElement\");\r\n      el.setAttribute(\"rel\", \"stylesheet\");\r\n      let darkMode = false;\r\n      switch (twpConfig.get(\"darkMode\")) {\r\n        case \"auto\":\r\n          if (matchMedia(\"(prefers-color-scheme: dark)\").matches)\r\n            darkMode = true;\r\n          break;\r\n        case \"yes\":\r\n          darkMode = true;\r\n          break;\r\n      }\r\n      if (darkMode === true) {\r\n        el.textContent = `\r\n                    #eDivResult {\r\n                        backdrop-filter: none;\r\n                        background-color: rgba(25, 25, 25, 0.98);\r\n                        color: white;\r\n                    }\r\n                    li, #moreOrLess {\r\n                    \tbackground-color: rgba(255, 255, 255, 0.2);\r\n                    }\r\n                    .selected {\r\n                    \tbackground-color: rgba(255, 255, 255, 0.4);\r\n                    }\r\n            \t\thr {\r\n            \t\t\tborder: 1px rgba(225, 225, 225, 0.75) solid;\r\n            \t\t}\r\n            \t\t#listen {\r\n            \t\t    fill: white;\r\n            \t\t}\r\n                `;\r\n      } else {\r\n        el.textContent = `\r\n                    #eDivResult {\r\n                        backdrop-filter: none;\r\n                        background-color: rgba(225, 225, 225, 0.98);\r\n                        color: black;\r\n                    }\r\n                    li, #moreOrLess {\r\n                    \tbackground-color: rgba(0, 0, 0, 0.2);\r\n                    }\r\n                    .selected {\r\n                    \tbackground-color: rgba(0, 0, 0, 0.4);\r\n                    }\r\n            \t\thr {\r\n            \t\t\tborder: 1px rgba(0, 0, 0, 0.75) solid;\r\n            \t\t}\r\n            \t\t#listen {\r\n            \t\t    fill: black;\r\n            \t\t}\r\n                `;\r\n      }\r\n      shadowRoot.appendChild(el);\r\n    }\r\n\r\n    eButtonTransSelText = shadowRoot.getElementById(\"eButtonTransSelText\");\r\n    eDivResult = shadowRoot.getElementById(\"eDivResult\");\r\n    eSelTextTrans = shadowRoot.getElementById(\"eSelTextTrans\");\r\n    eOrigText = shadowRoot.getElementById(\"eOrigText\");\r\n    origTextContainer = shadowRoot.getElementById(\"origTextContainer\");\r\n\r\n    const eMoreOrLess = shadowRoot.getElementById(\"moreOrLess\");\r\n    const eMore = shadowRoot.getElementById(\"more\");\r\n    const eLess = shadowRoot.getElementById(\"less\");\r\n\r\n    const sGoogle = shadowRoot.getElementById(\"sGoogle\");\r\n    const sYandex = shadowRoot.getElementById(\"sYandex\");\r\n    const sBing = shadowRoot.getElementById(\"sBing\");\r\n    const sDeepL = shadowRoot.getElementById(\"sDeepL\");\r\n    const sLibre = shadowRoot.getElementById(\"sLibre\");\r\n    const eCopy = shadowRoot.getElementById(\"copy\");\r\n    const eReplace = shadowRoot.getElementById(\"replace\");\r\n    const eListenOriginal = shadowRoot.getElementById(\"listenOriginal\");\r\n    const eListenTranslated = shadowRoot.getElementById(\"listenTranslated\");\r\n\r\n    if (\r\n      gSelectionInfo &&\r\n      (gSelectionInfo.isInputElement || gSelectionInfo.isContentEditable)\r\n    ) {\r\n      eReplace.style.display = \"block\";\r\n      eSelTextTrans.style.minHeight = \"55px\";\r\n    } else {\r\n      eReplace.style.display = \"none\";\r\n      eSelTextTrans.style.minHeight = null;\r\n    }\r\n\r\n    function replaceText() {\r\n      const prevSelInfo = prevSelectionInfo;\r\n      destroy();\r\n      if (prevSelInfo.element.nodeType === 3) {\r\n        prevSelInfo.element.parentNode.focus();\r\n      } else {\r\n        prevSelInfo.element.focus();\r\n      }\r\n      document.execCommand(\"selectAll\", false);\r\n      if (prevSelInfo.isInputElement) {\r\n        prevSelInfo.element.setSelectionRange(\r\n          prevSelInfo.selStart,\r\n          prevSelInfo.selEnd\r\n        );\r\n      } else if (prevSelInfo.isContentEditable) {\r\n        const selection = window.getSelection();\r\n        selection.removeAllRanges();\r\n        selection.addRange(prevSelInfo.range);\r\n      }\r\n      document.execCommand(\"insertText\", false, eSelTextTrans.textContent);\r\n    }\r\n\r\n    eCopy.onclick = () => {\r\n      navigator.clipboard.writeText(eSelTextTrans.textContent).then(() => {\r\n        const oldBackgroundColor = eCopy.style.backgroundColor;\r\n        eCopy.style.backgroundColor = \"rgba(0, 255, 0, 0.4)\";\r\n        setTimeout(() => {\r\n          eCopy.style.backgroundColor = oldBackgroundColor;\r\n        }, 500);\r\n      });\r\n    };\r\n\r\n    eReplace.onclick = replaceText;\r\n\r\n    eOrigText.onkeypress = (e) => {\r\n      e.stopPropagation();\r\n    };\r\n\r\n    eOrigText.onkeydown = (e) => {\r\n      e.stopPropagation();\r\n    };\r\n\r\n    let lastTimePressedCtrl = null;\r\n\r\n    eOrigText.onkeyup = (e) => {\r\n      e.stopPropagation();\r\n\r\n      if (twpConfig.get(\"translateSelectedWhenPressTwice\") !== \"yes\") return;\r\n      // https://github.com/FilipePS/Traduzir-paginas-web/issues/577\r\n      if (isSelectingText()) {\r\n        return onKeyUp(e);\r\n      } else {\r\n        if (eReplace.hasAttribute(\"hidden\")) return;\r\n      }\r\n\r\n      if (e.key == \"Control\") {\r\n        if (\r\n          lastTimePressedCtrl &&\r\n          performance.now() - lastTimePressedCtrl < 250\r\n        ) {\r\n          lastTimePressedCtrl = performance.now();\r\n          replaceText();\r\n        }\r\n        lastTimePressedCtrl = performance.now();\r\n      }\r\n    };\r\n\r\n    let translateNewInputTimerHandler;\r\n    eOrigText.oninput = () => {\r\n      clearTimeout(translateNewInputTimerHandler);\r\n      translateNewInputTimerHandler = setTimeout(translateNewInput, 600);\r\n    };\r\n\r\n    eMoreOrLess.onclick = () => {\r\n      if (twpConfig.get(\"expandPanelTranslateSelectedText\") === \"no\") {\r\n        twpConfig.set(\"expandPanelTranslateSelectedText\", \"yes\");\r\n      } else {\r\n        twpConfig.set(\"expandPanelTranslateSelectedText\", \"no\");\r\n      }\r\n\r\n      setCaretAtEnd();\r\n    };\r\n\r\n    sGoogle.onclick = () => {\r\n      currentTextTranslatorService = \"google\";\r\n      twpConfig.set(\"textTranslatorService\", \"google\");\r\n      translateNewInput();\r\n\r\n      sGoogle.classList.remove(\"selected\");\r\n      sYandex.classList.remove(\"selected\");\r\n      sBing.classList.remove(\"selected\");\r\n      sDeepL.classList.remove(\"selected\");\r\n      sLibre.classList.remove(\"selected\");\r\n\r\n      sGoogle.classList.add(\"selected\");\r\n    };\r\n    sYandex.onclick = () => {\r\n      currentTextTranslatorService = \"yandex\";\r\n      twpConfig.set(\"textTranslatorService\", \"yandex\");\r\n      translateNewInput();\r\n\r\n      sGoogle.classList.remove(\"selected\");\r\n      sYandex.classList.remove(\"selected\");\r\n      sBing.classList.remove(\"selected\");\r\n      sDeepL.classList.remove(\"selected\");\r\n      sLibre.classList.remove(\"selected\");\r\n\r\n      sYandex.classList.add(\"selected\");\r\n    };\r\n    sBing.onclick = () => {\r\n      currentTextTranslatorService = \"bing\";\r\n      twpConfig.set(\"textTranslatorService\", \"bing\");\r\n      translateNewInput();\r\n\r\n      sGoogle.classList.remove(\"selected\");\r\n      sYandex.classList.remove(\"selected\");\r\n      sBing.classList.remove(\"selected\");\r\n      sDeepL.classList.remove(\"selected\");\r\n      sLibre.classList.remove(\"selected\");\r\n\r\n      sBing.classList.add(\"selected\");\r\n    };\r\n    sDeepL.onclick = () => {\r\n      currentTextTranslatorService = \"deepl\";\r\n      twpConfig.set(\"textTranslatorService\", \"deepl\");\r\n      translateNewInput();\r\n\r\n      sGoogle.classList.remove(\"selected\");\r\n      sYandex.classList.remove(\"selected\");\r\n      sBing.classList.remove(\"selected\");\r\n      sDeepL.classList.remove(\"selected\");\r\n      sLibre.classList.remove(\"selected\");\r\n\r\n      sDeepL.classList.add(\"selected\");\r\n    };\r\n    sLibre.onclick = () => {\r\n      currentTextTranslatorService = \"libre\";\r\n      twpConfig.set(\"textTranslatorService\", \"libre\");\r\n      translateNewInput();\r\n\r\n      sGoogle.classList.remove(\"selected\");\r\n      sYandex.classList.remove(\"selected\");\r\n      sBing.classList.remove(\"selected\");\r\n      sDeepL.classList.remove(\"selected\");\r\n      sLibre.classList.remove(\"selected\");\r\n\r\n      sLibre.classList.add(\"selected\");\r\n    };\r\n\r\n    const setTargetLanguage = shadowRoot.getElementById(\"setTargetLanguage\");\r\n    setTargetLanguage.onclick = (e) => {\r\n      if (e.target.getAttribute(\"value\")) {\r\n        const langCode = twpLang.fixTLanguageCode(\r\n          e.target.getAttribute(\"value\")\r\n        );\r\n        if (langCode) {\r\n          currentTargetLanguage = langCode;\r\n          twpConfig.setTargetLanguageTextTranslation(langCode);\r\n          translateNewInput();\r\n        }\r\n\r\n        shadowRoot.querySelectorAll(\"#setTargetLanguage li\").forEach((li) => {\r\n          li.classList.remove(\"selected\");\r\n        });\r\n\r\n        e.target.classList.add(\"selected\");\r\n      }\r\n    };\r\n\r\n    function onListenClick(type, element, text, language) {\r\n      const msgListen = twpI18n.getMessage(\"btnListen\");\r\n      const msgStopListening = twpI18n.getMessage(\"btnStopListening\");\r\n\r\n      eListenOriginal.classList.remove(\"selected\");\r\n      eListenTranslated.classList.remove(\"selected\");\r\n      eListenOriginal.setAttribute(\"title\", msgStopListening);\r\n      eListenTranslated.setAttribute(\"title\", msgStopListening);\r\n\r\n      if (isPlayingAudio) {\r\n        stopAudio();\r\n        element.classList.remove(\"selected\");\r\n      } else {\r\n        playAudio(text, language, () => {\r\n          element.classList.remove(\"selected\");\r\n          element.setAttribute(\"title\", msgListen);\r\n        });\r\n        element.classList.add(\"selected\");\r\n      }\r\n    }\r\n\r\n    let lastListenAudioType = null;\r\n    eListenOriginal.onclick = async () => {\r\n      let { lang, isReliable } = await detectTextLanguage(\r\n        eOrigText.textContent\r\n      );\r\n      if (!isReliable && originalTabLanguage !== \"und\") {\r\n        lang = originalTabLanguage;\r\n      }\r\n      if (lastListenAudioType !== \"original\") {\r\n        stopAudio();\r\n      }\r\n      lastListenAudioType = \"original\";\r\n      onListenClick(\"original\", eListenOriginal, eOrigText.textContent, lang);\r\n    };\r\n\r\n    eListenTranslated.onclick = () => {\r\n      if (lastListenAudioType !== \"translated\") {\r\n        stopAudio();\r\n      }\r\n      lastListenAudioType = \"translated\";\r\n      onListenClick(\r\n        \"translated\",\r\n        eListenTranslated,\r\n        eSelTextTrans.textContent,\r\n        currentTargetLanguage\r\n      );\r\n    };\r\n\r\n    document.body.appendChild(divElement);\r\n\r\n    twpI18n.translateDocument(shadowRoot);\r\n\r\n    if (platformInfo.isMobile.any) {\r\n      eButtonTransSelText.style.width = \"30px\";\r\n      eButtonTransSelText.style.height = \"30px\";\r\n      document.addEventListener(\"touchstart\", onTouchstart);\r\n    }\r\n\r\n    eButtonTransSelText.addEventListener(\"click\", onClick);\r\n    document.addEventListener(\"mousedown\", onDown);\r\n\r\n    const targetLanguageButtons = shadowRoot.querySelectorAll(\r\n      \"#setTargetLanguage li\"\r\n    );\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      if (currentTargetLanguages[i] == currentTargetLanguage) {\r\n        targetLanguageButtons[i].classList.add(\"selected\");\r\n      }\r\n      targetLanguageButtons[i].textContent = currentTargetLanguages[i];\r\n      targetLanguageButtons[i].setAttribute(\"value\", currentTargetLanguages[i]);\r\n      targetLanguageButtons[i].setAttribute(\r\n        \"title\",\r\n        twpLang.codeToLanguage(currentTargetLanguages[i])\r\n      );\r\n    }\r\n\r\n    if (currentTextTranslatorService === \"yandex\") {\r\n      sYandex.classList.add(\"selected\");\r\n    } else if (currentTextTranslatorService == \"deepl\") {\r\n      sDeepL.classList.add(\"selected\");\r\n    } else if (currentTextTranslatorService == \"bing\") {\r\n      sBing.classList.add(\"selected\");\r\n    } else if (currentTextTranslatorService == \"libre\") {\r\n      sLibre.classList.add(\"selected\");\r\n    } else {\r\n      sGoogle.classList.add(\"selected\");\r\n    }\r\n\r\n    const enabledServices = twpConfig.get(\"enabledServices\");\r\n    if (enabledServices.includes(\"google\")) {\r\n      sGoogle.removeAttribute(\"hidden\");\r\n    } else {\r\n      sGoogle.setAttribute(\"hidden\", \"\");\r\n    }\r\n    if (enabledServices.includes(\"bing\")) {\r\n      sBing.removeAttribute(\"hidden\");\r\n    } else {\r\n      sBing.setAttribute(\"hidden\", \"\");\r\n    }\r\n    if (enabledServices.includes(\"yandex\")) {\r\n      sYandex.removeAttribute(\"hidden\");\r\n    } else {\r\n      sYandex.setAttribute(\"hidden\", \"\");\r\n    }\r\n    if (enabledServices.includes(\"deepl\")) {\r\n      sDeepL.removeAttribute(\"hidden\");\r\n    } else {\r\n      sDeepL.setAttribute(\"hidden\", \"\");\r\n    }\r\n    if (twpConfig.get(\"customServices\").find((cs) => cs.name === \"libre\")) {\r\n      sLibre.removeAttribute(\"hidden\");\r\n    } else {\r\n      sLibre.setAttribute(\"hidden\", \"\");\r\n    }\r\n\r\n    if (\r\n      twpConfig.get(\"expandPanelTranslateSelectedText\") === \"yes\" ||\r\n      (prevSelectionInfo &&\r\n        (prevSelectionInfo.isContentEditable ||\r\n          prevSelectionInfo.isInputElement))\r\n    ) {\r\n      origTextContainer.style.display = \"block\";\r\n      eMore.style.display = \"none\";\r\n      eLess.style.display = \"block\";\r\n      eMoreOrLess.setAttribute(\"title\", twpI18n.getMessage(\"less\"));\r\n    } else {\r\n      origTextContainer.style.display = \"none\";\r\n      eMore.style.display = \"block\";\r\n      eLess.style.display = \"none\";\r\n      eMoreOrLess.setAttribute(\"title\", twpI18n.getMessage(\"more\"));\r\n    }\r\n\r\n    twpConfig.onChanged((name, newvalue) => {\r\n      switch (name) {\r\n        case \"enabledServices\": {\r\n          const enabledServices = newvalue;\r\n          if (enabledServices.includes(\"google\")) {\r\n            sGoogle.removeAttribute(\"hidden\");\r\n          } else {\r\n            sGoogle.setAttribute(\"hidden\", \"\");\r\n          }\r\n          if (enabledServices.includes(\"bing\")) {\r\n            sBing.removeAttribute(\"hidden\");\r\n          } else {\r\n            sBing.setAttribute(\"hidden\", \"\");\r\n          }\r\n          if (enabledServices.includes(\"yandex\")) {\r\n            sYandex.removeAttribute(\"hidden\");\r\n          } else {\r\n            sYandex.setAttribute(\"hidden\", \"\");\r\n          }\r\n          if (enabledServices.includes(\"deepl\")) {\r\n            sDeepL.removeAttribute(\"hidden\");\r\n          } else {\r\n            sDeepL.setAttribute(\"hidden\", \"\");\r\n          }\r\n          break;\r\n        }\r\n        case \"customServices\": {\r\n          if (newvalue.find((cs) => cs.name === \"libre\")) {\r\n            sLibre.removeAttribute(\"hidden\");\r\n          } else {\r\n            sLibre.setAttribute(\"hidden\", \"\");\r\n          }\r\n          break;\r\n        }\r\n        case \"expandPanelTranslateSelectedText\":\r\n          const prevHeight = parseInt(getComputedStyle(eDivResult).height);\r\n          if (newvalue === \"yes\") {\r\n            origTextContainer.style.display = \"block\";\r\n            eMore.style.display = \"none\";\r\n            eLess.style.display = \"block\";\r\n            eMoreOrLess.setAttribute(\"title\", twpI18n.getMessage(\"less\"));\r\n            eDivResult.style.top =\r\n              parseInt(eDivResult.style.top) +\r\n              (prevHeight - parseInt(getComputedStyle(eDivResult).height)) +\r\n              \"px\";\r\n          } else {\r\n            origTextContainer.style.display = \"none\";\r\n            eMore.style.display = \"block\";\r\n            eLess.style.display = \"none\";\r\n            eMoreOrLess.setAttribute(\"title\", twpI18n.getMessage(\"more\"));\r\n            eDivResult.style.top =\r\n              parseInt(eDivResult.style.top) +\r\n              (prevHeight - parseInt(getComputedStyle(eDivResult).height)) +\r\n              \"px\";\r\n          }\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  function destroy() {\r\n    window.isTranslatingSelected = false;\r\n    fooCount++;\r\n    stopAudio();\r\n    if (!divElement) return;\r\n\r\n    eButtonTransSelText.removeEventListener(\"click\", onClick);\r\n    document.removeEventListener(\"mousedown\", onDown);\r\n    if (platformInfo.isMobile.any) {\r\n      document.removeEventListener(\"touchstart\", onTouchstart);\r\n    }\r\n    divElement.remove();\r\n    divElement = eButtonTransSelText = eDivResult = null;\r\n  }\r\n\r\n  function destroyIfButtonIsShowing(e) {\r\n    if (\r\n      eButtonTransSelText &&\r\n      e.target !== divElement &&\r\n      eButtonTransSelText.style.display === \"block\"\r\n    ) {\r\n      destroy();\r\n    }\r\n  }\r\n\r\n  twpConfig.onChanged(function (name, newValue) {\r\n    switch (name) {\r\n      case \"textTranslatorService\":\r\n        currentTextTranslatorService = newValue;\r\n        break;\r\n      case \"targetLanguages\":\r\n        currentTargetLanguages = newValue;\r\n        break;\r\n      case \"targetLanguageTextTranslation\":\r\n        currentTargetLanguage = newValue;\r\n        break;\r\n      case \"alwaysTranslateSites\":\r\n        awaysTranslateThisSite = newValue.indexOf(tabHostName) !== -1;\r\n        updateEventListener();\r\n        break;\r\n      case \"neverTranslateSites\":\r\n        translateThisSite = newValue.indexOf(tabHostName) === -1;\r\n        updateEventListener();\r\n        break;\r\n      case \"neverTranslateLangs\":\r\n        translateThisLanguage = newValue.indexOf(originalTabLanguage) === -1;\r\n        updateEventListener();\r\n        break;\r\n      case \"showTranslateSelectedButton\":\r\n        showTranslateSelectedButton = newValue;\r\n        updateEventListener();\r\n        break;\r\n      case \"dontShowIfPageLangIsTargetLang\":\r\n        dontShowIfPageLangIsTargetLang = newValue;\r\n        updateEventListener();\r\n        break;\r\n      case \"dontShowIfPageLangIsUnknown\":\r\n        dontShowIfPageLangIsUnknown = newValue;\r\n        updateEventListener();\r\n        break;\r\n      case \"dontShowIfSelectedTextIsTargetLang\":\r\n        dontShowIfSelectedTextIsTargetLang = newValue;\r\n        break;\r\n      case \"dontShowIfSelectedTextIsUnknown\":\r\n        dontShowIfSelectedTextIsUnknown = newValue;\r\n        break;\r\n    }\r\n  });\r\n\r\n  function update_eDivResult(result = \"\") {\r\n    if (eDivResult.style.display !== \"block\") {\r\n      init();\r\n    }\r\n\r\n    function onloaded() {\r\n      const eTop = prevSelectionInfo.bottom;\r\n      const eLeft = prevSelectionInfo.left;\r\n\r\n      if (twpLang.isRtlLanguage(currentTargetLanguage)) {\r\n        eSelTextTrans.setAttribute(\"dir\", \"rtl\");\r\n      } else {\r\n        eSelTextTrans.setAttribute(\"dir\", \"ltr\");\r\n      }\r\n      eSelTextTrans.textContent = result;\r\n      let top = parseInt(eDivResult.style.top) || 0,\r\n        left = parseInt(eDivResult.style.left) || 0;\r\n      if (eDivResult.style.display !== \"block\") {\r\n        eDivResult.style.display = \"block\";\r\n        eDivResult.style.top = \"0px\";\r\n        eDivResult.style.left = \"0px\";\r\n        eOrigText.textContent = prevSelectionInfo.text;\r\n\r\n        setCaretAtEnd();\r\n\r\n        const height = parseInt(eDivResult.offsetHeight);\r\n        top = eTop + 5;\r\n        top = Math.max(0, top);\r\n        top = Math.min(window.innerHeight - height, top);\r\n\r\n        const width = parseInt(eDivResult.offsetWidth);\r\n        left = parseInt(eLeft /*- width / 2*/);\r\n        left = Math.max(0, left);\r\n        left = Math.min(window.innerWidth - width, left);\r\n      }\r\n\r\n      eDivResult.style.top =\r\n        Math.min(\r\n          window.innerHeight - parseInt(getComputedStyle(eDivResult).height),\r\n          top\r\n        ) + \"px\";\r\n      eDivResult.style.left =\r\n        Math.min(\r\n          window.innerWidth - parseInt(getComputedStyle(eDivResult).width) - 18,\r\n          left\r\n        ) + \"px\";\r\n    }\r\n\r\n    if (isCSSLoaded) {\r\n      onloaded();\r\n    } else {\r\n      const currentFooCount = fooCount;\r\n      onCSSLoad = () => {\r\n        onCSSLoad = null;\r\n        if (currentFooCount !== fooCount) return;\r\n        onloaded();\r\n      };\r\n    }\r\n  }\r\n\r\n  function translateNewInput() {\r\n    fooCount++;\r\n    const currentFooCount = fooCount;\r\n    stopAudio();\r\n\r\n    backgroundTranslateSingleText(\r\n      currentTextTranslatorService,\r\n      \"auto\",\r\n      currentTargetLanguage,\r\n      eOrigText.textContent\r\n    ).then((result) => {\r\n      if (currentFooCount !== fooCount) return;\r\n\r\n      update_eDivResult(result);\r\n    });\r\n  }\r\n\r\n  function translateSelText(usePrevSelectionInfo = false) {\r\n    if (!usePrevSelectionInfo && gSelectionInfo) {\r\n      prevSelectionInfo = gSelectionInfo;\r\n    } else if (!(usePrevSelectionInfo && prevSelectionInfo)) {\r\n      return;\r\n    }\r\n\r\n    eOrigText.textContent = prevSelectionInfo.text;\r\n\r\n    translateNewInput();\r\n    const currentFooCount = fooCount;\r\n    setTimeout(() => {\r\n      if (currentFooCount !== fooCount) return;\r\n      update_eDivResult(eSelTextTrans.textContent);\r\n      fooCount = currentFooCount;\r\n    }, 1000);\r\n  }\r\n\r\n  function onClick(e) {\r\n    translateSelText();\r\n    eButtonTransSelText.style.display = \"none\";\r\n  }\r\n\r\n  function onDown(e) {\r\n    if (e.target != divElement) {\r\n      eDivResult.style.display = \"none\";\r\n      eButtonTransSelText.style.display = \"none\";\r\n      destroy();\r\n    }\r\n  }\r\n\r\n  let isTouchSelection = false;\r\n\r\n  function onTouchstart(e) {\r\n    isTouchSelection = true;\r\n    onDown(e);\r\n  }\r\n\r\n  function getSelectionText() {\r\n    let text = \"\";\r\n    const activeEl = document.activeElement;\r\n    const activeElTagName = activeEl ? activeEl.tagName.toLowerCase() : null;\r\n    if (\r\n      activeElTagName == \"textarea\" ||\r\n      (activeElTagName == \"input\" &&\r\n        /^(?:text|search)$/i.test(activeEl.type) &&\r\n        typeof activeEl.selectionStart == \"number\")\r\n    ) {\r\n      text = activeEl.value.slice(\r\n        activeEl.selectionStart,\r\n        activeEl.selectionEnd\r\n      );\r\n    } else if (window.getSelection) {\r\n      text = window.getSelection().toString();\r\n    }\r\n    return text;\r\n  }\r\n\r\n  function readSelection(dontReadIfSelectionDontChange = false) {\r\n    let newSelectionInfo = null;\r\n\r\n    const activeEl = document.activeElement;\r\n    const activeElTagName = activeEl ? activeEl.tagName.toLowerCase() : null;\r\n    if (\r\n      activeElTagName == \"textarea\" ||\r\n      (activeElTagName == \"input\" &&\r\n        /^(?:text|search)$/i.test(activeEl.type) &&\r\n        typeof activeEl.selectionStart == \"number\")\r\n    ) {\r\n      const text = activeEl.value.slice(\r\n        activeEl.selectionStart,\r\n        activeEl.selectionEnd\r\n      );\r\n      const rect = activeEl.getBoundingClientRect();\r\n      newSelectionInfo = {\r\n        isInputElement: true,\r\n        isContentEditable: false,\r\n        element: activeEl,\r\n        selStart: activeEl.selectionStart,\r\n        selEnd: activeEl.selectionEnd,\r\n        text: text,\r\n        top: rect.top,\r\n        left: rect.left,\r\n        bottom: rect.bottom,\r\n        right: rect.right,\r\n      };\r\n    } else if (window.getSelection) {\r\n      const selection = window.getSelection();\r\n      if (selection.type == \"Range\") {\r\n        const text = selection.toString();\r\n        const rect = selection.getRangeAt(0).getBoundingClientRect();\r\n        newSelectionInfo = {\r\n          isInputElement: false,\r\n          isContentEditable:\r\n            selection.focusNode.nodeType === 3\r\n              ? selection.focusNode.parentNode.isContentEditable\r\n              : selection.focusNode.isContentEditable,\r\n          element: selection.focusNode,\r\n          selStart: selection.getRangeAt(0).startOffset,\r\n          selEnd: selection.getRangeAt(0).endOffset,\r\n          text: text,\r\n          top: rect.top,\r\n          left: rect.left,\r\n          bottom: rect.bottom,\r\n          right: rect.right,\r\n          range: selection.getRangeAt(0),\r\n        };\r\n      }\r\n    }\r\n\r\n    if (\r\n      dontReadIfSelectionDontChange &&\r\n      gSelectionInfo &&\r\n      newSelectionInfo &&\r\n      gSelectionInfo.text === newSelectionInfo.text\r\n    ) {\r\n      gSelectionInfo = newSelectionInfo;\r\n      return false;\r\n    }\r\n    gSelectionInfo = newSelectionInfo;\r\n    return true;\r\n  }\r\n\r\n  async function onUp(e) {\r\n    if (e.target == divElement) return;\r\n\r\n    const clientX = Math.max(\r\n      typeof e.clientX === \"undefined\" ? 0 : e.clientX,\r\n      typeof e.changedTouches === \"undefined\" ? 0 : e.changedTouches[0].clientX\r\n    );\r\n    const clientY = Math.max(\r\n      typeof e.clientY === \"undefined\" ? 0 : e.clientY,\r\n      typeof e.changedTouches === \"undefined\" ? 0 : e.changedTouches[0].clientY\r\n    );\r\n\r\n    const selectedText = getSelectionText().trim();\r\n    if (!selectedText || selectedText.length < 1) return;\r\n    let detectedLanguage = (await detectTextLanguage(selectedText)).lang;\r\n    if (!detectedLanguage) detectedLanguage = \"und\";\r\n\r\n    if (\r\n      ((dontShowIfSelectedTextIsTargetLang == \"yes\" &&\r\n        detectedLanguage !== currentTargetLanguage) ||\r\n        dontShowIfSelectedTextIsTargetLang != \"yes\") &&\r\n      ((dontShowIfSelectedTextIsUnknown == \"yes\" &&\r\n        detectedLanguage !== \"und\") ||\r\n        dontShowIfSelectedTextIsUnknown != \"yes\")\r\n    ) {\r\n      init();\r\n      if (platformInfo.isMobile.any) {\r\n        eButtonTransSelText.style.left = window.innerWidth - 45 + \"px\";\r\n        eButtonTransSelText.style.top = clientY + \"px\";\r\n      } else {\r\n        eButtonTransSelText.style.left =\r\n          Math.min(window.innerWidth - 40, clientX + 25) + \"px\";\r\n        eButtonTransSelText.style.top = Math.max(2, clientY - 35) + \"px\";\r\n      }\r\n\r\n      eButtonTransSelText.style.display = \"block\";\r\n    }\r\n  }\r\n\r\n  let showButtonTimerHandler = null;\r\n\r\n  function onMouseup(e) {\r\n    if (e.button != 0) return;\r\n    if (e.target == divElement) return;\r\n    if (readSelection(true)) {\r\n      clearTimeout(showButtonTimerHandler);\r\n      showButtonTimerHandler = setTimeout(() => onUp(e), 150);\r\n    }\r\n  }\r\n\r\n  function onTouchend(e) {\r\n    if (e.target == divElement) return;\r\n    readSelection();\r\n    clearTimeout(showButtonTimerHandler);\r\n    showButtonTimerHandler = setTimeout(() => onUp(e), 150);\r\n  }\r\n\r\n  function onSelectionchange(e) {\r\n    if (isTouchSelection) {\r\n      readSelection();\r\n    }\r\n  }\r\n\r\n  function isSelectingText() {\r\n    const activeEl = document.activeElement;\r\n    const activeElTagName = activeEl ? activeEl.tagName.toLowerCase() : null;\r\n    if (\r\n      activeElTagName == \"textarea\" ||\r\n      (activeElTagName == \"input\" &&\r\n        /^(?:text|search)$/i.test(activeEl.type) &&\r\n        typeof activeEl.selectionStart == \"number\")\r\n    ) {\r\n      const text = activeEl.value.slice(\r\n        activeEl.selectionStart,\r\n        activeEl.selectionEnd\r\n      );\r\n      if (text) return true;\r\n    } else if (window.getSelection) {\r\n      const selection = window.getSelection();\r\n      if (selection.type == \"Range\") {\r\n        const text = selection.toString();\r\n        if (text) return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  let lastTimePressedCtrl = null;\r\n\r\n  function onKeyUp(e) {\r\n    if (twpConfig.get(\"translateSelectedWhenPressTwice\") !== \"yes\") return;\r\n    if (e.key == \"Control\") {\r\n      if (\r\n        lastTimePressedCtrl &&\r\n        performance.now() - lastTimePressedCtrl < 280 &&\r\n        isSelectingText()\r\n      ) {\r\n        lastTimePressedCtrl = performance.now();\r\n        readSelection();\r\n        init();\r\n        translateSelText();\r\n      }\r\n      lastTimePressedCtrl = performance.now();\r\n    }\r\n  }\r\n\r\n  document.addEventListener(\"keyup\", onKeyUp);\r\n\r\n  let windowIsInFocus = true;\r\n  window.addEventListener(\"focus\", function (e) {\r\n    windowIsInFocus = true;\r\n    chrome.runtime.sendMessage(\r\n      { action: \"thisFrameIsInFocus\" },\r\n      checkedLastError\r\n    );\r\n  });\r\n  window.addEventListener(\"blur\", function (e) {\r\n    windowIsInFocus = false;\r\n  });\r\n\r\n  window.addEventListener(\"beforeunload\", function (e) {\r\n    destroy();\r\n  });\r\n\r\n  function updateEventListener() {\r\n    if (\r\n      showTranslateSelectedButton == \"yes\" &&\r\n      (awaysTranslateThisSite ||\r\n        (translateThisSite && translateThisLanguage)) &&\r\n      ((dontShowIfPageLangIsTargetLang == \"yes\" &&\r\n        originalTabLanguage !== currentTargetLanguage) ||\r\n        dontShowIfPageLangIsTargetLang != \"yes\") &&\r\n      ((dontShowIfPageLangIsUnknown == \"yes\" &&\r\n        originalTabLanguage !== \"und\") ||\r\n        dontShowIfPageLangIsUnknown != \"yes\")\r\n    ) {\r\n      document.addEventListener(\"mouseup\", onMouseup);\r\n\r\n      document.addEventListener(\"blur\", destroyIfButtonIsShowing);\r\n      document.addEventListener(\"visibilitychange\", destroyIfButtonIsShowing);\r\n\r\n      document.addEventListener(\"keydown\", destroyIfButtonIsShowing);\r\n      document.addEventListener(\"mousedown\", destroyIfButtonIsShowing);\r\n      document.addEventListener(\"wheel\", destroyIfButtonIsShowing);\r\n\r\n      if (platformInfo.isMobile.any) {\r\n        document.addEventListener(\"touchend\", onTouchend);\r\n        document.addEventListener(\"selectionchange\", onSelectionchange);\r\n      }\r\n    } else {\r\n      document.removeEventListener(\"mouseup\", onMouseup);\r\n\r\n      document.removeEventListener(\"blur\", destroyIfButtonIsShowing);\r\n      document.removeEventListener(\r\n        \"visibilitychange\",\r\n        destroyIfButtonIsShowing\r\n      );\r\n\r\n      document.removeEventListener(\"keydown\", destroyIfButtonIsShowing);\r\n      document.removeEventListener(\"mousedown\", destroyIfButtonIsShowing);\r\n      document.removeEventListener(\"wheel\", destroyIfButtonIsShowing);\r\n\r\n      if (platformInfo.isMobile.any) {\r\n        document.removeEventListener(\"touchend\", onTouchend);\r\n        document.removeEventListener(\"selectionchange\", onSelectionchange);\r\n      }\r\n    }\r\n  }\r\n\r\n  updateEventListener();\r\n\r\n  chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\r\n    if (request.action === \"TranslateSelectedText\") {\r\n      readSelection();\r\n      init();\r\n      translateSelText();\r\n    } else if (request.action === \"anotherFrameIsInFocus\") {\r\n      if (!windowIsInFocus) {\r\n        destroy();\r\n      }\r\n    } else if (request.action === \"hotTranslateSelectedText\") {\r\n      readSelection();\r\n      const prevSelInfo = gSelectionInfo;\r\n      if (\r\n        !prevSelInfo?.element?.focus &&\r\n        !prevSelInfo?.element?.parentNode?.focus\r\n      )\r\n        return;\r\n      if (prevSelInfo.isInputElement && prevSelInfo.readOnly) return;\r\n      if (prevSelInfo.text) {\r\n        backgroundTranslateSingleText(\r\n          currentTextTranslatorService,\r\n          \"auto\",\r\n          currentTargetLanguage,\r\n          prevSelInfo.text\r\n        ).then((result) => {\r\n          if (!result) return;\r\n          destroy();\r\n          if (prevSelInfo.element.nodeType === 3) {\r\n            prevSelInfo.element.parentNode.focus();\r\n          } else {\r\n            prevSelInfo.element.focus();\r\n          }\r\n          document.execCommand(\"selectAll\", false);\r\n          if (prevSelInfo.isInputElement) {\r\n            prevSelInfo.element.setSelectionRange(\r\n              prevSelInfo.selStart,\r\n              prevSelInfo.selEnd\r\n            );\r\n          } else if (prevSelInfo.isContentEditable) {\r\n            const selection = window.getSelection();\r\n            selection.removeAllRanges();\r\n            selection.addRange(prevSelInfo.range);\r\n          }\r\n          document.execCommand(\"insertText\", false, result);\r\n        });\r\n      }\r\n    }\r\n  });\r\n});\r\n"],"mappings":"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;IAEvC,MAAMC,UAAU,GAAG9F,UAAU,CAAC+F,YAAY,CAAC;MACzCC,IAAI,EAAE;IACR,CAAC,CAAC;IAEFF,UAAU,CAACG,SAAS,GAAI;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;IAEL,MAAMC,IAAI,GAAGzC,QAAQ,CAACkC,aAAa,CAAC,MAAM,CAAC;IAC3CO,IAAI,CAACC,YAAY,CAAC,KAAK,EAAE,YAAY,CAAC;IACtCD,IAAI,CAACC,YAAY,CACf,MAAM,EACNjH,MAAM,CAACC,OAAO,CAACiH,MAAM,CAAC,0CAA0C,CAClE,CAAC;IACDb,WAAW,GAAG,KAAK;IACnBW,IAAI,CAACG,MAAM,GAAIlD,CAAC,IAAK;MACnBoC,WAAW,GAAG,IAAI;MAClB,IAAID,SAAS,EAAEA,SAAS,CAAC,CAAC;IAC5B,CAAC;IACDQ,UAAU,CAACQ,WAAW,CAACJ,IAAI,CAAC;IAE5B,MAAMK,QAAQ,GAAG9C,QAAQ,CAACkC,aAAa,CAAC,OAAO,CAAC;IAChDY,QAAQ,CAACvB,WAAW,GAAI;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;IACCc,UAAU,CAACQ,WAAW,CAACC,QAAQ,CAAC;IAEhC7D,WAAW,CACToD,UAAU,CAACU,cAAc,CAAC,YAAY,CAAC,EACvCV,UAAU,CAACU,cAAc,CAAC,MAAM,CAClC,CAAC;IAED,MAAMC,SAAS,GAAGC,SAAS,CAACC,SAAS,CAACC,WAAW,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"}
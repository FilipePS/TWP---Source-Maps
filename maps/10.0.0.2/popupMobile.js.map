{"version":3,"file":"../../contentScript/popupMobile.js","names":["getTabHostName","Promise","resolve","chrome","runtime","sendMessage","action","result","checkedLastError","twpConfig","onReady","platformInfo","isMobile","any","get","tabHostName","tabLanguage","pageLanguageState","htmlText","fetch","getURL","then","response","text","googleIcon","blob","yandexIcon","bingIcon","twpI18n","updateUiMessages","rootElement","document","createElement","style","cssText","classList","add","shadowRoot","attachShadow","mode","innerHTML","setInterval","popupElement","getElementById","menuOptions","setProperty","clientHeight","lastInteraction","Date","now","lastInteractionInterval","serviceSelectorIsOpen","showPopup","clearInterval","updatePadding","padding","documentElement","height","paddingTop","paddingBottom","scrollHeight","isConnected","appendChild","menuContainer","display","hidePopup","updateInterface","withoutAnimation","mainElement","querySelector","animation","animate","transform","opacity","duration","iterations","onfinish","remove","setTimeout","twpLang","isRtlLanguage","fixUILanguageCode","i18n","getUILanguage","setAttribute","translateDocument","ontouchstart","e","target","stopImmediatePropagation","startPoint","x","touches","clientX","y","clientY","ontouchmove","offset","Math","abs","window","innerWidth","ontouchend","ontouchcancel","transition","ontransitionend","serviceIconElement","updateServiceIcon","service","src","URL","createObjectURL","onload","revokeObjectURL","serviceSelector","onclick","scale","rotate","onchange","value","set","pageTranslator","swapTranslationService","onblur","gearButton","menuBg","closeMenu","onMenuOptionClick","dataset","onanimationend","fixTLanguageCode","indexOf","addLangToAlwaysTranslate","translatePage","removeLangFromAlwaysTranslate","addLangToNeverTranslate","restorePage","removeLangFromNeverTranslate","addSiteToNeverTranslate","removeSiteFromNeverTranslate","generateRandomHash","length","characters","hash","i","charAt","floor","random","authorizationToOpenOptions","open","questionElement","btnTranslate","textContent","getMessage","from_to_element","codeToLanguage","bottomStyle","id","onPageLanguageStateChange","_pageLanguageState","langs","getLanguageList","langsSorted","push","sort","a","b","localeCompare","menuSelectLanguage","eAllLangs","forEach","option","eRecentsLangs","buildRecentsLanguages","oninput","setTargetLanguage","addEventListener","onMessage","addListener","request","sender","sendResponse","onGetOriginalTabLanguage","_tabLanguage","updateTheme","darkMode","matchMedia","matches","lightModeElement","onChanged","name","newValue"],"sources":["popupMobile.js"],"sourcesContent":["\"use strict\";\r\n\r\nfunction getTabHostName() {\r\n  return new Promise((resolve) =>\r\n    chrome.runtime.sendMessage({ action: \"getTabHostName\" }, (result) => {\r\n      checkedLastError();\r\n      resolve(result);\r\n    })\r\n  );\r\n}\r\n\r\nvoid (async function () {\r\n  await twpConfig.onReady();\r\n  if (\r\n    !platformInfo.isMobile.any &&\r\n    twpConfig.get(\"showMobilePopupOnDesktop\") !== \"yes\"\r\n  )\r\n    return;\r\n\r\n  const tabHostName = await getTabHostName();\r\n  let tabLanguage = \"und\";\r\n  let pageLanguageState = \"original\";\r\n\r\n  // load html and icons\r\n  const htmlText = await fetch(\r\n    chrome.runtime.getURL(\"/contentScript/html/popupMobile.html\")\r\n  ).then((response) => response.text());\r\n  const googleIcon = await fetch(\r\n    chrome.runtime.getURL(\"/icons/google-translate-32.png\")\r\n  ).then((response) => response.blob());\r\n  const yandexIcon = await fetch(\r\n    chrome.runtime.getURL(\"/icons/yandex-translate-32.png\")\r\n  ).then((response) => response.blob());\r\n  const bingIcon = await fetch(\r\n    chrome.runtime.getURL(\"/icons/bing-translate-32.png\")\r\n  ).then((response) => response.blob());\r\n\r\n  // Load i18n messages based on your language preference\r\n  await twpI18n.updateUiMessages();\r\n\r\n  // creates shadow root, root element and append to document\r\n  const rootElement = document.createElement(\"div\");\r\n  rootElement.style.cssText = \"all: initial\";\r\n  rootElement.classList.add(\"notranslate\");\r\n\r\n  const shadowRoot = rootElement.attachShadow({ mode: \"closed\" });\r\n  shadowRoot.innerHTML = htmlText;\r\n\r\n  // update css property --popup-height\r\n  setInterval(() => {\r\n    const popupElement = shadowRoot.getElementById(\"popup\");\r\n    const menuOptions = shadowRoot.getElementById(\"menu-options\");\r\n    menuOptions.style.setProperty(\r\n      \"--popup-height\",\r\n      `${popupElement.clientHeight}px`\r\n    );\r\n  }, 1000);\r\n\r\n  // remove popup after 8 seconds of inactivity\r\n  let lastInteraction = Date.now();\r\n  let lastInteractionInterval = null;\r\n  let serviceSelectorIsOpen = false;\r\n\r\n  function showPopup() {\r\n    lastInteraction = Date.now();\r\n    clearInterval(lastInteractionInterval);\r\n\r\n    const updatePadding = () => {\r\n      if (twpConfig.get(\"addPaddingToPage\") === \"yes\") {\r\n        const popupElement = shadowRoot.getElementById(\"popup\");\r\n        let padding = popupElement.clientHeight + \"px\";\r\n\r\n        \r\n        document.documentElement.style.height = null;\r\n        document.documentElement.style.paddingTop = null;\r\n        document.documentElement.style.paddingBottom = null;\r\n\r\n        document.documentElement.style.height =\r\n          document.documentElement.scrollHeight + \"px\";\r\n        if (twpConfig.get(\"popupMobilePosition\") === \"top\") {\r\n          document.documentElement.style.paddingTop = padding;\r\n          document.documentElement.style.paddingBottom = null;\r\n        } else {\r\n          document.documentElement.style.paddingTop = null;\r\n          document.documentElement.style.paddingBottom = padding;\r\n        }\r\n      }\r\n    };\r\n\r\n    if (!rootElement.isConnected) {\r\n      document.documentElement.appendChild(rootElement);\r\n      updatePadding();\r\n\r\n      lastInteractionInterval = setInterval(() => {\r\n        updatePadding();\r\n\r\n        const menuContainer = shadowRoot.getElementById(\"menu-container\");\r\n        if (\r\n          Date.now() - lastInteraction > 1000 * 8 &&\r\n          menuContainer.style.display !== \"block\" &&\r\n          serviceSelectorIsOpen === false &&\r\n          twpConfig.get(\"popupMobileKeepOnScren\") === \"no\"\r\n        ) {\r\n          hidePopup();\r\n        }\r\n      }, 1000);\r\n\r\n      updateInterface();\r\n    }\r\n  }\r\n\r\n  function hidePopup(withoutAnimation = false) {\r\n    clearInterval(lastInteractionInterval);\r\n    if (rootElement.isConnected && !withoutAnimation) {\r\n      const mainElement = shadowRoot.querySelector(\"main\");\r\n      const animation = mainElement.animate(\r\n        [\r\n          { transform: \"translateY(0px)\", opacity: \"1\" },\r\n          {\r\n            transform: `translateY(${\r\n              twpConfig.get(\"popupMobilePosition\") === \"top\" ? \"-50px\" : \"50px\"\r\n            })`,\r\n            opacity: \"0\",\r\n          },\r\n        ],\r\n        {\r\n          duration: 200,\r\n          iterations: 1,\r\n        }\r\n      );\r\n      animation.onfinish = () => {\r\n        rootElement.remove();\r\n      };\r\n      setTimeout(() => {\r\n        rootElement.remove();\r\n        animation.onfinish = null;\r\n      }, 300);\r\n      const menuContainer = shadowRoot.getElementById(\"menu-container\");\r\n      menuContainer.style.display = \"none\";\r\n    }\r\n\r\n    if (withoutAnimation) {\r\n      rootElement.remove();\r\n    }\r\n\r\n    if (twpConfig.get(\"addPaddingToPage\") === \"yes\") {\r\n      document.documentElement.style.height = null;\r\n      document.documentElement.style.paddingTop = null;\r\n      document.documentElement.style.paddingBottom = null;\r\n    }\r\n  }\r\n\r\n  // set text direction\r\n  if (\r\n    twpLang.isRtlLanguage(\r\n      twpConfig.get(\"uiLanguage\") ||\r\n        twpLang.fixUILanguageCode(chrome.i18n.getUILanguage())\r\n    )\r\n  ) {\r\n    shadowRoot.querySelector(\"main\").setAttribute(\"dir\", \"rtl\");\r\n  }\r\n\r\n  // translate shadow root\r\n  twpI18n.translateDocument(shadowRoot);\r\n\r\n  // close popup\r\n  const popupElement = shadowRoot.getElementById(\"popup\");\r\n  popupElement.ontouchstart = (e) => {\r\n    if (e.target !== popupElement) return;\r\n    lastInteraction = Date.now();\r\n\r\n    e.stopImmediatePropagation();\r\n    const startPoint = { x: e.touches[0].clientX, y: e.touches[0].clientY };\r\n    popupElement.ontouchmove = (e) => {\r\n      lastInteraction = Date.now();\r\n\r\n      e.stopImmediatePropagation();\r\n      const offset = e.touches[0].clientX - startPoint.x;\r\n      popupElement.style.transform = `translateX(${offset}px)`;\r\n\r\n      if (Math.abs(offset) > window.innerWidth * 0.2) {\r\n        popupElement.ontouchmove = null;\r\n        popupElement.ontouchend = null;\r\n        popupElement.ontouchcancel = null;\r\n\r\n        popupElement.style.transition = `transform 0.3s ease-in-out`;\r\n        if (offset > 0) {\r\n          popupElement.style.transform = `translateX(100%)`;\r\n        } else {\r\n          popupElement.style.transform = `translateX(-100%)`;\r\n        }\r\n        popupElement.ontransitionend = () => {\r\n          hidePopup(true);\r\n          popupElement.ontransitionend = null;\r\n          popupElement.style.cssText = \"\";\r\n        };\r\n        setTimeout(() => {\r\n          hidePopup(true);\r\n          popupElement.ontransitionend = null;\r\n          popupElement.style.cssText = \"\";\r\n        }, 400);\r\n      }\r\n    };\r\n\r\n    popupElement.ontouchend = (e) => {\r\n      lastInteraction = Date.now();\r\n\r\n      e.stopImmediatePropagation();\r\n      popupElement.style.transform = `translateX(0px)`;\r\n    };\r\n    popupElement.ontouchcancel = (e) => {\r\n      lastInteraction = Date.now();\r\n\r\n      e.stopImmediatePropagation();\r\n      popupElement.style.transform = `translateX(0px)`;\r\n    };\r\n  };\r\n\r\n  // update service icon\r\n  const serviceIconElement = /** @type {HTMLImageElement} */ (\r\n    shadowRoot.getElementById(\"serviceIcon\")\r\n  );\r\n  const updateServiceIcon = () => {\r\n    const service = twpConfig.get(\"pageTranslatorService\");\r\n    if (service === \"google\") {\r\n      serviceIconElement.src = URL.createObjectURL(googleIcon);\r\n    } else if (service === \"yandex\") {\r\n      serviceIconElement.src = URL.createObjectURL(yandexIcon);\r\n    } else if (service === \"bing\") {\r\n      serviceIconElement.src = URL.createObjectURL(bingIcon);\r\n    }\r\n    serviceIconElement.onload = () => {\r\n      serviceIconElement.onload = null;\r\n      URL.revokeObjectURL(serviceIconElement.src);\r\n    };\r\n  };\r\n  updateServiceIcon();\r\n\r\n  // select translation service\r\n  const serviceSelector = /** @type {HTMLSelectElement} */ (\r\n    shadowRoot.getElementById(\"serviceSelector\")\r\n  );\r\n  serviceSelector.onclick = () => {\r\n    serviceSelectorIsOpen = true;\r\n    lastInteraction = Date.now();\r\n\r\n    serviceIconElement.style.scale = \"1.5\";\r\n    serviceIconElement.style.rotate = \"180deg\";\r\n  };\r\n  serviceSelector.onchange = () => {\r\n    serviceSelectorIsOpen = false;\r\n    lastInteraction = Date.now();\r\n\r\n    const service = serviceSelector.value;\r\n    twpConfig.set(\"pageTranslatorService\", service);\r\n    updateServiceIcon();\r\n\r\n    serviceIconElement.style.scale = null;\r\n    serviceIconElement.style.rotate = null;\r\n\r\n    pageTranslator.swapTranslationService(service);\r\n  };\r\n  serviceSelector.onblur = () => {\r\n    serviceSelectorIsOpen = false;\r\n    lastInteraction = Date.now();\r\n\r\n    serviceIconElement.style.scale = null;\r\n    serviceIconElement.style.rotate = null;\r\n  };\r\n  serviceSelector.value = twpConfig.get(\"pageTranslatorService\");\r\n\r\n  // gear button\r\n  const gearButton = shadowRoot.getElementById(\"gear\");\r\n  gearButton.onclick = () => {\r\n    lastInteraction = Date.now();\r\n\r\n    gearButton.classList.add(\"rotate\");\r\n    const menuContainer = shadowRoot.getElementById(\"menu-container\");\r\n    menuContainer.style.display = \"block\";\r\n\r\n    const menuBg = shadowRoot.getElementById(\"menu-bg\");\r\n    menuBg.onclick = (e) => {\r\n      lastInteraction = Date.now();\r\n\r\n      e.stopImmediatePropagation();\r\n      closeMenu();\r\n    };\r\n\r\n    const menuOptions = shadowRoot.getElementById(\"menu-options\");\r\n    menuOptions.onclick = (e) => {\r\n      lastInteraction = Date.now();\r\n\r\n      const target = /** @type {HTMLElement} */ (e.target);\r\n      e.stopImmediatePropagation();\r\n      onMenuOptionClick(target.dataset.value);\r\n    };\r\n  };\r\n\r\n  // close menu\r\n  function closeMenu() {\r\n    const gearButton = shadowRoot.getElementById(\"gear\");\r\n    const menuContainer = shadowRoot.getElementById(\"menu-container\");\r\n\r\n    gearButton.classList.remove(\"rotate\");\r\n    menuContainer.style.animation = \"expand 0.3s ease-out reverse\";\r\n    menuContainer.onanimationend = () => {\r\n      menuContainer.onanimationend = null;\r\n      menuContainer.style.display = \"none\";\r\n      menuContainer.style.animation = null;\r\n    };\r\n  }\r\n\r\n  // menu options\r\n  /**\r\n   * @param {string} action\r\n   * @returns\r\n   */\r\n  function onMenuOptionClick(action) {\r\n    if (!action) return;\r\n\r\n    if (action === \"choose-another-language\") {\r\n      return;\r\n    } else if (action === \"always-translate-from\") {\r\n      tabLanguage = twpLang.fixTLanguageCode(tabLanguage);\r\n      if (twpConfig.get(\"alwaysTranslateLangs\").indexOf(tabLanguage) === -1) {\r\n        twpConfig.addLangToAlwaysTranslate(tabLanguage);\r\n        pageTranslator.translatePage();\r\n      } else {\r\n        twpConfig.removeLangFromAlwaysTranslate(tabLanguage);\r\n      }\r\n    } else if (action === \"never-translate-from\") {\r\n      tabLanguage = twpLang.fixTLanguageCode(tabLanguage);\r\n      if (twpConfig.get(\"neverTranslateLangs\").indexOf(tabLanguage) === -1) {\r\n        twpConfig.addLangToNeverTranslate(tabLanguage);\r\n        pageTranslator.restorePage();\r\n      } else {\r\n        twpConfig.removeLangFromNeverTranslate(tabLanguage);\r\n      }\r\n    } else if (action === \"never-translate-this-site\") {\r\n      if (twpConfig.get(\"neverTranslateSites\").indexOf(tabHostName) === -1) {\r\n        twpConfig.addSiteToNeverTranslate(tabHostName);\r\n        pageTranslator.restorePage();\r\n      } else {\r\n        twpConfig.removeSiteFromNeverTranslate(tabHostName);\r\n      }\r\n    } else if (action === \"show-translate-selected-button\") {\r\n      twpConfig.set(\r\n        \"showTranslateSelectedButton\",\r\n        twpConfig.get(\"showTranslateSelectedButton\") === \"yes\" ? \"no\" : \"yes\"\r\n      );\r\n    } else if (action === \"more-options\") {\r\n      const generateRandomHash = (length) => {\r\n        const characters =\r\n          \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\r\n        let hash = \"\";\r\n        for (let i = 0; i < length; i++) {\r\n          hash += characters.charAt(\r\n            Math.floor(Math.random() * characters.length)\r\n          );\r\n        }\r\n        return hash;\r\n      };\r\n      const authorizationToOpenOptions = generateRandomHash(32);\r\n      chrome.runtime.sendMessage({\r\n        action: \"authorizationToOpenOptions\",\r\n        authorizationToOpenOptions,\r\n      });\r\n      window.open(\r\n        chrome.runtime.getURL(\"/options/open-options.html\") +\r\n          `#!authorizationToOpenOptions=${authorizationToOpenOptions}`,\r\n        \"blank\"\r\n      );\r\n    } else if (action === \"keep-on-screen\") {\r\n      twpConfig.set(\r\n        \"popupMobileKeepOnScren\",\r\n        twpConfig.get(\"popupMobileKeepOnScren\") === \"yes\" ? \"no\" : \"yes\"\r\n      );\r\n    } else if (action === \"change-position\") {\r\n      twpConfig.set(\r\n        \"popupMobilePosition\",\r\n        twpConfig.get(\"popupMobilePosition\") === \"top\" ? \"bottom\" : \"top\"\r\n      );\r\n    }\r\n\r\n    closeMenu();\r\n\r\n    updateInterface();\r\n  }\r\n\r\n  // update interface\r\n  function updateInterface() {\r\n    // update the question text\r\n    const questionElement = shadowRoot.getElementById(\"question\");\r\n    const btnTranslate = shadowRoot.getElementById(\"btnTranslate\");\r\n    if (pageLanguageState === \"original\") {\r\n      questionElement.textContent = twpI18n.getMessage(\"msgTranslatePage\");\r\n      btnTranslate.textContent = twpI18n.getMessage(\"btnTranslate\");\r\n    } else {\r\n      questionElement.textContent = twpI18n.getMessage(\"msgPageTranslated\");\r\n      btnTranslate.textContent = twpI18n.getMessage(\"btnUndoTranslation\");\r\n    }\r\n\r\n    // update show-translate-selected-button checkicon\r\n    if (twpConfig.get(\"showTranslateSelectedButton\") === \"yes\") {\r\n      shadowRoot.querySelector(\r\n        `#menu-options [data-value=\"show-translate-selected-button\"] [checkicon]`\r\n      ).textContent = \"✔\";\r\n    } else {\r\n      shadowRoot.querySelector(\r\n        `#menu-options [data-value=\"show-translate-selected-button\"] [checkicon]`\r\n      ).textContent = \"\";\r\n    }\r\n\r\n    // update never-translate-this-site checkicon\r\n    if (twpConfig.get(\"neverTranslateSites\").indexOf(tabHostName) !== -1) {\r\n      shadowRoot.querySelector(\r\n        `#menu-options [data-value=\"never-translate-this-site\"] [checkicon]`\r\n      ).textContent = \"✔\";\r\n    } else {\r\n      shadowRoot.querySelector(\r\n        `#menu-options [data-value=\"never-translate-this-site\"] [checkicon]`\r\n      ).textContent = \"\";\r\n    }\r\n\r\n    tabLanguage = twpLang.fixTLanguageCode(tabLanguage) || \"und\";\r\n\r\n    // update from-to text when original tab is detected\r\n    const from_to_element = shadowRoot.getElementById(\"from-to\");\r\n    from_to_element.textContent = twpI18n.getMessage(\"msgTranslateFromTo\", [\r\n      twpLang.codeToLanguage(tabLanguage),\r\n      twpLang.codeToLanguage(twpConfig.get(\"targetLanguage\")),\r\n    ]);\r\n\r\n    // show or hide always-translate-from and never-translate-from\r\n    if (\r\n      tabLanguage === \"und\" ||\r\n      tabLanguage == twpConfig.get(\"targetLanguage\")\r\n    ) {\r\n      shadowRoot.querySelector(\r\n        `#menu-options [data-value=\"always-translate-from\"]`\r\n      ).style.display = \"none\";\r\n      shadowRoot.querySelector(\r\n        `#menu-options [data-value=\"never-translate-from\"]`\r\n      ).style.display = \"none\";\r\n    } else {\r\n      shadowRoot.querySelector(\r\n        `#menu-options [data-value=\"always-translate-from\"]`\r\n      ).style.display = \"flex\";\r\n      shadowRoot.querySelector(\r\n        `#menu-options [data-value=\"never-translate-from\"]`\r\n      ).style.display = \"flex\";\r\n    }\r\n\r\n    // update always-translate-from text\r\n    shadowRoot.querySelector(\r\n      `#menu-options [data-value=\"always-translate-from\"] [data-i18n]`\r\n    ).textContent = twpI18n.getMessage(\"lblAlwaysTranslate\", [\r\n      twpLang.codeToLanguage(tabLanguage),\r\n    ]);\r\n\r\n    // update always-translate-from checkicon\r\n    if (twpConfig.get(\"alwaysTranslateLangs\").indexOf(tabLanguage) !== -1) {\r\n      shadowRoot.querySelector(\r\n        `#menu-options [data-value=\"always-translate-from\"] [checkicon]`\r\n      ).textContent = \"✔\";\r\n    } else {\r\n      shadowRoot.querySelector(\r\n        `#menu-options [data-value=\"always-translate-from\"] [checkicon]`\r\n      ).textContent = \"\";\r\n    }\r\n\r\n    // update never-translate-from checkicon\r\n    if (twpConfig.get(\"neverTranslateLangs\").indexOf(tabLanguage) !== -1) {\r\n      shadowRoot.querySelector(\r\n        `#menu-options [data-value=\"never-translate-from\"] [checkicon]`\r\n      ).textContent = \"✔\";\r\n    } else {\r\n      shadowRoot.querySelector(\r\n        `#menu-options [data-value=\"never-translate-from\"] [checkicon]`\r\n      ).textContent = \"\";\r\n    }\r\n\r\n    // update keep-on-screen checkicon\r\n    if (twpConfig.get(\"popupMobileKeepOnScren\") === \"yes\") {\r\n      shadowRoot.querySelector(\r\n        `#menu-options [data-value=\"keep-on-screen\"] [checkicon]`\r\n      ).textContent = \"✔\";\r\n    } else {\r\n      shadowRoot.querySelector(\r\n        `#menu-options [data-value=\"keep-on-screen\"] [checkicon]`\r\n      ).textContent = \"\";\r\n    }\r\n\r\n    // update change-position\r\n    if (twpConfig.get(\"popupMobilePosition\") === \"top\") {\r\n      const bottomStyle = shadowRoot.getElementById(\"bottom-style\");\r\n      if (bottomStyle) bottomStyle.remove();\r\n    } else {\r\n      const bottomStyle = shadowRoot.getElementById(\"bottom-style\");\r\n      if (!bottomStyle) {\r\n        const bottomStyle = document.createElement(\"style\");\r\n        bottomStyle.id = \"bottom-style\";\r\n        bottomStyle.textContent = `\r\n          main {\r\n            bottom: 0;\r\n            display: flex;\r\n            flex-direction: column-reverse;\r\n          }\r\n\r\n          #menu-options {\r\n            top: 5px;\r\n            box-shadow: 0 -3px 6px 0 var(--shadow-color);\r\n          }\r\n\r\n          @keyframes popup {\r\n            0% {\r\n                opacity: 0;\r\n                transform: translateY(50px);\r\n            }\r\n    \r\n            100% {\r\n                opacity: 1;\r\n                transform: translateY(0);\r\n            }\r\n          }\r\n\r\n          @keyframes expand {\r\n            0% {\r\n                opacity: 0;\r\n                scale: 0 0;\r\n                translate: 50% 50%;\r\n            }\r\n    \r\n            100% {\r\n                opacity: 1;\r\n                scale: 1 1;\r\n                translate: 0 0;\r\n            }\r\n          }\r\n        `;\r\n        shadowRoot.appendChild(bottomStyle);\r\n      }\r\n    }\r\n  }\r\n  updateInterface();\r\n\r\n  pageTranslator.onPageLanguageStateChange((_pageLanguageState) => {\r\n    pageLanguageState = _pageLanguageState;\r\n    updateInterface();\r\n  });\r\n\r\n  // translate or restore page\r\n  const btnTranslate = shadowRoot.getElementById(\"btnTranslate\");\r\n  btnTranslate.onclick = () => {\r\n    lastInteraction = Date.now();\r\n\r\n    if (pageLanguageState === \"original\") {\r\n      pageTranslator.translatePage();\r\n    } else {\r\n      pageTranslator.restorePage();\r\n    }\r\n  };\r\n\r\n  // fill language list\r\n  (function () {\r\n    let langs = twpLang.getLanguageList();\r\n\r\n    const langsSorted = [];\r\n\r\n    for (const i in langs) {\r\n      langsSorted.push([i, langs[i]]);\r\n    }\r\n\r\n    langsSorted.sort(function (a, b) {\r\n      return a[1].localeCompare(b[1]);\r\n    });\r\n\r\n    const menuSelectLanguage = /** @type {HTMLSelectElement} */ (\r\n      shadowRoot.getElementById(\"language-selector\")\r\n    );\r\n\r\n    const eAllLangs = menuSelectLanguage.querySelector('[name=\"all\"]');\r\n    langsSorted.forEach((value) => {\r\n      const option = document.createElement(\"option\");\r\n      option.value = value[0];\r\n      option.textContent = value[1];\r\n      eAllLangs.appendChild(option);\r\n    });\r\n\r\n    const eRecentsLangs = menuSelectLanguage.querySelector('[name=\"targets\"]');\r\n\r\n    const buildRecentsLanguages = () => {\r\n      eRecentsLangs.innerHTML = \"\";\r\n      for (const value of twpConfig.get(\"targetLanguages\")) {\r\n        const option = document.createElement(\"option\");\r\n        option.value = value;\r\n        option.textContent = langs[value];\r\n        eRecentsLangs.appendChild(option);\r\n      }\r\n      menuSelectLanguage.value = twpConfig.get(\"targetLanguages\")[0];\r\n    };\r\n    buildRecentsLanguages();\r\n\r\n    menuSelectLanguage.oninput = () => {\r\n      twpConfig.setTargetLanguage(menuSelectLanguage.value, true);\r\n      pageTranslator.translatePage(menuSelectLanguage.value);\r\n      buildRecentsLanguages();\r\n      updateInterface();\r\n\r\n      closeMenu();\r\n    };\r\n  })();\r\n\r\n  // show/hide popup on 3 finger tap\r\n  window.addEventListener(\"touchstart\", (e) => {\r\n    if (e.touches.length == 3) {\r\n      if (rootElement.isConnected) {\r\n        hidePopup();\r\n      } else {\r\n        showPopup();\r\n      }\r\n    }\r\n  });\r\n\r\n  // show popup when clicked on the extension icon on the extension manager\r\n  chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\r\n    if (request.action === \"showPopupMobile\") {\r\n      showPopup();\r\n    }\r\n  });\r\n\r\n  pageTranslator.onGetOriginalTabLanguage(function (_tabLanguage) {\r\n    tabLanguage = _tabLanguage || \"und\";\r\n    if (tabLanguage !== \"und\") {\r\n      tabLanguage = twpLang.fixTLanguageCode(tabLanguage);\r\n    }\r\n    if (\r\n      twpConfig.get(\"whenShowMobilePopup\") !== \"only-when-i-touch\" &&\r\n      tabLanguage !== \"und\" &&\r\n      twpConfig.get(\"neverTranslateLangs\").indexOf(tabLanguage) === -1 &&\r\n      twpConfig.get(\"neverTranslateSites\").indexOf(tabHostName) === -1 &&\r\n      twpConfig.get(\"targetLanguage\") !== tabLanguage\r\n    ) {\r\n      showPopup();\r\n    } else if (twpConfig.get(\"whenShowMobilePopup\") === \"always-show\") {\r\n      showPopup();\r\n    }\r\n  });\r\n\r\n  // dark/light mode\r\n  function updateTheme() {\r\n    let darkMode = false;\r\n    if (twpConfig.get(\"darkMode\") === \"auto\") {\r\n      darkMode = window.matchMedia(\"(prefers-color-scheme: dark)\").matches\r\n        ? true\r\n        : false;\r\n    } else {\r\n      darkMode = twpConfig.get(\"darkMode\") === \"yes\" ? true : false;\r\n    }\r\n\r\n    if (darkMode) {\r\n      const lightModeElement = shadowRoot.getElementById(\"light-mode\");\r\n      if (lightModeElement) lightModeElement.remove();\r\n    } else {\r\n      let lightModeElement = shadowRoot.getElementById(\"light-mode\");\r\n      if (!lightModeElement) {\r\n        lightModeElement = document.createElement(\"style\");\r\n        lightModeElement.id = \"light-mode\";\r\n        lightModeElement.textContent = `\r\n          * {\r\n            --primary-text-color: rgb(36, 34, 34);\r\n            --secondary-text-color: rgb(68, 67, 67);\r\n            --background-color: rgb(238, 236, 236);\r\n            --shadow-color: rgb(115, 148, 211);\r\n            --translate-button-text-color: rgb(91, 153, 247);\r\n            --hover-color: rgb(67, 78, 95);\r\n          }\r\n        `;\r\n        shadowRoot.appendChild(lightModeElement);\r\n      }\r\n    }\r\n  }\r\n  updateTheme();\r\n\r\n  matchMedia(\"(prefers-color-scheme: dark)\").addEventListener(\"change\", () => {\r\n    updateTheme();\r\n  });\r\n\r\n  twpConfig.onChanged((name, newValue) => {\r\n    if (name == \"darkMode\") {\r\n      updateTheme();\r\n    }\r\n  });\r\n})();\r\n"],"mappings":"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"}
{"version":3,"file":"../../lib/i18n.js","names":["twpI18n","messages","getMessage","messageName","substitutions","message","finalMessage","placeholders","key","value","Object","entries","content","match","index","parseInt","Array","replaceAll","String","chrome","i18n","e","console","log","translateAttributes","root","attributeName","element","querySelectorAll","text","getAttribute","setAttribute","translateDocument","document","textContent","updateUiMessages","temporaryLanguage","uiLanguage","twpConfig","get","replace","fetch","runtime","getURL","then","response","json","result","catch","warn","onReady","onChanged","name","newValue"],"sources":["i18n.js"],"sourcesContent":["\"use strict\";\r\n\r\nconst twpI18n = (function () {\r\n  const twpI18n = {};\r\n  let messages = null;\r\n\r\n  /**\r\n   * Gets the localized string for the specified message\r\n   * @example\r\n   * getMessage(\"lblAlwaysTranslate\", \"German\")\r\n   * // returns \"Always translate from German\"\r\n   * getMessage(\"lblAlwaysTranslate\", [\"German\"])\r\n   * // returns \"Always translate from German\"\r\n   * @param {string} messageName\r\n   * @param {string | string[]} substitutions\r\n   * @returns {string} localizedString\r\n   */\r\n  twpI18n.getMessage = function (messageName, substitutions = null) {\r\n    try {\r\n      if (messages) {\r\n        const message = messages[messageName];\r\n        if (!message) return \"\";\r\n\r\n        /** @type {string} */\r\n        let finalMessage = message.message;\r\n\r\n        if (message.placeholders) {\r\n          for (const [key, value] of Object.entries(message.placeholders)) {\r\n            /** @type {string} */\r\n            let content = value.content;\r\n            let match = content.match(/\\$([1-9][0-9]*)/);\r\n            let index = match ? parseInt(match[1]) : null;\r\n            if (index) {\r\n              if (substitutions instanceof Array) {\r\n                content = content.replaceAll(\r\n                  \"$\" + index,\r\n                  String(substitutions[index - 1])\r\n                );\r\n              } else if (index === 1) {\r\n                content = content.replaceAll(\r\n                  \"$\" + index,\r\n                  String(substitutions)\r\n                );\r\n              } else {\r\n                content = content.replaceAll(\"$\" + index, \"\");\r\n              }\r\n            }\r\n            finalMessage = finalMessage.replaceAll(\"$\" + key + \"$\", content);\r\n          }\r\n        }\r\n\r\n        return finalMessage;\r\n      } else {\r\n        return chrome.i18n.getMessage(messageName, substitutions);\r\n      }\r\n    } catch (e) {\r\n      console.log(e);\r\n      return chrome.i18n.getMessage(messageName, substitutions);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * translate attribute in all childNodes\r\n   * @param {Document | HTMLElement | ShadowRoot} root\r\n   * @param {string} attributeName\r\n   */\r\n  function translateAttributes(root, attributeName) {\r\n    for (const element of root.querySelectorAll(\r\n      `[data-i18n-${attributeName}]`\r\n    )) {\r\n      let text = twpI18n.getMessage(\r\n        element.getAttribute(`data-i18n-${attributeName}`),\r\n        element.getAttribute(\"data-i18n-ph-value\")\r\n      );\r\n      if (!text) {\r\n        continue;\r\n      }\r\n\r\n      element.setAttribute(attributeName, text);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * translate innerText and attributes for a Document or HTMLElement\r\n   * @param {Document | HTMLElement | ShadowRoot} root\r\n   */\r\n  twpI18n.translateDocument = function (root = document) {\r\n    for (const element of root.querySelectorAll(\"[data-i18n]\")) {\r\n      let text = twpI18n.getMessage(\r\n        element.getAttribute(\"data-i18n\"),\r\n        element.getAttribute(\"data-i18n-ph-value\")\r\n      );\r\n      if (!text) {\r\n        continue;\r\n      }\r\n      element.textContent = text;\r\n    }\r\n\r\n    translateAttributes(root, \"title\");\r\n    translateAttributes(root, \"placeholder\");\r\n    translateAttributes(root, \"label\");\r\n  };\r\n\r\n  /**\r\n   * Updates interface location messages based on user preference\r\n   * @returns {Promise<void>}\r\n   */\r\n  twpI18n.updateUiMessages = async (temporaryLanguage = null) => {\r\n    let uiLanguage = temporaryLanguage || twpConfig.get(\"uiLanguage\");\r\n    uiLanguage = uiLanguage.replace(\"-\", \"_\");\r\n    if (uiLanguage === \"default\") {\r\n      messages = null;\r\n    } else {\r\n      return await fetch(\r\n        chrome.runtime.getURL(`/_locales/${uiLanguage}/messages.json`)\r\n      )\r\n        .then((response) => response.json())\r\n        .then((result) => {\r\n          messages = result;\r\n        })\r\n        .catch((e) => {\r\n          messages = null;\r\n          console.warn(e);\r\n        });\r\n    }\r\n  };\r\n\r\n  twpConfig.onReady(function () {\r\n    twpI18n.updateUiMessages();\r\n\r\n    twpConfig.onChanged(function (name, newValue) {\r\n      if (name === \"uiLanguage\") {\r\n        twpI18n.updateUiMessages();\r\n      }\r\n    });\r\n  });\r\n\r\n  return twpI18n;\r\n})();\r\n"],"mappings":"AAAA,YAAY;;AAEZ,MAAMA,OAAO,GAAI,YAAY;EAC3B,MAAMA,OAAO,GAAG,CAAC,CAAC;EAClB,IAAIC,QAAQ,GAAG,IAAI;;EAEnB;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACED,OAAO,CAACE,UAAU,GAAG,UAAUC,WAAW,EAAEC,aAAa,GAAG,IAAI,EAAE;IAChE,IAAI;MACF,IAAIH,QAAQ,EAAE;QACZ,MAAMI,OAAO,GAAGJ,QAAQ,CAACE,WAAW,CAAC;QACrC,IAAI,CAACE,OAAO,EAAE,OAAO,EAAE;;QAEvB;QACA,IAAIC,YAAY,GAAGD,OAAO,CAACA,OAAO;QAElC,IAAIA,OAAO,CAACE,YAAY,EAAE;UACxB,KAAK,MAAM,CAACC,GAAG,EAAEC,KAAK,CAAC,IAAIC,MAAM,CAACC,OAAO,CAACN,OAAO,CAACE,YAAY,CAAC,EAAE;YAC/D;YACA,IAAIK,OAAO,GAAGH,KAAK,CAACG,OAAO;YAC3B,IAAIC,KAAK,GAAGD,OAAO,CAACC,KAAK,CAAC,iBAAiB,CAAC;YAC5C,IAAIC,KAAK,GAAGD,KAAK,GAAGE,QAAQ,CAACF,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI;YAC7C,IAAIC,KAAK,EAAE;cACT,IAAIV,aAAa,YAAYY,KAAK,EAAE;gBAClCJ,OAAO,GAAGA,OAAO,CAACK,UAAU,CAC1B,GAAG,GAAGH,KAAK,EACXI,MAAM,CAACd,aAAa,CAACU,KAAK,GAAG,CAAC,CAAC,CACjC,CAAC;cACH,CAAC,MAAM,IAAIA,KAAK,KAAK,CAAC,EAAE;gBACtBF,OAAO,GAAGA,OAAO,CAACK,UAAU,CAC1B,GAAG,GAAGH,KAAK,EACXI,MAAM,CAACd,aAAa,CACtB,CAAC;cACH,CAAC,MAAM;gBACLQ,OAAO,GAAGA,OAAO,CAACK,UAAU,CAAC,GAAG,GAAGH,KAAK,EAAE,EAAE,CAAC;cAC/C;YACF;YACAR,YAAY,GAAGA,YAAY,CAACW,UAAU,CAAC,GAAG,GAAGT,GAAG,GAAG,GAAG,EAAEI,OAAO,CAAC;UAClE;QACF;QAEA,OAAON,YAAY;MACrB,CAAC,MAAM;QACL,OAAOa,MAAM,CAACC,IAAI,CAAClB,UAAU,CAACC,WAAW,EAAEC,aAAa,CAAC;MAC3D;IACF,CAAC,CAAC,OAAOiB,CAAC,EAAE;MACVC,OAAO,CAACC,GAAG,CAACF,CAAC,CAAC;MACd,OAAOF,MAAM,CAACC,IAAI,CAAClB,UAAU,CAACC,WAAW,EAAEC,aAAa,CAAC;IAC3D;EACF,CAAC;;EAED;AACF;AACA;AACA;AACA;EACE,SAASoB,mBAAmBA,CAACC,IAAI,EAAEC,aAAa,EAAE;IAChD,KAAK,MAAMC,OAAO,IAAIF,IAAI,CAACG,gBAAgB,CACxC,cAAaF,aAAc,GAC9B,CAAC,EAAE;MACD,IAAIG,IAAI,GAAG7B,OAAO,CAACE,UAAU,CAC3ByB,OAAO,CAACG,YAAY,CAAE,aAAYJ,aAAc,EAAC,CAAC,EAClDC,OAAO,CAACG,YAAY,CAAC,oBAAoB,CAC3C,CAAC;MACD,IAAI,CAACD,IAAI,EAAE;QACT;MACF;MAEAF,OAAO,CAACI,YAAY,CAACL,aAAa,EAAEG,IAAI,CAAC;IAC3C;EACF;;EAEA;AACF;AACA;AACA;EACE7B,OAAO,CAACgC,iBAAiB,GAAG,UAAUP,IAAI,GAAGQ,QAAQ,EAAE;IACrD,KAAK,MAAMN,OAAO,IAAIF,IAAI,CAACG,gBAAgB,CAAC,aAAa,CAAC,EAAE;MAC1D,IAAIC,IAAI,GAAG7B,OAAO,CAACE,UAAU,CAC3ByB,OAAO,CAACG,YAAY,CAAC,WAAW,CAAC,EACjCH,OAAO,CAACG,YAAY,CAAC,oBAAoB,CAC3C,CAAC;MACD,IAAI,CAACD,IAAI,EAAE;QACT;MACF;MACAF,OAAO,CAACO,WAAW,GAAGL,IAAI;IAC5B;IAEAL,mBAAmB,CAACC,IAAI,EAAE,OAAO,CAAC;IAClCD,mBAAmB,CAACC,IAAI,EAAE,aAAa,CAAC;IACxCD,mBAAmB,CAACC,IAAI,EAAE,OAAO,CAAC;EACpC,CAAC;;EAED;AACF;AACA;AACA;EACEzB,OAAO,CAACmC,gBAAgB,GAAG,OAAOC,iBAAiB,GAAG,IAAI,KAAK;IAC7D,IAAIC,UAAU,GAAGD,iBAAiB,IAAIE,SAAS,CAACC,GAAG,CAAC,YAAY,CAAC;IACjEF,UAAU,GAAGA,UAAU,CAACG,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC;IACzC,IAAIH,UAAU,KAAK,SAAS,EAAE;MAC5BpC,QAAQ,GAAG,IAAI;IACjB,CAAC,MAAM;MACL,OAAO,MAAMwC,KAAK,CAChBtB,MAAM,CAACuB,OAAO,CAACC,MAAM,CAAE,aAAYN,UAAW,gBAAe,CAC/D,CAAC,CACEO,IAAI,CAAEC,QAAQ,IAAKA,QAAQ,CAACC,IAAI,CAAC,CAAC,CAAC,CACnCF,IAAI,CAAEG,MAAM,IAAK;QAChB9C,QAAQ,GAAG8C,MAAM;MACnB,CAAC,CAAC,CACDC,KAAK,CAAE3B,CAAC,IAAK;QACZpB,QAAQ,GAAG,IAAI;QACfqB,OAAO,CAAC2B,IAAI,CAAC5B,CAAC,CAAC;MACjB,CAAC,CAAC;IACN;EACF,CAAC;EAEDiB,SAAS,CAACY,OAAO,CAAC,YAAY;IAC5BlD,OAAO,CAACmC,gBAAgB,CAAC,CAAC;IAE1BG,SAAS,CAACa,SAAS,CAAC,UAAUC,IAAI,EAAEC,QAAQ,EAAE;MAC5C,IAAID,IAAI,KAAK,YAAY,EAAE;QACzBpD,OAAO,CAACmC,gBAAgB,CAAC,CAAC;MAC5B;IACF,CAAC,CAAC;EACJ,CAAC,CAAC;EAEF,OAAOnC,OAAO;AAChB,CAAC,CAAE,CAAC"}
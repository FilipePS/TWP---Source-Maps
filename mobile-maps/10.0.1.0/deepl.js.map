{"version":3,"file":"../../contentScript/deepl.js","names":["translate","text","targetLanguage","Promise","resolve","target_textarea","document","querySelector","location","hash","encodeURIComponent","Error","startTime","performance","now","checkresult","oldvalue","textContent","setTimeout","injectInformation","getElementById","style","createElement","head","appendChild","info","setAttribute","cssText","innerHTML","body","insertBefore","firstChild","addEventListener","twpConfig","set","window","close","onReady","twpI18n","updateUiMessages","translateDocument","startsWith","split","decodeURIComponent","substring","then","result","console","chrome","runtime","sendMessage","action","checkedLastError","catch","e","error","onMessage","addListener","request","sender","sendResponse"],"sources":["deepl.js"],"sourcesContent":["\"use strict\";\r\n\r\n/*\r\n  When the DeepL tab is not activated, the timers will have a minimum delay of 1 second which delays the translation.\r\n*/\r\n\r\nvoid (function () {\r\n  /**\r\n   * Put the original text in the correct place, select the target language, wait and return the translation result.\r\n   * @param {string} text\r\n   * @param {string} targetLanguage\r\n   * @returns {Promise<string>} resultText\r\n   */\r\n  async function translate(text, targetLanguage) {\r\n    return await new Promise((resolve) => {\r\n      /** @type {HTMLTextAreaElement} */\r\n      const target_textarea = document.querySelector(\r\n        \"d-textarea[data-testid=translator-target-input]\"\r\n      );\r\n\r\n      // set the URL hash, the translation will start immediately\r\n      location.hash = `#/auto/${targetLanguage}/${encodeURIComponent(text)}`;\r\n\r\n      if (!target_textarea) {\r\n        throw new Error(\"target_textarea not found.\");\r\n      }\r\n\r\n      const startTime = performance.now();\r\n\r\n      /**\r\n       * wait for the translation to finish\r\n       * @param {string} oldvalue\r\n       * @returns\r\n       */\r\n      function checkresult(oldvalue) {\r\n        if (\r\n          performance.now() - startTime > 2400 ||\r\n          (target_textarea.textContent &&\r\n            target_textarea.textContent !== oldvalue)\r\n        ) {\r\n          return resolve(target_textarea.textContent);\r\n        }\r\n        setTimeout(checkresult, 100, oldvalue);\r\n      }\r\n      checkresult(target_textarea.textContent);\r\n    });\r\n  }\r\n\r\n  function injectInformation() {\r\n    if (document.getElementById(\"twp-info\")) return;\r\n    const style = document.createElement(\"style\");\r\n    style.textContent = `\r\n    /* TWP - Translate Web Pages */\r\n    #twp-info button {\r\n      color: black;\r\n      background-color: white;\r\n      border: 1px solid black;\r\n      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);\r\n      border-radius: 10px\r\n      cursor: pointer;\r\n      padding: 5px 10px;\r\n      border-radius: 10px;\r\n      transition: transform 0.1s;\r\n    }\r\n    #twp-info button:hover {\r\n      transform: scale(1.1);\r\n    }\r\n    #twp-info p {\r\n      color: white;\r\n    }\r\n    `;\r\n    document.head.appendChild(style);\r\n\r\n    const info = document.createElement(\"div\");\r\n    info.setAttribute(\"id\", \"twp-info\");\r\n    info.style.cssText = `\r\n      width: 100%;\r\n      padding: 10px;\r\n      text-align: center;\r\n      background: rgb(37, 108, 219);\r\n      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);\r\n      padding: 7px;\r\n    `;\r\n    info.innerHTML = `\r\n      <p style=\"font-size: 20px; font-weight: bold;\">TWP - Translate Web Pages</p>\r\n      <p data-i18n=\"msgDeepLTabReasoOpened\">This tab opened because you clicked to translate selected text using DeepL.</p>\r\n      <button data-i18n=\"msgDontShowAgain\">Don't show again</button>\r\n    `;\r\n    document.body.insertBefore(info, document.body.firstChild);\r\n\r\n    info.querySelector(\"button\").addEventListener(\"click\", () => {\r\n      twpConfig.set(\"textTranslatorService\", \"google\");\r\n      setTimeout(() => window.close(), 500);\r\n    });\r\n\r\n    twpConfig.onReady(async () => {\r\n      await twpI18n.updateUiMessages();\r\n      twpI18n.translateDocument(info);\r\n    });\r\n  }\r\n\r\n  // get the sourceText and targetLanguage from the URL hash\r\n  if (location.hash.startsWith(\"#!\")) {\r\n    injectInformation();\r\n\r\n    let [targetLanguage, text] = location.hash.split(\"!#\");\r\n    location.hash = \"\";\r\n\r\n    targetLanguage = decodeURIComponent(targetLanguage.substring(2));\r\n    text = decodeURIComponent(text);\r\n\r\n    translate(text, targetLanguage || \"en\")\r\n      .then((result) => {\r\n        console.info(result);\r\n        chrome.runtime.sendMessage(\r\n          {\r\n            action: \"DeepL_firstTranslationResult\",\r\n            result,\r\n          },\r\n          checkedLastError\r\n        );\r\n      })\r\n      .catch((e) => {\r\n        console.error(e);\r\n        chrome.runtime.sendMessage(\r\n          {\r\n            action: \"DeepL_firstTranslationResult\",\r\n            result: \"\",\r\n          },\r\n          checkedLastError\r\n        );\r\n      });\r\n  }\r\n\r\n  chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\r\n    if (request.action === \"translateTextWithDeepL\") {\r\n      console.info(request);\r\n      translate(request.text, request.targetLanguage)\r\n        .then((result) => {\r\n          console.info(result);\r\n          sendResponse(result);\r\n        })\r\n        .catch((e) => {\r\n          console.error(e);\r\n          sendResponse(\"\");\r\n        });\r\n    }\r\n\r\n    return true;\r\n  });\r\n})();\r\n"],"mappings":"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","ignoreList":[]}
{"version":3,"file":"../../background/translationService.js","names":["translationService","Utils","escapeHTML","unsafe","bingMarkFrontPart","bingMarkSecondPart","replaceAll","replace","unescapeHTML","GoogleHelper","googleTranslateTKK","shiftLeftOrRightThenSumOrXor","num","optString","i","length","acc","charAt","charCodeAt","Number","transformQuery","query","bytesArray","idx","charCode","calcHash","windowTkk","tkkSplited","split","tkkIndex","tkkKey","encondingRound","item","normalizedResult","toString","YandexHelper","translateSid","_translateSid","_","findSID","_findPromise","Promise","resolve","updateYandexSid","_lastRequestSidTime","date","Date","setMinutes","getMinutes","_SIDNotFound","getTime","now","http","XMLHttpRequest","open","send","onload","e","result","responseText","match","substring","onerror","onabort","ontimeout","console","error","finally","BingHelper","translateAuth","_translateAuth","findAuth","_authPromise","updateBingAuth","_lastRequestAuthTime","_AuthNotFound","Service","constructor","serviceName","baseURL","xhrMethod","cbTransformRequest","cbParseResponse","cbTransformResponse","cbGetExtraParameters","cbGetRequestBody","cbGetExtraHeaders","translationsInProgress","Map","removeTranslationsWithError","forEach","transInfo","key","status","delete","getRequests","sourceLanguage","targetLanguage","sourceArray2d","requests","currentTranslationsInProgress","currentRequest","currentSize","sourceArray","requestString","fixString","requestHash","join","progressInfo","get","push","promise_resolve","originalText","translatedText","detectedLanguage","_status","waitTranlate","set","cacheEntry","translationCache","makeRequest","reject","xhr","headers","header","setRequestHeader","name","value","responseType","event","response","undefined","translate","dontSaveInPersistentCache","dontSortResults","promises","request","then","results","text","catch","all","map","str","googleService","index","responseJson","indexOf","slice","sentences","sentenceStartIndex","sentenceFinalIndex","resultArray","lastEndPos","r","matchAll","fullText","fullLength","pos","aTag","insideText","outsideText","lastOutsideText","indexes","parseInt","filter","isNaN","resultStartAtIndex","finalResulArray","j","info","encodeURIComponent","yandexService","lang","bingService","id","_r$detectedLanguage","translations","language","parser","DOMParser","doc","parseFromString","currText","body","childNodes","node","nodeName","textContent","JSON","stringify","replacements","search","deeplService","DeepLTab","startsWith","waitFirstTranslationResult","listener","sender","sendResponse","action","chrome","runtime","onMessage","removeListener","addListener","setTimeout","tabs","tab","checkedLastError","sendMessage","frameId","tabsCreate","createLibreService","url","apiKey","params","URLSearchParams","append","createDeeplFreeApiService","detected_source_language","serviceList","getSafeServiceByName","twpConfig","includes","find","cs","translateHTML","twpLang","getAlternativeService","service","translateText","translateSingleText","incognito","source","libre","deepl_freeapi","onReady","_proxyServers$google","proxyServers","google","translateServer","URL","host","onChanged","newValue","_newValue$google"],"sources":["translationService.js"],"sourcesContent":["\"use strict\";\r\n\r\nconst translationService = (function () {\r\n  const translationService = {};\r\n\r\n  class Utils {\r\n    /**\r\n     * Replace the characters `& < > \" '` with `&amp; &lt; &gt; &quot; &#39;`.\r\n     *\r\n     * Note: For bing translation, we want to use its custom dictionary feature,\r\n     * we have to keep certain html tags, so we need to avoid them from being escaped.\r\n     * These symbols are nothing, just to ensure that there are no such symbols in the original text.\r\n     *\r\n     * @param {string} unsafe\r\n     * @returns {string} escapedString\r\n     */\r\n    static escapeHTML(unsafe) {\r\n      const bingMarkFrontPart = '<mstrans:dictionary translation=\"';\r\n      const bingMarkSecondPart = '\"></mstrans:dictionary>';\r\n\r\n      unsafe = unsafe\r\n        .replaceAll(bingMarkFrontPart, \"@-/629^*\")\r\n        .replaceAll(bingMarkSecondPart, \"^$537+*\");\r\n\r\n      unsafe = unsafe\r\n        .replace(/\\&/g, \"&amp;\")\r\n        .replace(/\\</g, \"&lt;\")\r\n        .replace(/\\>/g, \"&gt;\")\r\n        .replace(/\\\"/g, \"&quot;\")\r\n        .replace(/\\'/g, \"&#39;\");\r\n\r\n      unsafe = unsafe\r\n        .replaceAll(\"@-/629^*\", bingMarkFrontPart)\r\n        .replaceAll(\"^$537+*\", bingMarkSecondPart);\r\n\r\n      return unsafe;\r\n    }\r\n\r\n    /**\r\n     * Replace the characters `&amp; &lt; &gt; &quot; &#39;` with `& < > \" '`.\r\n     * @param {string} unsafe\r\n     * @returns {string} unescapedString\r\n     */\r\n    static unescapeHTML(unsafe) {\r\n      return unsafe\r\n        .replace(/\\&amp;/g, \"&\")\r\n        .replace(/\\&lt;/g, \"<\")\r\n        .replace(/\\&gt;/g, \">\")\r\n        .replace(/\\&quot;/g, '\"')\r\n        .replace(/\\&\\#39;/g, \"'\");\r\n    }\r\n  }\r\n\r\n  class GoogleHelper {\r\n    static get googleTranslateTKK() {\r\n      return \"448487.932609646\";\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {number} num\r\n     * @param {string} optString\r\n     * @returns {number}\r\n     */\r\n    static shiftLeftOrRightThenSumOrXor(num, optString) {\r\n      for (let i = 0; i < optString.length - 2; i += 3) {\r\n        /** @type {string|number} */\r\n        let acc = optString.charAt(i + 2);\r\n        if (\"a\" <= acc) {\r\n          acc = acc.charCodeAt(0) - 87;\r\n        } else {\r\n          acc = Number(acc);\r\n        }\r\n        if (optString.charAt(i + 1) == \"+\") {\r\n          acc = num >>> acc;\r\n        } else {\r\n          acc = num << acc;\r\n        }\r\n        if (optString.charAt(i) == \"+\") {\r\n          num += acc & 4294967295;\r\n        } else {\r\n          num ^= acc;\r\n        }\r\n      }\r\n      return num;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} query\r\n     * @returns {Array<number>}\r\n     */\r\n    static transformQuery(query) {\r\n      /** @type {Array<number>} */\r\n      const bytesArray = [];\r\n      let idx = 0;\r\n      for (let i = 0; i < query.length; i++) {\r\n        let charCode = query.charCodeAt(i);\r\n\r\n        if (128 > charCode) {\r\n          bytesArray[idx++] = charCode;\r\n        } else {\r\n          if (2048 > charCode) {\r\n            bytesArray[idx++] = (charCode >> 6) | 192;\r\n          } else {\r\n            if (\r\n              55296 == (charCode & 64512) &&\r\n              i + 1 < query.length &&\r\n              56320 == (query.charCodeAt(i + 1) & 64512)\r\n            ) {\r\n              charCode =\r\n                65536 +\r\n                ((charCode & 1023) << 10) +\r\n                (query.charCodeAt(++i) & 1023);\r\n              bytesArray[idx++] = (charCode >> 18) | 240;\r\n              bytesArray[idx++] = ((charCode >> 12) & 63) | 128;\r\n            } else {\r\n              bytesArray[idx++] = (charCode >> 12) | 224;\r\n            }\r\n            bytesArray[idx++] = ((charCode >> 6) & 63) | 128;\r\n          }\r\n          bytesArray[idx++] = (charCode & 63) | 128;\r\n        }\r\n      }\r\n      return bytesArray;\r\n    }\r\n\r\n    /**\r\n     * Calculates the hash (TK) of a query for google translator.\r\n     * @param {string} query\r\n     * @returns {string}\r\n     */\r\n    static calcHash(query) {\r\n      const windowTkk = GoogleHelper.googleTranslateTKK;\r\n      const tkkSplited = windowTkk.split(\".\");\r\n      const tkkIndex = Number(tkkSplited[0]) || 0;\r\n      const tkkKey = Number(tkkSplited[1]) || 0;\r\n\r\n      const bytesArray = GoogleHelper.transformQuery(query);\r\n\r\n      let encondingRound = tkkIndex;\r\n      for (const item of bytesArray) {\r\n        encondingRound += item;\r\n        encondingRound = GoogleHelper.shiftLeftOrRightThenSumOrXor(\r\n          encondingRound,\r\n          \"+-a^+6\"\r\n        );\r\n      }\r\n      encondingRound = GoogleHelper.shiftLeftOrRightThenSumOrXor(\r\n        encondingRound,\r\n        \"+-3^+b+-f\"\r\n      );\r\n\r\n      encondingRound ^= tkkKey;\r\n      if (encondingRound <= 0) {\r\n        encondingRound = (encondingRound & 2147483647) + 2147483648;\r\n      }\r\n\r\n      const normalizedResult = encondingRound % 1000000;\r\n      return normalizedResult.toString() + \".\" + (normalizedResult ^ tkkIndex);\r\n    }\r\n  }\r\n\r\n  class YandexHelper {\r\n    /** @type {number} */\r\n    static #lastRequestSidTime = null;\r\n    /** @type {string} */\r\n    static #translateSid = null;\r\n    /** @type {boolean} */\r\n    static #SIDNotFound = false;\r\n    /** @type {Promise<void>} */\r\n    static #findPromise = null;\r\n\r\n    static get translateSid() {\r\n      return YandexHelper.#translateSid;\r\n    }\r\n\r\n    /**\r\n     * Find the SID of Yandex Translator. The SID value is used in translation requests.\r\n     * @returns {Promise<void>}\r\n     */\r\n    static async findSID() {\r\n      if (YandexHelper.#findPromise) return await YandexHelper.#findPromise;\r\n      YandexHelper.#findPromise = new Promise((resolve) => {\r\n        let updateYandexSid = false;\r\n        if (YandexHelper.#lastRequestSidTime) {\r\n          const date = new Date();\r\n          if (YandexHelper.#translateSid) {\r\n            date.setMinutes(date.getMinutes() - 30);\r\n          } else if (YandexHelper.#SIDNotFound) {\r\n            date.setMinutes(date.getMinutes() - 5);\r\n          } else {\r\n            date.setMinutes(date.getMinutes() - 1);\r\n          }\r\n          if (date.getTime() > YandexHelper.#lastRequestSidTime) {\r\n            updateYandexSid = true;\r\n          }\r\n        } else {\r\n          updateYandexSid = true;\r\n        }\r\n\r\n        if (updateYandexSid) {\r\n          YandexHelper.#lastRequestSidTime = Date.now();\r\n\r\n          const http = new XMLHttpRequest();\r\n          http.open(\r\n            \"GET\",\r\n            \"https://translate.yandex.net/website-widget/v1/widget.js?widgetId=ytWidget&pageLang=es&widgetTheme=light&autoMode=false\"\r\n          );\r\n          http.send();\r\n          http.onload = (e) => {\r\n            const result = http.responseText.match(/sid\\:\\s\\'[0-9a-f\\.]+/);\r\n            if (result && result[0] && result[0].length > 7) {\r\n              YandexHelper.#translateSid = result[0].substring(6);\r\n              YandexHelper.#SIDNotFound = false;\r\n            } else {\r\n              YandexHelper.#SIDNotFound = true;\r\n            }\r\n            resolve();\r\n          };\r\n          http.onerror =\r\n            http.onabort =\r\n            http.ontimeout =\r\n              (e) => {\r\n                console.error(e);\r\n                resolve();\r\n              };\r\n        } else {\r\n          resolve();\r\n        }\r\n      });\r\n\r\n      YandexHelper.#findPromise.finally(() => {\r\n        YandexHelper.#findPromise = null;\r\n      });\r\n\r\n      return await YandexHelper.#findPromise;\r\n    }\r\n  }\r\n\r\n  class BingHelper {\r\n    /** @type {number} */\r\n    static #lastRequestAuthTime = null;\r\n    /** @type {string} */\r\n    static #translateAuth = null;\r\n    /** @type {boolean} */\r\n    static #AuthNotFound = false;\r\n    /** @type {Promise<void>} */\r\n    static #authPromise = null;\r\n\r\n    static get translateAuth() {\r\n      return BingHelper.#translateAuth;\r\n    }\r\n\r\n    /**\r\n     * Find the Auth of Bing Translator. The Auth value is used in translation requests.\r\n     * @returns {Promise<void>}\r\n     */\r\n    static async findAuth() {\r\n      if (BingHelper.#authPromise) return await BingHelper.#authPromise;\r\n\r\n      BingHelper.#authPromise = new Promise((resolve) => {\r\n        let updateBingAuth = false;\r\n        if (BingHelper.#lastRequestAuthTime) {\r\n          const date = new Date();\r\n          if (BingHelper.#translateAuth) {\r\n            date.setMinutes(date.getMinutes() - 30);\r\n          } else if (BingHelper.#AuthNotFound) {\r\n            date.setMinutes(date.getMinutes() - 5);\r\n          } else {\r\n            date.setMinutes(date.getMinutes() - 2);\r\n          }\r\n          if (date.getTime() > BingHelper.#lastRequestAuthTime) {\r\n            updateBingAuth = true;\r\n          }\r\n        } else {\r\n          updateBingAuth = true;\r\n        }\r\n\r\n        if (updateBingAuth) {\r\n          BingHelper.#lastRequestAuthTime = Date.now();\r\n\r\n          const http = new XMLHttpRequest();\r\n          http.open(\"GET\", \"https://edge.microsoft.com/translate/auth\");\r\n          http.send();\r\n          http.onload = (e) => {\r\n            if (http.responseText && http.responseText.length > 1) {\r\n              BingHelper.#translateAuth = http.responseText;\r\n              BingHelper.#AuthNotFound = false;\r\n            } else {\r\n              BingHelper.#AuthNotFound = true;\r\n            }\r\n            resolve();\r\n          };\r\n          http.onerror =\r\n            http.onabort =\r\n            http.ontimeout =\r\n              (e) => {\r\n                console.error(e);\r\n                resolve();\r\n              };\r\n        } else {\r\n          resolve();\r\n        }\r\n      });\r\n\r\n      BingHelper.#authPromise.finally(() => {\r\n        BingHelper.#authPromise = null;\r\n      });\r\n\r\n      return await BingHelper.#authPromise;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a string with additional parameters to be concatenated to the request URL.\r\n   * @callback callback_cbParameters\r\n   * @param {string} sourceLanguage\r\n   * @param {string} targetLanguage\r\n   * @param {Array<TranslationInfo>} requests\r\n   * @returns {string}\r\n   */\r\n\r\n  /**\r\n   * Takes `sourceArray` and returns a request string to the translation service.\r\n   * @callback callback_cbTransformRequest\r\n   * @param {string[]} sourceArray\r\n   * @returns {string}\r\n   */\r\n\r\n  /**\r\n   * @typedef {{text: string, detectedLanguage: string}} Service_Single_Result_Response\r\n   */\r\n\r\n  /**\r\n   * Receives the response from the *http request* and returns `Service_Single_Result_Response[]`.\r\n   *\r\n   * Returns a string with the body of a request of type **POST**.\r\n   * @callback callback_cbParseResponse\r\n   * @param {Object} response\r\n   * @returns {Array<Service_Single_Result_Response>}\r\n   */\r\n\r\n  /**\r\n   * Takes a string formatted with the translated text and returns a `resultArray`.\r\n   * @callback callback_cbTransformResponse\r\n   * @param {String} result\r\n   * @param {boolean} dontSortResults\r\n   * @returns {string[]} resultArray\r\n   */\r\n\r\n  /**\r\n   * Return extra headers for the request.\r\n   * @callback callback_cbGetExtraHeaders\r\n   * @returns {Array<{name: string, value: string}>} headers\r\n   */\r\n\r\n  /** @typedef {\"complete\" | \"translating\" | \"error\"} TranslationStatus */\r\n  /**\r\n   * @typedef {Object} TranslationInfo\r\n   * @property {String} originalText\r\n   * @property {String} translatedText\r\n   * @property {String} detectedLanguage\r\n   * @property {TranslationStatus} status\r\n   * @property {Promise<void>} waitTranlate\r\n   */\r\n\r\n  /**\r\n   * Base class to create new translation services.\r\n   */\r\n  class Service {\r\n    /**\r\n     * Initializes the **Service** class with information about the new translation service.\r\n     * @param {string} serviceName\r\n     * @param {string} baseURL\r\n     * @param {\"GET\" | \"POST\"} xhrMethod\r\n     * @param {callback_cbTransformRequest} cbTransformRequest Takes `sourceArray` and returns a request string to the translation service.\r\n     * @param {callback_cbParseResponse} cbParseResponse Receives the response from the *http request* and returns `Service_Single_Result_Response[]`.\r\n     * @param {callback_cbTransformResponse} cbTransformResponse Takes a string formatted with the translated text and returns a `resultArray`.\r\n     * @param {callback_cbParameters} cbGetExtraParameters Returns a string with additional parameters to be concatenated to the request URL.\r\n     * @param {callback_cbParameters} cbGetRequestBody Returns a string with the body of a request of type **POST**.\r\n     * @param {callback_cbGetExtraHeaders} cbGetExtraHeaders Return extra headers for the request.\r\n     */\r\n    constructor(\r\n      serviceName,\r\n      baseURL,\r\n      xhrMethod = \"GET\",\r\n      cbTransformRequest,\r\n      cbParseResponse,\r\n      cbTransformResponse,\r\n      cbGetExtraParameters = null,\r\n      cbGetRequestBody = null,\r\n      cbGetExtraHeaders = null\r\n    ) {\r\n      this.serviceName = serviceName;\r\n      this.baseURL = baseURL;\r\n      this.xhrMethod = xhrMethod;\r\n      this.cbTransformRequest = cbTransformRequest;\r\n      this.cbParseResponse = cbParseResponse;\r\n      this.cbTransformResponse = cbTransformResponse;\r\n      this.cbGetExtraParameters = cbGetExtraParameters;\r\n      this.cbGetRequestBody = cbGetRequestBody;\r\n      this.cbGetExtraHeaders = cbGetExtraHeaders;\r\n\r\n      /**\r\n       * @type {Map<string, TranslationInfo>}\r\n       *\r\n       * It works as an in-memory translation cache.\r\n       * Ensures that two identical requests share the same `XMLHttpRequest`.\r\n       * */\r\n      this.translationsInProgress = new Map();\r\n    }\r\n\r\n    /**\r\n     * Removes all translations with `status` **error** and are in `translationsInProgress`.\r\n     *\r\n     * Sometimes there is a device translation error due to internet connection problems.\r\n     * Clearing translationsInProgress ensures that the translation will be retried.\r\n     */\r\n    removeTranslationsWithError() {\r\n      this.translationsInProgress.forEach((transInfo, key) => {\r\n        if (transInfo.status === \"error\") {\r\n          this.translationsInProgress.delete(key);\r\n        }\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Receives the `sourceArray2d` parameter and prepares the requests.\r\n     * Calls `cbTransformRequest` for each `sourceArray` of `sourceArray2d`.\r\n     * The `currentTranslationsInProgress` array will be the **final result** with requests already completed or in progress. And the `requests` array will only contain the new requests that need to be made.\r\n     *\r\n     * Checks if there is already an identical request in progress or if it is already in the translation cache.\r\n     * If it doesn't exist, add it to `requests` to make a new *http request*.\r\n     *\r\n     * Requests longer than **800 characters** will be split into new requests.\r\n     * @param {string} sourceLanguage\r\n     * @param {string} targetLanguage\r\n     * @param {Array<string[]>} sourceArray2d\r\n     * @returns {Promise<[Array<TranslationInfo[]>, TranslationInfo[]]>} `requests`, `currentTranslationsInProgress`\r\n     */\r\n    async getRequests(sourceLanguage, targetLanguage, sourceArray2d) {\r\n      /** @type {Array<TranslationInfo[]>} */\r\n      const requests = [];\r\n      /** @type {TranslationInfo[]} */\r\n      const currentTranslationsInProgress = [];\r\n\r\n      let currentRequest = [];\r\n      let currentSize = 0;\r\n\r\n      for (const sourceArray of sourceArray2d) {\r\n        const requestString = this.fixString(\r\n          this.cbTransformRequest(sourceArray)\r\n        );\r\n        const requestHash = [\r\n          sourceLanguage,\r\n          targetLanguage,\r\n          requestString,\r\n        ].join(\", \");\r\n\r\n        const progressInfo = this.translationsInProgress.get(requestHash);\r\n        if (progressInfo) {\r\n          currentTranslationsInProgress.push(progressInfo);\r\n        } else {\r\n          /** @type {TranslationStatus} */\r\n          let status = \"translating\";\r\n          /** @type {() => void} */\r\n          let promise_resolve = null;\r\n\r\n          /** @type {TranslationInfo} */\r\n          const progressInfo = {\r\n            originalText: requestString,\r\n            translatedText: null,\r\n            detectedLanguage: null,\r\n            get status() {\r\n              return status;\r\n            },\r\n            set status(_status) {\r\n              status = _status;\r\n              promise_resolve();\r\n            },\r\n            waitTranlate: new Promise((resolve) => (promise_resolve = resolve)),\r\n          };\r\n\r\n          currentTranslationsInProgress.push(progressInfo);\r\n          this.translationsInProgress.set(requestHash, progressInfo);\r\n\r\n          //cast\r\n          const cacheEntry = await translationCache.get(\r\n            this.serviceName,\r\n            sourceLanguage,\r\n            targetLanguage,\r\n            requestString\r\n          );\r\n          if (cacheEntry) {\r\n            progressInfo.translatedText = cacheEntry.translatedText;\r\n            progressInfo.detectedLanguage = cacheEntry.detectedLanguage;\r\n            progressInfo.status = \"complete\";\r\n            //this.translationsInProgress.delete([sourceLanguage, targetLanguage, requestString])\r\n          } else {\r\n            currentRequest.push(progressInfo);\r\n            currentSize += progressInfo.originalText.length;\r\n            if (currentSize > 800) {\r\n              requests.push(currentRequest);\r\n              currentSize = 0;\r\n              currentRequest = [];\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if (currentRequest.length > 0) {\r\n        requests.push(currentRequest);\r\n        currentRequest = [];\r\n        currentSize = 0;\r\n      }\r\n\r\n      return [requests, currentTranslationsInProgress];\r\n    }\r\n\r\n    /**\r\n     * Makes a request using the *XMLHttpRequest* API. Returns a promise that will be resolved with the result of the request. If the request fails, the promise will be rejected.\r\n     * @param {string} sourceLanguage\r\n     * @param {string} targetLanguage\r\n     * @param {Array<TranslationInfo>} requests\r\n     * @returns {Promise<*>}\r\n     */\r\n    async makeRequest(sourceLanguage, targetLanguage, requests) {\r\n      return await new Promise((resolve, reject) => {\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.open(\r\n          this.xhrMethod,\r\n          this.baseURL +\r\n            (this.cbGetExtraParameters\r\n              ? this.cbGetExtraParameters(\r\n                  sourceLanguage,\r\n                  targetLanguage,\r\n                  requests\r\n                )\r\n              : \"\")\r\n        );\r\n\r\n        if (this.cbGetExtraHeaders) {\r\n          const headers = this.cbGetExtraHeaders();\r\n          headers.forEach((header) => {\r\n            xhr.setRequestHeader(header.name, header.value);\r\n          });\r\n        }\r\n\r\n        xhr.responseType = \"json\";\r\n\r\n        xhr.onload = (event) => {\r\n          resolve(xhr.response);\r\n        };\r\n\r\n        xhr.onerror =\r\n          xhr.onabort =\r\n          xhr.ontimeout =\r\n            (event) => {\r\n              console.error(event);\r\n              reject();\r\n            };\r\n\r\n        xhr.send(\r\n          this.cbGetRequestBody\r\n            ? this.cbGetRequestBody(sourceLanguage, targetLanguage, requests)\r\n            : undefined\r\n        );\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Translates the `sourceArray2d`.\r\n     *\r\n     * If `dontSaveInPersistentCache` is **true** then the translation result will not be saved in the on-disk translation cache, only in the in-memory cache.\r\n     *\r\n     * The `dontSortResults` parameter is only valid when using the ***google*** translation service, if its value is **true** then the translation result will not be sorted.\r\n     * @param {string} sourceLanguage\r\n     * @param {string} targetLanguage\r\n     * @param {Array<string[]>} sourceArray2d\r\n     * @param {boolean} dontSaveInPersistentCache\r\n     * @param {boolean} dontSortResults\r\n     * @returns {Promise<string[][]>}\r\n     */\r\n    async translate(\r\n      sourceLanguage,\r\n      targetLanguage,\r\n      sourceArray2d,\r\n      dontSaveInPersistentCache = false,\r\n      dontSortResults = false\r\n    ) {\r\n      const [requests, currentTranslationsInProgress] = await this.getRequests(\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        sourceArray2d\r\n      );\r\n      /** @type {Promise<void>[]} */\r\n      const promises = [];\r\n\r\n      for (const request of requests) {\r\n        promises.push(\r\n          this.makeRequest(sourceLanguage, targetLanguage, request)\r\n            .then((response) => {\r\n              const results = this.cbParseResponse(response);\r\n              for (const idx in request) {\r\n                const result = results[idx];\r\n                this.cbTransformResponse(result.text, dontSortResults); // apenas para gerar error\r\n                const transInfo = request[idx];\r\n                transInfo.detectedLanguage = result.detectedLanguage || \"und\";\r\n                transInfo.translatedText = result.text;\r\n                transInfo.status = \"complete\";\r\n\r\n                if (\r\n                  dontSaveInPersistentCache === false &&\r\n                  transInfo.translatedText\r\n                ) {\r\n                  translationCache.set(\r\n                    this.serviceName,\r\n                    sourceLanguage,\r\n                    targetLanguage,\r\n                    transInfo.originalText,\r\n                    transInfo.translatedText,\r\n                    transInfo.detectedLanguage\r\n                  );\r\n                }\r\n              }\r\n            })\r\n            .catch((e) => {\r\n              console.error(e);\r\n              for (const transInfo of request) {\r\n                transInfo.status = \"error\";\r\n                //this.translationsInProgress.delete([sourceLanguage, targetLanguage, transInfo.originalText])\r\n              }\r\n            })\r\n        );\r\n      }\r\n      await Promise.all(\r\n        currentTranslationsInProgress.map((transInfo) => transInfo.waitTranlate)\r\n      );\r\n      return currentTranslationsInProgress.map((transInfo) =>\r\n        this.cbTransformResponse(transInfo.translatedText, dontSortResults)\r\n      );\r\n    }\r\n\r\n    /**\r\n     * https://github.com/FilipePS/Traduzir-paginas-web/issues/484\r\n     * @param {string} str\r\n     * @returns {string} fixedStr\r\n     */\r\n    fixString(str) {\r\n      return str.replace(/\\u200b/g, \" \");\r\n    }\r\n  }\r\n\r\n  const googleService = new (class extends Service {\r\n    constructor() {\r\n      super(\r\n        \"google\",\r\n        \"https://translate.googleapis.com/translate_a/t?anno=3&client=te&v=1.0&format=html\",\r\n        \"POST\",\r\n        function cbTransformRequest(sourceArray) {\r\n          sourceArray = sourceArray.map((text) => Utils.escapeHTML(text));\r\n          if (sourceArray.length > 1) {\r\n            sourceArray = sourceArray.map(\r\n              (text, index) => `<a i=${index}>${text}</a>`\r\n            );\r\n          }\r\n          // the <pre> tag is to preserve the text formating\r\n          return `<pre>${sourceArray.join(\"\")}</pre>`;\r\n        },\r\n        function cbParseResponse(response) {\r\n          /** @type {[Service_Single_Result_Response]} */\r\n          let responseJson;\r\n          if (typeof response === \"string\") {\r\n            responseJson = [{ text: response, detectedLanguage: null }];\r\n          } else if (typeof response[0] === \"string\") {\r\n            responseJson = response.map(\r\n              /** @returns {Service_Single_Result_Response} */ (\r\n                /** @type {string} */ value\r\n              ) => ({ text: value, detectedLanguage: null })\r\n            );\r\n          } else {\r\n            responseJson = response.map(\r\n              /** @returns {Service_Single_Result_Response} */ (\r\n                /** @type {[string, string]} */ value\r\n              ) => ({ text: value[0], detectedLanguage: value[1] })\r\n            );\r\n          }\r\n          return responseJson;\r\n        },\r\n        function cbTransformResponse(result, dontSortResults) {\r\n          // remove the <pre> tag from the response\r\n          if (result.indexOf(\"<pre\") !== -1) {\r\n            result = result.replace(\"</pre>\", \"\");\r\n            const index = result.indexOf(\">\");\r\n            result = result.slice(index + 1);\r\n          }\r\n\r\n          /** @type {string[]} */\r\n          const sentences = []; // each translated sentence is inside of <b> tag\r\n\r\n          // The main objective is to remove the original text of each sentense that is inside the <i> tags.\r\n          // Keeping only the <a> tags\r\n          let idx = 0;\r\n          while (true) {\r\n            // each translated sentence is inside of <b> tag\r\n            const sentenceStartIndex = result.indexOf(\"<b>\", idx);\r\n            if (sentenceStartIndex === -1) break;\r\n\r\n            // the <i> tag is the original text in each sentence\r\n            const sentenceFinalIndex = result.indexOf(\r\n              \"<i>\",\r\n              sentenceStartIndex\r\n            );\r\n\r\n            if (sentenceFinalIndex === -1) {\r\n              sentences.push(result.slice(sentenceStartIndex + 3));\r\n              break;\r\n            } else {\r\n              sentences.push(\r\n                result.slice(sentenceStartIndex + 3, sentenceFinalIndex)\r\n              );\r\n            }\r\n            idx = sentenceFinalIndex;\r\n          }\r\n\r\n          // maybe the response don't have any sentence (does not have <i> and <b> tags), is this case just use de result\r\n          result = sentences.length > 0 ? sentences.join(\" \") : result;\r\n          // Remove the remaining </b> tags (usually the last)\r\n          result = result.replace(/\\<\\/b\\>/g, \"\");\r\n          // Capture each <a i={number}> and put it in an array, the </a> will be ignored\r\n          // maybe the same index appears several times\r\n          // maybe some text will be outside of <a i={number}> (Usually text before the first <a> tag, and some whitespace between the <a> tags),\r\n          // in this case, The outside text will be placed inside the <a i={number}> closer\r\n          // https://github.com/FilipePS/Traduzir-paginas-web/issues/449\r\n          // TODO lidar com tags dentro de tags e tags vazias\r\n          // https://de.wikipedia.org/wiki/Wikipedia:Hauptseite\r\n          // \"{\\\"originalText\\\":\\\"<pre><a i=0>\\\\nFür den </a><a i=1>37. Schreib­wettbewerb</a><a i=2> und den </a><a i=3>18. Miniaturwettbewerb</a><a i=4> können ab sofort Artikel nominiert werden.</a></pre>\\\",\\\"translatedText\\\":\\\"<pre><a i=0>\\\\n</a>Artigos já podem ser indicados <a i=0>para o</a> <a i=1>37º Concurso de Redação <a i=2>e</a></a> <a i=3><a i=4>18º</a> Concurso de Miniaturas</a> .</pre>\\\",\\\"detectedLanguage\\\":\\\"de\\\",\\\"status\\\":\\\"complete\\\",\\\"waitTranlate\\\":{}}\"\r\n          let resultArray = [];\r\n          let lastEndPos = 0;\r\n          for (const r of result.matchAll(\r\n            /(\\<a\\si\\=[0-9]+\\>)([^\\<\\>]*(?=\\<\\/a\\>))*/g\r\n          )) {\r\n            const fullText = r[0];\r\n            const fullLength = r[0].length;\r\n            const pos = r.index;\r\n            // if it is bigger then it has text outside the tags\r\n            if (pos > lastEndPos) {\r\n              const aTag = r[1];\r\n              const insideText = r[2] || \"\";\r\n              const outsideText = result\r\n                .slice(lastEndPos, pos)\r\n                .replace(/\\<\\/a\\>/g, \"\");\r\n              resultArray.push(aTag + outsideText + insideText);\r\n            } else {\r\n              resultArray.push(fullText);\r\n            }\r\n            lastEndPos = pos + fullLength;\r\n          }\r\n\r\n          // captures the final text outside the <a> tag\r\n          {\r\n            const lastOutsideText = result\r\n              .slice(lastEndPos)\r\n              .replace(/\\<\\/a\\>/g, \"\");\r\n            if (resultArray.length > 0) {\r\n              resultArray[resultArray.length - 1] += lastOutsideText;\r\n            }\r\n          }\r\n          // this is the old method, don't capture text outside of <a> tags\r\n          // let resultArray = result.match(\r\n          //   /\\<a\\si\\=[0-9]+\\>[^\\<\\>]*(?=\\<\\/a\\>)/g\r\n          // );\r\n\r\n          let indexes;\r\n          // each inline tag has a index starting with 0 <a i={number}>\r\n          if (resultArray && resultArray.length > 0) {\r\n            // get the indexed of <a i={number}>\r\n            indexes = resultArray\r\n              .map((value) => parseInt(value.match(/[0-9]+(?=\\>)/g)[0]))\r\n              .filter((value) => !isNaN(value));\r\n            // get the text inside of <a i={number}>\r\n            resultArray = resultArray.map((value) => {\r\n              const resultStartAtIndex = value.indexOf(\">\");\r\n              return value.slice(resultStartAtIndex + 1);\r\n            });\r\n          } else {\r\n            // maybe the response don't have any <a i={number}>\r\n            resultArray = [result];\r\n            indexes = [0];\r\n          }\r\n\r\n          // unescapeHTML\r\n          resultArray = resultArray.map((value) => Utils.unescapeHTML(value));\r\n\r\n          if (dontSortResults) {\r\n            // Should not sort the <a i={number}> of Google Translate result\r\n            // Instead of it, join the texts without sorting\r\n            // https://github.com/FilipePS/Traduzir-paginas-web/issues/163\r\n\r\n            // /** @type {string[]} */\r\n            // const finalResulArray = [];\r\n\r\n            // for (const j in indexes) {\r\n            //   finalResulArray[indexes[j]] = \"\";\r\n            // }\r\n\r\n            // resultArray.forEach((text, i) => {\r\n            //   finalResulArray[\r\n            //     Math.floor(i * (finalResulArray.length / resultArray.length))\r\n            //   ] += text;\r\n            // });\r\n\r\n            // return finalResulArray;\r\n            return resultArray;\r\n          } else {\r\n            // Sort Google translate results to keep the links with the correct name\r\n            // Note: the links may also disappear; http://web.archive.org/web/20220919162911/https://de.wikipedia.org/wiki/Wikipedia:Hauptseite\r\n\r\n            /** @type {string[]} */\r\n            const finalResulArray = [];\r\n\r\n            for (const j in indexes) {\r\n              if (finalResulArray[indexes[j]]) {\r\n                finalResulArray[indexes[j]] += \" \" + resultArray[j];\r\n              } else {\r\n                finalResulArray[indexes[j]] = resultArray[j];\r\n              }\r\n            }\r\n\r\n            return finalResulArray;\r\n          }\r\n        },\r\n        function cbGetExtraParameters(\r\n          sourceLanguage,\r\n          targetLanguage,\r\n          requests\r\n        ) {\r\n          return `&sl=${sourceLanguage}&tl=${targetLanguage}&tk=${GoogleHelper.calcHash(\r\n            requests.map((info) => info.originalText).join(\"\")\r\n          )}`;\r\n        },\r\n        function cbGetRequestBody(sourceLanguage, targetLanguage, requests) {\r\n          return requests\r\n            .map((info) => `&q=${encodeURIComponent(info.originalText)}`)\r\n            .join(\"\");\r\n        },\r\n        function cbGetExtraHeaders() {\r\n          return [\r\n            {\r\n              name: \"Content-Type\",\r\n              value: \"application/x-www-form-urlencoded\",\r\n            },\r\n          ];\r\n        }\r\n      );\r\n    }\r\n  })();\r\n\r\n  const yandexService = new (class extends Service {\r\n    constructor() {\r\n      super(\r\n        \"yandex\",\r\n        \"https://translate.yandex.net/api/v1/tr.json/translate?srv=tr-url-widget\",\r\n        \"GET\",\r\n        function cbTransformRequest(sourceArray) {\r\n          return sourceArray\r\n            .map((value) => Utils.escapeHTML(value))\r\n            .join(\"<wbr>\");\r\n        },\r\n        function cbParseResponse(response) {\r\n          const lang = response.lang;\r\n          const detectedLanguage = lang ? lang.split(\"-\")[0] : null;\r\n          return response.text.map(\r\n            /** @return {Service_Single_Result_Response} */ (\r\n              /** @type {string} */ text\r\n            ) => ({ text, detectedLanguage })\r\n          );\r\n        },\r\n        function cbTransformResponse(result, dontSortResults) {\r\n          return result\r\n            .split(\"<wbr>\")\r\n            .map((value) => Utils.unescapeHTML(value));\r\n        },\r\n        function cbGetExtraParameters(\r\n          sourceLanguage,\r\n          targetLanguage,\r\n          requests\r\n        ) {\r\n          return `&id=${YandexHelper.translateSid}-0-0&format=html&lang=${\r\n            sourceLanguage === \"auto\" ? \"\" : sourceLanguage + \"-\"\r\n          }${targetLanguage}${requests\r\n            .map((info) => `&text=${encodeURIComponent(info.originalText)}`)\r\n            .join(\"\")}`;\r\n        },\r\n        function cbGetRequestBody(sourceLanguage, targetLanguage, requests) {\r\n          return undefined;\r\n        },\r\n        function cbGetExtraHeaders() {\r\n          return [\r\n            {\r\n              name: \"Content-Type\",\r\n              value: \"application/x-www-form-urlencoded\",\r\n            },\r\n          ];\r\n        }\r\n      );\r\n    }\r\n\r\n    /**\r\n     * @param {boolean} dontSortResults This parameter is not needed in this translation service\r\n     */\r\n    async translate(\r\n      sourceLanguage,\r\n      targetLanguage,\r\n      sourceArray2d,\r\n      dontSaveInPersistentCache,\r\n      dontSortResults = false\r\n    ) {\r\n      await YandexHelper.findSID();\r\n      if (!YandexHelper.translateSid) return;\r\n      sourceLanguage = sourceLanguage.split(\"-\")[0];\r\n      targetLanguage = targetLanguage.split(\"-\")[0];\r\n      return await super.translate(\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        sourceArray2d,\r\n        dontSaveInPersistentCache,\r\n        dontSortResults\r\n      );\r\n    }\r\n  })();\r\n\r\n  const bingService = new (class extends Service {\r\n    constructor() {\r\n      super(\r\n        \"bing\",\r\n        \"https://api-edge.cognitive.microsofttranslator.com/translate?api-version=3.0&includeSentenceLength=true\",\r\n        \"POST\",\r\n        function cbTransformRequest(sourceArray) {\r\n          let id = 10;\r\n          return sourceArray\r\n            .map((value) => {\r\n              const r = `<b${id}>${Utils.escapeHTML(value)}</b${id}>`;\r\n              id++;\r\n              return r;\r\n            })\r\n            .join(\"\");\r\n        },\r\n        function cbParseResponse(response) {\r\n          return response.map(\r\n            /** @return {Service_Single_Result_Response} */\r\n            (/** @type {object} */ r) => ({\r\n              text: r.translations[0].text,\r\n              detectedLanguage: r.detectedLanguage?.language,\r\n            })\r\n          );\r\n        },\r\n        function cbTransformResponse(result, dontSortResults) {\r\n          const resultArray = [];\r\n\r\n          const parser = new DOMParser();\r\n          const doc = parser.parseFromString(result, \"text/html\");\r\n          let currText = \"\";\r\n          doc.body.childNodes.forEach((node) => {\r\n            if (dontSortResults) {\r\n              if (node.nodeName == \"#text\") {\r\n                currText += node.textContent;\r\n              } else {\r\n                resultArray.push(currText + node.textContent);\r\n                currText = \"\";\r\n              }\r\n            } else {\r\n              if (node.nodeName == \"#text\") {\r\n                currText += node.textContent;\r\n              } else {\r\n                const id = parseInt(node.nodeName.slice(1)) - 10;\r\n                resultArray[id] = currText + node.textContent;\r\n                currText = \"\";\r\n              }\r\n            }\r\n          });\r\n\r\n          return resultArray;\r\n        },\r\n        function cbGetExtraParameters(\r\n          sourceLanguage,\r\n          targetLanguage,\r\n          requests\r\n        ) {\r\n          return `${\r\n            sourceLanguage !== \"auto-detect\" ? \"&from=\" + sourceLanguage : \"\"\r\n          }&to=${targetLanguage}`;\r\n        },\r\n        function cbGetRequestBody(sourceLanguage, targetLanguage, requests) {\r\n          return JSON.stringify(\r\n            requests.map((info) => ({\r\n              text: info.originalText,\r\n            }))\r\n          );\r\n        },\r\n        function cbGetExtraHeaders() {\r\n          return [\r\n            {\r\n              name: \"Content-Type\",\r\n              value: \"application/json\",\r\n            },\r\n            {\r\n              name: \"authorization\",\r\n              value: \"Bearer \" + BingHelper.translateAuth,\r\n            },\r\n          ];\r\n        }\r\n      );\r\n    }\r\n\r\n    /**\r\n     * @param {string[][]} sourceArray2d - Only the string `sourceArray2d[0][0]` will be translated.\r\n     * @param {boolean} dontSortResults - This parameter is not needed in this translation service\r\n     */\r\n    async translate(\r\n      sourceLanguage,\r\n      targetLanguage,\r\n      sourceArray2d,\r\n      dontSaveInPersistentCache,\r\n      dontSortResults = false\r\n    ) {\r\n      /** @type {{search: string, replace: string}[]} */\r\n      const replacements = [\r\n        {\r\n          search: \"auto\",\r\n          replace: \"auto-detect\",\r\n        },\r\n        {\r\n          search: \"zh-CN\",\r\n          replace: \"zh-Hans\",\r\n        },\r\n        {\r\n          search: \"zh-TW\",\r\n          replace: \"zh-Hant\",\r\n        },\r\n        {\r\n          search: \"tl\",\r\n          replace: \"fil\",\r\n        },\r\n        {\r\n          search: \"hmn\",\r\n          replace: \"mww\",\r\n        },\r\n        {\r\n          search: \"ku\",\r\n          replace: \"kmr\",\r\n        },\r\n        {\r\n          search: \"ckb\",\r\n          replace: \"ku\",\r\n        },\r\n        {\r\n          search: \"mn\",\r\n          replace: \"mn-Cyrl\",\r\n        },\r\n        {\r\n          search: \"no\",\r\n          replace: \"nb\",\r\n        },\r\n        {\r\n          search: \"lg\",\r\n          replace: \"lug\",\r\n        },\r\n        {\r\n          search: \"sr\",\r\n          replace: \"sr-Cyrl\",\r\n        },\r\n        {\r\n          search: \"mni-Mtei\",\r\n          replace: \"mni\",\r\n        },\r\n      ];\r\n      replacements.forEach((r) => {\r\n        if (targetLanguage === r.search) {\r\n          targetLanguage = r.replace;\r\n        }\r\n        if (sourceLanguage === r.search) {\r\n          sourceLanguage = r.replace;\r\n        }\r\n      });\r\n\r\n      await BingHelper.findAuth();\r\n      if (!BingHelper.translateAuth) return;\r\n\r\n      return await super.translate(\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        sourceArray2d,\r\n        dontSaveInPersistentCache,\r\n        dontSortResults\r\n      );\r\n    }\r\n  })();\r\n\r\n  const deeplService = new (class {\r\n    constructor() {\r\n      this.DeepLTab = null;\r\n    }\r\n    /**\r\n     *\r\n     * @param {string} sourceLanguage - This parameter is not used\r\n     * @param {*} targetLanguage\r\n     * @param {*} sourceArray2d - Only the string `sourceArray2d[0][0]` will be translated.\r\n     * @param {*} dontSaveInPersistentCache - This parameter is not used\r\n     * @param {*} dontSortResults - This parameter is not used\r\n     * @returns\r\n     */\r\n    async translate(\r\n      sourceLanguage,\r\n      targetLanguage,\r\n      sourceArray2d,\r\n      dontSaveInPersistentCache,\r\n      dontSortResults = false\r\n    ) {\r\n      if (targetLanguage === \"pt\") {\r\n        targetLanguage = \"pt-BR\";\r\n      } else if (targetLanguage === \"no\") {\r\n        targetLanguage = \"nb\";\r\n      } else if (targetLanguage.startsWith(\"zh-\")) {\r\n        targetLanguage = \"zh\";\r\n      } else if (targetLanguage.startsWith(\"fr-\")) {\r\n        targetLanguage = \"fr\";\r\n      }\r\n\r\n      return await new Promise((resolve) => {\r\n        const waitFirstTranslationResult = () => {\r\n          const listener = (request, sender, sendResponse) => {\r\n            if (request.action === \"DeepL_firstTranslationResult\") {\r\n              resolve([[request.result]]);\r\n              chrome.runtime.onMessage.removeListener(listener);\r\n            }\r\n          };\r\n          chrome.runtime.onMessage.addListener(listener);\r\n\r\n          setTimeout(() => {\r\n            chrome.runtime.onMessage.removeListener(listener);\r\n            resolve([[\"\"]]);\r\n          }, 8000);\r\n        };\r\n\r\n        if (this.DeepLTab) {\r\n          chrome.tabs.get(this.DeepLTab.id, (tab) => {\r\n            checkedLastError();\r\n            if (tab) {\r\n              //chrome.tabs.update(tab.id, {active: true})\r\n              chrome.tabs.sendMessage(\r\n                tab.id,\r\n                {\r\n                  action: \"translateTextWithDeepL\",\r\n                  text: sourceArray2d[0][0],\r\n                  targetLanguage,\r\n                },\r\n                {\r\n                  frameId: 0,\r\n                },\r\n                (response) => {\r\n                  checkedLastError();\r\n                  resolve([[response]]);\r\n                }\r\n              );\r\n            } else {\r\n              tabsCreate(\r\n                `https://www.deepl.com/#!${targetLanguage}!#${encodeURIComponent(\r\n                  sourceArray2d[0][0]\r\n                )}`,\r\n                (tab) => {\r\n                  this.DeepLTab = tab;\r\n                  waitFirstTranslationResult();\r\n                }\r\n              );\r\n              // resolve([[\"\"]])\r\n            }\r\n          });\r\n        } else {\r\n          tabsCreate(\r\n            `https://www.deepl.com/#!${targetLanguage}!#${encodeURIComponent(\r\n              sourceArray2d[0][0]\r\n            )}`,\r\n            (tab) => {\r\n              this.DeepLTab = tab;\r\n              waitFirstTranslationResult();\r\n            }\r\n          );\r\n          // resolve([[\"\"]])\r\n        }\r\n      });\r\n    }\r\n  })();\r\n\r\n  /**\r\n   * Creates the libreTranslate translation service from URL and apiKey\r\n   * @param {string} url\r\n   * @param {string} apiKey\r\n   * @returns {Service} libreService\r\n   */\r\n  const createLibreService = (url, apiKey) => {\r\n    return new (class extends Service {\r\n      constructor() {\r\n        super(\r\n          \"libre\",\r\n          url,\r\n          \"POST\",\r\n          function cbTransformRequest(sourceArray) {\r\n            return sourceArray[0];\r\n          },\r\n          function cbParseResponse(response) {\r\n            return [\r\n              {\r\n                text: response.translatedText,\r\n                detectedLanguage: response.detectedLanguage.language,\r\n              },\r\n            ];\r\n          },\r\n          function cbTransformResponse(result, dontSortResults) {\r\n            return [result];\r\n          },\r\n          null,\r\n          function cbGetRequestBody(sourceLanguage, targetLanguage, requests) {\r\n            const params = new URLSearchParams();\r\n            params.append(\"q\", requests[0].originalText);\r\n            params.append(\"source\", sourceLanguage);\r\n            params.append(\"target\", targetLanguage);\r\n            params.append(\"format\", \"text\");\r\n            params.append(\"api_key\", apiKey);\r\n            return params.toString();\r\n          },\r\n          function cbGetExtraHeaders() {\r\n            return [\r\n              {\r\n                name: \"Content-Type\",\r\n                value: \"application/x-www-form-urlencoded\",\r\n              },\r\n            ];\r\n          }\r\n        );\r\n      }\r\n\r\n      /**\r\n       *\r\n       * @param {string} sourceLanguage - This parameter is not used\r\n       * @param {*} targetLanguage\r\n       * @param {*} sourceArray2d - Only the string `sourceArray2d[0][0]` will be translated.\r\n       * @param {*} dontSaveInPersistentCache - This parameter is not used\r\n       * @param {*} dontSortResults - This parameter is not used\r\n       * @returns\r\n       */\r\n      /*\r\n      async translate(\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        sourceArray2d,\r\n        dontSaveInPersistentCache,\r\n        dontSortResults = false\r\n      ) {\r\n      }\r\n      //*/\r\n    })();\r\n  };\r\n\r\n  /**\r\n   * Creates the DeepLFreeApi translation service\r\n   * @param {string} apiKey\r\n   * @returns {Service} libreService\r\n   */\r\n  const createDeeplFreeApiService = (apiKey) => {\r\n    return new (class extends Service {\r\n      constructor() {\r\n        super(\r\n          \"deepl\",\r\n          \"https://api-free.deepl.com/v2/translate\",\r\n          \"POST\",\r\n          function cbTransformRequest(sourceArray) {\r\n            return sourceArray[0];\r\n          },\r\n          function cbParseResponse(response) {\r\n            return [\r\n              {\r\n                text: response.translations[0].text,\r\n                detectedLanguage:\r\n                  response.translations[0].detected_source_language,\r\n              },\r\n            ];\r\n          },\r\n          function cbTransformResponse(result, dontSortResults) {\r\n            return [result];\r\n          },\r\n          null,\r\n          function cbGetRequestBody(sourceLanguage, targetLanguage, requests) {\r\n            const params = new URLSearchParams();\r\n            params.append(\"text\", requests[0].originalText);\r\n            if (sourceLanguage !== \"auto\") {\r\n              // params.append(\"source_lang\", sourceLanguage);\r\n            }\r\n            if (targetLanguage === \"pt\") {\r\n              targetLanguage = \"pt-BR\";\r\n            } else if (targetLanguage === \"no\") {\r\n              targetLanguage = \"nb\";\r\n            } else if (targetLanguage.startsWith(\"zh-\")) {\r\n              targetLanguage = \"zh\";\r\n            } else if (targetLanguage.startsWith(\"fr-\")) {\r\n              targetLanguage = \"fr\";\r\n            }\r\n            params.append(\"target_lang\", targetLanguage);\r\n            return params.toString();\r\n          },\r\n          function cbGetExtraHeaders() {\r\n            return [\r\n              {\r\n                name: \"Content-Type\",\r\n                value: \"application/x-www-form-urlencoded\",\r\n              },\r\n              {\r\n                name: \"Authorization\",\r\n                value: \"DeepL-Auth-Key \" + apiKey,\r\n              },\r\n            ];\r\n          }\r\n        );\r\n      }\r\n\r\n      /**\r\n       *\r\n       * @param {string} sourceLanguage - This parameter is not used\r\n       * @param {*} targetLanguage\r\n       * @param {*} sourceArray2d - Only the string `sourceArray2d[0][0]` will be translated.\r\n       * @param {*} dontSaveInPersistentCache - This parameter is not used\r\n       * @param {*} dontSortResults - This parameter is not used\r\n       * @returns\r\n       */\r\n      /*\r\n      async translate(\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        sourceArray2d,\r\n        dontSaveInPersistentCache,\r\n        dontSortResults = false\r\n      ) {\r\n      }\r\n      //*/\r\n    })();\r\n  };\r\n\r\n  /** @type {Map<string, Service>} */\r\n  const serviceList = new Map();\r\n\r\n  serviceList.set(\"google\", googleService);\r\n  serviceList.set(\"yandex\", yandexService);\r\n  serviceList.set(\"bing\", bingService);\r\n  serviceList.set(\r\n    \"deepl\",\r\n    /** @type {Service} */ /** @type {?} */ (deeplService)\r\n  );\r\n\r\n  /**\r\n   * Get translation service from your name\r\n   * Make sure the service is enabled\r\n   * @param {string} serviceName\r\n   * @returns {Service} service\r\n   */\r\n  const getSafeServiceByName = (serviceName) => {\r\n    if (\r\n      twpConfig.get(\"enabledServices\").includes(serviceName) ||\r\n      twpConfig.get(\"customServices\").find((cs) => cs.name === serviceName)\r\n    ) {\r\n      return serviceList.get(serviceName);\r\n    } else {\r\n      return null;\r\n    }\r\n  };\r\n\r\n  translationService.translateHTML = async (\r\n    serviceName,\r\n    sourceLanguage,\r\n    targetLanguage,\r\n    sourceArray2d,\r\n    dontSaveInPersistentCache = false,\r\n    dontSortResults = false\r\n  ) => {\r\n    serviceName = twpLang.getAlternativeService(\r\n      targetLanguage,\r\n      serviceName,\r\n      true\r\n    );\r\n    const service = getSafeServiceByName(serviceName);\r\n    return await service.translate(\r\n      sourceLanguage,\r\n      targetLanguage,\r\n      sourceArray2d,\r\n      dontSaveInPersistentCache,\r\n      dontSortResults\r\n    );\r\n  };\r\n\r\n  translationService.translateText = async (\r\n    serviceName,\r\n    sourceLanguage,\r\n    targetLanguage,\r\n    sourceArray,\r\n    dontSaveInPersistentCache = false\r\n  ) => {\r\n    serviceName = twpLang.getAlternativeService(\r\n      targetLanguage,\r\n      serviceName,\r\n      false\r\n    );\r\n    const service = getSafeServiceByName(serviceName);\r\n    return (\r\n      await service.translate(\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        sourceArray.map((text) => [text]),\r\n        dontSaveInPersistentCache\r\n      )\r\n    ).map((result) => result[0]);\r\n  };\r\n\r\n  translationService.translateSingleText = async (\r\n    serviceName,\r\n    sourceLanguage,\r\n    targetLanguage,\r\n    originalText,\r\n    dontSaveInPersistentCache = false\r\n  ) => {\r\n    serviceName = twpLang.getAlternativeService(\r\n      targetLanguage,\r\n      serviceName,\r\n      false\r\n    );\r\n    const service = getSafeServiceByName(serviceName);\r\n    return (\r\n      await service.translate(\r\n        sourceLanguage,\r\n        targetLanguage,\r\n        [[originalText]],\r\n        dontSaveInPersistentCache\r\n      )\r\n    )[0][0];\r\n  };\r\n\r\n  chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\r\n    // If the translation request came from an incognito window, the translation should not be cached on disk.\r\n    let dontSaveInPersistentCache = true;\r\n    if (twpConfig.get(\"enableDiskCache\") !== \"yes\") {\r\n      dontSaveInPersistentCache = true;\r\n    } else {\r\n      dontSaveInPersistentCache = sender.tab ? sender.tab.incognito : false;\r\n    }\r\n\r\n    if (request.action === \"translateHTML\") {\r\n      translationService\r\n        .translateHTML(\r\n          request.translationService,\r\n          request.sourceLanguage,\r\n          request.targetLanguage,\r\n          request.sourceArray2d,\r\n          dontSaveInPersistentCache,\r\n          request.dontSortResults\r\n        )\r\n        .then((results) => sendResponse(results))\r\n        .catch((e) => {\r\n          sendResponse();\r\n          console.error(e);\r\n        });\r\n\r\n      return true;\r\n    } else if (request.action === \"translateText\") {\r\n      translationService\r\n        .translateText(\r\n          request.translationService,\r\n          request.sourceLanguage,\r\n          request.targetLanguage,\r\n          request.sourceArray,\r\n          dontSaveInPersistentCache\r\n        )\r\n        .then((results) => sendResponse(results))\r\n        .catch((e) => {\r\n          sendResponse();\r\n          console.error(e);\r\n        });\r\n\r\n      return true;\r\n    } else if (request.action === \"translateSingleText\") {\r\n      translationService\r\n        .translateSingleText(\r\n          request.translationService,\r\n          request.sourceLanguage,\r\n          request.targetLanguage,\r\n          request.source,\r\n          dontSaveInPersistentCache\r\n        )\r\n        .then((results) => sendResponse(results))\r\n        .catch((e) => {\r\n          sendResponse();\r\n          console.error(e);\r\n        });\r\n\r\n      return true;\r\n    } else if (request.action === \"removeTranslationsWithError\") {\r\n      serviceList.forEach((service) => {\r\n        if (service.removeTranslationsWithError) {\r\n          service.removeTranslationsWithError();\r\n        }\r\n      });\r\n    } else if (request.action === \"createLibreService\") {\r\n      serviceList.set(\r\n        \"libre\",\r\n        createLibreService(request.libre.url, request.libre.apiKey)\r\n      );\r\n    } else if (request.action === \"removeLibreService\") {\r\n      serviceList.delete(\"libre\");\r\n    } else if (request.action === \"createDeeplFreeApiService\") {\r\n      serviceList.set(\r\n        \"deepl\",\r\n        createDeeplFreeApiService(request.deepl_freeapi.apiKey)\r\n      );\r\n    } else if (request.action === \"removeDeeplFreeApiService\") {\r\n      serviceList.set(\r\n        \"deepl\",\r\n        /** @type {Service} */ /** @type {?} */ (deeplService)\r\n      );\r\n    }\r\n  });\r\n\r\n  twpConfig.onReady(function () {\r\n    if (twpConfig.get(\"customServices\").find((cs) => cs.name === \"libre\")) {\r\n      const libre = twpConfig\r\n        .get(\"customServices\")\r\n        .find((cs) => cs.name === \"libre\");\r\n      serviceList.set(\"libre\", createLibreService(libre.url, libre.apiKey));\r\n    }\r\n\r\n    if (\r\n      twpConfig.get(\"customServices\").find((cs) => cs.name === \"deepl_freeapi\")\r\n    ) {\r\n      const deepl_freeapi = twpConfig\r\n        .get(\"customServices\")\r\n        .find((cs) => cs.name === \"deepl_freeapi\");\r\n      serviceList.set(\"deepl\", createDeeplFreeApiService(deepl_freeapi.apiKey));\r\n    }\r\n\r\n    const proxyServers = twpConfig.get(\"proxyServers\");\r\n    if (proxyServers?.google?.translateServer) {\r\n      const url = new URL(googleService.baseURL);\r\n      url.host = proxyServers.google.translateServer;\r\n      googleService.baseURL = url.toString();\r\n    }\r\n  });\r\n\r\n  twpConfig.onChanged((name, newValue) => {\r\n    if (name === \"proxyServers\") {\r\n      if (newValue?.google?.translateServer) {\r\n        const url = new URL(googleService.baseURL);\r\n        url.host = newValue.google.translateServer;\r\n        googleService.baseURL = url.toString();\r\n      } else {\r\n        const url = new URL(googleService.baseURL);\r\n        url.host = \"translate.googleapis.com\";\r\n        googleService.baseURL = url.toString();\r\n      }\r\n    }\r\n  });\r\n\r\n  return translationService;\r\n})();\r\n"],"mappings":"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","ignoreList":[]}